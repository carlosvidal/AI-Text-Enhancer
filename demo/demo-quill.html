<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AI Text Enhancer - Demo Quill</title>
    <link rel="stylesheet" href="css/common-styles.css" />

    <!-- Quill -->
    <link
      href="https://cdn.quilljs.com/1.3.6/quill.snow.css"
      rel="stylesheet"
    />
    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>

    <style>
      /* Editor specific styles */
      .ql-container {
        font-size: 0.875rem;
        font-family: inherit;
      }

      .ql-toolbar {
        border-top-left-radius: 6px;
        border-top-right-radius: 6px;
      }

      .ql-container {
        border-bottom-left-radius: 6px;
        border-bottom-right-radius: 6px;
      }

      /* Estilo para botón AI en Quill */
      .ql-ai-enhancer svg {
        fill: none;
        stroke: currentColor;
        stroke-width: 2;
      }

      .ql-ai-enhancer:hover {
        color: #2563eb;
      }
    </style>
  </head>
  <body>
    <h1>AI Text Enhancer - Demo Quill</h1>

    <div class="api-key-form">
      <label for="api-key">OpenAI API Key:</label>
      <input type="password" id="api-key" placeholder="sk-..." />
      <button id="update-api-key">Actualizar API Key</button>
    </div>

    <div class="demo-navigation">
      <a href="index.html">Inicio</a>
      <a href="demo-simple.html">Textarea Simple</a>
      <a href="demo-tinymce.html">TinyMCE</a>
      <a href="demo-ckeditor.html">CKEditor 5</a>
      <a href="demo-quill.html" class="active">Quill</a>
      <a href="demo-froala.html">Froala</a>
    </div>

    <!-- Quill Editor -->
    <div class="editor-container">
      <h2>
        <img src="https://quilljs.com/favicon.ico" alt="Quill Logo" />
        Quill Editor
      </h2>
      <div id="quill-editor"></div>
      <ai-text-enhancer
        id="quill-enhancer"
        editor-id="quill-editor"
        api-provider="openai"
        api-model="gpt-4"
        prompt="Eres un experto en marketing digital, especializado en crear contenido que conecta con la audiencia."
        hide-trigger
      ></ai-text-enhancer>
    </div>

    <!-- Script para importar el componente y configurar Quill -->
    <script type="module">
      // Esperar a que el DOM esté listo
      document.addEventListener("DOMContentLoaded", async () => {
        try {
          // Importar componente base
          await import("../dist/ai-text-enhancer.umd.js");

          // Importar plugins
          const pluginsModule = await import(
            "../dist/ai-text-enhancer-plugins.es.js"
          );

          // Verificar si los plugins se han cargado correctamente
          console.log("Plugins importados:", pluginsModule);

          // Inicializar Quill con el plugin de IA
          const quill = new Quill("#quill-editor", {
            theme: "snow",
            modules: {
              toolbar: [
                [{ header: [1, 2, false] }],
                ["bold", "italic", "underline", "strike"],
                ["blockquote", "code-block"],
                [{ list: "ordered" }, { list: "bullet" }],
                [{ script: "sub" }, { script: "super" }],
                [{ indent: "-1" }, { indent: "+1" }],
                [{ direction: "rtl" }],
                [{ size: ["small", false, "large", "huge"] }],
                [{ header: [1, 2, 3, 4, 5, 6, false] }],
                [{ color: [] }, { background: [] }],
                [{ font: [] }],
                [{ align: [] }],
                ["clean"],
              ],
            },
          });

          // Añadir contenido inicial a Quill
          quill.setContents([
            {
              insert:
                "Este es un ejemplo de descripción en Quill que se puede mejorar con estrategias de marketing digital usando IA.\n\nEl contenido actual es funcional pero carece de elementos que conecten con la audiencia. Necesita un tono más conversacional y empático que resuene con los lectores y los inspire a tomar acción.\n",
            },
          ]);

          // Inicializar el plugin de Quill después de un breve retraso
          setTimeout(() => {
            if (typeof pluginsModule.QuillPlugin === "function") {
              try {
                // Acceder directamente al contenedor
                const quillContainer = document.querySelector("#quill-editor");
                const toolbar = quillContainer.previousElementSibling; // La barra de herramientas suele estar justo antes del editor

                if (toolbar && toolbar.classList.contains("ql-toolbar")) {
                  console.log(
                    "Encontrada barra de herramientas de Quill:",
                    toolbar
                  );
                }

                // Aplicar plugin con más información
                pluginsModule.QuillPlugin({
                  enhancerId: "quill-enhancer",
                  buttonTooltip: "Mejorar con IA",
                  quill: quill,
                  container: quillContainer,
                })(quill);
              } catch (err) {
                console.error("Error al inicializar QuillPlugin:", err);
              }
            } else {
              console.error(
                "QuillPlugin no está disponible o no es una función"
              );
            }
          }, 1000);
        } catch (error) {
          console.error("Error inicializando el demo de Quill:", error);
        }
      });
    </script>

    <script src="js/common.js"></script>
  </body>
</html>
