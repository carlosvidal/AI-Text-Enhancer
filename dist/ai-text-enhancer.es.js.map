{"version":3,"file":"ai-text-enhancer.es.js","sources":["../src/constants/translations.js","../src/services/icon-service.js","../src/styles/base/variables.js","../src/styles/base/animations.js","../src/styles/layout/preview.js","../src/styles/components/response-history.js","../src/components/ResponseHistory.js","../src/styles/components/chat.js","../src/styles/components/image-preview.js","../src/components/ChatWithImage.js","../src/components/ToolBar.js","../src/services/token-manager.js","../src/services/markdown-handler.js","../src/services/api-client.js","../src/services/cache-manager.js","../src/utils/tinymce-adapter.js","../src/utils/ckeditor-adapter.js","../src/utils/quill-adapter.js","../src/utils/froala-adapter.js","../src/services/editor-adapter.js","../src/utils/event-utils.js","../src/utils/dom-utils.js","../src/services/notification-manager.js","../src/features/keyboard-navigation.js","../src/features/response-handlers.js","../src/features/image-handlers.js","../src/utils/state-utils.js","../src/features/state-integration.js","../src/styles/components/modal-trigger.js","../src/styles/layout/modal.js","../src/styles/components/notifications.js","../src/template.js","../src/index.js"],"sourcesContent":["// translations.js with added prompt templates\n\nexport const TRANSLATIONS = {\n  en: {\n    modalTrigger: \"Enhance with AI (Beta)\",\n    modalTitle: \"Enhance your text with AI\",\n    tools: {\n      improve: \"Improve\",\n      summarize: \"Summarize\",\n      expand: \"Expand\",\n      paraphrase: \"Paraphrase\",\n      \"more-formal\": \"More Formal\",\n      \"more-casual\": \"More Casual\",\n      \"chat-question\": \"Question\",\n      \"chat-response\": \"Response\",\n      \"chat-error\": \"Error\",\n    },\n    actions: {\n      copy: \"Copy\",\n      use: \"Use\",\n      edit: \"Edit\",\n      retry: \"Retry\",\n      insert: \"Insert\",\n      replace: \"Replace\",\n      generate: \"Generate\",\n    },\n    preview: {\n      placeholder: \"Enhanced text will appear here\",\n    },\n    chat: {\n      placeholder: \"Ask a question about the product description...\",\n      question: \"Question\",\n      contentPrompt: \"Could you improve the text I have in the editor?\",\n      contextPrompt:\n        \"Please create a professional description based on the following context.\",\n      emptyPrompt: \"What type of content would you like me to help you create?\",\n    },\n    errors: {\n      \n      initialization: \"Error initializing component:\",\n      request: \"Error processing request:\",\n    },\n  },\n  es: {\n    modalTrigger: \"Mejorar con IA (Beta)\",\n    modalTitle: \"Mejora tu texto con IA\",\n    tools: {\n      improve: \"Mejorar\",\n      summarize: \"Resumir\",\n      expand: \"Ampliar\",\n      paraphrase: \"Parafrasear\",\n      \"more-formal\": \"Más formal\",\n      \"more-casual\": \"Más casual\",\n      \"chat-question\": \"Pregunta\",\n      \"chat-response\": \"Respuesta\",\n      \"chat-error\": \"Error\",\n    },\n    actions: {\n      copy: \"Copiar\",\n      use: \"Usar\",\n      edit: \"Editar\",\n      retry: \"Reintentar\",\n      insert: \"Insertar\",\n      replace: \"Reemplazar\",\n      generate: \"Generar\",\n    },\n    preview: {\n      placeholder: \"El texto mejorado aparecerá aquí\",\n    },\n    chat: {\n      placeholder: \"Haz una pregunta sobre la descripción del producto...\",\n      question: \"Pregunta\",\n      contentPrompt: \"¿Podrías mejorar el texto que tengo en el editor?\",\n      contextPrompt:\n        \"Por favor, crea una descripción profesional basada en el siguiente contexto.\",\n      emptyPrompt: \"¿Qué tipo de contenido te gustaría que te ayude a crear?\",\n    },\n    errors: {\n      \n      initialization: \"Error inicializando componente:\",\n      request: \"Error procesando solicitud:\",\n    },\n  },\n  fr: {\n    modalTrigger: \"Améliorer avec IA (Beta)\",\n    modalTitle: \"Améliorez votre texte avec IA\",\n    tools: {\n      improve: \"Améliorer\",\n      summarize: \"Résumer\",\n      expand: \"Développer\",\n      paraphrase: \"Paraphraser\",\n      \"more-formal\": \"Plus Formel\",\n      \"more-casual\": \"Plus Décontracté\",\n      \"chat-question\": \"Question\",\n      \"chat-response\": \"Réponse\",\n      \"chat-error\": \"Erreur\",\n    },\n    actions: {\n      retry: \"Réessayer\",\n      insert: \"Insérer\",\n      replace: \"Remplacer\",\n      generate: \"Générer\",\n      copy: \"Copier\",\n      use: \"Utiliser\",\n      edit: \"Éditer\",\n    },\n    preview: {\n      placeholder: \"Le texte amélioré apparaîtra ici\",\n    },\n    chat: {\n      placeholder: \"Posez une question sur la description du produit...\",\n      question: \"Question\",\n      contentPrompt:\n        \"Pourriez-vous améliorer le texte que j'ai dans l'éditeur ?\",\n      contextPrompt:\n        \"Veuillez créer une description professionnelle basée sur le contexte suivant.\",\n      emptyPrompt:\n        \"Quel type de contenu souhaitez-vous que je vous aide à créer ?\",\n    },\n    errors: {\n      \n      initialization: \"Erreur d'initialisation du composant :\",\n      request: \"Erreur lors du traitement de la demande :\",\n    },\n  },\n  de: {\n    modalTrigger: \"Beschreibung Verbessern mit KI (Beta)\",\n    modalTitle: \"Verbessern Sie Ihre Beschreibun mit KI\",\n    tools: {\n      improve: \"Verbessern\",\n      summarize: \"Zusammenfassen\",\n      expand: \"Erweitern\",\n      paraphrase: \"Umformulieren\",\n      \"more-formal\": \"Formaler\",\n      \"more-casual\": \"Lockerer\",\n      \"chat-question\": \"Frage\",\n      \"chat-response\": \"Antwort\",\n      \"chat-error\": \"Fehler\",\n    },\n    actions: {\n      retry: \"Wiederholen\",\n      insert: \"Einfügen\",\n      replace: \"Ersetzen\",\n      generate: \"Generieren\",\n      copy: \"Kopieren\",\n      use: \"Verwenden\",\n      edit: \"Bearbeiten\",\n    },\n    preview: {\n      placeholder: \"Verbesserter Text erscheint hier\",\n    },\n    chat: {\n      placeholder: \"Stellen Sie eine Frage zur Produktbeschreibung...\",\n      question: \"Frage\",\n      contentPrompt: \"Könnten Sie den Text in meinem Editor verbessern?\",\n      contextPrompt:\n        \"Bitte erstellen Sie eine professionelle Beschreibung basierend auf dem folgenden Kontext.\",\n      emptyPrompt:\n        \"Welche Art von Inhalt möchten Sie, dass ich Ihnen erstellen helfe?\",\n    },\n    errors: {\n      \n      initialization: \"Fehler bei der Initialisierung der Komponente:\",\n      request: \"Fehler bei der Verarbeitung der Anfrage:\",\n    },\n  },\n  pt: {\n    modalTrigger: \"Melhorar com IA (Beta)\",\n    modalTitle: \"Melhore sua texto com IA\",\n    tools: {\n      improve: \"Melhorar\",\n      summarize: \"Resumir\",\n      expand: \"Expandir\",\n      paraphrase: \"Parafrasear\",\n      \"more-formal\": \"Mais Formal\",\n      \"more-casual\": \"Mais Casual\",\n      \"chat-question\": \"Pergunta\",\n      \"chat-response\": \"Resposta\",\n      \"chat-error\": \"Erro\",\n    },\n    actions: {\n      retry: \"Tentar Novamente\",\n      insert: \"Inserir\",\n      replace: \"Substituir\",\n      generate: \"Gerar\",\n      copy: \"Copiar\",\n      use: \"Usar\",\n      edit: \"Editar\",\n    },\n    preview: {\n      placeholder: \"O texto melhorado aparecerá aqui\",\n    },\n    chat: {\n      placeholder: \"Faça uma pergunta sobre a descrição do produto...\",\n      question: \"Pergunta\",\n      contentPrompt: \"Você poderia melhorar o texto que tenho no editor?\",\n      contextPrompt:\n        \"Por favor, crie uma descrição profissional com base no seguinte contexto.\",\n      emptyPrompt:\n        \"Que tipo de conteúdo você gostaria que eu ajudasse a criar?\",\n    },\n    errors: {\n      apiKey:\n        \"Erro: Chave API não configurada. Por favor, forneça uma chave API válida.\",\n      initialization: \"Erro ao inicializar componente:\",\n      request: \"Erro ao processar solicitação:\",\n    },\n  },\n  it: {\n    modalTrigger: \"Migliorare con IA (Beta)\",\n    modalTitle: \"Migliorare il tuo testo con IA\",\n    tools: {\n      improve: \"Migliorare\",\n      summarize: \"Sommario\",\n      expand: \"Espandere\",\n      paraphrase: \"Parafrasare\",\n      \"more-formal\": \"Più Formale\",\n      \"more-casual\": \"Più Casual\",\n      \"chat-question\": \"Domanda\",\n      \"chat-response\": \"Risposta\",\n      \"chat-error\": \"Errore\",\n    },\n    actions: {\n      retry: \"Riprova\",\n      insert: \"Inserire\",\n      replace: \"Sostituire\",\n      generate: \"Generare\",\n      copy: \"Copiare\",\n      use: \"Usare\",\n      edit: \"Modificare\",\n    },\n    preview: {\n      placeholder: \"Il testo migliorato apparirà qui\",\n    },\n    chat: {\n      placeholder: \"Fai una domanda sulla descrizione del prodotto...\",\n      question: \"Domanda\",\n      contentPrompt: \"Potresti migliorare il testo che ho nell'editor?\",\n      contextPrompt:\n        \"Per favore, crea una descrizione professionale basata sul seguente contesto.\",\n      emptyPrompt: \"Che tipo di contenuto vorresti che ti aiutassi a creare?\",\n    },\n    errors: {\n      apiKey:\n        \"Errore: Chiave API non configurata. Fornisci una chiave API valida.\",\n      initialization: \"Errore inizializzazione componente:\",\n      request: \"Errore elaborazione richiesta:\",\n    },\n  },\n};\n","export const getToolIcon = (action) => {\n  const icons = {\n    improve: `\n        <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n          <path d=\"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72Z\"/>\n          <path d=\"m14 7 3 3\"/>\n        </svg>\n      `,\n    summarize: `\n        <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n          <path d=\"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20\"/>\n          <path d=\"M9 10h6\"/>\n        </svg>\n      `,\n    expand: `\n        <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n          <path d=\"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20\"/>\n          <path d=\"M9 10h6\"/><path d=\"M12 7v6\"/>\n        </svg>\n      `,\n    paraphrase: `\n        <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n          <path d=\"M21 6H3\"/><path d=\"M7 12H3\"/><path d=\"M7 18H3\"/>\n          <path d=\"M12 18a5 5 0 0 0 9-3 4.5 4.5 0 0 0-4.5-4.5c-1.33 0-2.54.54-3.41 1.41L11 14\"/>\n          <path d=\"M11 10v4h4\"/>\n        </svg>\n      `,\n    \"more-formal\": `\n        <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n          <rect width=\"20\" height=\"14\" x=\"2\" y=\"7\" rx=\"2\" ry=\"2\"/>\n          <path d=\"M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16\"/>\n        </svg>\n      `,\n    \"more-casual\": `\n        <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n          <circle cx=\"12\" cy=\"12\" r=\"10\"/>\n          <path d=\"M8 14s1.5 2 4 2 4-2 4-2\"/>\n          <line x1=\"9\" x2=\"9.01\" y1=\"9\" y2=\"9\"/>\n          <line x1=\"15\" x2=\"15.01\" y1=\"9\" y2=\"9\"/>\n        </svg>\n      `,\n    \"chat-question\": `\n      <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n        <path d=\"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z\"/>\n      </svg>\n    `,\n    \"chat-response\": `\n      <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n        <path d=\"M3 15a2 2 0 0 0 2 2h14l4 4V5a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2z\"/>\n      </svg>\n    `,\n    \"chat-error\": `\n      <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n        <circle cx=\"12\" cy=\"12\" r=\"10\"/>\n        <line x1=\"12\" y1=\"8\" x2=\"12\" y2=\"12\"/>\n        <line x1=\"12\" y1=\"16\" x2=\"12.01\" y2=\"16\"/>\n      </svg>\n    `\n  };\n\n  return icons[action] || icons.improve;\n};","// styles/base/variables.js\nexport const variables = `\n  :host {\n    --ai-primary: #3b82f6;\n    --ai-primary-hover: #2563eb;\n    --ai-secondary: #e5e7eb;\n    --ai-secondary-hover: #d1d5db;\n    --ai-text: #1f2937;\n    --ai-text-light: #6b7280;\n    --ai-border: #e5e7eb;\n    --ai-success: #10b981;\n    --ai-warning: #f59e0b;\n    --ai-error: #dc2626;\n    --ai-background: #ffffff;\n    --ai-background-light: #f9fafb;\n    \n    --ai-shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);\n    --ai-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);\n    --ai-shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);\n    \n    --ai-radius-sm: 0.375rem;\n    --ai-radius: 0.5rem;\n    --ai-radius-md: 0.75rem;\n    --ai-radius-lg: 1rem;\n    \n    --ai-font-sans: system-ui, -apple-system, sans-serif;\n    --ai-z-modal: 99999;\n    --ai-z-content: 100000;\n\n    /* Gradient colors */\n    --ai-gradient-start: #da22ff;\n    --ai-gradient-middle: #9733ee;\n    --ai-gradient-end: #da22ff;\n  }\n`;\n","// styles/base/animations.js\nexport const animations = `\n  @keyframes fadeIn {\n    from {\n      opacity: 0;\n      transform: translateY(10px);\n    }\n    to {\n      opacity: 1;\n      transform: translateY(0);\n    }\n  }\n\n  @keyframes blink {\n    0%, 100% { opacity: 1; }\n    50% { opacity: 0; }\n  }\n\n  @keyframes glow {\n    0% { background-position: 0 0; }\n    50% { background-position: 200% 0; }\n    100% { background-position: 0 0; }\n  }\n\n  @keyframes shake {\n    0%, 100% { transform: rotate(0deg); }\n    25% { transform: rotate(5deg); }\n    50% { transform: rotate(-5deg); }\n    75% { transform: rotate(5deg); }\n  }\n\n  @keyframes pulse {\n    0% { transform: scale(1); }\n    50% { transform: scale(1.05); }\n    100% { transform: scale(1); }\n  }\n`;\n","// styles/layout/preview.js\nexport const previewStyles = `\n  .preview {\n    flex: 1;\n    overflow-y: auto;\n    background: var(--ai-background);\n    border-radius: var(--ai-radius);\n  }\n\n  .response-tool {\n    font-weight: 500;\n    color: var(--ai-text);\n    display: flex;\n    align-items: center;\n    gap: 0.5rem;\n  }\n\n  .response-timestamp {\n    color: var(--ai-text-light);\n    font-size: 0.875rem;\n  }\n\n  .response-action.primary {\n    background: var(--ai-primary);\n    color: white;\n  }\n\n  .response-action.primary:hover {\n    background: var(--ai-primary-hover);\n  }\n`;\n","// styles/components/response-history.js\nexport const responseHistoryStyles = `\n  /* ===== CONTENEDORES PRINCIPALES ===== */\n  .response-container {\n    overflow-y: auto;\n    max-height: 100%;\n  }\n\n  .response-entry {\n    background: var(--ai-surface);\n    border-radius: var(--ai-radius);\n    border: 1px solid var(--ai-border);\n    margin-bottom: 1rem;\n    padding: 1rem;\n    /* Optimizaciones de rendimiento */\n    contain: content;\n    position: relative;\n    will-change: contents;\n    transform: translateZ(0);\n    backface-visibility: hidden;\n  }\n\n  .response-content-wrapper {\n    flex: 1;\n    min-width: 0;\n    /* Optimizar para cambios frecuentes */\n    will-change: contents;\n  }\n\n  .response-entry[data-action=\"error\"],\n  .response-entry[data-action=\"info\"],\n  .response-entry[data-action=\"chat-error\"] {\n    background: var(--ai-surface-light);\n    border-left: 3px solid var(--ai-error);\n    padding-left: calc(1rem - 3px);\n  }\n\n  .response-entry[data-action=\"info\"] {\n    border-left-color: var(--ai-info);\n  }\n\n  /* ===== ÁREA DE CONTENIDO ===== */\n  .response-content {\n    margin: 1rem 0;\n    line-height: 1.5;\n    word-break: break-word;\n    overflow-wrap: break-word;\n    position: relative;\n    min-height: 1.5em;\n  }\n\n  /* Control para streaming activo */\n  .response-content[data-streaming-active=\"true\"] {\n    transition: none !important;\n    user-select: none;\n  }\n\n  /* Desactivar transiciones durante streaming para contenido anidado */\n  .response-content[data-streaming-active=\"true\"] * {\n    transition: none !important;\n  }\n\n  /* Restaurar selección cuando termina el streaming */\n  .response-content:not([data-streaming-active=\"true\"]) {\n    user-select: text;\n  }\n\n  /* Contenido para markdown */\n  .response-content p {\n    margin: 0.5em 0;\n    animation: textReveal 0.2s ease-out forwards;\n  }\n\n  .response-content ul, \n  .response-content ol {\n    margin: 0.5em 0;\n    padding-left: 1.5em;\n  }\n\n  .response-content pre {\n    background: var(--ai-surface-dark);\n    padding: 1rem;\n    border-radius: var(--ai-radius);\n    overflow-x: auto;\n    margin-bottom: 1em;\n  }\n\n  .response-content code {\n    font-family: var(--ai-font-mono);\n    font-size: 0.9em;\n    padding: 0.2em 0.4em;\n    background: var(--ai-surface-dark);\n    border-radius: var(--ai-radius-sm);\n  }\n\n  /* Mantener contenido estable */\n  .response-content p, \n  .response-content ul, \n  .response-content ol,\n  .response-content pre {\n    contain: layout;\n  }\n\n  /* Eliminar margen en el último elemento para mantener espaciado consistente */\n  .response-content > *:last-child {\n    margin-bottom: 0;\n  }\n\n  /* ===== ANIMACIÓN DE ESCRITURA ===== */\n  /* Deshabilitar el cursor por defecto */\n  .response-content::after {\n    content: none;\n  }\n\n  /* Cursor de escritura personalizado */\n  .typing-animation::after {\n    content: '|';\n    display: inline-block;\n    width: 0.5em;\n    height: 1.2em;\n    background: transparent;\n    margin-left: 1px;\n    border: none;\n    animation: typingCursor 0.8s infinite step-end;\n    vertical-align: middle;\n    position: relative;\n    opacity: 0.8;\n  }\n\n  /* Eliminar CUALQUIER cursor adicional */\n  .typing-animation span.typing,\n  .typing span.cursor,\n  span.typing-cursor {\n    display: none !important;\n    opacity: 0 !important;\n    visibility: hidden !important;\n  }\n\n  /* Animación del cursor */\n  @keyframes typingCursor {\n    0%, 100% { opacity: 0.8; }\n    50% { opacity: 0; }\n  }\n\n  /* Indicadores de carga */\n  .typing-indicator {\n    color: var(--ai-text-light);\n    font-style: italic;\n    padding: 0.25rem 0;\n    animation: fadeInOut 1.5s ease-in-out infinite;\n  }\n\n  /* Animación para indicadores de carga */\n  @keyframes fadeInOut {\n    0%, 100% { opacity: 0.7; }\n    50% { opacity: 1; }\n  }\n\n  /* Efecto de texto apareciendo gradualmente */\n  @keyframes textReveal {\n    from { opacity: 0; transform: translateY(5px); }\n    to { opacity: 1; transform: translateY(0); }\n  }\n\n  /* Mensajes de estado iniciales para contenido vacío */\n  .response-entry[data-action=\"chat-response\"] .response-content:empty::after,\n  .response-entry[data-action=\"summarize\"] .response-content:empty::after,\n  .response-entry[data-action=\"improve\"] .response-content:empty::after,\n  .response-entry[data-action=\"expand\"] .response-content:empty::after,\n  .response-entry[data-action=\"paraphrase\"] .response-content:empty::after,\n  .response-entry[data-action=\"more-formal\"] .response-content:empty::after,\n  .response-entry[data-action=\"more-casual\"] .response-content:empty::after {\n    content: 'Pensando...';\n    color: var(--ai-text-light);\n    font-style: italic;\n  }\n\n  .response-entry[data-action=\"chat-response\"] .response-content:empty::after {\n    content: 'Escribiendo respuesta...';\n  }\n\n  /* ===== CABECERA Y PIE DE RESPUESTA ===== */\n  .response-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 0.5rem;\n    color: var(--ai-text-secondary);\n  }\n\n.response-footer {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding-top: 0.75rem !important;\n  margin-top: 0.5rem !important;\n  border-top: 1px solid var(--ai-border);\n  flex-wrap: wrap;\n  gap: 0.75rem;\n}\n\n  /* ===== BOTONES Y ACCIONES ===== */\n  .response-actions {\n    display: flex;\n    gap: 0.5rem;\n    margin-left: auto;\n  }\n\n.response-tools {\n  display: flex;\n  gap: 0.5rem;\n  flex-wrap: wrap;\n  max-width: 100%;\n  overflow-x: auto;\n  padding: 0 0.25rem;\n  -webkit-overflow-scrolling: touch;\n  scroll-padding: 0.5rem;\n  scroll-snap-type: x proximity;\n}\n\n  .response-tools::-webkit-scrollbar {\n    height: 4px;\n  }\n\n  .response-tools::-webkit-scrollbar-track {\n    background: var(--ai-surface-light);\n    border-radius: 2px;\n  }\n\n  .response-tools::-webkit-scrollbar-thumb {\n    background: var(--ai-surface-dark);\n    border-radius: 2px;\n  }\n\n  .response-action,\n.tool-button {\n  display: inline-flex;\n  align-items: center;\n  gap: 0.5rem;\n  padding: 0.5rem 0.75rem;\n  background: var(--ai-background);\n  border: none;\n  border-radius: var(--ai-radius);\n  color: var(--ai-text);\n  font-size: 0.8125rem;\n  cursor: pointer;\n  white-space: nowrap;\n  transition: all 0.2s ease;\n  scroll-snap-align: start;\n}\n\n.response-action {\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n  padding: 0.5rem;\n  border: none;\n  border-radius: var(--ai-radius);\n  background: var(--ai-surface-dark, #f1f5f9);\n  color: var(--ai-text);\n  cursor: pointer;\n  transition: all 0.2s ease;\n  position: relative;\n}\n\n  .response-action:hover,\n  .tool-button:hover {\n    background: var(--ai-secondary);\n  color: var(--ai-text);\n  transform: translateY(-1px);\n  }\n\n  .response-action svg,\n  .tool-button svg {\n    width: 16px;\n    height: 16px;\n  }\n\n  /* ===== IMÁGENES Y ADJUNTOS ===== */\n  .response-entry.with-image {\n    display: grid;\n    grid-template-columns: auto 1fr;\n    gap: 1rem;\n    align-items: start;\n  }\n\n  .response-image-container {\n    width: 120px;\n  }\n\n  .image-preview {\n    width: 120px;\n    height: 120px;\n    border-radius: var(--ai-radius);\n    overflow: hidden;\n  }\n\n  .image-preview img {\n    width: 100%;\n    height: 100%;\n    object-fit: cover;\n  }\n\n  .response-content-with-image {\n    display: flex;\n    align-items: flex-start;\n    gap: 1rem;\n    margin: 1rem 0;\n  }\n\n  .response-image {\n    width: 100%;\n    height: 120px;\n    object-fit: cover;\n    border-radius: var(--ai-radius);\n    border: 1px solid var(--ai-border);\n  }\n\n  .response-image img {\n    width: 100%;\n    height: auto;\n    display: block;\n    object-fit: contain;\n  }\n\n  .image-filename {\n    font-size: 0.75rem;\n    color: var(--ai-text-light);\n    margin-top: 0.25rem;\n    text-align: center;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    white-space: nowrap;\n  }\n\n  /* Estilos para imágenes en las respuestas */\n  .response-entry img {\n    max-width: 100px;\n    max-height: 100px;\n    object-fit: contain;\n    border-radius: var(--ai-radius);\n    border: 1px solid var(--ai-border);\n  }\n\n  .response-content .image-preview-card {\n    flex-shrink: 0;\n    width: 100px;\n    margin: 0;\n  }\n\n  .response-content .image-preview-card img {\n    width: 100%;\n    height: 100px;\n    object-fit: cover;\n  }\n\n  .response-content .image-preview-filename {\n    font-size: 0.75rem;\n    color: var(--ai-text-light);\n    text-align: center;\n    margin-top: 0.25rem;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    white-space: nowrap;\n  }\n\n  /* ===== PREGUNTAS CON IMÁGENES ===== */\n  .question-container {\n    display: flex;\n    gap: 1rem;\n    align-items: flex-start;\n  }\n\n  .question-content {\n    flex: 1;\n    min-width: 0;\n  }\n\n  .question-image {\n    flex-shrink: 0;\n    width: 100px;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    gap: 0.25rem;\n  }\n\n  .question-image img {\n    width: 100px;\n    height: 100px;\n    object-fit: cover;\n    border-radius: var(--ai-radius);\n    border: 1px solid var(--ai-border);\n  }\n\n  .question-image .image-filename {\n    font-size: 0.75rem;\n    color: var(--ai-text-light);\n    max-width: 100px;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    white-space: nowrap;\n    text-align: center;\n  }\n\n  .question-with-image {\n    display: flex;\n    gap: 1rem;\n    align-items: flex-start;\n    margin: 0.5rem 0;\n  }\n\n  /* ESTILO PARA MENSAJES DE INFORMACIÓN */\n.response-entry[data-action=\"info\"],\n.response-entry[data-action=\"error\"],\n.response-entry[data-action=\"chat-error\"] {\n  background-color: var(--ai-surface-light, #f9fafb);\n  padding: 0.5rem 0.75rem !important; \n  display: flex !important;\n  align-items: center !important;\n  max-height: none !important;\n}\n\n.response-entry[data-action=\"info\"] .response-header,\n.response-entry[data-action=\"error\"] .response-header,\n.response-entry[data-action=\"chat-error\"] .response-header {\n  display: none !important; /* Ocultar header para más compacidad */\n}\n\n/* ESTILO PARA PREGUNTAS */\n.response-entry[data-action=\"chat-question\"] {\n  padding: 0.5rem 0.75rem !important;\n  max-height: none !important;\n  margin-right: 5rem;\n    background: aliceblue;\n}\n\n.response-entry[data-action=\"chat-response\"] {\n    margin-left: 5rem;\n}\n\n.action-text {\n  display: none;\n  margin-left: 0.25rem;\n  font-size: 0.8125rem;\n  opacity: 0;\n  transform: translateX(-0.5rem);\n  transition: all 0.2s ease;\n}\n\n.response-action:hover .action-text {\n  display: inline;\n  opacity: 1;\n  transform: translateX(0);\n}\n\n@media (min-width: 1024px) {\n  .response-action {\n    padding: 0.5rem 0.75rem;\n  }\n  \n  .action-text {\n    display: inline;\n    opacity: 1;\n    transform: translateX(0);\n  }\n}\n  /* Fix for question entries - no footer */\n.response-entry[data-action=\"chat-question\"] .response-footer {\n  display: none !important;\n}\n\n/* Additional optimizations for mobile layout */\n@media (max-width: 640px) {\n  .response-footer {\n    flex-direction: column;\n    align-items: flex-start;\n  }\n  \n  .response-tools {\n    width: 100%;\n    padding-bottom: 0.5rem;\n  }\n  \n  .response-actions {\n    margin-left: 0;\n    width: 100%;\n    justify-content: flex-end;\n  }\n}\n`;\n","// src/components/ResponseHistory.js\nimport { TRANSLATIONS } from \"../constants/translations.js\";\nimport { getToolIcon } from \"../services/icon-service.js\";\nimport { variables } from \"../styles/base/variables.js\";\nimport { animations } from \"../styles/base/animations.js\";\nimport { previewStyles } from \"../styles/layout/preview.js\";\nimport { responseHistoryStyles } from \"../styles/components/response-history.js\";\n\nexport class ResponseHistory extends HTMLElement {\n  constructor() {\n    super();\n    this.attachShadow({ mode: \"open\" });\n    this.responses = [];\n    this.markdownHandler = null;\n  }\n\n  static get observedAttributes() {\n    return [\"language\"];\n  }\n\n  get language() {\n    const lang = this.getAttribute(\"language\");\n    console.log(\"[ResponseHistory] Getting language:\", lang);\n    return lang || \"en\";\n  }\n\n  connectedCallback() {\n    console.log(\"[ResponseHistory] Connected, language:\", this.language);\n    console.log(\n      \"[ResponseHistory] Has language attribute:\",\n      this.hasAttribute(\"language\")\n    );\n    console.log(\"[ResponseHistory] All attributes:\", this.getAttributeNames());\n\n    this.translations = TRANSLATIONS[this.language] || TRANSLATIONS.en;\n    console.log(\"[ResponseHistory] Initial translations:\", this.translations);\n\n    this.render();\n    this.setupEventListeners();\n  }\n\n  attributeChangedCallback(name, oldValue, newValue) {\n    console.log(\n      \"[ResponseHistory] Attribute changed:\",\n      name,\n      \"from\",\n      oldValue,\n      \"to\",\n      newValue\n    );\n    if (name === \"language\" && oldValue !== newValue) {\n      console.log(\n        \"[ResponseHistory] Updating translations for new language:\",\n        newValue\n      );\n      this.translations = TRANSLATIONS[newValue] || TRANSLATIONS.en;\n      console.log(\"[ResponseHistory] New translations:\", this.translations);\n      this.render();\n    }\n  }\n\n  // Versión optimizada de createResponseEntry para reducir espacios en blanco innecesarios\n  // Sobrescribir el método createResponseEntry para manejar específicamente mensajes info y preguntas\n  createResponseEntry(response) {\n    const entry = document.createElement(\"div\");\n    entry.className = \"response-entry\";\n    entry.dataset.id = response.id;\n    entry.dataset.action = response.action;\n\n    // Determinar el tipo de respuesta\n    const isInfo = [\"info\", \"error\", \"chat-error\"].includes(response.action);\n    const isQuestion = response.action === \"chat-question\";\n\n    // ===== CASO 1: MENSAJES DE INFORMACIÓN/ERROR - FORMATO SUPER COMPACTO =====\n    if (isInfo) {\n      entry.innerHTML = `\n      <div class=\"response-content-wrapper\">\n        <div class=\"response-content\">\n          ${\n            this.markdownHandler\n              ? this.markdownHandler.convert(response.content)\n              : response.content\n          }\n        </div>\n      </div>\n    `;\n      return entry;\n    }\n\n    // ===== CASO 2: PREGUNTAS - FORMATO COMPACTO =====\n    if (isQuestion) {\n      const hasImage = response.image !== undefined && response.image !== null;\n\n      // Si tiene imagen, usar un layout especial\n      if (hasImage) {\n        entry.innerHTML = `\n        <div class=\"response-content-wrapper\">\n          <div class=\"response-header mini\">\n            <div class=\"response-tool\">\n              ${getToolIcon(response.action)}\n              <span>Pregunta:</span>\n            </div>\n            <div class=\"response-timestamp\">${this.formatTimestamp(\n              response.timestamp\n            )}</div>\n          </div>\n          <div class=\"question-container\">\n            <div class=\"question-content\">\n              ${response.content.replace(/^\\*\\*Pregunta:\\*\\*\\s*/i, \"\")}\n            </div>\n            <div class=\"question-image mini\">\n              <img src=\"${URL.createObjectURL(\n                response.image\n              )}\" alt=\"Imagen adjunta\">\n            </div>\n          </div>\n        </div>\n      `;\n      } else {\n        // Sin imagen, aún más compacto\n        entry.innerHTML = `\n        <div class=\"response-content-wrapper\">\n          <div class=\"response-header mini\">\n            <div class=\"response-tool\">\n              ${getToolIcon(response.action)}\n              <span>Pregunta:</span>\n            </div>\n            <div class=\"response-timestamp\">${this.formatTimestamp(\n              response.timestamp\n            )}</div>\n          </div>\n          <div class=\"response-content\">\n            ${response.content.replace(/^\\*\\*Pregunta:\\*\\*\\s*/i, \"\")}\n          </div>\n        </div>\n        `;\n      }\n\n      return entry;\n    }\n\n    // Para todos los demás tipos de respuestas, mantener el comportamiento normal\n    const contentWrapper = document.createElement(\"div\");\n    contentWrapper.className = \"response-content-wrapper\";\n\n    // Verificar si está en proceso de escritura\n    const isLoading = response.content === \"\" || response.content.length < 5;\n    const contentClass = isLoading\n      ? \"response-content typing-animation\"\n      : \"response-content\";\n\n    // Crear el contenido principal como lo hacías antes\n    let mainContent;\n    if (response.action === \"image-upload\") {\n      mainContent = response.content;\n    } else if (isLoading) {\n      if (response.action === \"chat-response\") {\n        mainContent = `<div class=\"typing-indicator\">Escribiendo respuesta...</div>`;\n      } else if (\n        [\n          \"improve\",\n          \"summarize\",\n          \"expand\",\n          \"paraphrase\",\n          \"more-formal\",\n          \"more-casual\",\n        ].includes(response.action)\n      ) {\n        mainContent = `<div class=\"typing-indicator\">Pensando...</div>`;\n      } else {\n        mainContent = \"\";\n      }\n    } else {\n      mainContent = this.markdownHandler\n        ? this.markdownHandler.convert(response.content)\n        : response.content;\n    }\n\n    // Crear herramientas si no es pregunta ni mensaje del sistema\n    const isSystemMessage = [\"error\", \"info\", \"chat-error\"].includes(\n      response.action\n    );\n\n    // Generar los botones de herramientas\n    let toolsHtml = \"\";\n    if (!isQuestion && !isSystemMessage) {\n      toolsHtml = `\n        <button class=\"tool-button\" data-action=\"improve\" data-response-id=\"${\n          response.id\n        }\">\n          ${getToolIcon(\"improve\")}\n          ${this.translations?.tools?.improve || \"Improve\"}\n        </button>\n        <button class=\"tool-button\" data-action=\"summarize\" data-response-id=\"${\n          response.id\n        }\">\n          ${getToolIcon(\"summarize\")}\n          ${this.translations?.tools?.summarize || \"Summarize\"}\n        </button>\n        <button class=\"tool-button\" data-action=\"expand\" data-response-id=\"${\n          response.id\n        }\">\n          ${getToolIcon(\"expand\")}\n          ${this.translations?.tools?.expand || \"Expand\"}\n        </button>\n        <button class=\"tool-button\" data-action=\"paraphrase\" data-response-id=\"${\n          response.id\n        }\">\n          ${getToolIcon(\"paraphrase\")}\n          ${this.translations?.tools?.paraphrase || \"Paraphrase\"}\n        </button>\n        <button class=\"tool-button\" data-action=\"more-formal\" data-response-id=\"${\n          response.id\n        }\">\n          ${getToolIcon(\"more-formal\")}\n          ${this.translations?.tools?.[\"more-formal\"] || \"More Formal\"}\n        </button>\n        <button class=\"tool-button\" data-action=\"more-casual\" data-response-id=\"${\n          response.id\n        }\">\n          ${getToolIcon(\"more-casual\")}\n          ${this.translations?.tools?.[\"more-casual\"] || \"More Casual\"}\n        </button>\n      `;\n    }\n\n    // Botones de acción\n    const actionsHtml =\n      !isSystemMessage && !isQuestion\n        ? `\n<div class=\"response-footer\">\n  <div class=\"response-tools\">\n    ${toolsHtml}\n  </div>\n  <div class=\"response-actions\">\n    <button class=\"response-action copy-button\" data-response-id=\"${\n      response.id\n    }\" title=\"${this.translations?.actions?.copy || \"Copy\"}\">\n      <svg viewBox=\"0 0 24 24\" width=\"16\" height=\"16\" stroke=\"currentColor\" stroke-width=\"2\" fill=\"none\">\n        <rect x=\"9\" y=\"9\" width=\"13\" height=\"13\" rx=\"2\" ry=\"2\"/>\n        <path d=\"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1\"/>\n      </svg>\n      <span class=\"action-text\">${\n        this.translations?.actions?.copy || \"Copy\"\n      }</span>\n    </button>\n    <button class=\"response-action use-button\" data-response-id=\"${\n      response.id\n    }\" title=\"${this.translations?.actions?.use || \"Use\"}\">\n      <svg viewBox=\"0 0 24 24\" width=\"16\" height=\"16\" stroke=\"currentColor\" stroke-width=\"2\" fill=\"none\">\n        <polyline points=\"20 6 9 17 4 12\"/>\n      </svg>\n      <span class=\"action-text\">${\n        this.translations?.actions?.use || \"Use\"\n      }</span>\n    </button>\n    <button class=\"response-action retry-button\" data-response-id=\"${\n      response.id\n    }\" data-action=\"${response.action}\" title=\"${\n            this.translations?.actions?.retry || \"Retry\"\n          }\">\n      <svg viewBox=\"0 0 24 24\" width=\"16\" height=\"16\" stroke=\"currentColor\" stroke-width=\"2\" fill=\"none\">\n        <path d=\"M21.5 2v6h-6M2.5 22v-6h6M2 11.5a10 10 0 0 1 18.8-4.3M22 12.5a10 10 0 0 1-18.8 4.3\"/>\n      </svg>\n      <span class=\"action-text\">${\n        this.translations?.actions?.retry || \"Retry\"\n      }</span>\n    </button>\n  </div>\n</div>\n`\n        : \"\";\n\n    // Construir el HTML para respuestas normales\n    contentWrapper.innerHTML = `\n    <div class=\"response-header\">\n      <div class=\"response-tool\">\n        ${getToolIcon(response.action)}\n        <span>${\n          this.translations?.tools[response.action] || response.action\n        }</span>\n      </div>\n      <div class=\"response-timestamp\">${this.formatTimestamp(\n        response.timestamp\n      )}</div>\n    </div>\n    <div class=\"${contentClass}\">\n      ${mainContent}\n    </div>\n    ${actionsHtml}\n  `;\n\n    // Añadir estilos específicos para elementos miniatura si no existen\n    if (!this.shadowRoot.querySelector(\"#mini-elements-style\")) {\n      const styleEl = document.createElement(\"style\");\n      styleEl.id = \"mini-elements-style\";\n      styleEl.textContent = `\n      /* Estilos para elementos miniatura */\n      .mini {\n        margin: 0 !important;\n        padding: 0 !important;\n      }\n      \n      .response-header.mini {\n        margin-bottom: 0.25rem !important;\n      }\n      \n      .response-footer.mini {\n        padding-top: 0.25rem !important;\n        display: flex;\n        justify-content: flex-end;\n      }\n      \n      .question-image.mini {\n        width: 60px !important;\n        height: 60px !important;\n      }\n      \n      .question-image.mini img {\n        width: 60px !important;\n        height: 60px !important;\n      }\n      \n      .response-action.mini {\n        padding: 0.25rem !important;\n      }\n      \n      /* Estilos específicos para mensajes de información */\n      .response-entry[data-action=\"info\"],\n      .response-entry[data-action=\"error\"],\n      .response-entry[data-action=\"chat-error\"] {\n        padding: 0.5rem 0.75rem !important;\n      }\n      \n      /* Estilos específicos para preguntas */\n      .response-entry[data-action=\"chat-question\"] {\n        padding: 0.5rem 0.75rem !important;\n      }\n      \n      .question-container {\n        display: flex;\n        gap: 0.5rem;\n        align-items: flex-start;\n        margin: 0;\n        padding: 0;\n      }\n    `;\n      this.shadowRoot.appendChild(styleEl);\n    }\n\n    entry.appendChild(contentWrapper);\n    return entry;\n  }\n\n  setupEventListeners() {\n    this.shadowRoot.addEventListener(\"click\", (e) => {\n      const button = e.target.closest(\"button\");\n      if (!button) return;\n\n      const responseId = button.dataset.responseId;\n      if (!responseId) return;\n\n      const response = this.getResponse(responseId);\n      if (!response) return;\n\n      // Manejar los eventos de las herramientas\n      if (button.classList.contains(\"tool-button\")) {\n        const action = button.dataset.action;\n        console.log(\"[ResponseHistory] Tool button clicked:\", {\n          action,\n          responseId,\n        });\n        this.dispatchEvent(\n          new CustomEvent(\"toolaction\", {\n            detail: {\n              action,\n              responseId,\n              content: response.content,\n            },\n            bubbles: true,\n            composed: true,\n          })\n        );\n      } else if (button.classList.contains(\"retry-button\")) {\n        const action = button.dataset.action;\n        this.dispatchEvent(\n          new CustomEvent(\"responseRetry\", {\n            detail: { responseId, action },\n            bubbles: true,\n            composed: true,\n          })\n        );\n      } else if (button.classList.contains(\"edit-button\")) {\n        this.dispatchEvent(\n          new CustomEvent(\"responseEdit\", {\n            detail: { responseId },\n            bubbles: true,\n            composed: true,\n          })\n        );\n      } else if (button.classList.contains(\"copy-button\")) {\n        this.dispatchEvent(\n          new CustomEvent(\"responseCopy\", {\n            detail: { responseId },\n            bubbles: true,\n            composed: true,\n          })\n        );\n      } else if (button.classList.contains(\"use-button\")) {\n        console.log(\"[ResponseHistory] Use button clicked\");\n\n        // Primero disparamos el evento de uso\n        this.dispatchEvent(\n          new CustomEvent(\"responseUse\", {\n            detail: { responseId },\n            bubbles: true,\n            composed: true,\n          })\n        );\n\n        // Esperar un momento antes de cerrar el modal\n        setTimeout(() => {\n          console.log(\"[ResponseHistory] Attempting to close modal\");\n\n          try {\n            // Buscar el modal más cercano usando la clase correcta\n            let element = this;\n            while (element) {\n              console.log(\n                \"[ResponseHistory] Checking element for modal class:\",\n                element\n              );\n              if (element.classList?.contains(\"modal\")) {\n                console.log(\"[ResponseHistory] Found modal element:\", element);\n                element.classList.remove(\"open\");\n                break;\n              }\n              // Navegar hacia arriba en el árbol del DOM\n              element = element.parentNode || element.getRootNode().host;\n            }\n          } catch (error) {\n            console.error(\"[ResponseHistory] Error closing modal:\", error);\n          }\n        }, 100); // Esperar 100ms\n      } else if (button.classList.contains(\"retry-button\")) {\n        const action = button.dataset.action;\n        this.dispatchEvent(\n          new CustomEvent(\"responseRetry\", {\n            detail: { responseId, action },\n            bubbles: true,\n            composed: true,\n          })\n        );\n      }\n    });\n  }\n\n  getResponse(id) {\n    console.log(\"[ResponseHistory] Getting response for ID:\", id);\n    console.log(\"[ResponseHistory] Available responses:\", this.responses);\n    const response = this.responses.find(\n      (response) => response.id === parseInt(id)\n    );\n    console.log(\"[ResponseHistory] Found response:\", response);\n    return response;\n  }\n\n  addResponse(response) {\n    console.log(\"[ResponseHistory] Adding response:\", response);\n    this.responses.push(response);\n    this.render();\n  }\n\n  // Método mejorado para updateResponse en ResponseHistory.js\n  updateResponse(id, contentOrCallback) {\n    const index = this.responses.findIndex((r) => r.id === id);\n    if (index === -1) return;\n\n    const response = this.responses[index];\n    const oldContent = response.content;\n\n    // Actualizar el contenido en el objeto de datos\n    if (typeof contentOrCallback === \"function\") {\n      response.content = contentOrCallback(response.content);\n    } else {\n      response.content = contentOrCallback;\n    }\n\n    // Determinar el tipo de actualización\n    const isFirstUpdate = oldContent === \"\";\n    const isIncrementalUpdate =\n      typeof contentOrCallback === \"function\" &&\n      response.content.length > oldContent.length &&\n      response.content.startsWith(oldContent);\n\n    // Obtener el elemento DOM\n    const responseEntry = this.shadowRoot.querySelector(`[data-id=\"${id}\"]`);\n    if (!responseEntry) {\n      // Si no hay elemento DOM, renderizar todo\n      this.render();\n      return;\n    }\n\n    // Obtener el elemento de contenido\n    const contentElement = responseEntry.querySelector(\".response-content\");\n    if (!contentElement) return;\n\n    // =========== ESTRATEGIA DE STREAMING SIN PARPADEO ===========\n\n    // CASO 1: Primera actualización - Configuración inicial\n    if (isFirstUpdate) {\n      console.log(\n        \"[ResponseHistory] Primera actualización, configurando streaming\"\n      );\n\n      // Verificar si hay texto de contenido\n      let firstChunk = response.content || \"\";\n\n      // Verificar si necesitamos reparar un inicio truncado\n      if (firstChunk.startsWith(\"aro,\") || firstChunk.startsWith(\"laro,\")) {\n        console.warn(\n          \"[ResponseHistory] Detectado inicio truncado, reparando...\"\n        );\n        firstChunk = \"C\" + firstChunk;\n        // Actualizar también el objeto de respuesta\n        response.content = firstChunk;\n      }\n\n      // Crear un nodo de texto para actualizaciones incrementales\n      const textNode = document.createTextNode(firstChunk);\n\n      // Asegurarnos de que el contenedor esté limpio\n      contentElement.innerHTML = \"\";\n      contentElement.appendChild(textNode);\n\n      // Marcar como streaming activo y añadir clase para cursor\n      contentElement.dataset.streamingActive = \"true\";\n      contentElement.classList.add(\"typing-animation\");\n    }\n\n    // CASO 2: Actualización incremental durante streaming\n    else if (\n      isIncrementalUpdate &&\n      contentElement.dataset.streamingActive === \"true\"\n    ) {\n      // Calcular solo el nuevo texto añadido\n      const newTextPart = response.content.substring(oldContent.length);\n\n      // Si tiene un nodo de texto como último hijo, actualizarlo directamente\n      if (\n        contentElement.lastChild &&\n        contentElement.lastChild.nodeType === Node.TEXT_NODE\n      ) {\n        // Actualizar el nodeValue para evitar parpadeo\n        contentElement.lastChild.nodeValue = response.content;\n      } else {\n        const textNode = document.createTextNode(response.content);\n        contentElement.innerHTML = \"\";\n        contentElement.appendChild(textNode);\n      }\n\n      // Mantener el scroll al final si está cerca del final\n      const container = responseEntry.parentNode;\n      if (container) {\n        const isNearBottom = container.scrollHeight - container.scrollTop - container.clientHeight < 50;\n        if (isNearBottom) {\n          container.scrollTop = container.scrollHeight;\n        }\n      }\n    }\n\n    // CASO 3: Streaming ha terminado o es una actualización completa\n    else {\n      console.log(\n        \"[ResponseHistory] Streaming completo o actualización no incremental\"\n      );\n\n      // Comprobar si se debe finalizar el streaming\n      const isStreamingComplete = response.content.length > 50;\n\n      // Si el streaming ha terminado, quitar clase de animación\n      if (\n        isStreamingComplete &&\n        contentElement.dataset.streamingActive === \"true\"\n      ) {\n        contentElement.classList.remove(\"typing-animation\");\n        contentElement.dataset.streamingActive = \"false\";\n\n        // Preservar el contenido texto antes de aplicar markdown\n        const textContent = response.content;\n\n        // Hacer una copia del contenido para restaurar punto de scroll\n        const scrollTop = responseEntry.parentNode?.scrollTop || 0;\n\n        // Aplicar formato markdown si está disponible\n        if (this.markdownHandler) {\n          try {\n            contentElement.innerHTML =\n              this.markdownHandler.convert(textContent);\n          } catch (error) {\n            console.error(\"[ResponseHistory] Error applying markdown:\", error);\n            contentElement.textContent = textContent;\n          }\n        } else {\n          contentElement.textContent = textContent;\n        }\n\n        // Restaurar desplazamiento para evitar saltos\n        if (responseEntry.parentNode) {\n          responseEntry.parentNode.scrollTop = scrollTop;\n        }\n      }\n      // Si no es incremental pero no es final de streaming, actualizar normalmente\n      else if (!isIncrementalUpdate) {\n        if (this.markdownHandler) {\n          contentElement.innerHTML = this.markdownHandler.convert(\n            response.content\n          );\n        } else {\n          contentElement.textContent = response.content;\n        }\n      }\n    }\n  }\n\n  getTypingPlaceholder() {\n    return '<span class=\"typing\">|</span>';\n  }\n\n  getResponse(id) {\n    return this.responses.find((response) => response.id === parseInt(id));\n  }\n\n  removeResponse(id) {\n    this.responses = this.responses.filter((r) => r.id !== id);\n    this.render();\n  }\n\n  clear() {\n    this.responses = [];\n    this.render();\n  }\n\n  render() {\n    const style = document.createElement(\"style\");\n\n    // Añadir estilos base junto con mejoras para el layout compacto\n    style.textContent = `\n      ${variables}\n      ${animations}\n      ${previewStyles}\n      ${responseHistoryStyles}\n      \n      /* Optimizaciones de layout */\n      .response-container {\n        overflow-y: auto;\n        max-height: 100%;\n        padding: 0;\n        margin: 0;\n        display: flex;\n        flex-direction: column;\n      }\n      \n      /* Reducir tamaño de los contenedores de respuesta */\n      .response-entry {\n        margin-bottom: 0.75rem !important;\n        padding: 0.75rem !important;\n        border-radius: var(--ai-radius);\n        max-height: fit-content;\n        overflow: visible;\n      }\n      \n      /* Reducir margen entre elementos */\n      .response-content {\n        margin: 0.25rem 0 !important;\n        line-height: 1.4 !important;\n        padding: 0 !important;\n      }\n      \n      /* Ajustar espaciado de cabecera */\n      .response-header {\n        margin-bottom: 0.25rem !important;\n      }\n      \n      /* Ajustar espaciado de pie */\n      .response-footer {\n        padding-top: 0.5rem !important;\n        margin-top: 0.25rem !important;\n      }\n      \n      /* Optimizar espaciado de párrafos */\n      .response-content p,\n      .response-content ul,\n      .response-content ol {\n        margin: 0.25em 0 !important;\n      }\n      \n      /* Reducir margen en listas */\n      .response-content ul, \n      .response-content ol {\n        padding-left: 1.25em !important;\n      }\n      \n      /* Optimizar tamaño de imágenes */\n      .question-image img {\n        width: 80px !important;\n        height: 80px !important;\n      }\n      \n      /* Ajustar espaciado de preguntas con imágenes */\n      .question-container {\n        gap: 0.5rem !important;\n      }\n      \n      /* Optimizar tamaño de botones */\n      .response-action {\n        padding: 0.35rem !important;\n      }\n      \n      .tool-button {\n        padding: 0.35rem 0.75rem !important;\n      }\n      \n      /* Optimizar indicadores de escritura */\n      .typing-indicator {\n        padding: 0.125rem 0 !important;\n      }\n    `;\n\n    const container = document.createElement(\"div\");\n    container.className = \"response-container\";\n\n    // Crear entradas de respuesta con el nuevo método optimizado\n    this.responses.forEach((response) => {\n      container.appendChild(this.createResponseEntry(response));\n    });\n\n    // Limpiar y actualizar el shadow DOM\n    while (this.shadowRoot.firstChild) {\n      this.shadowRoot.removeChild(this.shadowRoot.firstChild);\n    }\n\n    this.shadowRoot.appendChild(style);\n    this.shadowRoot.appendChild(container);\n\n    // Auto-scroll al último mensaje si hay respuestas\n    if (this.responses.length > 0) {\n      requestAnimationFrame(() => {\n        container.scrollTop = container.scrollHeight;\n      });\n    }\n  }\n\n  formatTimestamp(timestamp) {\n    if (!timestamp) return \"\";\n\n    try {\n      console.log(\"[ResponseHistory] Formatting timestamp:\", timestamp);\n      return new Date(timestamp).toLocaleTimeString(this.language || \"en\", {\n        hour: \"2-digit\",\n        minute: \"2-digit\",\n      });\n    } catch (error) {\n      console.error(\"[ResponseHistory] Error formatting timestamp:\", error);\n      return \"\";\n    }\n  }\n}\n\ncustomElements.define(\"response-history\", ResponseHistory);\n","// styles/components/chat.js\nexport const chatStyles = `\n\n  .chat-form {\n    display: flex;\n    gap: 0.5rem;\n  }\n\n  .chat-container {\n  border: 1px solid var(--ai-border);\n    border-radius: 8px;\n    background: white;\n  }\n\n  .chat-input {\n    flex: 1;\n    padding: 0.75rem;\n    border: 1px solid var(--ai-border);\n    border-radius: var(--ai-radius);\n    font-family: var(--ai-font-sans);\n    transition: border-color 0.2s ease;\n  }\n\n  .chat-input:focus {\n    outline: none;\n    border-color: var(--ai-primary);\n  }\n\n  .chat-submit {\n    display: inline-flex;\n    align-items: center;\n    gap: 0.5rem;\n    padding: 0.75rem 1rem;\n    background: var(--ai-primary);\n    color: white;\n    border: none;\n    border-radius: var(--ai-radius);\n    cursor: pointer;\n    transition: background-color 0.2s ease;\n  }\n\n  .chat-submit:hover {\n    background: var(--ai-primary-hover);\n  }\n`;\n","// styles/components/image-preview.js\nexport const imagePreviewStyles = `\n  .image-preview-card {\n    background: var(--ai-background);\n    border: 1px solid var(--ai-border);\n    border-radius: var(--ai-radius);\n    padding: 1rem;\n    margin-bottom: 1rem;\n    animation: fadeIn 0.3s ease forwards;\n  }\n\n  .image-preview-content {\n    display: flex;\n    align-items: flex-start;\n    gap: 1rem;\n  }\n\n  .image-preview-thumbnail {\n    width: 96px;\n    height: 96px;\n    position: relative;\n    border-radius: var(--ai-radius);\n    overflow: hidden;\n    background: var(--ai-background-light);\n  }\n\n  .image-preview-thumbnail img {\n    width: 100%;\n    height: 100%;\n    object-fit: cover;\n  }\n\n  .image-preview-info {\n    flex: 1;\n  }\n\n  .image-preview-label {\n    font-size: 0.875rem;\n    color: var(--ai-text-light);\n    margin-bottom: 0.25rem;\n  }\n\n  .image-preview-filename {\n    font-size: 0.875rem;\n    color: var(--ai-text);\n  }\n\n  .image-preview-remove {\n    padding: 0.25rem;\n    border: none;\n    background: none;\n    color: var(--ai-text-light);\n    cursor: pointer;\n    opacity: 0.7;\n    transition: all 0.2s ease;\n  }\n\n  .image-preview-remove:hover {\n    opacity: 1;\n    color: var(--ai-text);\n  }\n\n  /* Estilos para el botón de upload en el chat */\n  .chat-actions {\n    display: flex;\n    align-items: center;\n    gap: 0.5rem;\n    margin-bottom: 1rem;\n  }\n\n  .chat-upload-button {\n    display: inline-flex;\n    align-items: center;\n    gap: 0.5rem;\n    padding: 0.375rem 0.75rem;\n    background: var(--ai-background-light);\n    border: 1px solid var(--ai-border);\n    border-radius: var(--ai-radius);\n    color: var(--ai-text);\n    font-size: 0.875rem;\n    cursor: pointer;\n    transition: all 0.2s ease;\n  }\n\n  .chat-upload-button:hover {\n    background: var(--ai-secondary);\n    border-color: var(--ai-border);\n  }\n\n  .chat-upload-button svg {\n    width: 16px;\n    height: 16px;\n  }\n\n  /* Ocultar input de archivo */\n  .hidden {\n    display: none !important;\n  }\n`;\n","// Enhanced ChatWithImage.js\nimport { TRANSLATIONS } from \"../constants/translations.js\";\nimport { variables } from \"../styles/base/variables.js\";\nimport { animations } from \"../styles/base/animations.js\";\nimport { chatStyles } from \"../styles/components/chat.js\";\nimport { imagePreviewStyles } from \"../styles/components/image-preview.js\";\n\nexport class ChatWithImage extends HTMLElement {\n  constructor() {\n    super();\n    this.attachShadow({ mode: \"open\" });\n    this.tempImage = null;\n    // Don't initialize initialPrompt here since it's a getter\n  }\n\n  static get observedAttributes() {\n    return [\n      \"language\",\n      \"image-url\",\n      \"initial-prompt\",\n      \"has-content\",\n      \"has-context\",\n      \"supports-images\",\n      \"apiProvider\",\n      \"apiModel\",\n      \"temperature\",\n    ];\n  }\n\n  get apiProvider() {\n    return this.getAttribute(\"apiProvider\") || \"\";\n  }\n\n  get apiModel() {\n    return this.getAttribute(\"apiModel\") || \"\";\n  }\n\n  get temperature() {\n    return this.getAttribute(\"temperature\") || \"\";\n  }\n\n  get supportsImages() {\n    return this.getAttribute(\"supports-images\") === \"true\";\n  }\n\n  get language() {\n    return this.getAttribute(\"language\") || \"en\";\n  }\n\n  get translations() {\n    return TRANSLATIONS[this.language] || TRANSLATIONS.en;\n  }\n\n  get imageUrl() {\n    return this.getAttribute(\"image-url\");\n  }\n\n  get initialPrompt() {\n    return this.getAttribute(\"initial-prompt\") || \"\";\n  }\n\n\n\n  async connectedCallback() {\n    this.render();\n    this.setupEventListeners();\n\n    if (this.imageUrl) {\n      await this.handleImageUrl(this.imageUrl);\n    }\n\n    // Set initial prompt if available\n    this.setInitialPrompt();\n  }\n\n  attributeChangedCallback(name, oldValue, newValue) {\n    if (oldValue === newValue) return;\n\n    switch (name) {\n      case \"language\":\n        this.updateTranslations();\n        break;\n      case \"image-url\":\n        if (newValue) {\n          this.handleImageUrl(newValue);\n        }\n        break;\n      case \"apiProvider\":\n        this.updateUploadVisibility();\n        break;\n      case \"initial-prompt\":\n      case \"has-content\":\n      case \"has-context\":\n        this.updateInitialPrompt();\n        break;\n    }\n  }\n\n  setInitialPrompt() {\n    if (!this.shadowRoot) return;\n\n    const chatInput = this.shadowRoot.querySelector(\".chat-input\");\n    if (!chatInput) return;\n\n    // Determine which initial prompt to use\n    let prompt = \"\";\n\n    const content = this.getAttribute(\"content\") || this.currentContent || \"\";\n    const context = this.getAttribute(\"context\") || \"\";\n\n    const hasContent = !!content.trim();\n    const hasContext = !!context.trim();\n\n    if (hasContent && hasContext) {\n      // Ambos presentes\n      prompt =\n        (this.translations?.chat?.contentAndContextPrompt\n          ? `${this.translations.chat.contentAndContextPrompt}\\n\\n${content}\\n\\n${this.translations?.chat?.contextLabel || \"Contexto:\"}\\n${context}`\n          : `Mejora el siguiente texto considerando el siguiente contexto:\\n\\n${content}\\n\\nContexto:\\n${context}`);\n    } else if (hasContent) {\n      // Solo contenido\n      prompt =\n        (this.translations?.chat?.contentPrompt\n          ? `${this.translations.chat.contentPrompt}\\n\\n${content}`\n          : `Mejora el siguiente texto:\\n\\n${content}`);\n    } else if (hasContext) {\n      // Solo contexto\n      prompt =\n        (this.translations?.chat?.contextPrompt\n          ? `${this.translations.chat.contextPrompt}\\n\\n${context}`\n          : `Crea una descripción profesional basado en este contexto:\\n\\n${context}`);\n    } else if (this.initialPrompt) {\n      prompt = this.initialPrompt;\n    }\n\n    // Set the prompt in the input\n    if (prompt && chatInput.innerText.trim() === \"\") {\n      chatInput.innerText = prompt;\n\n      // Place cursor at end of text\n      if (document.activeElement === chatInput) {\n        const selection = window.getSelection();\n        const range = document.createRange();\n        range.selectNodeContents(chatInput);\n        range.collapse(false);\n        selection.removeAllRanges();\n        selection.addRange(range);\n      }\n    }\n  }\n\n  updateInitialPrompt() {\n    // Check if the input is empty before updating to avoid overwriting user input\n    const chatInput = this.shadowRoot?.querySelector(\".chat-input\");\n    if (chatInput && chatInput.innerText.trim() === \"\") {\n      this.setInitialPrompt();\n    }\n  }\n\n  updateImagePreview() {\n    // Remove this method's content - we don't want to show preview in chat\n    // Just keep track of the selected image\n    const existingPreview = this.shadowRoot.querySelector(\n      \".image-preview-container\"\n    );\n    if (existingPreview) {\n      existingPreview.remove();\n    }\n  }\n\n  render() {\n    const style = document.createElement(\"style\");\n    style.textContent = `\n      ${variables}\n      ${animations}\n      ${chatStyles}\n      \n      .chat-form {\n        display: flex;\n        gap: 8px;\n        align-items: flex-start;\n        padding: 8px;\n      }\n      \n      .chat-input-container {\n        position: relative;\n        flex: 1;\n        display: flex;\n        align-items: flex-end;\n      }\n      \n      .chat-submit {\n        flex-shrink: 0;\n        width: 32px;\n        height: 32px;\n        padding: 0;\n        display: inline-flex;\n        align-items: center;\n        justify-content: center;\n      }\n      \n      .chat-input {\n        flex: 1;\n        min-height: 24px;\n        max-height: 150px;\n        padding: 12px;\n        padding-right: 40px;\n        background: var(--ai-background);\n        color: var(--ai-text);\n        font-size: 14px;\n        line-height: 1.5;\n        overflow-y: auto;\n        white-space: pre-wrap;\n        word-wrap: break-word;\n      }\n      \n      .chat-input:empty::before {\n        content: attr(data-placeholder);\n        color: var(--ai-text-light);\n      }\n      \n      .chat-input:focus {\n        outline: none;\n      }\n      \n      .chat-upload-button {\n        display: inline-flex;\n        cursor: pointer;\n        color: var(--ai-text-light);\n        width: 32px;\n        height: 32px;\n        background: lightgray;\n        padding: 0;\n        align-items: center;\n        justify-content: center;\n        border-radius: var(--ai-radius);\n        border: 0;\n        flex-shrink: 0;\n      }\n      \n      .chat-upload-button:hover {\n        color: var(--ai-text);\n      }\n      \n      .hidden {\n        display: none !important;\n      }\n    `;\n\n    const template = `\n      <div class=\"chat-container\">\n        <form class=\"chat-form\">\n          <div class=\"chat-input-container\">\n            <div class=\"chat-input\" \n                 contenteditable=\"true\" \n                 data-placeholder=\"${\n                   this.translations?.chat?.placeholder || \"Ask a question...\"\n                 }\"\n                 role=\"textbox\"\n                 aria-multiline=\"true\"></div>\n          </div>\n          ${\n            this.supportsImages\n              ? `\n            <label class=\"chat-upload-button\" title=\"Upload image\">\n              <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n                <path d=\"M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h7\"/>\n                <circle cx=\"9\" cy=\"9\" r=\"2\"/>\n                <path d=\"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21\"/>\n              </svg>\n              <input type=\"file\" accept=\"image/*\" class=\"hidden\" id=\"imageInput\">\n            </label>\n          `\n              : \"\"\n          }\n          <button type=\"submit\" class=\"chat-submit\">\n            <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n              <path d=\"M5 12h14\"/>\n              <path d=\"m12 5 7 7-7 7\"/>\n            </svg>\n          </button>\n        </form>\n      </div>\n    `;\n\n    this.shadowRoot.innerHTML = \"\";\n    this.shadowRoot.appendChild(style);\n    this.shadowRoot.appendChild(\n      document.createRange().createContextualFragment(template)\n    );\n  }\n\n  setupEventListeners() {\n    const form = this.shadowRoot.querySelector(\".chat-form\");\n    const input = this.shadowRoot.querySelector(\".chat-input\");\n    const uploadButton = this.shadowRoot.querySelector(\".chat-upload-button\");\n    const imageInput = this.shadowRoot.querySelector(\"#imageInput\");\n\n    form.addEventListener(\"submit\", this.handleSubmit.bind(this));\n\n    // Prevent default enter behavior and handle form submission\n    input.addEventListener(\"keydown\", (e) => {\n      if (e.key === \"Enter\" && !e.shiftKey) {\n        e.preventDefault();\n        form.dispatchEvent(new Event(\"submit\"));\n      }\n    });\n\n    // Focus event to set initial prompt if input is empty\n    input.addEventListener(\"focus\", () => {\n      if (input.innerText.trim() === \"\") {\n        this.setInitialPrompt();\n      }\n    });\n\n    if (uploadButton && imageInput) {\n      uploadButton.addEventListener(\"click\", (e) => {\n        // Prevent the click event from triggering multiple times\n        e.stopPropagation();\n      });\n\n      imageInput.addEventListener(\"change\", (e) => {\n        this.handleFileSelect(e);\n        // Reset the input value to allow selecting the same file again\n        e.target.value = \"\";\n      });\n    }\n  }\n\n  handleFileSelect(event) {\n    const file = event.target.files[0];\n    if (file) {\n      this.tempImage = file;\n    }\n  }\n\n  /**\n   * Método handleSubmit actualizado para manejar URLs de imágenes\n   */\n  handleSubmit(event) {\n    event.preventDefault();\n    event.stopPropagation();\n\n    const input = this.shadowRoot.querySelector(\".chat-input\");\n    const message = input.innerText.trim();\n\n    if (message || this.tempImage) {\n      this.dispatchEvent(\n        new CustomEvent(\"chatMessage\", {\n          detail: {\n            message,\n            image: this.tempImage,\n            apiProvider: this.apiProvider,\n            apiModel: this.apiModel,\n            temperature: this.temperature,\n          },\n          bubbles: true,\n          composed: true,\n        })\n      );\n      input.innerText = \"\";\n\n      // Limpiar imagen temporal y vista previa\n      this.tempImage = null;\n      const container = this.shadowRoot.querySelector(\n        \".image-preview-container\"\n      );\n      if (container) {\n        container.remove();\n      }\n    }\n  }\n\n  updateTranslations() {\n    const input = this.shadowRoot.querySelector(\".chat-input\");\n    const submitButton = this.shadowRoot.querySelector(\".chat-submit\");\n\n    if (input && submitButton) {\n      input.setAttribute(\n        \"data-placeholder\",\n        this.translations?.chat?.placeholder || \"Ask a question...\"\n      );\n      submitButton.innerHTML = `\n        <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n          <path d=\"M5 12h14\"/>\n          <path d=\"m12 5 7 7-7 7\"/>\n        </svg>\n      `;\n    }\n\n    // Update initial prompt based on new language\n    this.updateInitialPrompt();\n  }\n\n  updateUploadVisibility() {\n    const uploadButton = this.shadowRoot.querySelector(\".chat-upload-button\");\n    if (uploadButton) {\n      uploadButton.style.display = this.supportsImages ? \"inline-flex\" : \"none\";\n    }\n  }\n\n  /**\n   * Maneja una URL de imagen, con soporte para URLs con restricciones CORS\n   * @param {string} url - URL de la imagen\n   * @returns {Promise<void>}\n   */\n  /**\n   * Método actualizado para manejar imageUrl\n   * Con soporte para URLs con restricciones CORS\n   */\n  async handleImageUrl(url) {\n    if (!url) return;\n\n    console.log(\"[ChatWithImage] Processing image URL:\", url);\n\n    try {\n      // Primero intentamos el método tradicional: fetch + blob\n      try {\n        const response = await fetch(url, {\n          mode: \"cors\",\n          credentials: \"omit\", // Evitar cookies para reducir problemas CORS\n          cache: \"no-store\", // Evitar problemas de caché\n        });\n\n        const blob = await response.blob();\n        const file = new File([blob], \"image.jpg\", { type: blob.type });\n        this.tempImage = file;\n\n        console.log(\"[ChatWithImage] Successfully loaded image via fetch\");\n        this.updateImagePreview();\n        return;\n      } catch (fetchError) {\n        console.warn(\"[ChatWithImage] Error fetching image:\", fetchError);\n\n        // Si falla, usamos la URL directamente\n        this.tempImage = url; // Guardar URL como string\n        console.log(\n          \"[ChatWithImage] Using URL directly due to CORS restrictions\"\n        );\n\n        // Crear vista previa aunque no podamos cargar la imagen directamente\n        this.updateImagePreviewForURL(url);\n      }\n    } catch (error) {\n      console.error(\"[ChatWithImage] Error loading image:\", error);\n    }\n  }\n\n  /**\n   * Nuevo método para actualizar la vista previa usando una URL\n   */\n  updateImagePreviewForURL(url) {\n    if (!url) return;\n\n    // Obtener nombre de archivo de la URL\n    let filename = \"image\";\n    try {\n      const urlObj = new URL(url);\n      const pathParts = urlObj.pathname.split(\"/\");\n      if (pathParts.length > 0) {\n        const lastPart = pathParts[pathParts.length - 1];\n        if (lastPart) {\n          filename = lastPart;\n        }\n      }\n    } catch (e) {\n      console.warn(\"[ChatWithImage] Error parsing image URL for filename\");\n    }\n\n    const container = document.createElement(\"div\");\n    container.className = \"image-preview-container\";\n    container.innerHTML = `\n    <div class=\"image-preview-card\">\n      <div class=\"image-preview-content\">\n        <div class=\"image-preview-thumbnail\">\n          <img src=\"${url}\" alt=\"Preview\" onerror=\"this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9IiNmMWYxZjEiLz48dGV4dCB4PSI1MCUiIHk9IjUwJSIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjE0IiBmaWxsPSIjNDQ0IiBkb21pbmFudC1iYXNlbGluZT0ibWlkZGxlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj5JbWFnZSBub3QgYXZhaWxhYmxlPC90ZXh0Pjwvc3ZnPg=='\"/>\n        </div>\n        <div class=\"image-preview-info\">\n          <div class=\"image-preview-filename\">\n            ${filename} (External URL)\n          </div>\n          <button class=\"image-preview-remove\" title=\"Remove image\">\n            <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n              <line x1=\"18\" y1=\"6\" x2=\"6\" y2=\"18\"></line>\n              <line x1=\"6\" y1=\"6\" x2=\"18\" y2=\"18\"></line>\n            </svg>\n          </button>\n        </div>\n      </div>\n    </div>\n  `;\n\n    // Buscar contenedor existente y reemplazarlo\n    const existingContainer = this.shadowRoot.querySelector(\n      \".image-preview-container\"\n    );\n    if (existingContainer) {\n      existingContainer.remove();\n    }\n\n    // Añadir nuevo contenedor\n    this.shadowRoot\n      .querySelector(\".chat-form\")\n      .parentNode.insertBefore(\n        container,\n        this.shadowRoot.querySelector(\".chat-form\")\n      );\n\n    // Agregar evento de clic para eliminar\n    const removeButton = container.querySelector(\".image-preview-remove\");\n    if (removeButton) {\n      removeButton.addEventListener(\"click\", () => {\n        this.tempImage = null;\n        container.remove();\n      });\n    }\n  }\n}\n\ncustomElements.define(\"chat-with-image\", ChatWithImage);\n","// src/components/ToolBar.js\nimport { TRANSLATIONS } from \"../constants/translations.js\";\nimport { getToolIcon } from \"../services/icon-service.js\";\nimport { variables } from \"../styles/base/variables.js\";\nimport { toolbarStyles } from \"../styles/components/toolbar.js\";\n\nexport class ToolBar extends HTMLElement {\n  constructor() {\n    super();\n    this.attachShadow({ mode: \"open\" });\n    this.currentAction = \"improve\";\n  }\n\n  static get observedAttributes() {\n    return [\"has-content\", \"language\"];\n  }\n\n  get hasContent() {\n    return this.getAttribute(\"has-content\") === \"true\";\n  }\n\n  get language() {\n    return this.getAttribute(\"language\") || \"en\";\n  }\n\n  get translations() {\n    return TRANSLATIONS[this.language] || TRANSLATIONS.en;\n  }\n\n  connectedCallback() {\n    this.render();\n    this.bindEvents();\n  }\n\n  attributeChangedCallback(name, oldValue, newValue) {\n    if (oldValue === newValue) return;\n  \n    if (name === 'language') {\n      // Re-render the entire toolbar when language changes\n      this.render();\n    } else if (name === 'has-content') {\n      this.updateVisibleTools();\n    }\n  }\n\n  render() {\n    const style = document.createElement(\"style\");\n    style.textContent = `\n      :host {\n        display: block;\n      }\n\n      .tools {\n        display: flex;\n        gap: 8px;\n        margin-bottom: 16px;\n        flex-wrap: wrap;\n      }\n\n      .tool-button {\n        display: inline-flex;\n        align-items: center;\n        gap: 8px;\n        padding: 8px 16px;\n        border: none;\n        border-radius: 6px;\n        background: #e5e7eb;\n        cursor: pointer;\n        font-family: inherit;\n      }\n\n      .tool-button:hover {\n        background: #d1d5db;\n      }\n\n      .tool-button.active {\n        background: #3b82f6;\n        color: white;\n      }\n\n      .tool-button svg {\n        width: 16px;\n        height: 16px;\n      }\n    `;\n\n    this.shadowRoot.innerHTML = \"\";\n    this.shadowRoot.appendChild(style);\n    this.shadowRoot.appendChild(this.createToolbar());\n    \n    requestAnimationFrame(() => {\n      this.updateVisibleTools();\n    });\n  }\n\n  createToolbar() {\n    const toolbar = document.createElement(\"div\");\n    toolbar.className = \"tools\";\n\n    const tools = [\n      { action: \"improve\", label: this.translations.tools.improve },\n      { action: \"summarize\", label: this.translations.tools.summarize },\n      { action: \"expand\", label: this.translations.tools.expand },\n      { action: \"paraphrase\", label: this.translations.tools.paraphrase },\n      { action: \"more-formal\", label: this.translations.tools[\"more-formal\"] || this.translations.tools.formal },\n      { action: \"more-casual\", label: this.translations.tools[\"more-casual\"] || this.translations.tools.casual }\n    ];\n\n    tools.forEach((tool) => {\n      const button = document.createElement(\"button\");\n      button.className = \"tool-button\";\n      button.dataset.action = tool.action;\n      // Asegurarse de que siempre hay una etiqueta\n      const label = tool.label || tool.action;\n      button.innerHTML = `${getToolIcon(tool.action)}${label}`;\n      toolbar.appendChild(button);\n    });\n\n    return toolbar;\n  }\n\n  bindEvents() {\n    this.shadowRoot.querySelectorAll(\".tool-button\").forEach((button) => {\n      button.onclick = () => {\n        this.setActiveAction(button.dataset.action);\n        this.dispatchEvent(\n          new CustomEvent(\"toolaction\", {\n            detail: { action: button.dataset.action },\n            bubbles: true,\n            composed: true,\n          })\n        );\n      };\n    });\n  }\n\n  setActiveAction(action) {\n    this.currentAction = action;\n    this.shadowRoot.querySelectorAll(\".tool-button\").forEach((button) => {\n      button.classList.toggle(\"active\", button.dataset.action === action);\n    });\n  }\n\n  updateVisibleTools() {\n    const hasContent = this.hasContent;\n    const improveButton = this.shadowRoot.querySelector('[data-action=\"improve\"]');\n    const tools = this.shadowRoot.querySelectorAll(\".tool-button\");\n\n    if (!hasContent) {\n      improveButton.innerHTML = `\n        <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n          <path d=\"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z\"/>\n          <path d=\"M5 3v4\"/><path d=\"M19 17v4\"/><path d=\"M3 5h4\"/><path d=\"M17 19h4\"/>\n        </svg>\n        ${this.translations.tools.generate || 'Generate'}\n      `;\n    } else {\n      improveButton.innerHTML = `${getToolIcon(\"improve\")}${this.translations.tools.improve}`;\n    }\n\n    tools.forEach((tool) => {\n      const action = tool.dataset.action;\n      if (hasContent) {\n        tool.style.display = \"inline-flex\";\n      } else {\n        tool.style.display = action === \"improve\" ? \"inline-flex\" : \"none\";\n      }\n    });\n  }\n\n  getCurrentAction() {\n    return this.currentAction;\n  }\n}\n\ncustomElements.define(\"ai-toolbar\", ToolBar);\n","// token-manager.js\n\n\n\nexport class TokenManager {\n  constructor() {\n\n    // Average tokens per character for different languages\n    this.tokensPerChar = {\n      en: 0.25, // English: ~4 chars per token\n      es: 0.28, // Spanish: ~3.6 chars per token\n      fr: 0.28, // French: ~3.6 chars per token\n      de: 0.3, // German: ~3.3 chars per token (compound words)\n      zh: 0.5, // Chinese: ~2 chars per token\n      ja: 0.5, // Japanese: ~2 chars per token\n    };\n\n    this.defaultTokensPerChar = 0.25;\n  }\n}\n","// markdown-handler.js\nexport class MarkdownHandler {\n  constructor() {\n    this.marked = null;\n  }\n\n  async initialize() {\n    try {\n      const { marked } = await import('https://cdn.jsdelivr.net/npm/marked/lib/marked.esm.js');\n      this.marked = marked;\n      \n      this.marked.setOptions({\n        gfm: true,\n        breaks: true,\n        sanitize: false\n      });\n    } catch (error) {\n      console.error('Error initializing markdown handler:', error);\n      throw error;\n    }\n  }\n\n  convert(text) {\n    if (!text || !this.marked) return text;\n    return this.marked(text);\n  }\n}\n","// api-client.js - Versión mejorada con corrección del procesamiento de streams\n// Eliminado ModelManager, ya no es necesario para múltiples providers\n\nclass APIClient {\n  constructor(config = {}) {\n    this.config = {\n      proxyEndpoint:\n        config.proxyEndpoint ||\n        \"https://llmproxy.mitienda.host/index.php/api/llm-proxy\",\n      temperature: config.temperature || 0.7,\n      sessionToken: config.sessionToken || \"\",\n      systemPrompt:\n        config.systemPrompt ||\n        \"Actúa como un experto en redacción de descripciones de productos para tiendas en línea.\\n\\n\" +\n          \"Tu tarea es generar o mejorar la descripción de un producto con un enfoque atractivo y persuasivo, destacando sus características principales, beneficios y posibles usos.\\n\\n\" +\n          \"Si el usuario ya ha escrito una descripción: Mejórala manteniendo su esencia, pero haciéndola más clara, persuasiva y optimizada para ventas.\\n\\n\" +\n          \"Si la descripción está vacía: Genera una nueva descripción atractiva, destacando características y beneficios. Usa un tono profesional y cercano, adaptado a una tienda en línea.\\n\\n\" +\n          \"Si hay una imagen del producto, aprovecha los detalles visuales para enriquecer la descripción.\\n\\n\" +\n          \"Si aplica, menciona información relevante del comercio para reforzar la confianza del comprador (envíos, garantía, atención al cliente, etc.).\\n\\n\" +\n          \"Mantén el texto claro, sin repeticiones innecesarias, y optimizado para SEO si es posible.\",\n      tenantId: config.tenantId || \"\",\n      userId: config.userId || \"\",\n      componentId: config.componentId || \"\",\n      debugMode: config.debugMode || false,\n    };\n    this._streamCounter = 0;\n  }\n\n  setSessionToken(token) {\n    this.config.sessionToken = token;\n  }\n\n  // Métodos de provider y modelo eliminados. Solo se permite actualizar el proxyEndpoint y parámetros seguros.\n  updateConfig(config) {\n    if (config.sessionToken) {\n      this.setSessionToken(config.sessionToken);\n    }\n    if (config.tenantId) {\n      this.config.tenantId = config.tenantId;\n    }\n    if (config.userId) {\n      this.config.userId = config.userId;\n    }\n    if (config.componentId) {\n      this.config.componentId = config.componentId;\n    }\n    if (config.proxyEndpoint) {\n      this.config.proxyEndpoint = config.proxyEndpoint;\n    }\n    if (config.debugMode !== undefined) {\n      this.config.debugMode = config.debugMode;\n    }\n  }\n\n  // Método mejorado para processStream\n  async processStream(response, onProgress) {\n    const reader = response.body.getReader();\n    const decoder = new TextDecoder();\n    let buffer = \"\";\n    let completeText = \"\";\n    let accumulatedChunks = [];\n    let streamedChars = 0;\n    let chunkCounter = 0;\n\n    try {\n      console.log(\"[APIClient] Iniciando procesamiento de stream\");\n\n      // Función para procesar JSON y extraer contenido\n      const extractContentFromJSON = (data) => {\n        let content = \"\";\n\n        if (\n          data.choices &&\n          data.choices[0].delta &&\n          data.choices[0].delta.content !== undefined\n        ) {\n          // Formato OpenAI\n          content = data.choices[0].delta.content;\n        } else if (data.text !== undefined) {\n          // Formato común alternativo\n          content = data.text;\n        } else if (data.content !== undefined) {\n          // Otro formato común\n          content = data.content;\n        } else if (data.delta && data.delta.text !== undefined) {\n          // Formato específico de algunos modelos\n          content = data.delta.text;\n        }\n\n        return content;\n      };\n\n      // Verificar si es el inicio de la respuesta\n      let isFirstContentChunk = true;\n\n      while (true) {\n        const { done, value } = await reader.read();\n\n        if (done) {\n          console.log(\n            \"[APIClient] Stream completado con\",\n            streamedChars,\n            \"caracteres procesados\"\n          );\n\n          // Procesar cualquier contenido pendiente en el buffer\n          if (buffer.trim()) {\n            try {\n              // Intento final de extraer contenido estructurado\n              const jsonMatch = buffer.match(/data: ({.*})/);\n              if (jsonMatch) {\n                try {\n                  const data = JSON.parse(jsonMatch[1]);\n                  const content = extractContentFromJSON(data);\n                  if (content) {\n                    completeText += content;\n                    onProgress(content);\n                  }\n                } catch (e) {\n                  // Si falla, usar el buffer como texto plano\n                  completeText += buffer.trim();\n                  onProgress(buffer.trim());\n                }\n              } else {\n                // Usar como texto plano\n                const cleanBuffer = buffer.replace(/^data:\\s*/, \"\").trim();\n                if (cleanBuffer && cleanBuffer !== \"[DONE]\") {\n                  completeText += cleanBuffer;\n                  onProgress(cleanBuffer);\n                }\n              }\n            } catch (e) {\n              console.warn(\"[APIClient] Error procesando buffer final:\", e);\n            }\n          }\n          break;\n        }\n\n        // Decodificar el chunk recibido y añadirlo al buffer\n        const chunk = decoder.decode(value, { stream: true });\n        buffer += chunk;\n        chunkCounter++;\n\n        if (this.config.debugMode) {\n          console.log(\n            `[APIClient] Chunk #${chunkCounter} recibido:`,\n            chunk.length > 100\n              ? `${chunk.substring(0, 100)}... (${chunk.length} chars)`\n              : chunk\n          );\n          // Guardar para análisis\n          accumulatedChunks.push(chunk);\n        }\n\n        // Procesamos líneas completas\n        const lines = buffer.split(\"\\n\");\n        buffer = lines.pop() || \"\"; // El último elemento puede estar incompleto\n\n        let foundContent = false;\n\n        for (const line of lines) {\n          // Filtrar líneas que son datos de la API\n          if (line.startsWith(\"data: \")) {\n            const content = line.slice(5).trim();\n\n            if (content === \"[DONE]\") continue;\n\n            let jsonData;\n            try {\n              jsonData = JSON.parse(content);\n            } catch (e) {\n              // Si no es JSON válido y no está vacío, tratar como texto plano\n              if (content.trim()) {\n                foundContent = true;\n                completeText += content;\n                onProgress(content);\n              }\n              continue;\n            }\n\n            const extractedContent = extractContentFromJSON(jsonData);\n\n            if (extractedContent) {\n              foundContent = true;\n              completeText += extractedContent;\n              streamedChars += extractedContent.length;\n\n              // Llamar a onProgress con solo el nuevo contenido\n              onProgress(extractedContent);\n            }\n          }\n        }\n\n        // Si no hemos encontrado contenido en las líneas pero tenemos datos\n        // en el buffer, intentamos verificar si hay datos parciales\n        if (!foundContent && buffer.includes(\"data: {\")) {\n          try {\n            const parts = buffer.split(\"data: \");\n            for (let i = 1; i < parts.length; i++) {\n              if (parts[i].trim() && parts[i].includes('\"delta\":{\"content\":')) {\n                try {\n                  // Intentar extraer contenido de delta\n                  const match = parts[i].match(/\"content\":\"([^\"]*)\"/);\n                  if (match && match[1]) {\n                    const content = match[1];\n                    completeText += content;\n                    streamedChars += content.length;\n                    onProgress(content);\n\n                    // Limpiar la parte procesada del buffer\n                    const processed = parts[i].substring(\n                      0,\n                      match.index + match[0].length\n                    );\n                    buffer = buffer.replace(processed, \"\");\n\n                    if (isFirstContentChunk) {\n                      isFirstContentChunk = false;\n                      if (this.config.debugMode) {\n                        console.log(\n                          `[APIClient] Primer fragmento (buffer): \"${content}\"`\n                        );\n                      }\n                    }\n                  }\n                } catch (e) {\n                  console.warn(\n                    \"[APIClient] Error procesando buffer parcial:\",\n                    e\n                  );\n                }\n              }\n            }\n          } catch (e) {\n            console.warn(\"[APIClient] Error analizando buffer:\", e);\n          }\n        }\n      }\n\n      // Verificación final del resultado\n      if (this.config.debugMode) {\n        console.log(\n          `[APIClient] Texto completo (${completeText.length} chars):`,\n          completeText.substring(0, 50) +\n            (completeText.length > 50 ? \"...\" : \"\")\n        );\n\n        // Verificar si hay problemas con el inicio\n        if (completeText.startsWith(\"aro,\") && accumulatedChunks.length > 0) {\n          console.warn(\n            \"[APIClient] Posible pérdida del inicio. Primeros chunks:\",\n            accumulatedChunks.slice(0, 3)\n          );\n        }\n      }\n\n      return completeText;\n    } catch (error) {\n      console.error(\"[APIClient] Error en procesamiento de stream:\", error);\n      throw error;\n    }\n  }\n\n  async makeRequest(prompt, content, onProgress = () => {}) {\n    try {\n      const model = this.config.models[this.config.provider];\n      if (!model) {\n        throw new Error(\"Model not configured for provider\");\n      }\n\n      // Crear wrapper para onProgress que nos permita debugging\n      const progressHandler = this.config.debugMode\n        ? this._createDebugProgressHandler(onProgress)\n        : onProgress;\n\n      // Preparar el payload para el proxy\n      const payload = {\n        provider: this.config.provider,\n        model: model,\n        messages: [\n          {\n            role: \"system\",\n            content: this.config.systemPrompt,\n          },\n          {\n            role: \"user\",\n            content: `${prompt}\\n\\n${content || \"Crea una nueva descripción.\"}`,\n          },\n        ],\n        temperature: this.config.temperature,\n        stream: true,\n        tenantId: this.config.tenantId,\n        userId: this.config.userId,\n        buttonId: this.config.componentId, // Cambiado de componentId a buttonId\n        debugMode: this.config.debugMode,\n      };\n\n      console.log(\n        \"[APIClient] Enviando solicitud al proxy:\",\n        this.config.proxyEndpoint\n      );\n      console.log(\n        \"[APIClient] JSON exacto de la solicitud:\",\n        JSON.stringify(\n          {\n            endpoint: this.config.proxyEndpoint,\n            method: \"POST\",\n            headers: {\n              \"Content-Type\": \"application/json\",\n            },\n            body: JSON.stringify(payload),\n          },\n          null,\n          2\n        )\n      );\n      if (this.config.debugMode) {\n        console.log(\"[APIClient] Payload:\", JSON.stringify(payload, null, 2));\n      }\n\n      // Reset stream counter for each request\n      this._streamCounter = 0;\n\n      const response = await fetch(this.config.proxyEndpoint, {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify(payload),\n      });\n\n      console.log(\"[APIClient] Respuesta del proxy:\", {\n        status: response.status,\n        ok: response.ok,\n        headers: Object.fromEntries([...response.headers.entries()]),\n      });\n\n      if (!response.ok) {\n        let errorMessage;\n        try {\n          const errorData = await response.json();\n          errorMessage =\n            errorData.error?.message ||\n            `API Error: ${response.status} ${response.statusText}`;\n        } catch (e) {\n          errorMessage = `API Error: ${response.status} ${response.statusText}`;\n        }\n        throw new Error(errorMessage);\n      }\n\n      return await this.processStream(response, progressHandler);\n    } catch (error) {\n      console.error(\"[APIClient] Error al hacer la solicitud:\", error);\n      throw new APIError(error.message, error);\n    }\n  }\n\n  /**\n   * Versión actualizada de makeRequestWithImage que maneja URLs con CORS\n   * @param {string} prompt - El prompt para la IA\n   * @param {string} content - El contenido a procesar\n   * @param {string|File} imageSource - URL de imagen o archivo\n   * @param {Function} onProgress - Callback para streaming de respuesta\n   * @returns {Promise<string>} El texto generado\n   */\n  async makeRequestWithImage(\n    prompt,\n    content,\n    imageSource,\n    onProgress = () => {}\n  ) {\n    try {\n      let imageData;\n      let imageUrl;\n      let mimeType = \"image/jpeg\"; // Default mime type\n      let isExternalUrl = false;\n\n      if (typeof imageSource === \"string\") {\n        // Es una URL - guardamos directamente\n        imageUrl = imageSource;\n        isExternalUrl = true;\n        console.log(\"[APIClient] Using external image URL:\", imageUrl);\n      } else if (imageSource instanceof File) {\n        // Es un archivo - convertimos a base64\n        imageData = await this.imageToBase64(imageSource);\n        mimeType = imageSource.type || mimeType;\n        console.log(\"[APIClient] Image file processed, type:\", mimeType);\n      } else {\n        throw new Error(\"Invalid image source\");\n      }\n\n      // Wrapper para debugging de onProgress\n      const progressHandler = this.config.debugMode\n        ? this._createDebugProgressHandler(onProgress)\n        : onProgress;\n\n      // Construir mensajes según el formato de cada proveedor\n      const messages = [];\n\n      if (this.config.provider === \"openai\") {\n        messages.push({\n          role: \"system\",\n          content: this.config.systemPrompt,\n        });\n\n        // Contenido de usuario con texto e imagen\n        const userContent = [\n          {\n            type: \"text\",\n            text: `${prompt}\\n\\n${\n              content || \"Please create a new description.\"\n            }`,\n          },\n        ];\n\n        // Añadir la imagen en el formato correcto\n        if (isExternalUrl) {\n          userContent.push({\n            type: \"image_url\",\n            image_url: { url: imageUrl, detail: \"high\" },\n          });\n        } else {\n          userContent.push({\n            type: \"image_url\",\n            image_url: {\n              url: `data:${mimeType};base64,${imageData}`,\n              detail: \"high\",\n            },\n          });\n        }\n\n        messages.push({\n          role: \"user\",\n          content: userContent,\n        });\n      } else if (this.config.provider === \"anthropic\") {\n        // Contenido de usuario con texto e imagen\n        const userContent = [\n          {\n            type: \"text\",\n            text: this.config.systemPrompt,\n          },\n        ];\n\n        // Añadir la imagen en el formato correcto\n        if (isExternalUrl) {\n          userContent.push({\n            type: \"image\",\n            source: { type: \"url\", url: imageUrl },\n          });\n        } else {\n          userContent.push({\n            type: \"image\",\n            source: { type: \"base64\", media_type: mimeType, data: imageData },\n          });\n        }\n\n        // Añadir el prompt del usuario\n        userContent.push({\n          type: \"text\",\n          text: `${prompt}\\n\\n${content || \"Please create a new description.\"}`,\n        });\n\n        messages.push({\n          role: \"user\",\n          content: userContent,\n        });\n      } else if (this.config.provider === \"google\") {\n        // Formato para Google Gemini\n        const userParts = [\n          {\n            text: `${this.config.systemPrompt}\\n\\n${prompt}\\n\\n${\n              content || \"Please create a new description.\"\n            }`,\n          },\n        ];\n\n        // Añadir la imagen en el formato correcto\n        if (isExternalUrl) {\n          // Para URLs externas, podemos necesitar un formato diferente\n          // que el proxy backend pueda manejar adecuadamente\n          userParts.push({\n            externalImageUrl: imageUrl, // Campo personalizado para el proxy\n          });\n        } else {\n          userParts.push({\n            inline_data: {\n              mime_type: mimeType,\n              data: imageData,\n            },\n          });\n        }\n\n        messages.push({\n          role: \"user\",\n          parts: userParts,\n        });\n      }\n\n      // Get the appropriate vision model\n      const visionModel = this.modelManager.getVisionModelForProvider(\n        this.config.provider\n      );\n\n      const payload = {\n        provider: this.config.provider,\n        model: visionModel || this.config.models[this.config.provider],\n        messages: messages,\n        temperature: this.config.temperature,\n        stream: true,\n        tenantId: this.config.tenantId,\n        userId: this.config.userId,\n        buttonId: this.config.componentId, // Cambiado de componentId a buttonId\n        hasImage: true,\n        isExternalImageUrl: isExternalUrl, // Indicador para el servidor\n      };\n\n      console.log(\"[APIClient] Sending image request to proxy:\", {\n        endpoint: this.config.proxyEndpoint,\n        provider: this.config.provider,\n        model: payload.model,\n        hasImage: true,\n        isExternalUrl: isExternalUrl,\n      });\n\n      // Reset stream counter for each request\n      this._streamCounter = 0;\n\n      const response = await fetch(this.config.proxyEndpoint, {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n          ...(this.config.sessionToken && {\n            Authorization: `Bearer ${this.config.sessionToken}`,\n          }),\n        },\n        body: JSON.stringify(payload),\n      });\n\n      console.log(\n        \"[APIClient] Image request response status:\",\n        response.status,\n        response.statusText\n      );\n\n      if (!response.ok) {\n        // Manejo de errores\n        try {\n          const errorData = await response.json();\n          console.error(\"[APIClient] Image API Error Response:\", errorData);\n          throw new Error(\n            errorData.error?.message ||\n              `API Error: ${response.status} ${response.statusText}`\n          );\n        } catch (parseError) {\n          console.error(\n            \"[APIClient] Failed to parse error response:\",\n            parseError\n          );\n          const rawText = await response.text().catch(() => \"\");\n          console.error(\"[APIClient] Raw error response:\", rawText);\n          throw new Error(\n            `API Error: ${response.status} ${response.statusText}`\n          );\n        }\n      }\n\n      return await this.processStream(response, progressHandler);\n    } catch (error) {\n      console.error(\"[APIClient] Image processing error:\", error);\n      throw new Error(`Image processing failed: ${error.message}`);\n    }\n  }\n\n  /**\n   * Función de ayuda para crear el formato correcto para una imagen según el proveedor\n   * @param {string|Object} imageSource - URL de imagen o datos base64\n   * @param {string} mimeType - Tipo MIME para imágenes base64\n   * @returns {Object} Objeto con el formato correcto para la API\n   */\n  formatImageForProvider(imageSource, mimeType) {\n    // Si imageSource es una string, asumimos que es una URL\n    const isExternalUrl = typeof imageSource === \"string\";\n    const provider = this.config.provider;\n\n    if (provider === \"openai\") {\n      if (isExternalUrl) {\n        return {\n          type: \"image_url\",\n          image_url: {\n            url: imageSource,\n            detail: \"high\",\n          },\n        };\n      } else {\n        return {\n          type: \"image_url\",\n          image_url: {\n            url: `data:${mimeType};base64,${imageSource}`,\n            detail: \"high\",\n          },\n        };\n      }\n    } else if (provider === \"anthropic\") {\n      if (isExternalUrl) {\n        return {\n          type: \"image\",\n          source: {\n            type: \"url\",\n            url: imageSource,\n          },\n        };\n      } else {\n        return {\n          type: \"image\",\n          source: {\n            type: \"base64\",\n            media_type: mimeType,\n            data: imageSource,\n          },\n        };\n      }\n    } else if (provider === \"google\") {\n      if (isExternalUrl) {\n        // Algunos proveedores como Google Gemini pueden necesitar un formato especial\n        // para las URLs externas que no podemos convertir a base64\n        return {\n          externalImageUrl: imageSource, // Campo personalizado para el proxy\n        };\n      } else {\n        return {\n          inline_data: {\n            mime_type: mimeType,\n            data: imageSource,\n          },\n        };\n      }\n    }\n\n    // Formato por defecto - probablemente necesitarás ajustar esto\n    return isExternalUrl ? { url: imageSource } : { base64: imageSource };\n  }\n\n  async imageToBase64(imageFile) {\n    if (!imageFile) {\n      throw new Error(\"No image file provided\");\n    }\n\n    if (!imageFile.type.startsWith(\"image/\")) {\n      throw new Error(\"Invalid file type. Please provide an image file.\");\n    }\n\n    return new Promise((resolve, reject) => {\n      const reader = new FileReader();\n      reader.onload = () => {\n        try {\n          const result = reader.result.split(\",\")[1];\n          if (!result) {\n            reject(new Error(\"Failed to convert image to base64\"));\n            return;\n          }\n          resolve(result);\n        } catch (error) {\n          reject(new Error(\"Failed to process image data\"));\n        }\n      };\n      reader.onerror = () => reject(new Error(\"Failed to read image file\"));\n      reader.readAsDataURL(imageFile);\n    });\n  }\n\n  async enhanceText(\n    content,\n    action = \"improve\",\n    imageFile = null,\n    context = \"\",\n    onProgress = () => {}\n  ) {\n    const prompts = {\n      improve: `Mejora esta descripción considerando estos detalles del producto:\\n${context}\\n\\nDescripción actual:`,\n      summarize: `Teniendo en cuenta estos detalles del producto:\\n${context}\\n\\nCrea un resumen conciso y efectivo de la siguiente descripción:`,\n      expand: `Basándote en estos detalles del producto:\\n${context}\\n\\nExpande esta descripción añadiendo más detalles, beneficios y casos de uso:`,\n      paraphrase: `Considerando estos detalles del producto:\\n${context}\\n\\nReescribe esta descripción manteniendo el mensaje principal pero con un enfoque fresco:`,\n      \"more-formal\": `Usando estos detalles del producto:\\n${context}\\n\\nReescribe esta descripción con un tono más formal, profesional y técnico, manteniendo la información clave pero usando un lenguaje más sofisticado y corporativo:`,\n      \"more-casual\": `Usando estos detalles del producto:\\n${context}\\n\\nReescribe esta descripción con un tono más casual y cercano, como si estuvieras explicándolo a un amigo, manteniendo un lenguaje accesible y conversacional pero sin perder profesionalismo:`,\n      empty: `Usando estos detalles del producto:\\n${context}\\n\\nCrea una descripción profesional y atractiva que destaque sus características principales:`,\n    };\n\n    const prompt = prompts[action] || prompts.improve;\n\n    // Función wrapper para el manejo de progreso\n    const progressHandler = this.config.debugMode\n      ? this._createDebugProgressHandler(onProgress)\n      : onProgress;\n\n    try {\n      if (\n        imageFile &&\n        this.modelManager.isImageSupportedForProvider(this.config.provider)\n      ) {\n        return await this.makeRequestWithImage(\n          prompt,\n          content,\n          imageFile,\n          progressHandler\n        );\n      } else {\n        return await this.makeRequest(prompt, content, progressHandler);\n      }\n    } catch (error) {\n      console.error(\"[APIClient] Error in enhanceText:\", error);\n      throw new Error(`Error al mejorar el texto: ${error.message}`);\n    }\n  }\n\n  async chatResponse(content, message, image = null, onProgress = () => {}) {\n    try {\n      // Wrapper para debugging de progreso\n      const progressHandler = this.config.debugMode\n        ? this._createDebugProgressHandler(onProgress)\n        : onProgress;\n\n      // Preparamos los mensajes para enviar al proxy\n      let messages = [\n        { role: \"system\", content: this.config.systemPrompt },\n        { role: \"user\", content: content },\n      ];\n\n      let hasImage = false;\n\n      if (message) {\n        // Si hay imagen y el proveedor la soporta, formatear adecuadamente\n        if (\n          image &&\n          this.modelManager.isImageSupportedForProvider(this.config.provider)\n        ) {\n          try {\n            const imageData = await this.imageToBase64(image);\n            const mimeType = image.type || \"image/jpeg\"; // Default to jpeg if type is not available\n            console.log(\"[APIClient] Chat with image - file type:\", mimeType);\n\n            hasImage = true;\n\n            if (this.config.provider === \"openai\") {\n              messages.push({\n                role: \"user\",\n                content: [\n                  { type: \"text\", text: message },\n                  {\n                    type: \"image_url\",\n                    image_url: {\n                      url: `data:${mimeType};base64,${imageData}`,\n                      detail: \"auto\",\n                    },\n                  },\n                ],\n              });\n            } else if (this.config.provider === \"anthropic\") {\n              messages.push({\n                role: \"user\",\n                content: [\n                  { type: \"text\", text: message },\n                  {\n                    type: \"image\",\n                    source: {\n                      type: \"base64\",\n                      media_type: mimeType,\n                      data: imageData,\n                    },\n                  },\n                ],\n              });\n            } else if (this.config.provider === \"google\") {\n              // Google Gemini format\n              messages.push({\n                role: \"user\",\n                parts: [\n                  { text: message },\n                  {\n                    inline_data: {\n                      mime_type: mimeType,\n                      data: imageData,\n                    },\n                  },\n                ],\n              });\n            } else {\n              // Para proveedores que no soportan imágenes, enviar solo texto\n              messages.push({ role: \"user\", content: message });\n              hasImage = false;\n            }\n          } catch (imageError) {\n            console.error(\n              \"[APIClient] Failed to process image for chat:\",\n              imageError\n            );\n            // Fallback to text-only message\n            messages.push({ role: \"user\", content: message });\n            hasImage = false;\n          }\n        } else {\n          // Sin imagen, solo añadir el mensaje normal\n          messages.push({ role: \"user\", content: message });\n        }\n      }\n\n      // Seleccionar el modelo adecuado\n      const model = this.config.model || \"gpt-3.5-turbo\";\n\n      const payload = {\n        provider: this.config.provider,\n        model: model,\n        messages: messages,\n        temperature: this.config.temperature,\n        stream: true,\n        tenantId: this.config.tenantId,\n        userId: this.config.userId,\n        buttonId: this.config.componentId, // Cambiado de componentId a buttonId\n        hasImage: hasImage,\n      };\n\n      console.log(\n        \"[APIClient] Payload completo de la solicitud:\",\n        JSON.stringify(payload, null, 2)\n      );\n\n      console.log(\"[APIClient] Sending chat request to proxy:\", {\n        endpoint: this.config.proxyEndpoint,\n        provider: this.config.provider,\n        model: payload.model,\n        hasImage: hasImage,\n      });\n\n      // Reset stream counter for each request\n      this._streamCounter = 0;\n\n      const response = await fetch(this.config.proxyEndpoint, {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n          ...(this.config.sessionToken && {\n            Authorization: `Bearer ${this.config.sessionToken}`,\n          }),\n        },\n        body: JSON.stringify(payload),\n      });\n\n      console.log(\n        \"[APIClient] Chat response status:\",\n        response.status,\n        response.statusText\n      );\n\n      if (!response.ok) {\n        try {\n          const errorData = await response.json();\n          console.error(\"[APIClient] Chat API Error Response:\", errorData);\n          throw new Error(\n            errorData.error?.message ||\n              `API Error: ${response.status} ${response.statusText}`\n          );\n        } catch (parseError) {\n          console.error(\n            \"[APIClient] Failed to parse error response:\",\n            parseError\n          );\n          const rawText = await response.text().catch(() => \"\");\n          console.error(\"[APIClient] Raw error response:\", rawText);\n          throw new Error(\n            `API Error: ${response.status} ${response.statusText}`\n          );\n        }\n      }\n\n      return await this.processStream(response, progressHandler);\n    } catch (error) {\n      console.error(\"[APIClient] Chat response error:\", error);\n      throw new APIError(`Chat response failed: ${error.message}`, error);\n    }\n  }\n\n  get supportsImages() {\n    return this.modelManager.isImageSupportedForProvider(this.config.provider);\n  }\n\n  // Método auxiliar para crear wrapper de debug para onProgress\n  _createDebugProgressHandler(originalHandler) {\n    let chunkIndex = 0;\n\n    return (chunk) => {\n      // Log del chunk recibido\n      console.log(\n        `[APIClient] Progress chunk #${chunkIndex}:`,\n        chunk.length > 30\n          ? `${chunk.substring(0, 30)}... (${chunk.length} chars)`\n          : chunk,\n        `[${Array.from(chunk.substring(0, 5))\n          .map((c) => c.charCodeAt(0))\n          .join(\",\")}]`\n      );\n\n      // Verificar primeros chunks con cuidado\n      if (chunkIndex < 3) {\n        // Análisis específico para los primeros fragmentos\n        if (chunkIndex === 0 && chunk.length < 5) {\n          console.warn(\"[APIClient] ⚠️ Primer fragmento es muy corto:\", chunk);\n        }\n\n        // Verificar si parece un fragmento incompleto\n        if ((chunkIndex === 0 && chunk === \"aro\") || chunk === \"laro\") {\n          console.warn(\n            \"[APIClient] ⚠️ PROBLEMA DETECTADO: Fragmento inicial incompleto:\",\n            chunk\n          );\n        }\n      }\n\n      // Llamar al manejador original\n      if (typeof originalHandler === \"function\") {\n        originalHandler(chunk);\n      }\n\n      chunkIndex++;\n    };\n  }\n}\n\nclass APIError extends Error {\n  constructor(message, originalError = null) {\n    super(message);\n    this.name = \"APIError\";\n    this.originalError = originalError;\n  }\n}\n\nexport function createAPIClient(config = {}) {\n  return new APIClient(config);\n}\n","// cache-manager.js\n\nexport class CacheManager {\n  constructor(options = {}) {\n    this.options = {\n      prefix: options.prefix || \"ai-text-enhancer-cache\",\n      maxItems: options.maxItems || 20,\n      ttl: options.ttl || 30 * 60 * 1000, // 30 minutes in milliseconds\n      storage: options.storage || window.sessionStorage,\n    };\n\n    // Ensure storage is available\n    this.validateStorage();\n  }\n\n  /**\n   * Validates that storage is available and working\n   * @throws {Error} If storage is not available\n   */\n  validateStorage() {\n    try {\n      const testKey = `${this.options.prefix}-test`;\n      this.options.storage.setItem(testKey, \"test\");\n      this.options.storage.removeItem(testKey);\n    } catch (error) {\n      throw new Error(\"Storage is not available: \" + error.message);\n    }\n  }\n\n  /**\n   * Generates a cache key for a given action and content\n   * @param {string} action - The action being performed\n   * @param {string} content - The content being processed\n   * @returns {string} The generated cache key\n   */\n  generateKey(action, content) {\n    const hash = this.hashString(content);\n    return `${this.options.prefix}-${action}-${hash}`;\n  }\n\n  /**\n   * Creates a hash from a string\n   * @param {string} str - The string to hash\n   * @returns {string} The hashed string\n   */\n  hashString(str) {\n    let hash = 0;\n    for (let i = 0; i < str.length; i++) {\n      const char = str.charCodeAt(i);\n      hash = (hash << 5) - hash + char;\n      hash = hash & hash;\n    }\n    return Math.abs(hash).toString(36);\n  }\n\n  /**\n   * Gets a value from cache\n   * @param {string} action - The action associated with the cached content\n   * @param {string} content - The original content\n   * @returns {string|null} The cached value or null if not found/expired\n   */\n  get(action, content) {\n    try {\n      const key = this.generateKey(action, content);\n      const cachedItem = this.options.storage.getItem(key);\n\n      if (!cachedItem) return null;\n\n      const item = JSON.parse(cachedItem);\n\n      // Check if item has expired\n      if (Date.now() - item.timestamp > this.options.ttl) {\n        this.delete(action, content);\n        return null;\n      }\n\n      return item.value;\n    } catch (error) {\n      console.error(\"Error reading from cache:\", error);\n      return null;\n    }\n  }\n\n  /**\n   * Stores a value in cache\n   * @param {string} action - The action associated with the content\n   * @param {string} content - The original content\n   * @param {string} value - The value to cache\n   */\n  set(action, content, value) {\n    try {\n      const key = this.generateKey(action, content);\n      const item = {\n        value,\n        timestamp: Date.now(),\n      };\n\n      // Ensure we don't exceed max items\n      this.enforceSizeLimit();\n\n      this.options.storage.setItem(key, JSON.stringify(item));\n    } catch (error) {\n      console.error(\"Error writing to cache:\", error);\n      this.cleanup(); // Attempt to free up space\n    }\n  }\n\n  /**\n   * Deletes a specific item from cache\n   * @param {string} action - The action associated with the content\n   * @param {string} content - The original content\n   */\n  delete(action, content) {\n    const key = this.generateKey(action, content);\n    this.options.storage.removeItem(key);\n  }\n\n  /**\n   * Enforces the cache size limit\n   */\n  enforceSizeLimit() {\n    try {\n      const keys = this.getCacheKeys();\n      if (keys.length >= this.options.maxItems) {\n        // Remove oldest items first\n        const itemsToRemove = keys\n          .map((key) => ({\n            key,\n            timestamp: JSON.parse(this.options.storage.getItem(key)).timestamp,\n          }))\n          .sort((a, b) => a.timestamp - b.timestamp)\n          .slice(0, keys.length - this.options.maxItems + 1);\n\n        itemsToRemove.forEach((item) => {\n          this.options.storage.removeItem(item.key);\n        });\n      }\n    } catch (error) {\n      console.error(\"Error enforcing cache size limit:\", error);\n    }\n  }\n\n  /**\n   * Gets all cache keys for this instance\n   * @returns {string[]} Array of cache keys\n   */\n  getCacheKeys() {\n    const keys = [];\n    for (let i = 0; i < this.options.storage.length; i++) {\n      const key = this.options.storage.key(i);\n      if (key.startsWith(this.options.prefix)) {\n        keys.push(key);\n      }\n    }\n    return keys;\n  }\n\n  /**\n   * Cleans up expired items\n   */\n  cleanup() {\n    try {\n      const now = Date.now();\n      const keys = this.getCacheKeys();\n\n      keys.forEach((key) => {\n        const item = JSON.parse(this.options.storage.getItem(key));\n        if (now - item.timestamp > this.options.ttl) {\n          this.options.storage.removeItem(key);\n        }\n      });\n    } catch (error) {\n      console.error(\"Error during cache cleanup:\", error);\n    }\n  }\n\n  /**\n   * Clears all cached items for this instance\n   */\n  clear() {\n    const keys = this.getCacheKeys();\n    keys.forEach((key) => {\n      this.options.storage.removeItem(key);\n    });\n  }\n\n  /**\n   * Gets cache statistics\n   * @returns {Object} Cache statistics\n   */\n  getStats() {\n    try {\n      const keys = this.getCacheKeys();\n      const now = Date.now();\n      let totalSize = 0;\n      let expiredCount = 0;\n\n      keys.forEach((key) => {\n        const item = JSON.parse(this.options.storage.getItem(key));\n        totalSize += JSON.stringify(item).length;\n        if (now - item.timestamp > this.options.ttl) {\n          expiredCount++;\n        }\n      });\n\n      return {\n        totalItems: keys.length,\n        expiredItems: expiredCount,\n        totalSize: totalSize,\n        maxItems: this.options.maxItems,\n      };\n    } catch (error) {\n      console.error(\"Error getting cache stats:\", error);\n      return null;\n    }\n  }\n}\n\n// Factory function for creating cache managers\nexport function createCacheManager(options = {}) {\n  return new CacheManager(options);\n}\n","// src/utils/tinymce-adapter.js\n/**\n * Adaptador especializado para la integración con TinyMCE\n * Mejorado para soportar múltiples versiones (v3, v4, v5, v6)\n */\nexport class TinyMCEAdapter {\n  /**\n   * Crea un nuevo adaptador para TinyMCE\n   * @param {string} editorId - ID del elemento contenedor de TinyMCE\n   * @param {Object} options - Opciones adicionales\n   */\n  constructor(editorId, options = {}) {\n    this.editorId = editorId;\n    this.options = {\n      debug: options.debug || false,\n      waitTimeout: options.waitTimeout || 2000,\n      useGlobalReference: options.useGlobalReference !== false, // Por defecto usa referencias globales\n      ...options,\n    };\n\n    this.editorInstance = null;\n    this._initialized = false;\n    this.tmceVersion = null; // Versión de TinyMCE detectada\n\n    // Intentar obtener la instancia de TinyMCE (si ya está inicializada)\n    this._findEditorInstance();\n  }\n\n  /**\n   * Detecta la versión de TinyMCE\n   * @private\n   * @returns {number|null} Versión principal de TinyMCE (3, 4, 5 o 6) o null si no se puede detectar\n   */\n  _detectTinyMCEVersion() {\n    try {\n      if (typeof window.tinymce === \"undefined\") {\n        return null;\n      }\n\n      // Intentar detectar por la versión\n      if (window.tinymce.majorVersion) {\n        return parseInt(window.tinymce.majorVersion, 10);\n      }\n\n      // Alternativa: detectar por características específicas de cada versión\n      if (typeof window.tinymce.createEditor === \"function\") {\n        return 6; // Característica de v6\n      } else if (typeof window.tinymce.dom?.TreeWalker === \"function\") {\n        return 5; // Característica de v5\n      } else if (typeof window.tinymce.dom?.EventUtils === \"function\") {\n        return 4; // Característica de v4\n      } else if (typeof window.tinymce.dom?.Event === \"function\") {\n        return 3; // Característica de v3\n      }\n\n      // Si no podemos detectar específicamente, asumimos v4 como fallback común\n      return 4;\n    } catch (error) {\n      console.error(\"[TinyMCEAdapter] Error detecting TinyMCE version:\", error);\n      return null;\n    }\n  }\n\n  /**\n   * Busca la instancia de TinyMCE ya sea por ID o en el objeto global\n   * @private\n   */\n  _findEditorInstance() {\n    try {\n      // Detectar versión de TinyMCE\n      this.tmceVersion = this._detectTinyMCEVersion();\n\n      if (this.options.debug) {\n        console.log(\n          `[TinyMCEAdapter] Detected TinyMCE version: ${\n            this.tmceVersion || \"unknown\"\n          }`\n        );\n      }\n\n      // Verificar si tinymce existe en el contexto global\n      if (typeof window.tinymce !== \"undefined\") {\n        // Obtener la instancia del editor\n        let instance = null;\n\n        // Diferentes métodos según la versión\n        if (this.tmceVersion >= 3) {\n          instance = window.tinymce.get(this.editorId);\n        }\n\n        // Verificar opciones adicionales de búsqueda\n        if (!instance && this.options.useGlobalReference) {\n          // Verificar si hay una instancia global para este ID específico\n          const globalInstanceKey = `tinyMCE_${this.editorId}`;\n          if (window[globalInstanceKey]) {\n            instance = window[globalInstanceKey];\n          }\n\n          // Verificar si hay una instancia marcada específicamente\n          if (window.tinyMCEInstance) {\n            instance = window.tinyMCEInstance;\n          }\n        }\n\n        if (instance) {\n          this.editorInstance = instance;\n          this._initialized = true;\n\n          if (this.options.debug) {\n            console.log(\n              `[TinyMCEAdapter] Found editor instance for \"${this.editorId}\"`,\n              instance\n            );\n          }\n\n          return true;\n        }\n      }\n\n      if (this.options.debug) {\n        console.warn(\n          `[TinyMCEAdapter] TinyMCE instance not found for \"${this.editorId}\"`\n        );\n      }\n\n      return false;\n    } catch (error) {\n      console.error(`[TinyMCEAdapter] Error finding TinyMCE instance:`, error);\n      return false;\n    }\n  }\n\n  /**\n   * Espera a que TinyMCE esté inicializado\n   * @returns {Promise<boolean>} Promesa que se resuelve cuando el editor está listo\n   */\n  async waitForEditor() {\n    if (this._initialized && this.editorInstance) {\n      return true;\n    }\n\n    return new Promise((resolve) => {\n      // Intentar encontrar la instancia inmediatamente\n      if (this._findEditorInstance()) {\n        resolve(true);\n        return;\n      }\n\n      // Configurar un intervalo para verificar periódicamente\n      const startTime = Date.now();\n      const checkInterval = setInterval(() => {\n        if (this._findEditorInstance()) {\n          clearInterval(checkInterval);\n          resolve(true);\n          return;\n        }\n\n        // Verificar si hemos excedido el tiempo de espera\n        if (Date.now() - startTime > this.options.waitTimeout) {\n          clearInterval(checkInterval);\n          console.warn(\n            `[TinyMCEAdapter] Timeout waiting for TinyMCE to initialize`\n          );\n          resolve(false);\n        }\n      }, 100);\n    });\n  }\n\n  /**\n   * Verifica si el método existe en la instancia del editor y es una función\n   * @param {string} methodName - Nombre del método a verificar\n   * @returns {boolean} true si el método existe y es una función\n   */\n  _hasMethod(methodName) {\n    return (\n      this.editorInstance &&\n      typeof this.editorInstance[methodName] === \"function\"\n    );\n  }\n\n  /**\n   * Obtiene el contenido del editor\n   * @returns {string} El contenido HTML del editor o cadena vacía si no está disponible\n   */\n  async getContent() {\n    await this.waitForEditor();\n\n    try {\n      if (!this.editorInstance) {\n        throw new Error(\"No editor instance available\");\n      }\n\n      // Estrategia 1: Usar el método getContent directamente (v4+ principalmente)\n      if (this._hasMethod(\"getContent\")) {\n        try {\n          // Algunos editores necesitan especificar el formato\n          const content = this.editorInstance.getContent({ format: \"html\" });\n\n          if (this.options.debug) {\n            console.log(\n              `[TinyMCEAdapter] Retrieved content using getContent() (${\n                content?.length || 0\n              } chars)`\n            );\n          }\n\n          return content || \"\";\n        } catch (err) {\n          console.warn(\"[TinyMCEAdapter] Error using getContent():\", err);\n          // Continuar con otras estrategias\n        }\n      }\n\n      // Estrategia 2: Acceder al contenido mediante el DOM (v3-v4 fallback)\n      if (this.editorInstance.getBody) {\n        try {\n          const body = this.editorInstance.getBody();\n          if (body) {\n            const content = body.innerHTML;\n\n            if (this.options.debug) {\n              console.log(\n                `[TinyMCEAdapter] Retrieved content from body (${\n                  content?.length || 0\n                } chars)`\n              );\n            }\n\n            return content || \"\";\n          }\n        } catch (err) {\n          console.warn(\"[TinyMCEAdapter] Error accessing body content:\", err);\n        }\n      }\n\n      // Estrategia 3: Usar el área de contenido (v3 principalmente)\n      if (this.editorInstance.contentDocument) {\n        try {\n          const doc = this.editorInstance.contentDocument;\n          if (doc && doc.body) {\n            const content = doc.body.innerHTML;\n\n            if (this.options.debug) {\n              console.log(\n                `[TinyMCEAdapter] Retrieved content from contentDocument (${\n                  content?.length || 0\n                } chars)`\n              );\n            }\n\n            return content || \"\";\n          }\n        } catch (err) {\n          console.warn(\n            \"[TinyMCEAdapter] Error accessing contentDocument:\",\n            err\n          );\n        }\n      }\n\n      // Estrategia 4: Intentar con el original textarea\n      const textareaElement = document.getElementById(this.editorId);\n      if (textareaElement && textareaElement.value) {\n        if (this.options.debug) {\n          console.log(\n            `[TinyMCEAdapter] Retrieved content from textarea (${\n              textareaElement.value?.length || 0\n            } chars)`\n          );\n        }\n        return textareaElement.value;\n      }\n\n      // Si llegamos aquí, no pudimos obtener el contenido\n      console.error(\"[TinyMCEAdapter] All content retrieval methods failed\");\n      return \"\";\n    } catch (error) {\n      console.error(`[TinyMCEAdapter] Error getting content:`, error);\n      return \"\";\n    }\n  }\n\n  /**\n   * Establece el contenido del editor\n   * @param {string} content - El contenido HTML a establecer\n   * @returns {boolean} true si se estableció correctamente, false en caso contrario\n   */\n  async setContent(content) {\n    await this.waitForEditor();\n\n    try {\n      if (!this.editorInstance) {\n        throw new Error(\"No editor instance available\");\n      }\n\n      // Estrategia 1: Usar el método setContent directamente (v4+ principalmente)\n      if (this._hasMethod(\"setContent\")) {\n        try {\n          this.editorInstance.setContent(content);\n\n          // Agregar la acción al historial de deshacer si está disponible\n          if (\n            this._hasMethod(\"undoManager\") &&\n            this.editorInstance.undoManager &&\n            this._hasMethod(\"undoManager.add\")\n          ) {\n            this.editorInstance.undoManager.add();\n          }\n\n          if (this.options.debug) {\n            console.log(\n              `[TinyMCEAdapter] Content set successfully using setContent (${\n                content?.length || 0\n              } chars)`\n            );\n          }\n\n          return true;\n        } catch (err) {\n          console.warn(\"[TinyMCEAdapter] Error using setContent():\", err);\n          // Continuar con otras estrategias\n        }\n      }\n\n      // Estrategia 2: Establecer el contenido mediante el DOM (v3-v4 fallback)\n      if (this.editorInstance.getBody) {\n        try {\n          const body = this.editorInstance.getBody();\n          if (body) {\n            body.innerHTML = content;\n\n            if (this.options.debug) {\n              console.log(\n                `[TinyMCEAdapter] Content set successfully using body (${\n                  content?.length || 0\n                } chars)`\n              );\n            }\n\n            return true;\n          }\n        } catch (err) {\n          console.warn(\"[TinyMCEAdapter] Error setting body content:\", err);\n        }\n      }\n\n      // Estrategia 3: Usar el área de contenido (v3 principalmente)\n      if (this.editorInstance.contentDocument) {\n        try {\n          const doc = this.editorInstance.contentDocument;\n          if (doc && doc.body) {\n            doc.body.innerHTML = content;\n\n            if (this.options.debug) {\n              console.log(\n                `[TinyMCEAdapter] Content set successfully using contentDocument (${\n                  content?.length || 0\n                } chars)`\n              );\n            }\n\n            return true;\n          }\n        } catch (err) {\n          console.warn(\"[TinyMCEAdapter] Error setting contentDocument:\", err);\n        }\n      }\n\n      // Estrategia 4: Intentar con el original textarea\n      const textareaElement = document.getElementById(this.editorId);\n      if (textareaElement) {\n        textareaElement.value = content;\n\n        // Tratar de actualizar el editor desde el textarea\n        if (this._hasMethod(\"load\")) {\n          this.editorInstance.load();\n        }\n\n        if (this.options.debug) {\n          console.log(\n            `[TinyMCEAdapter] Content set using textarea (${\n              content?.length || 0\n            } chars)`\n          );\n        }\n\n        return true;\n      }\n\n      // Si llegamos aquí, no pudimos establecer el contenido\n      console.error(\"[TinyMCEAdapter] All content setting methods failed\");\n      return false;\n    } catch (error) {\n      console.error(`[TinyMCEAdapter] Error setting content:`, error);\n      return false;\n    }\n  }\n\n  /**\n   * Inserta contenido en la posición actual del cursor\n   * @param {string} content - El contenido HTML a insertar\n   * @returns {boolean} true si se insertó correctamente, false en caso contrario\n   */\n  async insertContent(content) {\n    await this.waitForEditor();\n\n    try {\n      if (!this.editorInstance) {\n        throw new Error(\"No editor instance available\");\n      }\n\n      // Estrategia 1: Usar commandExec con mceInsertContent (v4-v6)\n      if (this._hasMethod(\"execCommand\")) {\n        try {\n          this.editorInstance.execCommand(\"mceInsertContent\", false, content);\n\n          // Tratar de registrar para deshacer si disponible\n          if (\n            this._hasMethod(\"undoManager\") &&\n            this.editorInstance.undoManager &&\n            this._hasMethod(\"undoManager.add\")\n          ) {\n            this.editorInstance.undoManager.add();\n          }\n\n          if (this.options.debug) {\n            console.log(\n              `[TinyMCEAdapter] Content inserted successfully using execCommand`\n            );\n          }\n\n          return true;\n        } catch (err) {\n          console.warn(\"[TinyMCEAdapter] Error using execCommand():\", err);\n          // Continuar con otras estrategias\n        }\n      }\n\n      // Estrategia 2: Insertar directamente en la selección (v3-v4 fallback)\n      if (this._hasMethod(\"selection\") && this.editorInstance.selection) {\n        try {\n          const selection = this.editorInstance.selection;\n\n          if (this._hasMethod(\"selection.setContent\")) {\n            selection.setContent(content);\n\n            if (this.options.debug) {\n              console.log(\n                `[TinyMCEAdapter] Content inserted successfully using selection.setContent`\n              );\n            }\n\n            return true;\n          }\n        } catch (err) {\n          console.warn(\n            \"[TinyMCEAdapter] Error using selection.setContent():\",\n            err\n          );\n        }\n      }\n\n      // Estrategia 3: Fallback a reemplazar todo el contenido\n      return await this.setContent(content);\n    } catch (error) {\n      console.error(`[TinyMCEAdapter] Error inserting content:`, error);\n      return false;\n    }\n  }\n\n  /**\n   * Verifica si el editor está inicializado\n   * @returns {boolean} true si el editor está inicializado, false en caso contrario\n   */\n  isInitialized() {\n    return this._initialized && this.editorInstance !== null;\n  }\n\n  /**\n   * Obtiene la versión detectada de TinyMCE\n   * @returns {number|null} Versión principal de TinyMCE (3, 4, 5, 6) o null si no se detectó\n   */\n  getVersion() {\n    return this.tmceVersion;\n  }\n}\n\n/**\n * Función de ayuda para crear un adaptador TinyMCE\n * @param {string} editorId - ID del elemento contenedor de TinyMCE\n * @param {Object} options - Opciones adicionales\n * @returns {TinyMCEAdapter} Una nueva instancia del adaptador\n */\nexport function createTinyMCEAdapter(editorId, options = {}) {\n  return new TinyMCEAdapter(editorId, options);\n}\n","// src/utils/ckeditor-adapter.js\n/**\n * Adaptador especializado para la integración con CKEditor\n * Proporciona métodos para la interacción entre AITextEnhancer y CKEditor\n */\nexport class CKEditorAdapter {\n  /**\n   * Crea un nuevo adaptador para CKEditor\n   * @param {string} editorId - ID del elemento contenedor de CKEditor\n   * @param {Object} options - Opciones adicionales\n   */\n  constructor(editorId, options = {}) {\n    this.editorId = editorId;\n    this.options = {\n      debug: options.debug || false,\n      waitTimeout: options.waitTimeout || 2000,\n      ...options,\n    };\n\n    this.editorInstance = null;\n    this._initialized = false;\n\n    // Intentar obtener la instancia de CKEditor (si ya está inicializada)\n    this._findEditorInstance();\n  }\n\n  /**\n   * Busca la instancia de CKEditor ya sea por ID o en el objeto global\n   * @private\n   */\n  _findEditorInstance() {\n    try {\n      // Verificar si hay una instancia global (enfoque común para demos)\n      if (typeof window.ckeditorInstance !== \"undefined\") {\n        this.editorInstance = window.ckeditorInstance;\n        this._initialized = true;\n\n        if (this.options.debug) {\n          console.log(\n            `[CKEditorAdapter] Found editor instance from global variable`\n          );\n        }\n\n        return true;\n      }\n\n      // Alternativa: Buscar el elemento y verificar si tiene la propiedad ckeditorInstance\n      const editorElement = document.getElementById(this.editorId);\n      if (editorElement && editorElement.ckeditorInstance) {\n        this.editorInstance = editorElement.ckeditorInstance;\n        this._initialized = true;\n\n        if (this.options.debug) {\n          console.log(\n            `[CKEditorAdapter] Found editor instance from element property`\n          );\n        }\n\n        return true;\n      }\n\n      if (this.options.debug) {\n        console.warn(\n          `[CKEditorAdapter] CKEditor instance not found for \"${this.editorId}\"`\n        );\n      }\n\n      return false;\n    } catch (error) {\n      console.error(\n        `[CKEditorAdapter] Error finding CKEditor instance:`,\n        error\n      );\n      return false;\n    }\n  }\n\n  /**\n   * Espera a que CKEditor esté inicializado\n   * @returns {Promise<boolean>} Promesa que se resuelve cuando el editor está listo\n   */\n  async waitForEditor() {\n    if (this._initialized && this.editorInstance) {\n      return true;\n    }\n\n    return new Promise((resolve) => {\n      // Intentar encontrar la instancia inmediatamente\n      if (this._findEditorInstance()) {\n        resolve(true);\n        return;\n      }\n\n      // Configurar un intervalo para verificar periódicamente\n      const startTime = Date.now();\n      const checkInterval = setInterval(() => {\n        if (this._findEditorInstance()) {\n          clearInterval(checkInterval);\n          resolve(true);\n          return;\n        }\n\n        // Verificar si hemos excedido el tiempo de espera\n        if (Date.now() - startTime > this.options.waitTimeout) {\n          clearInterval(checkInterval);\n          console.warn(\n            `[CKEditorAdapter] Timeout waiting for CKEditor to initialize`\n          );\n          resolve(false);\n        }\n      }, 100);\n    });\n  }\n\n  /**\n   * Obtiene el contenido del editor\n   * @returns {string} El contenido HTML del editor o cadena vacía si no está disponible\n   */\n  async getContent() {\n    await this.waitForEditor();\n\n    try {\n      if (this.editorInstance) {\n        const content = this.editorInstance.getData();\n\n        if (this.options.debug) {\n          console.log(\n            `[CKEditorAdapter] Retrieved content (${content.length} chars)`\n          );\n        }\n\n        return content;\n      }\n    } catch (error) {\n      console.error(`[CKEditorAdapter] Error getting content:`, error);\n    }\n\n    return \"\";\n  }\n\n  /**\n   * Establece el contenido del editor\n   * @param {string} content - El contenido HTML a establecer\n   * @returns {boolean} true si se estableció correctamente, false en caso contrario\n   */\n  async setContent(content) {\n    await this.waitForEditor();\n\n    try {\n      if (this.editorInstance) {\n        this.editorInstance.setData(content);\n\n        if (this.options.debug) {\n          console.log(\n            `[CKEditorAdapter] Content set successfully (${content.length} chars)`\n          );\n        }\n\n        return true;\n      }\n    } catch (error) {\n      console.error(`[CKEditorAdapter] Error setting content:`, error);\n    }\n\n    return false;\n  }\n\n  /**\n   * Inserta contenido en la posición actual del cursor\n   * @param {string} content - El contenido HTML a insertar\n   * @returns {boolean} true si se insertó correctamente, false en caso contrario\n   */\n  async insertContent(content) {\n    await this.waitForEditor();\n\n    try {\n      if (this.editorInstance) {\n        const viewFragment = this.editorInstance.data.processor.toView(content);\n        const modelFragment = this.editorInstance.data.toModel(viewFragment);\n        this.editorInstance.model.insertContent(modelFragment);\n\n        if (this.options.debug) {\n          console.log(`[CKEditorAdapter] Content inserted successfully`);\n        }\n\n        return true;\n      }\n    } catch (error) {\n      console.error(`[CKEditorAdapter] Error inserting content:`, error);\n    }\n\n    return false;\n  }\n\n  /**\n   * Verifica si el editor está inicializado\n   * @returns {boolean} true si el editor está inicializado, false en caso contrario\n   */\n  isInitialized() {\n    return this._initialized && this.editorInstance !== null;\n  }\n}\n\n/**\n * Función de ayuda para crear un adaptador CKEditor\n * @param {string} editorId - ID del elemento contenedor de CKEditor\n * @param {Object} options - Opciones adicionales\n * @returns {CKEditorAdapter} Una nueva instancia del adaptador\n */\nexport function createCKEditorAdapter(editorId, options = {}) {\n  return new CKEditorAdapter(editorId, options);\n}\n","// src/utils/quill-adapter.js\n/**\n * Adaptador especializado para la integración con Quill Editor\n * Proporciona métodos para la interacción entre AITextEnhancer y Quill\n */\nexport class QuillAdapter {\n  /**\n   * Crea un nuevo adaptador para Quill\n   * @param {string} editorId - ID del elemento contenedor de Quill\n   * @param {Object} options - Opciones adicionales\n   */\n  constructor(editorId, options = {}) {\n    this.editorId = editorId;\n    this.options = {\n      debug: options.debug || false,\n      waitTimeout: options.waitTimeout || 2000,\n      ...options,\n    };\n\n    this.editorInstance = null;\n    this._initialized = false;\n\n    // Intentar obtener la instancia de Quill (si ya está inicializada)\n    this._findEditorInstance();\n  }\n\n  /**\n   * Busca la instancia de Quill ya sea por ID o en el objeto global\n   * @private\n   */\n  _findEditorInstance() {\n    try {\n      // Verificar si hay una instancia global (enfoque común para demos)\n      if (typeof window.quillInstance !== \"undefined\") {\n        this.editorInstance = window.quillInstance;\n        this._initialized = true;\n\n        if (this.options.debug) {\n          console.log(\n            `[QuillAdapter] Found editor instance from global variable`\n          );\n        }\n\n        return true;\n      }\n\n      // Alternativa: Buscar por el selector de Quill y su propiedad __quill\n      const editorElement = document.getElementById(this.editorId);\n      if (editorElement) {\n        // Intentar encontrar el editor por su ID y la propiedad __quill\n        const quillContainer = editorElement;\n        if (quillContainer && quillContainer.__quill) {\n          this.editorInstance = quillContainer.__quill;\n          this._initialized = true;\n\n          if (this.options.debug) {\n            console.log(\n              `[QuillAdapter] Found editor instance from element __quill property`\n            );\n          }\n\n          return true;\n        }\n\n        // Segundo intento: buscar el primer elemento con la clase ql-editor\n        const editor = quillContainer.querySelector(\".ql-editor\");\n        if (editor && editor.__quill) {\n          this.editorInstance = editor.__quill;\n          this._initialized = true;\n\n          if (this.options.debug) {\n            console.log(\n              `[QuillAdapter] Found editor instance from ql-editor element`\n            );\n          }\n\n          return true;\n        }\n      }\n\n      if (this.options.debug) {\n        console.warn(\n          `[QuillAdapter] Quill instance not found for \"${this.editorId}\"`\n        );\n      }\n\n      return false;\n    } catch (error) {\n      console.error(`[QuillAdapter] Error finding Quill instance:`, error);\n      return false;\n    }\n  }\n\n  /**\n   * Espera a que Quill esté inicializado\n   * @returns {Promise<boolean>} Promesa que se resuelve cuando el editor está listo\n   */\n  async waitForEditor() {\n    if (this._initialized && this.editorInstance) {\n      return true;\n    }\n\n    return new Promise((resolve) => {\n      // Intentar encontrar la instancia inmediatamente\n      if (this._findEditorInstance()) {\n        resolve(true);\n        return;\n      }\n\n      // Configurar un intervalo para verificar periódicamente\n      const startTime = Date.now();\n      const checkInterval = setInterval(() => {\n        if (this._findEditorInstance()) {\n          clearInterval(checkInterval);\n          resolve(true);\n          return;\n        }\n\n        // Verificar si hemos excedido el tiempo de espera\n        if (Date.now() - startTime > this.options.waitTimeout) {\n          clearInterval(checkInterval);\n          console.warn(\n            `[QuillAdapter] Timeout waiting for Quill to initialize`\n          );\n          resolve(false);\n        }\n      }, 100);\n    });\n  }\n\n  /**\n   * Obtiene el contenido del editor\n   * @returns {string} El contenido HTML del editor o cadena vacía si no está disponible\n   */\n  async getContent() {\n    await this.waitForEditor();\n\n    try {\n      if (this.editorInstance) {\n        // Quill tiene dos formas de obtener contenido:\n        // 1. getContents() - Devuelve un objeto Delta con formato interno de Quill\n        // 2. root.innerHTML - Devuelve el HTML del contenido\n\n        // Para compatibilidad con otros editores, devolvemos el HTML\n        const content = this.editorInstance.root.innerHTML;\n\n        if (this.options.debug) {\n          console.log(\n            `[QuillAdapter] Retrieved content (${content.length} chars)`\n          );\n        }\n\n        return content;\n      }\n    } catch (error) {\n      console.error(`[QuillAdapter] Error getting content:`, error);\n    }\n\n    return \"\";\n  }\n\n  /**\n   * Establece el contenido del editor\n   * @param {string} content - El contenido HTML a establecer\n   * @returns {boolean} true si se estableció correctamente, false en caso contrario\n   */\n  async setContent(content) {\n    await this.waitForEditor();\n\n    try {\n      if (this.editorInstance) {\n        // Quill puede configurar contenido como HTML\n        this.editorInstance.clipboard.dangerouslyPasteHTML(content);\n\n        if (this.options.debug) {\n          console.log(\n            `[QuillAdapter] Content set successfully (${content.length} chars)`\n          );\n        }\n\n        return true;\n      }\n    } catch (error) {\n      console.error(`[QuillAdapter] Error setting content:`, error);\n    }\n\n    return false;\n  }\n\n  /**\n   * Inserta contenido en la posición actual del cursor\n   * @param {string} content - El contenido HTML a insertar\n   * @returns {boolean} true si se insertó correctamente, false en caso contrario\n   */\n  async insertContent(content) {\n    await this.waitForEditor();\n\n    try {\n      if (this.editorInstance) {\n        const range = this.editorInstance.getSelection();\n        if (range) {\n          // Si hay una selección, inserta en esa posición\n          this.editorInstance.clipboard.dangerouslyPasteHTML(\n            range.index,\n            content,\n            \"user\"\n          );\n        } else {\n          // Si no hay selección, inserta al final\n          const length = this.editorInstance.getLength();\n          this.editorInstance.clipboard.dangerouslyPasteHTML(\n            length,\n            content,\n            \"user\"\n          );\n        }\n\n        if (this.options.debug) {\n          console.log(`[QuillAdapter] Content inserted successfully`);\n        }\n\n        return true;\n      }\n    } catch (error) {\n      console.error(`[QuillAdapter] Error inserting content:`, error);\n    }\n\n    return false;\n  }\n\n  /**\n   * Verifica si el editor está inicializado\n   * @returns {boolean} true si el editor está inicializado, false en caso contrario\n   */\n  isInitialized() {\n    return this._initialized && this.editorInstance !== null;\n  }\n}\n\n/**\n * Función de ayuda para crear un adaptador Quill\n * @param {string} editorId - ID del elemento contenedor de Quill\n * @param {Object} options - Opciones adicionales\n * @returns {QuillAdapter} Una nueva instancia del adaptador\n */\nexport function createQuillAdapter(editorId, options = {}) {\n  return new QuillAdapter(editorId, options);\n}\n","// src/utils/froala-adapter.js\n/**\n * Adaptador especializado para la integración con Froala Editor\n * Proporciona métodos para la interacción entre AITextEnhancer y Froala\n */\nexport class FroalaAdapter {\n  /**\n   * Crea un nuevo adaptador para Froala\n   * @param {string} editorId - ID del elemento contenedor de Froala\n   * @param {Object} options - Opciones adicionales\n   */\n  constructor(editorId, options = {}) {\n    this.editorId = editorId;\n    this.options = {\n      debug: options.debug || false,\n      waitTimeout: options.waitTimeout || 2000,\n      ...options,\n    };\n\n    this.editorInstance = null;\n    this._initialized = false;\n\n    // Intentar obtener la instancia de Froala (si ya está inicializada)\n    this._findEditorInstance();\n  }\n\n  /**\n   * Busca la instancia de Froala ya sea por ID o en el objeto global\n   * @private\n   */\n  _findEditorInstance() {\n    try {\n      // Verificar si hay una instancia global (enfoque común para demos)\n      if (typeof window.froalaInstance !== \"undefined\") {\n        this.editorInstance = window.froalaInstance;\n        this._initialized = true;\n\n        if (this.options.debug) {\n          console.log(\n            `[FroalaAdapter] Found editor instance from global variable`\n          );\n        }\n\n        return true;\n      }\n\n      // Verificar si el elemento tiene la instancia de Froala\n      const editorElement = document.getElementById(this.editorId);\n      if (editorElement && editorElement.froalaEditor) {\n        this.editorInstance = editorElement.froalaEditor;\n        this._initialized = true;\n\n        if (this.options.debug) {\n          console.log(\n            `[FroalaAdapter] Found editor instance from element property`\n          );\n        }\n\n        return true;\n      }\n\n      // Buscar el contenedor de Froala con la clase fr-box\n      const froalaContainer = document.querySelector(\n        `.fr-box[id^=\"${this.editorId}\"]`\n      );\n      if (froalaContainer) {\n        // Encontrar la instancia de editor dentro del contenedor\n        const editorElement = froalaContainer.querySelector(\n          \"[contenteditable=true]\"\n        );\n        if (\n          editorElement &&\n          editorElement.parentNode.querySelector(\".fr-element\")\n        ) {\n          const instanceKey = Object.keys(window).find(\n            (key) =>\n              key.startsWith(\"FE_\") &&\n              window[key] &&\n              typeof window[key] === \"object\" &&\n              window[key].$\n          );\n\n          if (instanceKey) {\n            this.editorInstance = window[instanceKey];\n            this._initialized = true;\n\n            if (this.options.debug) {\n              console.log(\n                `[FroalaAdapter] Found editor instance from global FE key`\n              );\n            }\n\n            return true;\n          }\n        }\n      }\n\n      if (this.options.debug) {\n        console.warn(\n          `[FroalaAdapter] Froala instance not found for \"${this.editorId}\"`\n        );\n      }\n\n      return false;\n    } catch (error) {\n      console.error(`[FroalaAdapter] Error finding Froala instance:`, error);\n      return false;\n    }\n  }\n\n  /**\n   * Espera a que Froala esté inicializado\n   * @returns {Promise<boolean>} Promesa que se resuelve cuando el editor está listo\n   */\n  async waitForEditor() {\n    if (this._initialized && this.editorInstance) {\n      return true;\n    }\n\n    return new Promise((resolve) => {\n      // Intentar encontrar la instancia inmediatamente\n      if (this._findEditorInstance()) {\n        resolve(true);\n        return;\n      }\n\n      // Configurar un intervalo para verificar periódicamente\n      const startTime = Date.now();\n      const checkInterval = setInterval(() => {\n        if (this._findEditorInstance()) {\n          clearInterval(checkInterval);\n          resolve(true);\n          return;\n        }\n\n        // Verificar si hemos excedido el tiempo de espera\n        if (Date.now() - startTime > this.options.waitTimeout) {\n          clearInterval(checkInterval);\n          console.warn(\n            `[FroalaAdapter] Timeout waiting for Froala to initialize`\n          );\n          resolve(false);\n        }\n      }, 100);\n    });\n  }\n\n  /**\n   * Obtiene el contenido del editor\n   * @returns {string} El contenido HTML del editor o cadena vacía si no está disponible\n   */\n  async getContent() {\n    await this.waitForEditor();\n\n    try {\n      if (this.editorInstance) {\n        // En Froala, el método .html() se usa para obtener el contenido\n        const content = this.editorInstance.html.get();\n\n        if (this.options.debug) {\n          console.log(\n            `[FroalaAdapter] Retrieved content (${content?.length || 0} chars)`\n          );\n        }\n\n        return content || \"\";\n      }\n    } catch (error) {\n      console.error(`[FroalaAdapter] Error getting content:`, error);\n    }\n\n    // Fallback: intentar obtener el HTML directamente del elemento editable\n    try {\n      const element = document.querySelector(\n        `#${this.editorId} div.fr-element`\n      );\n      if (element) {\n        return element.innerHTML || \"\";\n      }\n    } catch (e) {\n      console.error(`[FroalaAdapter] Error in fallback content retrieval:`, e);\n    }\n\n    return \"\";\n  }\n\n  /**\n   * Establece el contenido del editor\n   * @param {string} content - El contenido HTML a establecer\n   * @returns {boolean} true si se estableció correctamente, false en caso contrario\n   */\n  async setContent(content) {\n    await this.waitForEditor();\n\n    try {\n      if (this.editorInstance) {\n        // En Froala, el método .html.set() se usa para establecer el contenido\n        this.editorInstance.html.set(content);\n\n        // Asegurarse de que el editor esté enfocado y triggerea un evento change\n        this.editorInstance.events.trigger(\"contentChanged\");\n\n        if (this.options.debug) {\n          console.log(\n            `[FroalaAdapter] Content set successfully (${content.length} chars)`\n          );\n        }\n\n        return true;\n      }\n    } catch (error) {\n      console.error(`[FroalaAdapter] Error setting content:`, error);\n    }\n\n    // Fallback: intentar establecer el HTML directamente en el elemento editable\n    try {\n      const element = document.querySelector(\n        `#${this.editorId} div.fr-element`\n      );\n      if (element) {\n        element.innerHTML = content;\n        return true;\n      }\n    } catch (e) {\n      console.error(`[FroalaAdapter] Error in fallback content setting:`, e);\n    }\n\n    return false;\n  }\n\n  /**\n   * Inserta contenido en la posición actual del cursor\n   * @param {string} content - El contenido HTML a insertar\n   * @returns {boolean} true si se insertó correctamente, false en caso contrario\n   */\n  async insertContent(content) {\n    await this.waitForEditor();\n\n    try {\n      if (this.editorInstance) {\n        // En Froala, insertHTML inserta contenido en la posición del cursor\n        this.editorInstance.html.insert(content, true);\n\n        // Trigger para actualizar UI y historial\n        this.editorInstance.events.trigger(\"contentChanged\");\n\n        if (this.options.debug) {\n          console.log(`[FroalaAdapter] Content inserted successfully`);\n        }\n\n        return true;\n      }\n    } catch (error) {\n      console.error(`[FroalaAdapter] Error inserting content:`, error);\n    }\n\n    return false;\n  }\n\n  /**\n   * Verifica si el editor está inicializado\n   * @returns {boolean} true si el editor está inicializado, false en caso contrario\n   */\n  isInitialized() {\n    return this._initialized && this.editorInstance !== null;\n  }\n}\n\n/**\n * Función de ayuda para crear un adaptador Froala\n * @param {string} editorId - ID del elemento contenedor de Froala\n * @param {Object} options - Opciones adicionales\n * @returns {FroalaAdapter} Una nueva instancia del adaptador\n */\nexport function createFroalaAdapter(editorId, options = {}) {\n  return new FroalaAdapter(editorId, options);\n}\n","// editor-adapter.js - Actualizado con soporte para Froala\n\n// Importar los adaptadores específicos\nimport { createTinyMCEAdapter } from \"../utils/tinymce-adapter.js\";\nimport { createCKEditorAdapter } from \"../utils/ckeditor-adapter.js\";\nimport { createQuillAdapter } from \"../utils/quill-adapter.js\";\nimport { createFroalaAdapter } from \"../utils/froala-adapter.js\";\n\n/**\n * Clase adaptadora para diferentes tipos de editores\n * @class EditorAdapter\n */\nexport class EditorAdapter {\n  /**\n   * Constructor del adaptador de editor\n   * @param {string} editorId - ID del elemento editor\n   * @param {string} editorType - Tipo de editor ('textarea', 'tinymce', 'ckeditor', 'froala', etc.)\n   * @param {Object} options - Opciones adicionales\n   */\n  constructor(editorId, editorType = \"textarea\", options = {}) {\n    this.editorId = editorId;\n    this.editorType = editorType.toLowerCase();\n    this.options = {\n      debug: options.debug || false,\n      ...options,\n    };\n\n    // Inicializar contenedor para adaptadores específicos\n    this.specificAdapters = {};\n\n    // Inicializar el adaptador específico según el tipo\n    this._initializeSpecificAdapter();\n  }\n\n  /**\n   * Inicializa el adaptador específico según el tipo de editor\n   * @private\n   */\n  _initializeSpecificAdapter() {\n    switch (this.editorType) {\n      case \"tinymce\":\n        try {\n          this.specificAdapters.tinymce = createTinyMCEAdapter(this.editorId, {\n            debug: this.options.debug,\n          });\n\n          if (this.options.debug) {\n            console.log(\"[EditorAdapter] TinyMCE adapter initialized\");\n          }\n        } catch (error) {\n          console.error(\n            \"[EditorAdapter] Failed to initialize TinyMCE adapter:\",\n            error\n          );\n        }\n        break;\n\n      case \"ckeditor\":\n        try {\n          this.specificAdapters.ckeditor = createCKEditorAdapter(this.editorId, {\n            debug: this.options.debug,\n          });\n\n          if (this.options.debug) {\n            console.log(\"[EditorAdapter] CKEditor adapter initialized\");\n          }\n        } catch (error) {\n          console.error(\n            \"[EditorAdapter] Failed to initialize CKEditor adapter:\",\n            error\n          );\n        }\n        break;\n\n      case \"quill\":\n        try {\n          this.specificAdapters.quill = createQuillAdapter(this.editorId, {\n            debug: this.options.debug,\n          });\n\n          if (this.options.debug) {\n            console.log(\"[EditorAdapter] Quill adapter initialized\");\n          }\n        } catch (error) {\n          console.error(\n            \"[EditorAdapter] Failed to initialize Quill adapter:\",\n            error\n          );\n        }\n        break;\n\n      case \"froala\":\n        try {\n          this.specificAdapters.froala = createFroalaAdapter(this.editorId, {\n            debug: this.options.debug,\n          });\n\n          if (this.options.debug) {\n            console.log(\"[EditorAdapter] Froala adapter initialized\");\n          }\n        } catch (error) {\n          console.error(\n            \"[EditorAdapter] Failed to initialize Froala adapter:\",\n            error\n          );\n        }\n        break;\n\n      // Aquí se pueden agregar más adaptadores específicos para otros editores\n\n      default:\n        if (this.options.debug) {\n          console.log(\n            `[EditorAdapter] Using default textarea adapter for type: ${this.editorType}`\n          );\n        }\n        break;\n    }\n  }\n\n  /**\n   * Obtiene el contenido del editor\n   * @returns {string} Contenido del editor\n   */\n  getContent() {\n    try {\n      switch (this.editorType) {\n        case \"tinymce\":\n          // TinyMCE - usar adaptador específico si está disponible\n          if (this.specificAdapters.tinymce) {\n            return this.specificAdapters.tinymce.getContent() || \"\";\n          }\n\n          // Fallback: intentar obtener contenido directamente\n          if (typeof tinymce !== \"undefined\") {\n            const editor = tinymce.get(this.editorId);\n            if (editor) {\n              return editor.getContent() || \"\";\n            }\n          }\n\n          console.warn(\"[EditorAdapter] TinyMCE not initialized properly\");\n          return \"\";\n\n        case \"ckeditor\":\n          // CKEditor - usar adaptador específico si está disponible\n          if (this.specificAdapters.ckeditor) {\n            return this.specificAdapters.ckeditor.getContent() || \"\";\n          }\n\n          // Fallback: intentar obtener contenido directamente\n          if (typeof CKEDITOR !== \"undefined\") {\n            const editor = CKEDITOR.instances[this.editorId];\n            if (editor) {\n              return editor.getData() || \"\";\n            }\n          }\n\n          console.warn(\"[EditorAdapter] CKEditor not initialized properly\");\n          return \"\";\n\n        case \"quill\":\n          // Quill - usar adaptador específico si está disponible\n          if (this.specificAdapters.quill) {\n            return this.specificAdapters.quill.getContent() || \"\";\n          }\n\n          // Fallback: intentar obtener contenido directamente\n          const quillElement = document.querySelector(`#${this.editorId}`);\n          if (quillElement && quillElement.__quill) {\n            return quillElement.__quill.root.innerHTML || \"\";\n          }\n\n          console.warn(\"[EditorAdapter] Quill not initialized properly\");\n          return \"\";\n\n        case \"froala\":\n          // Froala - usar adaptador específico si está disponible\n          if (this.specificAdapters.froala) {\n            return this.specificAdapters.froala.getContent() || \"\";\n          }\n\n          // Fallback: intentar obtener contenido directamente\n          if (typeof window.froalaInstance !== \"undefined\") {\n            return window.froalaInstance.html.get() || \"\";\n          }\n\n          // Otro intento: buscar el elemento editable de Froala\n          const froalaElement = document.querySelector(\n            `#${this.editorId} div.fr-element`\n          );\n          if (froalaElement) {\n            return froalaElement.innerHTML || \"\";\n          }\n\n          console.warn(\"[EditorAdapter] Froala not initialized properly\");\n          return \"\";\n\n        case \"textarea\":\n        default:\n          // Textarea o elemento HTML genérico\n          const element = document.getElementById(this.editorId);\n          if (element) {\n            if (element.tagName.toLowerCase() === \"textarea\") {\n              return element.value || \"\";\n            } else {\n              return element.innerHTML || \"\";\n            }\n          }\n\n          console.warn(\"[EditorAdapter] Element not found:\", this.editorId);\n          return \"\";\n      }\n    } catch (error) {\n      console.error(\"[EditorAdapter] Error getting content:\", error);\n      return \"\";\n    }\n  }\n\n  /**\n   * Establece el contenido del editor\n   * @param {string} content - Contenido a establecer\n   * @returns {boolean} true si se estableció correctamente, false en caso contrario\n   */\n  setContent(content) {\n    try {\n      switch (this.editorType) {\n        case \"tinymce\":\n          // TinyMCE - usar adaptador específico si está disponible\n          if (this.specificAdapters.tinymce) {\n            return this.specificAdapters.tinymce.setContent(content);\n          }\n\n          // Fallback: intentar establecer contenido directamente\n          if (typeof tinymce !== \"undefined\") {\n            const editor = tinymce.get(this.editorId);\n            if (editor) {\n              editor.setContent(content);\n              return true;\n            }\n          }\n\n          console.warn(\"[EditorAdapter] TinyMCE not initialized properly\");\n          return false;\n\n        case \"ckeditor\":\n          // CKEditor - usar adaptador específico si está disponible\n          if (this.specificAdapters.ckeditor) {\n            return this.specificAdapters.ckeditor.setContent(content);\n          }\n\n          // Fallback: intentar establecer contenido directamente\n          if (typeof CKEDITOR !== \"undefined\") {\n            const editor = CKEDITOR.instances[this.editorId];\n            if (editor) {\n              editor.setData(content);\n              return true;\n            }\n          }\n\n          console.warn(\"[EditorAdapter] CKEditor not initialized properly\");\n          return false;\n\n        case \"quill\":\n          // Quill - usar adaptador específico si está disponible\n          if (this.specificAdapters.quill) {\n            return this.specificAdapters.quill.setContent(content);\n          }\n\n          // Fallback: intentar establecer contenido directamente\n          const quillElement = document.querySelector(`#${this.editorId}`);\n          if (quillElement && quillElement.__quill) {\n            quillElement.__quill.root.innerHTML = content;\n            return true;\n          }\n\n          console.warn(\"[EditorAdapter] Quill not initialized properly\");\n          return false;\n\n        case \"froala\":\n          // Froala - usar adaptador específico si está disponible\n          if (this.specificAdapters.froala) {\n            return this.specificAdapters.froala.setContent(content);\n          }\n\n          // Fallback: intentar establecer contenido directamente\n          if (typeof window.froalaInstance !== \"undefined\") {\n            window.froalaInstance.html.set(content);\n            window.froalaInstance.events.trigger(\"contentChanged\");\n            return true;\n          }\n\n          // Otro intento: buscar el elemento editable de Froala\n          const froalaElement = document.querySelector(\n            `#${this.editorId} div.fr-element`\n          );\n          if (froalaElement) {\n            froalaElement.innerHTML = content;\n            return true;\n          }\n\n          console.warn(\"[EditorAdapter] Froala not initialized properly\");\n          return false;\n\n        case \"textarea\":\n        default:\n          // Textarea o elemento HTML genérico\n          const element = document.getElementById(this.editorId);\n          if (element) {\n            if (element.tagName.toLowerCase() === \"textarea\") {\n              element.value = content;\n            } else {\n              element.innerHTML = content;\n            }\n            return true;\n          }\n\n          console.warn(\"[EditorAdapter] Element not found:\", this.editorId);\n          return false;\n      }\n    } catch (error) {\n      console.error(\"[EditorAdapter] Error setting content:\", error);\n      return false;\n    }\n  }\n}","export const createEventEmitter = (element) => {\n  return {\n    emit: (eventName, detail) => {\n      const event = new CustomEvent(eventName, {\n        detail,\n        bubbles: true,\n        composed: true,\n      });\n      element.dispatchEvent(event);\n    },\n    on: (eventName, handler) => {\n      element.addEventListener(eventName, handler);\n      return () => element.removeEventListener(eventName, handler);\n    },\n    off: (eventName, handler) => {\n      element.removeEventListener(eventName, handler);\n    },\n  };\n};\n\nexport const createCustomEvent = (name, detail) => {\n  return new CustomEvent(name, {\n    detail,\n    bubbles: true,\n    composed: true,\n  });\n};\n\nexport const dispatchCustomEvent = (element, name, detail) => {\n  element.dispatchEvent(createCustomEvent(name, detail));\n};\n","export function attachShadowTemplate(component, templateContent) {\n  if (!component) {\n    console.error(\n      \"Error: No se proporcionó un componente para attachShadowTemplate\"\n    );\n    return null;\n  }\n\n  if (!templateContent) {\n    console.error(\n      \"Error: No se proporcionó contenido de plantilla para attachShadowTemplate\"\n    );\n    return null;\n  }\n\n  console.log(\"Attaching shadow template to component:\", {\n    componentTagName: component.tagName,\n    templateContentLength: templateContent.length,\n  });\n\n  // Verificar si el componente ya tiene un shadowRoot\n  if (component.shadowRoot) {\n    console.log(\"El componente ya tiene un shadowRoot, no se creará uno nuevo\");\n\n    // Limpiar el shadowRoot existente\n    while (component.shadowRoot.firstChild) {\n      component.shadowRoot.removeChild(component.shadowRoot.firstChild);\n    }\n  } else {\n    // Crear un nuevo shadowRoot\n    try {\n      component.attachShadow({ mode: \"open\" });\n      console.log(\"Shadow root creado:\", !!component.shadowRoot);\n    } catch (error) {\n      console.error(\"Error creando shadow root:\", error);\n      return null;\n    }\n  }\n\n  try {\n    // Crear un template y agregar el contenido\n    const template = document.createElement(\"template\");\n    template.innerHTML = templateContent;\n    console.log(\n      \"Template element creado con contenido de longitud:\",\n      template.innerHTML.length\n    );\n\n    // Clonar el contenido del template\n    const content = template.content.cloneNode(true);\n    console.log(\"Contenido clonado:\", {\n      hasContent: !!content,\n      childNodes: content.childNodes.length,\n    });\n\n    // Agregar el contenido al shadowRoot\n    component.shadowRoot.appendChild(content);\n    console.log(\"Contenido agregado al shadow root\");\n\n    // Registrar elementos clave\n    const elements = {\n      modalTrigger: component.shadowRoot.querySelector(\".modal-trigger\"),\n      modal: component.shadowRoot.querySelector(\".modal\"),\n      aiToolbar: component.shadowRoot.querySelector(\"ai-toolbar\"),\n      chatWithImage: component.shadowRoot.querySelector(\"chat-with-image\"),\n      responseHistory: component.shadowRoot.querySelector(\"response-history\"),\n    };\n\n    console.log(\"Elementos renderizados:\", {\n      hasModalTrigger: !!elements.modalTrigger,\n      hasModal: !!elements.modal,\n      hasAiToolbar: !!elements.aiToolbar,\n      hasChatWithImage: !!elements.chatWithImage,\n      hasResponseHistory: !!elements.responseHistory,\n    });\n\n    return component.shadowRoot;\n  } catch (error) {\n    console.error(\"Error procesando template:\", error);\n    return null;\n  }\n}\n\nexport const createTemplate = (html) => {\n  if (typeof html !== \"string\") {\n    // Si se pasa un componente en lugar de una cadena HTML,\n    // asumimos que es un componente y utilizamos su método createTemplate\n    if (html && typeof html.translations === \"object\") {\n      if (typeof createTemplate === \"function\") {\n        return createTemplate(html);\n      } else {\n        console.warn(\n          \"No se encontró la función createTemplate para el componente\"\n        );\n        return \"\";\n      }\n    }\n\n    console.warn(\"Se esperaba una cadena HTML para createTemplate\");\n    return \"\";\n  }\n\n  const template = document.createElement(\"template\");\n  template.innerHTML = html;\n  return template;\n};\n","// Actualización de la clase NotificationManager en src/services/notification-manager.js\n\nexport class NotificationManager {\n  constructor(container) {\n    if (!container) {\n      console.error(\"[NotificationManager] No se proporcionó un contenedor\");\n      this.container = null;\n      return;\n    }\n\n    // Si el contenedor es un componente o elemento HTML con shadowRoot\n    if (container.shadowRoot) {\n      // Buscar el contenedor de notificaciones en el shadowRoot\n      this.container = container.shadowRoot.querySelector(\n        \".notifications-container\"\n      );\n\n      // Si no existe, crearlo\n      if (!this.container) {\n        this.container = document.createElement(\"div\");\n        this.container.className = \"notifications-container\";\n        container.shadowRoot.appendChild(this.container);\n      }\n    } else {\n      // Si es un elemento DOM normal\n      this.container = container;\n    }\n\n    this.notifications = new Set();\n    console.log(\n      \"[NotificationManager] Inicializado con contenedor:\",\n      this.container\n    );\n  }\n\n  show(message, type = \"info\", duration = 5000) {\n    if (!this.container) {\n      console.error(\n        \"[NotificationManager] No hay contenedor de notificaciones disponible\"\n      );\n      // Fallback: mostrar en la consola\n      console.log(`[${type.toUpperCase()}] ${message}`);\n      return null;\n    }\n\n    try {\n      const notification = document.createElement(\"div\");\n      notification.className = `ai-notification ${type}`;\n      notification.setAttribute(\"role\", \"alert\");\n\n      // Usar un símbolo apropiado según el tipo\n      const icon = this.getIconForType(type);\n\n      notification.innerHTML = `\n        ${icon}\n        <div class=\"notification-content\">${message}</div>\n        <button class=\"notification-close\" aria-label=\"Close notification\">\n          <svg width=\"16\" height=\"16\" viewBox=\"0 0 16 16\">\n            <path d=\"M4 4l8 8m0-8l-8 8\" stroke=\"currentColor\" stroke-width=\"2\"/>\n          </svg>\n        </button>\n      `;\n\n      // Función para cerrar la notificación\n      const close = () => {\n        notification.style.animation = \"slideOut 0.3s ease-out\";\n        setTimeout(() => {\n          if (notification.parentNode) {\n            notification.remove();\n          }\n          this.notifications.delete(notification);\n        }, 300);\n      };\n\n      // Agregar manejador de eventos al botón de cierre\n      const closeButton = notification.querySelector(\".notification-close\");\n      if (closeButton) {\n        closeButton.onclick = close;\n      }\n\n      // Cierre automático si la duración es mayor que 0\n      if (duration > 0) {\n        setTimeout(close, duration);\n      }\n\n      // Agregar la notificación al contenedor\n      this.container.appendChild(notification);\n      this.notifications.add(notification);\n\n      console.log(`[NotificationManager] Notificación mostrada: ${type}`);\n\n      // Auto-eliminar notificaciones antiguas si hay demasiadas\n      this.cleanupOldNotifications();\n\n      return notification;\n    } catch (error) {\n      console.error(\n        \"[NotificationManager] Error al mostrar notificación:\",\n        error\n      );\n      return null;\n    }\n  }\n\n  // Métodos de conveniencia para diferentes tipos de notificaciones\n  error(message, duration = 7000) {\n    return this.show(message, \"error\", duration);\n  }\n\n  warning(message, duration = 5000) {\n    return this.show(message, \"warning\", duration);\n  }\n\n  info(message, duration = 4000) {\n    return this.show(message, \"info\", duration);\n  }\n\n  success(message, duration = 3000) {\n    return this.show(message, \"success\", duration);\n  }\n\n  // Limitar el número de notificaciones simultáneas\n  cleanupOldNotifications(maxNotifications = 3) {\n    const notificationsArray = Array.from(this.notifications);\n\n    if (notificationsArray.length > maxNotifications) {\n      // Eliminar las notificaciones más antiguas\n      const oldNotifications = notificationsArray.slice(\n        0,\n        notificationsArray.length - maxNotifications\n      );\n\n      oldNotifications.forEach((notification) => {\n        if (notification.parentNode) {\n          notification.remove();\n        }\n        this.notifications.delete(notification);\n      });\n    }\n  }\n\n  // Obtener un ícono SVG según el tipo de notificación\n  getIconForType(type) {\n    switch (type) {\n      case \"error\":\n        return `\n          <svg class=\"notification-icon\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n            <circle cx=\"12\" cy=\"12\" r=\"10\"/>\n            <line x1=\"12\" y1=\"8\" x2=\"12\" y2=\"12\"/>\n            <line x1=\"12\" y1=\"16\" x2=\"12.01\" y2=\"16\"/>\n          </svg>\n        `;\n      case \"warning\":\n        return `\n          <svg class=\"notification-icon\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n            <path d=\"M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z\"/>\n            <line x1=\"12\" y1=\"9\" x2=\"12\" y2=\"13\"/>\n            <line x1=\"12\" y1=\"17\" x2=\"12.01\" y2=\"17\"/>\n          </svg>\n        `;\n      case \"success\":\n        return `\n          <svg class=\"notification-icon\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n            <path d=\"M22 11.08V12a10 10 0 1 1-5.93-9.14\"/>\n            <polyline points=\"22 4 12 14.01 9 11.01\"/>\n          </svg>\n        `;\n      case \"info\":\n      default:\n        return `\n          <svg class=\"notification-icon\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\n            <circle cx=\"12\" cy=\"12\" r=\"10\"/>\n            <line x1=\"12\" y1=\"16\" x2=\"12\" y2=\"12\"/>\n            <line x1=\"12\" y1=\"8\" x2=\"12.01\" y2=\"8\"/>\n          </svg>\n        `;\n    }\n  }\n\n  // Limpiar todas las notificaciones\n  clearAll() {\n    this.notifications.forEach((notification) => {\n      if (notification.parentNode) {\n        notification.remove();\n      }\n    });\n    this.notifications.clear();\n  }\n}\n\n// Función de fábrica para crear gestores de notificaciones\nexport function createNotificationManager(container) {\n  return new NotificationManager(container);\n}\n","export function setupKeyboardNavigation(component) {\n  document.addEventListener('keydown', component.handleKeyboard.bind(component));\n  \n  const modal = component.shadowRoot.querySelector('.modal');\n  if (modal) {\n    modal.addEventListener('keydown', component.handleModalKeyboard.bind(component));\n  }\n}\n\nexport const keyboardNavigationMixin = {\n  handleKeyboard(event) {\n    if (event.ctrlKey || event.metaKey) {\n      switch(event.key.toLowerCase()) {\n        case 'e':\n          event.preventDefault();\n          this.shadowRoot.querySelector('.modal-trigger').click();\n          break;\n        case 'i':\n          event.preventDefault();\n          if (this.isModalOpen()) {\n            this.handleToolAction('improve');\n          }\n          break;\n        case 's':\n          event.preventDefault();\n          if (this.isModalOpen()) {\n            this.handleToolAction('summarize');\n          }\n          break;\n      }\n    }\n  },\n\n  handleModalKeyboard(event) {\n    if (!this.isModalOpen()) return;\n\n    switch (event.key) {\n      case 'Escape':\n        this.shadowRoot.querySelector('.close-button').click();\n        break;\n      case 'Tab':\n        this.handleTabNavigation(event);\n        break;\n      case 'ArrowRight':\n      case 'ArrowLeft':\n        if (event.target.closest('.tools-container')) {\n          this.handleToolNavigation(event);\n        }\n        break;\n    }\n  },\n\n  handleTabNavigation(event) {\n    const modal = this.shadowRoot.querySelector('.modal');\n    const focusableElements = modal.querySelectorAll(\n      'button, [href], input, select, textarea, [tabindex]:not([tabindex=\"-1\"])'\n    );\n    const firstFocusable = focusableElements[0];\n    const lastFocusable = focusableElements[focusableElements.length - 1];\n\n    if (event.shiftKey) {\n      if (document.activeElement === firstFocusable) {\n        event.preventDefault();\n        lastFocusable.focus();\n      }\n    } else {\n      if (document.activeElement === lastFocusable) {\n        event.preventDefault();\n        firstFocusable.focus();\n      }\n    }\n  },\n\n  handleToolNavigation(event) {\n    const toolbar = this.shadowRoot.querySelector('ai-toolbar');\n    const tools = toolbar.shadowRoot.querySelectorAll('.tool-button');\n    const currentTool = toolbar.shadowRoot.querySelector('.tool-button:focus');\n\n    if (!currentTool) return;\n\n    const currentIndex = Array.from(tools).indexOf(currentTool);\n    let nextIndex;\n\n    if (event.key === 'ArrowRight') {\n      nextIndex = (currentIndex + 1) % tools.length;\n    } else {\n      nextIndex = (currentIndex - 1 + tools.length) % tools.length;\n    }\n\n    tools[nextIndex].focus();\n    event.preventDefault();\n  }\n};","export const responseHandlerMixin = {\n  /**\n   * Maneja el evento responseCopy para copiar el contenido al portapapeles\n   * @param {CustomEvent} event - El evento con el ID de la respuesta\n   */\n  handleResponseCopy(event) {\n    console.log(\"[ResponseHandlers] Copy event received:\", event.detail);\n    const { responseId } = event.detail;\n\n    if (!responseId) {\n      console.warn(\"[ResponseHandlers] No responseId provided in copy event\");\n      return;\n    }\n\n    const response = this.responseHistory?.getResponse(responseId);\n    if (!response) {\n      console.warn(\"[ResponseHandlers] No response found for ID:\", responseId);\n      return;\n    }\n\n    navigator.clipboard\n      .writeText(response.content)\n      .then(() => {\n        console.log(\"[ResponseHandlers] Content copied to clipboard\");\n\n        // Mostrar notificación al usuario si está disponible\n        if (this.notificationManager) {\n          this.notificationManager.success(\"Content copied to clipboard\", 2000);\n        }\n      })\n      .catch((err) => {\n        console.error(\"[ResponseHandlers] Copy failed:\", err);\n\n        // Mostrar error si hay un problema\n        if (this.notificationManager) {\n          this.notificationManager.error(\"Failed to copy to clipboard\");\n        }\n      });\n  },\n\n  /**\n   * Maneja el evento responseUse para utilizar una respuesta generada\n   * Versión mejorada con mejor manejo de errores y diagnóstico\n   * @param {CustomEvent} event - El evento con la respuesta\n   */\n  handleResponseUse(event) {\n    try {\n      console.log(\"[ResponseHandlers] Use event received:\", event.detail);\n\n      // Verificar si el evento tiene los datos necesarios\n      if (!event.detail || !event.detail.responseId) {\n        console.warn(\"[ResponseHandlers] Invalid event data:\", event.detail);\n        throw new Error(\"Invalid response data\");\n      }\n\n      const { responseId } = event.detail;\n\n      // Obtener la respuesta del historial\n      if (!this.responseHistory) {\n        console.error(\"[ResponseHandlers] No response history available\");\n        throw new Error(\"Response history not available\");\n      }\n\n      const response = this.responseHistory.getResponse(responseId);\n\n      if (!response) {\n        console.warn(\"[ResponseHandlers] No response found for ID:\", responseId);\n        throw new Error(\"Response not found\");\n      }\n\n      // Verificar que la respuesta tenga contenido\n      if (!response.content || typeof response.content !== \"string\" || response.content.trim() === \"\") {\n        console.warn(\"[ResponseHandlers] Empty content in response:\", responseId);\n        throw new Error(\"Response content is empty\");\n      }\n\n      // Convertir el contenido markdown a HTML si es necesario\n      let contentToInsert = response.content;\n      if (this.markdownHandler && [\"tinymce\", \"ckeditor\", \"froala\"].includes(this.editorAdapter?.editorType)) {\n        contentToInsert = this.markdownHandler.convert(response.content);\n        console.log(\"[ResponseHandlers] Content converted to HTML for WYSIWYG editor\");\n      }\n\n      // Primero intentar aplicar usando TinyMCE directamente (si está disponible)\n      if (window.tinymce && this.editorId && tinymce.get(this.editorId)) {\n        const editor = tinymce.get(this.editorId);\n        if (editor && editor.initialized) {\n          editor.setContent(contentToInsert);\n          editor.undoManager.add();\n          console.log(\"[ResponseHandlers] Content applied directly to TinyMCE\");\n\n          // Cerrar el modal\n          setTimeout(() => {\n            const modal = this.shadowRoot.querySelector(\".modal\");\n            if (modal) {\n              modal.classList.remove(\"open\");\n            }\n          }, 100);\n\n          return true;\n        }\n      }\n\n      // Intentar usar el adaptador del editor como fallback\n      if (this.editorAdapter) {\n        console.log(\"[ResponseHandlers] Applying content via editor adapter\");\n\n        // Usar el método setContent del adaptador del editor\n        const success = this.editorAdapter.setContent(contentToInsert);\n\n        if (success) {\n          console.log(\"[ResponseHandlers] Response content applied to editor\");\n\n          // Disparar evento ai-content-generated para plugins\n          this.dispatchEvent(\n            new CustomEvent(\"ai-content-generated\", {\n              detail: { content: contentToInsert },\n              bubbles: true,\n              composed: true,\n            })\n          );\n\n          // Cerrar el modal\n          const modal = this.shadowRoot.querySelector(\".modal\");\n          if (modal) {\n            modal.classList.remove(\"open\");\n          }\n\n          // Mostrar notificación\n          if (this.notificationManager) {\n            this.notificationManager.success(\"Content applied successfully\");\n          }\n\n          return true;\n        } else {\n          console.error(\"[ResponseHandlers] Failed to apply content to editor\");\n          throw new Error(\"Failed to apply content to editor\");\n        }\n      } else {\n        console.error(\"[ResponseHandlers] No editor adapter available\");\n        throw new Error(\"No editor connected\");\n      }\n    } catch (error) {\n      console.error(\"[ResponseHandlers] Error in handleResponseUse:\", error);\n\n      if (this.notificationManager) {\n        this.notificationManager.error(`Error: ${error.message}`);\n      }\n\n      return false;\n    }\n  },\n\n  /**\n   * Maneja el evento responseRetry para volver a ejecutar una acción\n   * @param {CustomEvent} event - El evento con la información de la acción a reintentar\n   */\n  handleResponseRetry(event) {\n    console.log(\"[ResponseHandlers] Retry event received:\", event.detail);\n    const { responseId, action } = event.detail;\n\n    if (!responseId) {\n      console.warn(\"[ResponseHandlers] No responseId provided in retry event\");\n      return;\n    }\n\n    const response = this.responseHistory?.getResponse(responseId);\n    if (!response) {\n      console.warn(\"[ResponseHandlers] No response found for ID:\", responseId);\n      return;\n    }\n\n    console.log(\"[ResponseHandlers] Retrying action:\", response.action);\n\n    // Crear un evento sintético con la estructura necesaria\n    const syntheticEvent = {\n      detail: {\n        action: action || response.action,\n        responseId: responseId,\n        content: response.content,\n      },\n    };\n\n    // Llamar al método handleToolAction con el evento sintético\n    this.handleToolAction(syntheticEvent);\n  },\n\n  /**\n   * Maneja el evento responseEdit para editar una respuesta\n   * @param {CustomEvent} event - El evento con el ID de la respuesta a editar\n   */\n  handleResponseEdit(event) {\n    console.log(\"[ResponseHandlers] Edit event received:\", event.detail);\n    const { responseId } = event.detail;\n\n    if (!responseId) {\n      console.warn(\"[ResponseHandlers] No responseId provided in edit event\");\n      return;\n    }\n\n    const response = this.responseHistory?.getResponse(responseId);\n    if (!response) {\n      console.warn(\"[ResponseHandlers] No response found for ID:\", responseId);\n      return;\n    }\n\n    // La implementación de la edición dependerá de tu diseño UI\n    // Aquí podría mostrarse un modal, o enviar el contenido a un área de edición, etc.\n    console.log(\"[ResponseHandlers] Edit functionality not fully implemented\");\n\n    // Mostrar notificación informativa\n    if (this.notificationManager) {\n      this.notificationManager.info(\"Edit functionality coming soon\");\n    }\n  },\n};\n","// src/features/image-handlers.js\n\nexport const imageHandlerMixin = {\n  isImageUsed(image) {\n    if (!this.responseHistory) return false;\n\n    const imageId = image instanceof File ? image.name : image;\n    return this.responseHistory.responses.some(\n      (response) =>\n        response.action !== \"image-upload\" && response.imageUsed === imageId\n    );\n  },\n\n  handleImageChange(file) {\n    if (file) {\n      this.productImage = file;\n      this.productImageUrl = null;\n\n      // Encontrar el último mensaje de pregunta en el historial\n      const lastQuestion = this.responseHistory.responses.findLast(\n        (response) => response.action === \"chat-question\"\n      );\n\n      if (lastQuestion) {\n        // Mover el contenido de la imagen al contenido de la pregunta\n        const imagePreviewHTML = this.renderImagePreview(file);\n\n        // Buscar el elemento response-content en el DOM\n        const questionEntry = this.shadowRoot.querySelector(\n          `.response-entry[data-response-id=\"${lastQuestion.id}\"]`\n        );\n\n        if (questionEntry) {\n          const responseContent =\n            questionEntry.querySelector(\".response-content\");\n          if (responseContent) {\n            // Insertar la imagen directamente en el response-content\n            responseContent.insertAdjacentHTML(\"beforeend\", imagePreviewHTML);\n          }\n        }\n\n        // Eliminar las entradas de image-upload existentes del DOM\n        const imageUploadEntries = this.shadowRoot.querySelectorAll(\n          '.response-entry[data-action=\"image-upload\"]'\n        );\n        imageUploadEntries.forEach((entry) => entry.remove());\n\n        // Eliminar las entradas de image-upload del historial\n        this.responseHistory.responses = this.responseHistory.responses.filter(\n          (response) => response.action !== \"image-upload\"\n        );\n      }\n    }\n  },\n\n  removeImage() {\n    if (this.productImage || this.productImageUrl) {\n      this.productImage = null;\n      this.productImageUrl = null;\n\n      // Encontrar y actualizar el último mensaje de pregunta en el historial\n      const lastQuestion = this.responseHistory.responses.findLast(\n        (response) => response.action === \"chat-question\"\n      );\n\n      if (lastQuestion) {\n        // Eliminar el HTML de la imagen del contenido\n        lastQuestion.content = lastQuestion.content.replace(\n          /<div class=\"image-preview-card\"[\\s\\S]*?<\\/div><\\/div><\\/div>/g,\n          \"\"\n        );\n\n        // En lugar de usar this.requestUpdate (que no existe), forzamos una actualización\n        // renderizando de nuevo el historial de respuestas\n        if (this.responseHistory) {\n          this.responseHistory.render();\n        }\n      }\n    }\n  },\n\n  renderImagePreview(image = null, isInitial = false) {\n    const imageToRender = image || this.productImage || this.productImageUrl;\n    if (!imageToRender) return \"\";\n\n    const imageUrl =\n      imageToRender instanceof File\n        ? URL.createObjectURL(imageToRender)\n        : imageToRender;\n\n    const filename =\n      imageToRender instanceof File\n        ? imageToRender.name\n        : new URL(imageToRender).pathname.split(\"/\").pop() || \"From URL\";\n\n    return `\n      <div class=\"image-preview-card\" \n           data-image-id=\"${Date.now()}\"\n           role=\"figure\"\n           aria-label=\"${\n             isInitial ? \"Initial product image\" : \"Uploaded product image\"\n           }\">\n        <div class=\"image-preview-content\">\n          <div class=\"image-preview-thumbnail\">\n            <img src=\"${imageUrl}\" alt=\"Product preview - ${filename}\">\n          </div>\n        </div>\n      </div>\n    `;\n  },\n};\n","// src/utils/state-utils.js\n\n/**\n * Utilidad para gestionar actualizaciones de estado y renderizado en componentes web\n *\n * @param {HTMLElement} component - El componente web que se va a ampliar con funcionalidades de estado\n * @returns {Object} - Métodos para manipular el estado del componente\n */\nexport const createStateManager = (component) => {\n  // Estado interno privado\n  const _state = {};\n\n  return {\n    /**\n     * Actualiza una propiedad de estado y opcionalmente vuelve a renderizar partes del componente\n     *\n     * @param {string} propName - Nombre de la propiedad a actualizar\n     * @param {any} value - Nuevo valor\n     * @param {Object} options - Opciones de actualización\n     * @param {Boolean} options.rerender - Si se debe volver a renderizar después de la actualización\n     * @param {String} options.targetSelector - Selector CSS del elemento que debería actualizarse\n     */\n    updateState(propName, value, options = {}) {\n      const oldValue = _state[propName];\n      _state[propName] = value;\n\n      // Disparar evento de cambio de propiedad\n      component.dispatchEvent(\n        new CustomEvent(\"stateChange\", {\n          detail: { property: propName, oldValue, newValue: value },\n          bubbles: false,\n        })\n      );\n\n      // Opcionalmente re-renderizar\n      if (options.rerender && component.shadowRoot) {\n        if (options.targetSelector) {\n          // Renderizado selectivo\n          const target = component.shadowRoot.querySelector(\n            options.targetSelector\n          );\n          if (target && typeof component.renderPart === \"function\") {\n            component.renderPart(target, propName);\n          }\n        } else if (typeof component.render === \"function\") {\n          // Renderizado completo\n          component.render();\n        }\n      }\n\n      return value;\n    },\n\n    /**\n     * Obtiene el valor actual de una propiedad de estado\n     *\n     * @param {string} propName - Nombre de la propiedad\n     * @param {any} defaultValue - Valor por defecto si la propiedad no existe\n     * @returns {any} - Valor actual de la propiedad\n     */\n    getState(propName, defaultValue = null) {\n      return propName in _state ? _state[propName] : defaultValue;\n    },\n\n    /**\n     * Devuelve una copia de todo el estado actual\n     *\n     * @returns {Object} - Copia del estado actual\n     */\n    getAllState() {\n      return { ..._state };\n    },\n\n    /**\n     * Actualiza múltiples propiedades de estado a la vez\n     *\n     * @param {Object} stateUpdates - Objeto con las actualizaciones {propiedad: nuevoValor}\n     * @param {Object} options - Opciones de actualización (igual que updateState)\n     */\n    batchUpdate(stateUpdates, options = {}) {\n      const changedProps = [];\n\n      for (const [propName, value] of Object.entries(stateUpdates)) {\n        const oldValue = _state[propName];\n        if (oldValue !== value) {\n          _state[propName] = value;\n          changedProps.push({ property: propName, oldValue, newValue: value });\n        }\n      }\n\n      // Solo disparar evento si hubo cambios\n      if (changedProps.length > 0) {\n        component.dispatchEvent(\n          new CustomEvent(\"stateBatchChange\", {\n            detail: { changes: changedProps },\n            bubbles: false,\n          })\n        );\n\n        // Renderizado tras actualización por lotes\n        if (options.rerender && component.shadowRoot) {\n          if (\n            options.targetSelector &&\n            typeof component.renderPart === \"function\"\n          ) {\n            const target = component.shadowRoot.querySelector(\n              options.targetSelector\n            );\n            if (target) {\n              component.renderPart(\n                target,\n                changedProps.map((c) => c.property)\n              );\n            }\n          } else if (typeof component.render === \"function\") {\n            component.render();\n          }\n        }\n      }\n\n      return changedProps.length > 0;\n    },\n  };\n};\n","// src/features/state-integration.js\nimport { createStateManager } from \"../utils/state-utils.js\";\n\nexport const stateManagementMixin = {\n  initializeStateManager() {\n    this.stateManager = createStateManager(this);\n\n    // Configuración de escuchadores para eventos de estado\n    this.addEventListener(\"stateChange\", this.handleStateChange.bind(this));\n    this.addEventListener(\n      \"stateBatchChange\",\n      this.handleStateBatchChange.bind(this)\n    );\n  },\n\n  handleStateChange(event) {\n    const { property, oldValue, newValue } = event.detail;\n    console.log(\n      `[StateManager] Property '${property}' changed:`,\n      oldValue,\n      \"->\",\n      newValue\n    );\n\n    // Manejar cambios específicos de propiedades\n    switch (property) {\n      case \"productImage\":\n        this.handleProductImageChange(oldValue, newValue);\n        break;\n      case \"enhancedText\":\n        this.handleEnhancedTextChange(oldValue, newValue);\n        break;\n      // Agregar más manejadores según sea necesario\n    }\n  },\n\n  handleStateBatchChange(event) {\n    console.log(\"[StateManager] Batch state change:\", event.detail.changes);\n\n    // Detectar tipos de cambios en el lote\n    const changedProps = event.detail.changes.map((c) => c.property);\n\n    if (changedProps.includes(\"productImage\")) {\n      const change = event.detail.changes.find(\n        (c) => c.property === \"productImage\"\n      );\n      this.handleProductImageChange(change.oldValue, change.newValue);\n    }\n\n    // Manejar más cambios según sea necesario\n  },\n\n  handleProductImageChange(oldImage, newImage) {\n    // Actualizar la interfaz de usuario basada en la imagen\n    if (newImage) {\n      console.log(\"[StateManager] New product image set:\", newImage.name);\n\n      // Si responseHistory existe, actualiza la vista\n      if (this.responseHistory) {\n        const lastQuestion = this.responseHistory.responses.findLast(\n          (response) => response.action === \"chat-question\"\n        );\n\n        if (lastQuestion) {\n          // Agregar la imagen a la última pregunta si existe\n          this.responseHistory.render();\n        }\n      }\n    } else if (oldImage) {\n      console.log(\"[StateManager] Product image removed\");\n    }\n  },\n\n  handleEnhancedTextChange(oldText, newText) {\n    // Manejar cambios en el texto mejorado\n    console.log(\"[StateManager] Enhanced text updated\");\n  },\n\n  // Método para solicitar una actualización de la interfaz de usuario\n  requestUpdate(target = null) {\n    console.log(\n      \"[StateManager] Update requested for:\",\n      target || \"entire component\"\n    );\n\n    if (!target) {\n      // Actualización general del componente\n      if (this.responseHistory) {\n        this.responseHistory.render();\n      }\n      this.updateVisibleTools();\n      return;\n    }\n\n    // Actualizaciones específicas de componentes\n    switch (target) {\n      case \"responseHistory\":\n        if (this.responseHistory) {\n          this.responseHistory.render();\n        }\n        break;\n      case \"toolbar\":\n        this.updateVisibleTools();\n        break;\n      // Otros casos según sea necesario\n    }\n  },\n};\n","export const modalTriggerStyles = `\n  .modal-trigger {\n    position: relative;\n    display: inline-flex;\n    align-items: center;\n    justify-content: center;\n    padding: 0.75rem 1.25rem;\n    background: linear-gradient(to right, var(--ai-gradient-start) 0%, var(--ai-gradient-middle) 51%, var(--ai-gradient-end) 100%);\n    background-size: 200% auto;\n    border: 0;\n    border-radius: 2em;\n    color: white;\n    font-family: var(--ai-font-sans);\n    font-weight: 600;\n    cursor: pointer;\n    transition: all 0.3s ease;\n    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);\n    white-space: nowrap;\n    box-shadow: var(--ai-shadow);\n    margin-top: 15px;\n  }\n\n  .modal-trigger::before {\n    content: \"\";\n    position: absolute;\n    inset: 0;\n    opacity: 0;\n    background: linear-gradient(45deg, #fb0094, #0000ff, #00ff00, #ffff00, #ff0000);\n    background-size: 400%;\n    border-radius: 2em;\n    z-index: -1;\n    transition: opacity 0.3s ease;\n    animation: glow 5s linear infinite;\n  }\n\n  .modal-trigger:hover {\n    background-position: right center;\n    box-shadow: var(--ai-shadow-md);\n    transform: translateY(-1px);\n  }\n\n  .modal-trigger:hover::before {\n    opacity: 0.7;\n    filter: blur(8px);\n  }\n\n  .modal-trigger svg {\n    width: 1.25em;\n    height: 1.25em;\n    margin-right: 0.5em;\n    transition: transform 0.3s ease;\n  }\n\n  .modal-trigger:hover svg {\n    animation: shake 0.5s ease-in-out;\n  }\n\n  .modal-trigger span {\n    font-size: 0.9375rem;\n    letter-spacing: 0.025em;\n  }\n`;\n","// styles/layout/modal.js\nexport const modalStyles = `\n  .modal {\n    display: none;\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    background: rgba(0, 0, 0, 0.5);\n    z-index: var(--ai-z-modal);\n  }\n\n  .modal.open {\n    display: block;\n  }\n\n  .modal-content {\n    position: relative;\n    background: var(--ai-background);\n    width: 95%;\n    max-width: 1200px;\n    height: 85vh;\n    margin: 5vh auto;\n    padding: 1.5rem;\n    border-radius: var(--ai-radius-lg);\n    box-shadow: var(--ai-shadow-md);\n    display: flex;\n    flex-direction: column;\n    z-index: var(--ai-z-content);\n  }\n\n  .modal-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 1.5rem;\n  }\n\n  .modal-header h2 {\n    margin: 0;\n    font-size: 1.5rem;\n    font-weight: 600;\n    color: var(--ai-text);\n  }\n\n  .modal-body {\n    flex: 1;\n    display: flex;\n    flex-direction: column;\n    min-height: 0;\n    overflow: hidden;\n    position: relative;\n  }\n\n  .editor-section {\n    flex: 1;\n    display: flex;\n    flex-direction: column;\n    min-height: 0;\n    overflow: hidden;\n  }\n\n  .image-upload-section {\n    margin-bottom: 1rem;\n  }\n\n  .tools-container {\n    margin-bottom: 1rem;\n  }\n\n  .chat-section {\n    flex-shrink: 0;\n  }\n\n  .close-button {\n    position: absolute;\n    top: 1rem;\n    right: 1rem;\n    background: none;\n    border: none;\n    font-size: 1.5rem;\n    cursor: pointer;\n    color: var(--ai-text-light);\n    transition: color 0.2s ease;\n    z-index: 1;\n  }\n\n  .close-button:hover {\n    color: var(--ai-text);\n  }\n`;\n","export const notificationStyles = `\n  .ai-notification {\n    position: fixed;\n    top: 1rem;\n    right: 1rem;\n    padding: 1rem;\n    border-radius: var(--ai-radius);\n    animation: slideIn 0.3s ease-out;\n    z-index: 1000;\n    max-width: 300px;\n    display: flex;\n    align-items: flex-start;\n    gap: 0.5rem;\n  }\n\n  .ai-notification.info {\n    background: var(--ai-info-bg, #e3f2fd);\n    color: var(--ai-info-text, #0d47a1);\n    border: 1px solid var(--ai-info-border, #90caf9);\n  }\n\n  .ai-notification.warning {\n    background: var(--ai-warning-bg);\n    color: var(--ai-warning-text);\n    border: 1px solid var(--ai-warning-border);\n  }\n\n  .ai-notification.error {\n    background: var(--ai-error-bg);\n    color: var(--ai-error-text);\n    border: 1px solid var(--ai-error-border);\n  }\n\n  .ai-notification.success {\n    background: var(--ai-success-bg, #e8f5e9);\n    color: var(--ai-success-text, #1b5e20);\n    border: 1px solid var(--ai-success-border, #a5d6a7);\n  }\n\n  .notification-close {\n    background: none;\n    border: none;\n    padding: 0;\n    cursor: pointer;\n    color: currentColor;\n    opacity: 0.7;\n  }\n\n  .notification-close:hover {\n    opacity: 1;\n  }\n\n  @keyframes slideIn {\n    from { transform: translateX(100%); opacity: 0; }\n    to { transform: translateX(0); opacity: 1; }\n  }\n\n  @keyframes slideOut {\n    from { transform: translateX(0); opacity: 1; }\n    to { transform: translateX(100%); opacity: 0; }\n  }\n`;","// Mejora de la función createTemplate en src/template.js\n// Esta función crea el HTML del componente AITextEnhancer\n\nimport { variables } from \"./styles/base/variables.js\";\nimport { animations } from \"./styles/base/animations.js\";\nimport { modalTriggerStyles } from \"./styles/components/modal-trigger.js\";\nimport { modalStyles } from \"./styles/layout/modal.js\";\nimport { previewStyles } from \"./styles/layout/preview.js\";\nimport { imagePreviewStyles } from \"./styles/components/image-preview.js\";\nimport { notificationStyles } from \"./styles/components/notifications.js\";\n\nexport function createTemplate(component) {\n  if (!component) {\n    console.error(\"[createTemplate] Error: No se proporcionó un componente\");\n    return \"\";\n  }\n\n  try {\n    console.log(\n      \"[createTemplate] Creando template para el componente\",\n      component.tagName\n    );\n\n    // Acceder a las traducciones con validación para evitar errores\n    const t = component.translations || {};\n\n    // Determinar si hay contenido y contexto con validación\n    const currentContent =\n      typeof component.currentContent === \"function\"\n        ? component.currentContent()\n        : component.currentContent || \"\";\n\n    const context = component.context || \"\";\n\n    const hasContent = Boolean(currentContent?.trim && currentContent.trim());\n    const hasContext = Boolean(context?.trim && context.trim());\n\n    // Verificar si el botón modal-trigger debe ser ocultado\n    // Añadir esta línea para comprobar el atributo hide-trigger\n    const showTrigger = !component.hideTrigger;\n\n    console.log(\"[createTemplate] Estado del componente:\", {\n      hasContent,\n      hasContext,\n      language: component.language || \"en\",\n      showTrigger, // Añadir esta línea para mostrar el estado en logs\n    });\n\n    // HTML del componente con comentarios para facilitar la depuración\n    return `\n    <!-- Estilos del componente -->\n    <style>\n      ${variables}\n      ${animations}\n      ${modalTriggerStyles}\n      ${modalStyles}\n      ${previewStyles}\n      ${imagePreviewStyles}\n      ${notificationStyles}\n      \n      /* Estilos específicos del componente */\n      :host {\n        display: inline-block;\n        font-family: var(--ai-font-sans);\n        position: relative;\n      }\n\n      .editor-section {\n        flex: 1;\n        display: flex;\n        flex-direction: column;\n        min-height: 0;\n      }\n\n      .chat-section {\n        position: relative;\n        width: 100%;\n        bottom: 0;\n        left: 0;\n      }\n\n      .tools-container {\n        margin-bottom: 1rem;\n      }\n\n      response-history {\n        flex: 1;\n        min-height: 0;\n        max-height: calc(85vh - 120px);\n        background: var(--ai-background);\n        border-radius: var(--ai-radius);\n        margin-bottom: 1rem;\n        overflow: auto;\n        display: block;\n      }\n      \n      /* Contenedor de notificaciones */\n      .notifications-container {\n        position: fixed;\n        top: 1rem;\n        right: 1rem;\n        z-index: var(--ai-z-notification, 100001);\n        pointer-events: none;\n      }\n      \n      .notifications-container > * {\n        pointer-events: auto;\n      }\n      \n      /* Estilos de ayuda y depuración */\n      .debug-info {\n        display: none;\n        padding: 10px;\n        margin: 10px 0;\n        background: #f8f9fa;\n        border: 1px solid #dee2e6;\n        border-radius: 4px;\n        font-size: 12px;\n      }\n      \n      /* Mostrar en modo depuración */\n      :host([debug]) .debug-info {\n        display: block;\n      }\n    </style>\n\n    <!-- Botón para abrir el modal (CONDICIONAL) -->\n    ${\n      showTrigger\n        ? `\n    <button class=\"modal-trigger\" id=\"modal-trigger-button\">\n       <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" fill-opacity=\"0\" stroke=\"#ffffff\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n                        <path d=\"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72\"/>\n                        <path d=\"m14 7 3 3\"/>\n                        <path d=\"M5 6v4\"/>\n                        <path d=\"M19 14v4\"/>\n                        <path d=\"M10 2v2\"/>\n                        <path d=\"M7 8H3\"/>\n                        <path d=\"M21 16h-4\"/>\n                        <path d=\"M11 3H9\"/>\n                      </svg>\n      <span>${t?.modalTrigger || \"Enhance with AI\"}</span>\n    </button>\n    `\n        : \"\"\n    }\n    \n    <!-- Modal principal -->\n    <div class=\"modal\" id=\"ai-enhancer-modal\">\n      <div class=\"modal-content\">\n        <button class=\"close-button\" aria-label=\"Close modal\">×</button>\n        <div class=\"modal-header\">\n          <h2>${t?.modalTitle || \"Enhance Text\"}</h2>\n        </div>\n        \n        <div class=\"modal-body\">\n          <!-- Historial de respuestas -->\n          <div class=\"editor-section\">\n            <response-history language=\"${\n              component.language || \"en\"\n            }\"></response-history>\n          </div>\n          \n          <!-- Sección de chat -->\n          <div class=\"chat-section\">\n            <!-- LOG: supports-images = \"${component.getAttribute && component.getAttribute('supports-images')}\" -->\n            <chat-with-image\n              language=\"${component.language || \"en\"}\"\n              image-url=\"${component.imageUrl || \"\"}\"\n              apiProvider=\"${component.apiProvider || \"openai\"}\"\n              ${component.hasAttribute && component.hasAttribute('supports-images') ? `supports-images=\"${component.getAttribute('supports-images')}\"` : ''}\n            >\n            </chat-with-image>\n          </div>\n        </div>\n      </div>\n    </div>\n    \n    <!-- Contenedor de notificaciones -->\n    <div class=\"notifications-container\"></div>`;\n  } catch (error) {\n    console.error(\"[createTemplate] Error creando template:\", error);\n\n    // Retornar un template básico en caso de error\n    return `\n    <div style=\"color: red; padding: 10px; border: 1px solid red;\">\n      Error creating component template: ${error.message}\n    </div>\n    <button class=\"modal-trigger\">Enhance Text</button>\n    <div class=\"modal\">\n      <div class=\"modal-content\">\n        <button class=\"close-button\">×</button>\n        <div class=\"modal-header\">\n          <h2>Enhance Text</h2>\n        </div>\n        <div class=\"modal-body\">\n          <p>Error loading component. Please try refreshing the page.</p>\n        </div>\n      </div>\n    </div>`;\n  }\n}\n","// Versión mejorada del archivo index.js con todas las correcciones integradas\n\nimport { ResponseHistory } from \"./components/ResponseHistory.js\";\nimport { ChatWithImage } from \"./components/ChatWithImage.js\";\nimport { ToolBar } from \"./components/ToolBar.js\";\nimport { TokenManager } from \"./services/token-manager.js\";\nimport { MarkdownHandler } from \"./services/markdown-handler.js\";\nimport { createAPIClient } from \"./services/api-client.js\";\nimport { createCacheManager } from \"./services/cache-manager.js\";\n\nimport { EditorAdapter } from \"./services/editor-adapter.js\";\nimport { createEventEmitter } from \"./utils/event-utils.js\";\nimport { attachShadowTemplate } from \"./utils/dom-utils.js\";\nimport { TRANSLATIONS } from \"./constants/translations.js\";\nimport { createNotificationManager } from \"./services/notification-manager.js\";\n\n// Feature imports\nimport {\n  setupKeyboardNavigation,\n  keyboardNavigationMixin,\n} from \"./features/keyboard-navigation.js\";\nimport { responseHandlerMixin } from \"./features/response-handlers.js\";\nimport { imageHandlerMixin } from \"./features/image-handlers.js\";\nimport { stateManagementMixin } from \"./features/state-integration.js\";\nimport { createTemplate } from \"./template.js\";\n\nclass AITextEnhancer extends HTMLElement {\n  constructor() {\n    super();\n\n    // Apply mixins first\n    Object.assign(\n      this,\n      keyboardNavigationMixin,\n      responseHandlerMixin,\n      imageHandlerMixin,\n      stateManagementMixin\n    );\n\n    // Register required components\n    if (!customElements.get(\"ai-toolbar\")) {\n      customElements.define(\"ai-toolbar\", ToolBar);\n    }\n    if (!customElements.get(\"chat-with-image\")) {\n      customElements.define(\"chat-with-image\", ChatWithImage);\n    }\n    if (!customElements.get(\"response-history\")) {\n      customElements.define(\"response-history\", ResponseHistory);\n    }\n\n    // Initialize core components\n    this.eventEmitter = createEventEmitter(this);\n    this.responseHistory = null;\n    this.editorAdapter = null;\n    this.currentAction = \"improve\";\n    // Eliminado ModelManager, ya no es necesario para múltiples providers\n    // this.modelManager = new ModelManager();\n    this.markdownHandler = new MarkdownHandler();\n    this.tokenManager = new TokenManager();\n\n    // Inicializar el gestor de estado\n    this.initializeStateManager();\n\n    // Initialize cache\n    this.cacheManager = createCacheManager({\n      prefix: \"ai-text-enhancer\",\n      maxItems: 20,\n      ttl: 30 * 60 * 1000,\n    });\n\n    // State initialization\n    this.stateManager.batchUpdate({\n      enhancedText: \"\",\n      chatMessages: [],\n      isInitialized: false,\n      productImage: null,\n      usageControl: null,\n    });\n\n    // Bind methods after mixins are applied\n    this.bindMethods();\n\n    // Configuración del endpoint del proxy (única integración)\n    // this.proxyEndpoint = this.getAttribute(\"proxy-endpoint\") || \"\";\n  }\n\n  bindMethods() {\n    // Core methods\n    this.handleToolAction = this.handleToolAction?.bind(this);\n    this.handleChatMessage = this.handleChatMessage?.bind(this);\n\n    // Response handler methods\n    this.handleResponseCopy = this.handleResponseCopy?.bind(this);\n    this.handleResponseUse = this.handleResponseUse?.bind(this);\n    this.handleResponseRetry = this.handleResponseRetry?.bind(this);\n    this.handleResponseEdit = this.handleResponseEdit?.bind(this);\n\n    // Keyboard navigation methods\n    this.handleKeyboard = this.handleKeyboard?.bind(this);\n    this.handleModalKeyboard = this.handleModalKeyboard?.bind(this);\n\n    // Modal trigger handler\n    this.modalTriggerHandler = this.modalTriggerHandler?.bind(this);\n  }\n\n  // Getters\n  static get observedAttributes() {\n    return [\n      \"editor-id\",\n      \"api-key\",\n      \"api-provider\",\n      \"api-model\",\n      \"language\",\n      \"prompt\",\n      \"context\",\n      \"image-url\",\n      \"tenant-id\",\n      \"user-id\",\n      \"quota-endpoint\",\n      \"proxy-endpoint\",\n      \"editor-type\",\n      \"hide-trigger\",\n      \"id\", // Añadido el atributo id\n    ];\n  }\n\n  get language() {\n    return this.getAttribute(\"language\") || \"en\";\n  }\n\n  get translations() {\n    return TRANSLATIONS[this.language] || TRANSLATIONS.en;\n  }\n\n  get editorId() {\n    return this.getAttribute(\"editor-id\");\n  }\n\n  get editorType() {\n    return this.getAttribute(\"editor-type\") || \"textarea\";\n  }\n\n  get apiKey() {\n    return this.getAttribute(\"api-key\");\n  }\n\n  get prompt() {\n    return (\n      this.getAttribute(\"prompt\") ||\n      \"You are a professional content enhancer. Improve the text while maintaining its core message and intent.\"\n    );\n  }\n\n  get currentContent() {\n    return this.editorAdapter?.getContent() || \"\";\n  }\n\n  get apiProvider() {\n    return this.getAttribute(\"api-provider\") || \"openai\";\n  }\n\n  get apiModel() {\n    return this.getAttribute(\"api-model\") || \"gpt-3.5-turbo\";\n  }\n\n  get imageUrl() {\n    return this.getAttribute(\"image-url\");\n  }\n\n  get context() {\n    return this.getAttribute(\"context\") || \"\";\n  }\n\n  get proxyEndpoint() {\n    return this.getAttribute(\"proxy-endpoint\");\n  }\n\n  get hideTrigger() {\n    return this.hasAttribute(\"hide-trigger\");\n  }\n\n  get componentId() { // Añadido getter para componentId\n    return this.getAttribute(\"id\");\n  }\n\n  // Método mejorado para connectedCallback\n  async connectedCallback() {\n    try {\n      console.log(\"[AITextEnhancer] Component connected, initializing...\");\n\n      // Crear el template y adjuntarlo al shadowRoot\n      const template = createTemplate(this);\n      attachShadowTemplate(this, template);\n      console.log(\"[AITextEnhancer] Shadow DOM created\");\n\n      // Inicializar el NotificationManager\n      const notificationsContainer = this.shadowRoot.querySelector(\n        \".notifications-container\"\n      );\n      if (notificationsContainer) {\n        this.notificationManager = createNotificationManager(\n          notificationsContainer\n        );\n        console.log(\"[AITextEnhancer] Notification manager initialized\");\n      }\n\n      // Asegurar que el modal exista y esté configurado correctamente\n      this.ensureModalExists();\n\n      // Configurar idioma para los hijos\n      this.updateLanguageForChildren(this.language);\n\n      // Configurar eventos\n      this.setupEventListeners();\n      setupKeyboardNavigation(this);\n\n      // Inicializar componentes - esperar a que completen\n      await this.initializeComponents();\n      console.log(\"[AITextEnhancer] Components initialized\");\n\n      // Configurar listener del editor\n      this.setupEditorListener();\n\n      // Bandera para saber si el editor está listo\n      this.editorReady = false;\n      if (window.tinymce && this.editorId && tinymce.get(this.editorId)) {\n        const editorInstance = tinymce.get(this.editorId);\n        if (editorInstance.initialized) {\n          this.editorReady = true;\n        } else {\n          editorInstance.on('init', () => {\n            this.editorReady = true;\n            this.updateChatState();\n          });\n        }\n      } else {\n        // Si no es TinyMCE, asumimos que el editorAdapter está listo después de initializeComponents\n        this.editorReady = true;\n      }\n\n      // Solo actualizar el chat si el editor está listo\n      if (this.editorReady) {\n        this.updateChatState();\n      }\n\n      // Reforzar la vinculación de eventos después de la inicialización\n      setTimeout(() => {\n        console.log(\"[AITextEnhancer] Re-binding events after initialization\");\n        this.bindEvents();\n\n        // Verificación final\n        const modalTrigger = this.shadowRoot.querySelector(\".modal-trigger\");\n        if (modalTrigger) {\n          console.log(\"[AITextEnhancer] Modal trigger element:\", modalTrigger);\n        } else {\n          console.warn(\n            \"[AITextEnhancer] Modal trigger still not found after initialization\"\n          );\n        }\n      }, 200);\n\n      console.log(\"[AITextEnhancer] Component fully initialized\");\n    } catch (error) {\n      console.error(\"[AITextEnhancer] Error initializing component:\", error);\n\n      // Intentar mostrar notificación de error\n      try {\n        if (this.notificationManager) {\n          this.notificationManager.error(\n            `Initialization error: ${error.message}`\n          );\n        } else {\n          // Fallback: mostrar error en el shadowRoot si está disponible\n          if (this.shadowRoot) {\n            const errorElement = document.createElement(\"div\");\n            errorElement.style.color = \"red\";\n            errorElement.style.padding = \"10px\";\n            errorElement.style.margin = \"10px 0\";\n            errorElement.style.border = \"1px solid red\";\n            errorElement.textContent = `Error initializing component: ${error.message}`;\n            this.shadowRoot.appendChild(errorElement);\n          }\n        }\n      } catch (notifError) {\n        console.error(\n          \"[AITextEnhancer] Error showing notification:\",\n          notifError\n        );\n      }\n    }\n  }\n\n  // Método mejorado para attributeChangedCallback\n  attributeChangedCallback(name, oldValue, newValue) {\n    console.log(\n      \"[AITextEnhancer] Attribute changed:\",\n      name,\n      \"from\",\n      oldValue,\n      \"to\",\n      newValue\n    );\n    if (oldValue === newValue) return;\n\n    switch (name) {\n      case \"api-key\":\n        if (this.apiClient) {\n          this.apiClient.setApiKey(newValue);\n        } else if (!this.isInitialized) {\n          this.initializeComponents();\n        }\n        break;\n      case \"language\":\n        this.updateLanguageForChildren(newValue);\n        break;\n      case \"context\":\n        // Update chat state when context changes\n        setTimeout(() => this.updateChatState(), 100);\n        break;\n      case \"api-provider\":\n      case \"api-model\":\n      case \"proxy-endpoint\":\n        if (this.isInitialized && this.apiClient) {\n          this.apiClient.updateConfig({\n            provider: this.apiProvider,\n            model: this.apiModel,\n            proxyEndpoint: this.proxyEndpoint,\n          });\n        }\n        break;\n      case \"image-url\":\n        if (this.isInitialized) {\n          const chatComponent =\n            this.shadowRoot.querySelector(\"chat-with-image\");\n          if (chatComponent) {\n            chatComponent.setAttribute(\"image-url\", newValue || \"\");\n          }\n        }\n        break;\n    }\n  }\n\n  // Método mejorado para setupEditorListener\n  setupEditorListener() {\n    if (!this.editorId) {\n      console.warn(\"[AITextEnhancer] No editor ID provided\");\n      return;\n    }\n\n    const editorElement = document.getElementById(this.editorId);\n    if (!editorElement) {\n      console.warn(\n        `[AITextEnhancer] Editor element with ID \"${this.editorId}\" not found`\n      );\n\n      if (this.notificationManager) {\n        this.notificationManager.warning(\n          `Editor element \"${this.editorId}\" not found. Text enhancement functionality may be limited.`\n        );\n      }\n      return;\n    }\n\n    // Función para actualizar el estado del chat cuando cambia el contenido del editor\n    const updateChatOnChange = () => {\n      // Update only if modal is open to avoid unnecessary updates\n      if (this.isModalOpen()) {\n        this.updateChatState();\n\n        // También actualizar las herramientas visibles basado en el contenido\n        this.updateVisibleTools();\n      }\n    };\n\n    // Eliminar listeners anteriores si existen\n    if (this._editorChangeListener) {\n      editorElement.removeEventListener(\"input\", this._editorChangeListener);\n      editorElement.removeEventListener(\"change\", this._editorChangeListener);\n    }\n\n    // Guardar referencia al listener para poder eliminarlo después\n    this._editorChangeListener = updateChatOnChange;\n\n    // Añadir listeners para diferentes tipos de editores\n    editorElement.addEventListener(\"input\", this._editorChangeListener);\n    editorElement.addEventListener(\"change\", this._editorChangeListener);\n\n    console.log(\n      `[AITextEnhancer] Editor listener set up for \"${this.editorId}\"`\n    );\n  }\n\n  // Método mejorado para updateLanguageForChildren\n  updateLanguageForChildren(language) {\n    console.log(\"[AITextEnhancer] Updating language for children:\", language);\n\n    if (!this.shadowRoot) {\n      console.warn(\"[AITextEnhancer] No shadowRoot available yet\");\n      return;\n    }\n\n    // Update modal texts\n    const modalTrigger = this.shadowRoot.querySelector(\".modal-trigger span\");\n    const modalTitle = this.shadowRoot.querySelector(\".modal-header h2\");\n\n    if (modalTrigger) {\n      modalTrigger.textContent =\n        this.translations.modalTrigger || \"Enhance Text\";\n      console.log(\n        \"[AITextEnhancer] Updated modal trigger text:\",\n        modalTrigger.textContent\n      );\n    }\n\n    if (modalTitle) {\n      modalTitle.textContent = this.translations.modalTitle || \"Enhance Text\";\n      console.log(\n        \"[AITextEnhancer] Updated modal title text:\",\n        modalTitle.textContent\n      );\n    }\n\n    // Asegurar que el manejador de eventos siga funcionando\n    if (this.modalTriggerHandler) {\n      const trigger = this.shadowRoot.querySelector(\".modal-trigger\");\n      if (trigger) {\n        trigger.removeEventListener(\"click\", this.modalTriggerHandler);\n        trigger.addEventListener(\"click\", this.modalTriggerHandler);\n      }\n    }\n\n    // Actualizar componentes con el atributo de language\n    const components = this.shadowRoot.querySelectorAll(\"[language]\");\n    console.log(\n      \"[AITextEnhancer] Found components to update:\",\n      components.length\n    );\n\n    components.forEach((component) => {\n      const oldLang = component.getAttribute(\"language\");\n      component.setAttribute(\"language\", language);\n      console.log(\"[AITextEnhancer] Updated component language:\", {\n        component: component.tagName,\n        from: oldLang,\n        to: language,\n      });\n    });\n\n    // Forzar la actualización en componentes específicos\n    const toolbar = this.shadowRoot.querySelector(\"ai-toolbar\");\n    const chatComponent = this.shadowRoot.querySelector(\"chat-with-image\");\n    const responseHistory = this.shadowRoot.querySelector(\"response-history\");\n\n    [toolbar, chatComponent, responseHistory].forEach((component) => {\n      if (component) {\n        component.setAttribute(\"language\", language);\n        console.log(\n          \"[AITextEnhancer] Forced language update on:\",\n          component.tagName\n        );\n      }\n    });\n  }\n\n  // Método mejorado para modalTriggerHandler\n  modalTriggerHandler() {\n    console.log(\"[AITextEnhancer] Modal trigger clicked, checking shadowRoot\");\n\n    if (!this.shadowRoot) {\n      console.error(\"[AITextEnhancer] Shadow root not available\");\n      return;\n    }\n\n    const modal = this.shadowRoot.querySelector(\".modal\");\n    if (!modal) {\n      console.error(\"[AITextEnhancer] Modal element not found in shadowRoot\");\n\n      // Intentar recrear el modal\n      if (this.notificationManager) {\n        this.notificationManager.warning(\n          \"Modal not found, trying to recreate it...\"\n        );\n      }\n\n      if (this.ensureModalExists()) {\n        const newModal = this.shadowRoot.querySelector(\".modal\");\n        if (newModal) {\n          modal = newModal;\n        } else {\n          if (this.notificationManager) {\n            this.notificationManager.error(\"Failed to recreate modal\");\n          }\n          return;\n        }\n      } else {\n        return;\n      }\n    }\n\n    // Solo loguear el contenido si el editor está listo\n    console.log(\"[AITextEnhancer] Opening modal with current state:\", {\n      apiProvider: this.apiProvider,\n      model: this.apiModel,\n      language: this.language,\n      context:\n        this.context?.substring(0, 50) +\n        (this.context?.length > 50 ? \"...\" : \"\"),\n      imageUrl: this.imageUrl,\n      hasContent: this.editorReady ? Boolean(this.currentContent?.trim()) : false,\n      hasContext: Boolean(this.context?.trim()),\n      editorReady: this.editorReady\n    });\n\n    modal.classList.add(\"open\");\n\n    // Asegurar que se actualice el estado de las herramientas\n    setTimeout(() => {\n      this.updateVisibleTools();\n      this.updateChatState();\n\n      // Enfocar el primer elemento interactivo para mejorar la accesibilidad\n      const firstFocusable = modal.querySelector(\n        'button, [href], input, select, textarea, [tabindex]:not([tabindex=\"-1\"])'\n      );\n      if (firstFocusable) {\n        firstFocusable.focus();\n      }\n    }, 100);\n  }\n\n  // Método público para abrir el modal programáticamente\n  openModal() {\n    const modal = this.shadowRoot.querySelector(\".modal\");\n    if (modal) {\n      modal.classList.add(\"open\");\n\n      // Asegurar que se actualice el estado de las herramientas\n      setTimeout(() => {\n        this.updateVisibleTools();\n        this.updateChatState();\n\n        // Enfocar el primer elemento interactivo para mejorar la accesibilidad\n        const firstFocusable = modal.querySelector(\n          'button, [href], input, select, textarea, [tabindex]:not([tabindex=\"-1\"])'\n        );\n        if (firstFocusable) {\n          firstFocusable.focus();\n        }\n      }, 100);\n    }\n  }\n\n  // Función para asegurar que el modal exista\n  ensureModalExists() {\n    // Esta función garantiza que el modal esté presente en el DOM\n    if (!this.shadowRoot) {\n      console.error(\"[AITextEnhancer] No shadowRoot available for modal check\");\n      return false;\n    }\n\n    let modal = this.shadowRoot.querySelector(\".modal\");\n    if (!modal) {\n      console.warn(\"[AITextEnhancer] Modal not found, attempting to recreate\");\n\n      // Intentar recrear el modal desde la plantilla\n      const template = createTemplate(this);\n      const fragment = document\n        .createRange()\n        .createContextualFragment(template);\n      const newModal = fragment.querySelector(\".modal\");\n\n      if (newModal) {\n        this.shadowRoot.appendChild(newModal);\n        console.log(\"[AITextEnhancer] Modal recreated successfully\");\n\n        // Asegurar que los eventos estén vinculados\n        const closeButton = newModal.querySelector(\".close-button\");\n        if (closeButton) {\n          closeButton.onclick = () => newModal.classList.remove(\"open\");\n        }\n\n        newModal.onclick = (e) => {\n          if (e.target === newModal) {\n            newModal.classList.remove(\"open\");\n          }\n        };\n\n        modal = newModal;\n      } else {\n        console.error(\"[AITextEnhancer] Failed to recreate modal\");\n        return false;\n      }\n    }\n\n    return true;\n  }\n\n  // Método mejorado para setupEventListeners\n  setupEventListeners() {\n    // Obtener el componente de chat\n    const chatComponent = this.shadowRoot.querySelector(\"chat-with-image\");\n    if (chatComponent) {\n      // Eliminar listener anterior si existe\n      chatComponent.removeEventListener(\"chatMessage\", this.handleChatMessage);\n      // Agregar nuevo listener\n      chatComponent.addEventListener(\"chatMessage\", this.handleChatMessage);\n      console.log(\"[AITextEnhancer] Chat message event listener set up\");\n    } else {\n      console.warn(\"[AITextEnhancer] Chat component not found\");\n    }\n\n    // Obtener el componente de historial de respuestas\n    this.responseHistory = this.shadowRoot.querySelector(\"response-history\");\n    if (this.responseHistory) {\n      // Configurar markdown handler\n      if (this.markdownHandler) {\n        this.responseHistory.markdownHandler = this.markdownHandler;\n      }\n\n      // Configurar eventos\n      this.responseHistory.addEventListener(\n        \"responseCopy\",\n        this.handleResponseCopy\n      );\n      this.responseHistory.addEventListener(\n        \"responseUse\",\n        this.handleResponseUse\n      );\n      this.responseHistory.addEventListener(\n        \"responseRetry\",\n        this.handleResponseRetry\n      );\n      this.responseHistory.addEventListener(\n        \"responseEdit\",\n        this.handleResponseEdit\n      );\n      this.responseHistory.addEventListener(\n        \"toolaction\",\n        this.handleToolAction\n      );\n\n      console.log(\"[AITextEnhancer] Response history events set up\");\n    } else {\n      console.warn(\"[AITextEnhancer] Response history component not found\");\n    }\n\n    // Configurar evento para actualización de configuración\n    this.addEventListener(\"configurationUpdated\", (event) => {\n      console.log(\"[AITextEnhancer] Configuration updated:\", event.detail);\n      if (this.isInitialized) {\n        this.initializeComponents().catch((error) => {\n          console.error(\"Error reinitializing components:\", error);\n          if (this.notificationManager) {\n            this.notificationManager.error(\n              `Failed to update configuration: ${error.message}`\n            );\n          }\n        });\n      }\n    });\n\n    // Vincular eventos UI\n    this.bindEvents();\n  }\n\n  // Método mejorado para bindEvents\n  bindEvents() {\n    // Verificar que el shadowRoot exista\n    if (!this.shadowRoot) {\n      console.error(\"[AITextEnhancer] No shadowRoot available in bindEvents\");\n      return;\n    }\n\n    // Modal events\n    const modal = this.shadowRoot.querySelector(\".modal\");\n    const modalTrigger = this.shadowRoot.querySelector(\".modal-trigger\");\n\n    if (modalTrigger) {\n      // Define the handler as a bound method if not already bound\n      if (!this.modalTriggerHandler) {\n        this.modalTriggerHandler = this.modalTriggerHandler.bind(this);\n      }\n\n      // Remove any existing event listener before adding new one\n      modalTrigger.removeEventListener(\"click\", this.modalTriggerHandler);\n      modalTrigger.addEventListener(\"click\", this.modalTriggerHandler);\n      console.log(\"[AITextEnhancer] Modal trigger event bound\");\n    } else {\n      console.warn(\"[AITextEnhancer] Modal trigger not found in bindEvents\");\n    }\n\n    // Modal and close button\n    if (modal) {\n      // Set up click outside to close\n      modal.onclick = (e) => {\n        if (e.target === modal) {\n          modal.classList.remove(\"open\");\n        }\n      };\n\n      // Close button\n      const closeButton = modal.querySelector(\".close-button\");\n      if (closeButton) {\n        closeButton.onclick = () => modal.classList.remove(\"open\");\n        console.log(\"[AITextEnhancer] Close button event bound\");\n      } else {\n        console.warn(\"[AITextEnhancer] Close button not found in modal\");\n      }\n    } else {\n      console.warn(\"[AITextEnhancer] Modal element not found in bindEvents\");\n    }\n\n    // Tool buttons\n    const toolbar = this.shadowRoot.querySelector(\"ai-toolbar\");\n    if (toolbar) {\n      // Remove previous listener if it exists\n      toolbar.removeEventListener(\"toolaction\", this.handleToolAction);\n      toolbar.addEventListener(\"toolaction\", this.handleToolAction);\n      console.log(\"[AITextEnhancer] Toolbar events bound\");\n    } else {\n      console.warn(\"[AITextEnhancer] Toolbar not found in bindEvents\");\n    }\n\n    // Chat component\n    const chatComponent = this.shadowRoot.querySelector(\"chat-with-image\");\n    if (chatComponent) {\n      // Remove previous listener if it exists\n      chatComponent.removeEventListener(\"chatMessage\", this.handleChatMessage);\n      chatComponent.addEventListener(\"chatMessage\", this.handleChatMessage);\n      console.log(\"[AITextEnhancer] Chat component events bound\");\n    }\n\n    // Response history\n    if (this.responseHistory) {\n      // Remove previous listeners\n      this.responseHistory.removeEventListener(\n        \"responseCopy\",\n        this.handleResponseCopy\n      );\n      this.responseHistory.removeEventListener(\n        \"responseUse\",\n        this.handleResponseUse\n      );\n      this.responseHistory.removeEventListener(\n        \"responseRetry\",\n        this.handleResponseRetry\n      );\n      this.responseHistory.removeEventListener(\n        \"responseEdit\",\n        this.handleResponseEdit\n      );\n      this.responseHistory.removeEventListener(\n        \"toolaction\",\n        this.handleToolAction\n      );\n\n      // Add new listeners\n      this.responseHistory.addEventListener(\n        \"responseCopy\",\n        this.handleResponseCopy\n      );\n      this.responseHistory.addEventListener(\n        \"responseUse\",\n        this.handleResponseUse\n      );\n      this.responseHistory.addEventListener(\n        \"responseRetry\",\n        this.handleResponseRetry\n      );\n      this.responseHistory.addEventListener(\n        \"responseEdit\",\n        this.handleResponseEdit\n      );\n      this.responseHistory.addEventListener(\n        \"toolaction\",\n        this.handleToolAction\n      );\n      console.log(\"[AITextEnhancer] Response history events bound\");\n    }\n\n    // Set up editor listener\n    this.setupEditorListener();\n\n    console.log(\"[AITextEnhancer] All events bound successfully\");\n  }\n\n  setupTinyMCEIntegration(editorInstance) {\n    // Añadir un listener adicional directamente en response-history para mayor robustez\n    if (this.responseHistory) {\n      this.responseHistory.addEventListener(\"responseUse\", (event) => {\n        try {\n          const { responseId } = event.detail || {};\n          if (!responseId) return;\n\n          // Obtener la respuesta\n          const response = this.responseHistory.getResponse(responseId);\n          if (response && response.content) {\n            // Aplicar directamente a TinyMCE\n            if (editorInstance && editorInstance.initialized) {\n              editorInstance.setContent(response.content);\n              editorInstance.undoManager.add();\n\n              // Cerrar el modal\n              setTimeout(() => {\n                const modal = this.shadowRoot.querySelector(\".modal\");\n                if (modal) {\n                  modal.classList.remove(\"open\");\n                }\n              }, 100);\n            }\n          }\n        } catch (error) {\n          console.error(\n            \"[AITextEnhancer] Error in direct responseUse handler:\",\n            error\n          );\n        }\n      });\n    }\n  }\n\n  // Método actualizado para initializeComponents\n  async initializeComponents() {\n    if (this.isInitialized) {\n      console.log(\"[AITextEnhancer] Components already initialized, skipping\");\n      return;\n    }\n\n    if (this.editorType === \"tinymce\" && window.tinymce) {\n      try {\n        const tinyMceInstance = window.tinymce.get(this.editorId);\n        if (tinyMceInstance) {\n          console.log(\n            \"[AITextEnhancer] TinyMCE detected, configuring special handling\"\n          );\n\n          // Configuración especial para TinyMCE\n          this.setupTinyMCEIntegration(tinyMceInstance);\n        }\n      } catch (error) {\n        console.warn(\n          \"[AITextEnhancer] Error setting up TinyMCE integration:\",\n          error\n        );\n      }\n    }\n\n    try {\n      console.log(\"[AITextEnhancer] Initializing components...\");\n\n      // Inicializar markdown handler\n      await this.markdownHandler.initialize();\n      console.log(\"[AITextEnhancer] Markdown handler initialized\");\n\n      // Obtener el endpoint del proxy del atributo o usar el valor predeterminado\n      const proxyEndpoint =\n        this.proxyEndpoint || \"https://llmproxy.mitienda.host/index.php/api/llm-proxy\";\n\n      // Inicializar API client con proxy\n      this.apiClient = createAPIClient({\n        provider: this.apiProvider,\n        model: this.apiModel,\n        systemPrompt: this.prompt,\n        temperature: 0.7,\n        proxyEndpoint: proxyEndpoint,\n        tenantId: this.getAttribute(\"tenant-id\") || \"default\",\n        userId: this.getAttribute(\"user-id\") || \"default\",\n        componentId: this.componentId, // Añadido componentId\n        debugMode: false,\n      });\n\n      console.log(\n        \"[AITextEnhancer] API client initialized with provider\",\n        this.apiProvider\n      );\n\n      // Inicializar editor adapter si editor ID es proporcionado\n      if (this.editorId) {\n        // Pasar el tipo de editor al crear EditorAdapter\n        this.editorAdapter = new EditorAdapter(this.editorId, this.editorType);\n        console.log(\n          \"[AITextEnhancer] Editor adapter initialized for\",\n          this.editorId,\n          \"with type\",\n          this.editorType\n        );\n      } else {\n        console.warn(\n          \"[AITextEnhancer] No editor ID provided, editor adapter not initialized\"\n        );\n      }\n\n      // Pasar markdown handler a response history\n      const responseHistory = this.shadowRoot.querySelector(\"response-history\");\n      if (responseHistory) {\n        responseHistory.markdownHandler = this.markdownHandler;\n        console.log(\n          \"[AITextEnhancer] Markdown handler passed to response history\"\n        );\n      }\n\n      // Establecer estado inicial\n      this.isInitialized = true;\n\n      // Notificar éxito\n      if (this.notificationManager) {\n        this.notificationManager.success(\n          \"AI Text Enhancer initialized successfully\"\n        );\n      }\n\n      // Actualizar herramientas visibles basadas en contenido\n      this.updateVisibleTools();\n\n      return true;\n    } catch (error) {\n      console.error(\"Error in initializeComponents:\", error);\n\n      // Notificar error\n      if (this.notificationManager) {\n        this.notificationManager.error(\n          `Initialization error: ${error.message}`\n        );\n      }\n\n      this.addResponseToHistory(\n        \"error\",\n        `Initialization error: ${error.message}`\n      );\n\n      throw error;\n    }\n  }\n\n  isModalOpen() {\n    const modal = this.shadowRoot?.querySelector(\".modal\");\n    return modal ? modal.classList.contains(\"open\") : false;\n  }\n\n  // Método mejorado de updateVisibleTools\n  updateVisibleTools() {\n    try {\n      // Implementación segura que evita errores con .trim()\n      let content = \"\";\n\n      // Intentar obtener el contenido de forma segura\n      if (\n        this.editorAdapter &&\n        typeof this.editorAdapter.getContent === \"function\"\n      ) {\n        try {\n          const rawContent = this.editorAdapter.getContent();\n          content = typeof rawContent === \"string\" ? rawContent : \"\";\n        } catch (error) {\n          console.warn(\n            \"[AITextEnhancer] Error obteniendo contenido del editor:\",\n            error\n          );\n        }\n      }\n\n      // Verificar si hay contenido de forma segura\n      const hasContent = content.trim().length > 0;\n\n      // Actualizar la barra de herramientas\n      const toolbar = this.shadowRoot?.querySelector(\"ai-toolbar\");\n      if (toolbar) {\n        toolbar.setAttribute(\"has-content\", hasContent.toString());\n      }\n    } catch (error) {\n      console.warn(\"[AITextEnhancer] Error en updateVisibleTools:\", error);\n      // No propagar el error para no romper la inicialización\n    }\n  }\n\n  // Getter mejorado de currentContent\n  get currentContent() {\n    try {\n      // Usar el editorAdapter si está listo\n      if (\n        this.editorAdapter &&\n        typeof this.editorAdapter.getContent === \"function\"\n      ) {\n        const content = this.editorAdapter.getContent();\n        if (typeof content === \"string\") {\n          return content;\n        }\n        // Si es una promesa, solo advierte y devuelve string vacío (sin efectos secundarios)\n        if (content && typeof content.then === \"function\") {\n          console.warn(\"[AITextEnhancer] editorAdapter.getContent() devolvió una promesa. Debes usar await para obtener el contenido real.\");\n          return \"\";\n        }\n        console.warn(\"[AITextEnhancer] editorAdapter.getContent() no devolvió un string\", content);\n        return \"\";\n      }\n\n      // Fallback para TinyMCE (si está presente en la página)\n      if (window.tinymce && this.editorId && tinymce.get(this.editorId)) {\n        const editorInstance = tinymce.get(this.editorId);\n        if (editorInstance && typeof editorInstance.getContent === \"function\") {\n          const content = editorInstance.getContent();\n          if (typeof content === \"string\") {\n            return content;\n          } else {\n            console.warn(\"[AITextEnhancer] TinyMCE.getContent() no devolvió un string\", content);\n            return \"\";\n          }\n        } else {\n          console.warn(\"[AITextEnhancer] TinyMCE instance not ready for editorId:\", this.editorId);\n          return \"\";\n        }\n      }\n\n      return \"\";\n    } catch (error) {\n      console.warn(\"[AITextEnhancer] Error en getter currentContent:\", error);\n      return \"\";\n    }\n  }\n\n  /**\n   * Manejador mejorado de mensajes de chat para AITextEnhancer\n   * con soporte para URLs de imágenes externas afectadas por CORS\n   */\n  async handleChatMessage(event) {\n    const { message, image } = event.detail;\n\n    try {\n      // Validar mensaje\n      if (!message?.trim() && !image) {\n        throw new Error(\"Message cannot be empty\");\n      }\n\n      // Agregar la pregunta con imagen al historial\n      const questionResponse = {\n        id: Date.now(),\n        action: \"chat-question\",\n        content: `**${this.translations.chat.question}:** ${message}`,\n        timestamp: new Date(),\n        image: image,\n      };\n      this.responseHistory.addResponse(questionResponse);\n\n      // Crear un ID para el streaming de respuestas\n      const responseId = Date.now() + 1;\n\n      // Agregar respuesta inicial vacía\n      this.responseHistory.addResponse({\n        id: responseId,\n        action: \"chat-response\",\n        content: \"\", // Empezar con contenido vacío para streaming adecuado\n        timestamp: new Date(),\n      });\n\n      // Manejador de streaming optimizado para evitar parpadeo\n      const onProgress = (chunk) => {\n        this.responseHistory.updateResponse(\n          responseId,\n          (prevContent) => prevContent + chunk\n        );\n      };\n\n      // Determinar el tipo de imagen (URL o File)\n      let imageParameter = image;\n\n      // Si la imagen es una string pero no empieza con 'data:' (que sería un data URL),\n      // asumimos que es una URL externa y la pasamos directamente\n      if (typeof image === \"string\" && !image.startsWith(\"data:\")) {\n        console.log(\"[AITextEnhancer] Using external image URL:\", image);\n        // Mantener la URL como string, el API client la maneja adecuadamente\n      }\n      // De lo contrario, si es un objeto File, lo pasamos como está\n      else if (image instanceof File) {\n        console.log(\"[AITextEnhancer] Using image file:\", image.name);\n      }\n      // O podría ser null/undefined (sin imagen)\n\n      // Hacer solicitud API con streaming\n      await this.apiClient.chatResponse(\n        this.currentContent,\n        message.trim(),\n        imageParameter,\n        onProgress\n      );\n\n      // Un último scroll para asegurar que todo el contenido sea visible\n      setTimeout(() => {\n        const responseContainer = this.shadowRoot.querySelector(\n          \".response-container\"\n        );\n        if (responseContainer) {\n          responseContainer.scrollTop = responseContainer.scrollHeight;\n        }\n      }, 200);\n\n      // Mostrar notificación de éxito sutil\n      if (this.notificationManager) {\n        this.notificationManager.success(\"Response received\", 2000);\n      }\n    } catch (error) {\n      console.error(\"Chat Error:\", error);\n      const errorMessage = this.formatErrorMessage(error);\n      this.addResponseToHistory(\"chat-error\", errorMessage);\n\n      // Mostrar notificación de error\n      if (this.notificationManager) {\n        this.notificationManager.error(`Chat error: ${error.message}`);\n      }\n    }\n  }\n  // Agrega este método para solicitar actualizaciones explícitas\n  requestUpdate(part = null) {\n    // Este método delegará en el stateManager\n    if (\n      this.stateManager &&\n      typeof this.stateManager.triggerUpdate === \"function\"\n    ) {\n      return this.stateManager.triggerUpdate(part);\n    } else {\n      console.warn(\n        \"[AITextEnhancer] StateManager or triggerUpdate method not available\"\n      );\n      return false;\n    }\n  }\n\n  /**\n   * Updates the ChatWithImage component with current content and context state\n   * This should be called whenever editor content or context changes\n   */\n  updateChatState() {\n    if (!this.shadowRoot) return;\n\n    const chatComponent = this.shadowRoot.querySelector(\"chat-with-image\");\n    if (!chatComponent) return;\n\n    // Propaga supports-images al componente interno\n    if (this.hasAttribute(\"supports-images\")) {\n      chatComponent.setAttribute(\"supports-images\", this.getAttribute(\"supports-images\"));\n    } else {\n      chatComponent.removeAttribute(\"supports-images\");\n    }\n\n    // Solo accede al contenido si el editor está listo\n    let contentLength = 0;\n    if (this.editorReady) {\n      contentLength = this.currentContent?.length || 0;\n    }\n\n    // Log for debugging\n    console.log(\"[AITextEnhancer] Updated chat state:\", {\n      contentLength: contentLength,\n      contextLength: this.context?.length || 0,\n      supportsImages: chatComponent.getAttribute(\"supports-images\"),\n      editorReady: this.editorReady\n    });\n  }\n\n  /**\n   * Override the original handleToolAction method to update chat state after content changes\n   */\n  /**\n   * Improved handleToolAction method for AITextEnhancer\n   * This implementation resolves issues with the retry functionality\n   * Replace this method in src/index.js\n   */\n  async handleToolAction(event) {\n    // Safely extract action details with fallbacks\n    const detail = event.detail || {};\n    const action = detail.action;\n    const responseId = detail.responseId;\n    const content = detail.content;\n\n    console.log(\"[AITextEnhancer] Tool action received:\", {\n      action,\n      responseId,\n      contentLength: content ? content.length : 0,\n    });\n\n    if (!action) {\n      console.error(\"[AITextEnhancer] Tool action missing action parameter\");\n      if (this.notificationManager) {\n        this.notificationManager.error(\"Invalid action request\");\n      }\n      return;\n    }\n\n    let tempResponse = null;\n    try {\n      // Determine text to process - from response content, event content, or current editor content\n      const textToProcess = content || this.currentContent;\n\n      // Check for cached response\n      const cachedResponse = this.cacheManager?.get(action, textToProcess);\n      if (cachedResponse) {\n        console.log(\"[AITextEnhancer] Using cached response for\", action);\n        this.addResponseToHistory(action, cachedResponse);\n        return;\n      }\n\n      // Create temporary response for showing progress\n      tempResponse = {\n        id: Date.now(),\n        action,\n        content: \"\", // Empty content to start with\n        timestamp: new Date(),\n      };\n\n      // Add response to history\n      if (this.responseHistory) {\n        this.responseHistory.addResponse(tempResponse);\n      } else {\n        console.error(\"[AITextEnhancer] Response history not available\");\n        return;\n      }\n\n      // Check if components are initialized\n      if (!this.apiClient || !this.isInitialized) {\n        console.log(\n          \"[AITextEnhancer] Components not initialized, initializing now...\"\n        );\n        await this.initializeComponents();\n      }\n\n      // Handler for streaming updates\n      const onProgress = (chunk) => {\n        if (chunk && this.responseHistory) {\n          this.responseHistory.updateResponse(\n            tempResponse.id,\n            (prevContent) => prevContent + chunk\n          );\n        }\n      };\n\n      try {\n        // Make the actual API request\n        console.log(\"[AITextEnhancer] Making API request for action:\", action);\n\n        // Log if we're using an empty text\n        if (!textToProcess) {\n          console.warn(\n            \"[AITextEnhancer] Processing empty text for action:\",\n            action\n          );\n        }\n\n        const completeText = await this.apiClient.enhanceText(\n          textToProcess,\n          action,\n          null, // No image for tool actions\n          this.context,\n          onProgress\n        );\n\n        // Cache for future requests if cache manager is available\n        if (this.cacheManager) {\n          this.cacheManager.set(action, textToProcess, completeText);\n        }\n\n        // Update chat state\n        this.updateChatState();\n\n        // Show success notification\n        if (this.notificationManager) {\n          const actionName = this.translations?.tools?.[action] || action;\n          this.notificationManager.success(\n            `Text ${actionName} successfully`,\n            2000\n          );\n        }\n      } catch (error) {\n        console.error(\"[AITextEnhancer] API request error:\", error);\n\n        // Remove temporary response\n        if (tempResponse && this.responseHistory) {\n          this.responseHistory.removeResponse(tempResponse.id);\n        }\n\n        // Add error message\n        this.addResponseToHistory(\"error\", this.formatErrorMessage(error));\n\n        // Show error notification\n        if (this.notificationManager) {\n          this.notificationManager.error(`Error: ${error.message}`);\n        }\n      }\n    } catch (error) {\n      console.error(\"[AITextEnhancer] Error in handleToolAction:\", error);\n\n      // Remove temporary response if it exists\n      if (tempResponse && this.responseHistory) {\n        this.responseHistory.removeResponse(tempResponse.id);\n      }\n\n      // Add error message\n      this.addResponseToHistory(\"error\", `Error: ${error.message}`);\n\n      // Show notification\n      if (this.notificationManager) {\n        this.notificationManager.error(`Error: ${error.message}`);\n      }\n    }\n  }\n\n  /**\n   * Helper method to add responses to history\n   * Add this if it doesn't exist\n   */\n  addResponseToHistory(action, content) {\n    if (!this.responseHistory) {\n      console.error(\"[AITextEnhancer] No response history available\");\n      return;\n    }\n\n    const response = {\n      id: Date.now(),\n      action,\n      content: content || \"\",\n      timestamp: new Date(),\n    };\n\n    this.responseHistory.addResponse(response);\n    return response;\n  }\n\n  /**\n   * Helper method to format error messages\n   * Add this if it doesn't exist\n   */\n  formatErrorMessage(error) {\n    if (!error) return \"An unknown error occurred\";\n\n    // Extract message from different error formats\n    let message = error.message || error.toString();\n\n    if (error.originalError) {\n      message += `\\n${\n        error.originalError.message || error.originalError.toString()\n      }`;\n    }\n\n    return message;\n  }\n}\n\n// Registrar el componente\ncustomElements.define(\"ai-text-enhancer\", AITextEnhancer);\n\nexport default AITextEnhancer;\n"],"names":["response","editorElement"],"mappings":"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A;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ACO9B,MAAM,wBAAwB,YAAY;AAAA,EAC/C,cAAc;AACZ,UAAO;AACP,SAAK,aAAa,EAAE,MAAM,OAAM,CAAE;AAClC,SAAK,YAAY,CAAE;AACnB,SAAK,kBAAkB;AAAA,EAC3B;AAAA,EAEE,WAAW,qBAAqB;AAC9B,WAAO,CAAC,UAAU;AAAA,EACtB;AAAA,EAEE,IAAI,WAAW;AACb,UAAM,OAAO,KAAK,aAAa,UAAU;AACzC,YAAQ,IAAI,uCAAuC,IAAI;AACvD,WAAO,QAAQ;AAAA,EACnB;AAAA,EAEE,oBAAoB;AAClB,YAAQ,IAAI,0CAA0C,KAAK,QAAQ;AACnE,YAAQ;AAAA,MACN;AAAA,MACA,KAAK,aAAa,UAAU;AAAA,IAC7B;AACD,YAAQ,IAAI,qCAAqC,KAAK,kBAAiB,CAAE;AAEzE,SAAK,eAAe,aAAa,KAAK,QAAQ,KAAK,aAAa;AAChE,YAAQ,IAAI,2CAA2C,KAAK,YAAY;AAExE,SAAK,OAAQ;AACb,SAAK,oBAAqB;AAAA,EAC9B;AAAA,EAEE,yBAAyB,MAAM,UAAU,UAAU;AACjD,YAAQ;AAAA,MACN;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,IACD;AACD,QAAI,SAAS,cAAc,aAAa,UAAU;AAChD,cAAQ;AAAA,QACN;AAAA,QACA;AAAA,MACD;AACD,WAAK,eAAe,aAAa,QAAQ,KAAK,aAAa;AAC3D,cAAQ,IAAI,uCAAuC,KAAK,YAAY;AACpE,WAAK,OAAQ;AAAA,IACnB;AAAA,EACA;AAAA;AAAA;AAAA,EAIE,oBAAoB,UAAU;AN/DhC;AMgEI,UAAM,QAAQ,SAAS,cAAc,KAAK;AAC1C,UAAM,YAAY;AAClB,UAAM,QAAQ,KAAK,SAAS;AAC5B,UAAM,QAAQ,SAAS,SAAS;AAGhC,UAAM,SAAS,CAAC,QAAQ,SAAS,YAAY,EAAE,SAAS,SAAS,MAAM;AACvE,UAAM,aAAa,SAAS,WAAW;AAGvC,QAAI,QAAQ;AACV,YAAM,YAAY;AAAA;AAAA;AAAA,YAIZ,KAAK,kBACD,KAAK,gBAAgB,QAAQ,SAAS,OAAO,IAC7C,SAAS,OACzB;AAAA;AAAA;AAAA;AAIM,aAAO;AAAA,IACb;AAGI,QAAI,YAAY;AACd,YAAM,WAAW,SAAS,UAAU,UAAa,SAAS,UAAU;AAGpE,UAAI,UAAU;AACZ,cAAM,YAAY;AAAA;AAAA;AAAA;AAAA,gBAIV,YAAY,SAAS,MAAM,CAAC;AAAA;AAAA;AAAA,8CAGE,KAAK;AAAA,UACrC,SAAS;AAAA,QACvB,CAAa;AAAA;AAAA;AAAA;AAAA,gBAIG,SAAS,QAAQ,QAAQ,0BAA0B,EAAE,CAAC;AAAA;AAAA;AAAA,0BAG5C,IAAI;AAAA,UACd,SAAS;AAAA,QACzB,CAAe;AAAA;AAAA;AAAA;AAAA;AAAA,MAKf,OAAa;AAEL,cAAM,YAAY;AAAA;AAAA;AAAA;AAAA,gBAIV,YAAY,SAAS,MAAM,CAAC;AAAA;AAAA;AAAA,8CAGE,KAAK;AAAA,UACrC,SAAS;AAAA,QACvB,CAAa;AAAA;AAAA;AAAA,cAGC,SAAS,QAAQ,QAAQ,0BAA0B,EAAE,CAAC;AAAA;AAAA;AAAA;AAAA,MAIpE;AAEM,aAAO;AAAA,IACb;AAGI,UAAM,iBAAiB,SAAS,cAAc,KAAK;AACnD,mBAAe,YAAY;AAG3B,UAAM,YAAY,SAAS,YAAY,MAAM,SAAS,QAAQ,SAAS;AACvE,UAAM,eAAe,YACjB,sCACA;AAGJ,QAAI;AACJ,QAAI,SAAS,WAAW,gBAAgB;AACtC,oBAAc,SAAS;AAAA,IACxB,WAAU,WAAW;AACpB,UAAI,SAAS,WAAW,iBAAiB;AACvC,sBAAc;AAAA,MACtB,WACQ;AAAA,QACE;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,MACV,EAAU,SAAS,SAAS,MAAM,GAC1B;AACA,sBAAc;AAAA,MACtB,OAAa;AACL,sBAAc;AAAA,MACtB;AAAA,IACA,OAAW;AACL,oBAAc,KAAK,kBACf,KAAK,gBAAgB,QAAQ,SAAS,OAAO,IAC7C,SAAS;AAAA,IACnB;AAGI,UAAM,kBAAkB,CAAC,SAAS,QAAQ,YAAY,EAAE;AAAA,MACtD,SAAS;AAAA,IACV;AAGD,QAAI,YAAY;AAChB,QAAI,CAAC,cAAc,CAAC,iBAAiB;AACnC,kBAAY;AAAA,8EAER,SAAS,EACV;AAAA,YACG,YAAY,SAAS,CAAC;AAAA,cACtB,gBAAK,iBAAL,mBAAmB,UAAnB,mBAA0B,YAAW,SAAS;AAAA;AAAA,gFAGhD,SAAS,EACV;AAAA,YACG,YAAY,WAAW,CAAC;AAAA,cACxB,gBAAK,iBAAL,mBAAmB,UAAnB,mBAA0B,cAAa,WAAW;AAAA;AAAA,6EAGpD,SAAS,EACV;AAAA,YACG,YAAY,QAAQ,CAAC;AAAA,cACrB,gBAAK,iBAAL,mBAAmB,UAAnB,mBAA0B,WAAU,QAAQ;AAAA;AAAA,iFAG9C,SAAS,EACV;AAAA,YACG,YAAY,YAAY,CAAC;AAAA,cACzB,gBAAK,iBAAL,mBAAmB,UAAnB,mBAA0B,eAAc,YAAY;AAAA;AAAA,kFAGtD,SAAS,EACV;AAAA,YACG,YAAY,aAAa,CAAC;AAAA,cAC1B,gBAAK,iBAAL,mBAAmB,UAAnB,mBAA2B,mBAAkB,aAAa;AAAA;AAAA,kFAG5D,SAAS,EACV;AAAA,YACG,YAAY,aAAa,CAAC;AAAA,cAC1B,gBAAK,iBAAL,mBAAmB,UAAnB,mBAA2B,mBAAkB,aAAa;AAAA;AAAA;AAAA,IAGtE;AAGI,UAAM,cACJ,CAAC,mBAAmB,CAAC,aACjB;AAAA;AAAA;AAAA,MAGJ,SAAS;AAAA;AAAA;AAAA,oEAIT,SAAS,EACV,cAAW,gBAAK,iBAAL,mBAAmB,YAAnB,mBAA4B,SAAQ,MAAM;AAAA;AAAA;AAAA;AAAA;AAAA,oCAMlD,gBAAK,iBAAL,mBAAmB,YAAnB,mBAA4B,SAAQ,MACrC;AAAA;AAAA,mEAGD,SAAS,EACV,cAAW,gBAAK,iBAAL,mBAAmB,YAAnB,mBAA4B,QAAO,KAAK;AAAA;AAAA;AAAA;AAAA,oCAKhD,gBAAK,iBAAL,mBAAmB,YAAnB,mBAA4B,QAAO,KACpC;AAAA;AAAA,qEAGD,SAAS,EACf,kBAAsB,SAAS,MAAM,cACzB,gBAAK,iBAAL,mBAAmB,YAAnB,mBAA4B,UAAS,OACtC;AAAA;AAAA;AAAA;AAAA,oCAKH,gBAAK,iBAAL,mBAAmB,YAAnB,mBAA4B,UAAS,OACtC;AAAA;AAAA;AAAA;AAAA,IAKG;AAGN,mBAAe,YAAY;AAAA;AAAA;AAAA,UAGrB,YAAY,SAAS,MAAM,CAAC;AAAA,kBAE5B,UAAK,iBAAL,mBAAmB,MAAM,SAAS,YAAW,SAAS,MACvD;AAAA;AAAA,wCAE+B,KAAK;AAAA,MACrC,SAAS;AAAA,IACjB,CAAO;AAAA;AAAA,kBAEW,YAAY;AAAA,QACtB,WAAW;AAAA;AAAA,MAEb,WAAW;AAAA;AAIb,QAAI,CAAC,KAAK,WAAW,cAAc,sBAAsB,GAAG;AAC1D,YAAM,UAAU,SAAS,cAAc,OAAO;AAC9C,cAAQ,KAAK;AACb,cAAQ,cAAc;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAmDtB,WAAK,WAAW,YAAY,OAAO;AAAA,IACzC;AAEI,UAAM,YAAY,cAAc;AAChC,WAAO;AAAA,EACX;AAAA,EAEE,sBAAsB;AACpB,SAAK,WAAW,iBAAiB,SAAS,CAAC,MAAM;AAC/C,YAAM,SAAS,EAAE,OAAO,QAAQ,QAAQ;AACxC,UAAI,CAAC,OAAQ;AAEb,YAAM,aAAa,OAAO,QAAQ;AAClC,UAAI,CAAC,WAAY;AAEjB,YAAM,WAAW,KAAK,YAAY,UAAU;AAC5C,UAAI,CAAC,SAAU;AAGf,UAAI,OAAO,UAAU,SAAS,aAAa,GAAG;AAC5C,cAAM,SAAS,OAAO,QAAQ;AAC9B,gBAAQ,IAAI,0CAA0C;AAAA,UACpD;AAAA,UACA;AAAA,QACV,CAAS;AACD,aAAK;AAAA,UACH,IAAI,YAAY,cAAc;AAAA,YAC5B,QAAQ;AAAA,cACN;AAAA,cACA;AAAA,cACA,SAAS,SAAS;AAAA,YACnB;AAAA,YACD,SAAS;AAAA,YACT,UAAU;AAAA,UACX,CAAA;AAAA,QACF;AAAA,MACF,WAAU,OAAO,UAAU,SAAS,cAAc,GAAG;AACpD,cAAM,SAAS,OAAO,QAAQ;AAC9B,aAAK;AAAA,UACH,IAAI,YAAY,iBAAiB;AAAA,YAC/B,QAAQ,EAAE,YAAY,OAAQ;AAAA,YAC9B,SAAS;AAAA,YACT,UAAU;AAAA,UACX,CAAA;AAAA,QACF;AAAA,MACF,WAAU,OAAO,UAAU,SAAS,aAAa,GAAG;AACnD,aAAK;AAAA,UACH,IAAI,YAAY,gBAAgB;AAAA,YAC9B,QAAQ,EAAE,WAAY;AAAA,YACtB,SAAS;AAAA,YACT,UAAU;AAAA,UACX,CAAA;AAAA,QACF;AAAA,MACF,WAAU,OAAO,UAAU,SAAS,aAAa,GAAG;AACnD,aAAK;AAAA,UACH,IAAI,YAAY,gBAAgB;AAAA,YAC9B,QAAQ,EAAE,WAAY;AAAA,YACtB,SAAS;AAAA,YACT,UAAU;AAAA,UACX,CAAA;AAAA,QACF;AAAA,MACF,WAAU,OAAO,UAAU,SAAS,YAAY,GAAG;AAClD,gBAAQ,IAAI,sCAAsC;AAGlD,aAAK;AAAA,UACH,IAAI,YAAY,eAAe;AAAA,YAC7B,QAAQ,EAAE,WAAY;AAAA,YACtB,SAAS;AAAA,YACT,UAAU;AAAA,UACX,CAAA;AAAA,QACF;AAGD,mBAAW,MAAM;ANrazB;AMsaU,kBAAQ,IAAI,6CAA6C;AAEzD,cAAI;AAEF,gBAAI,UAAU;AACd,mBAAO,SAAS;AACd,sBAAQ;AAAA,gBACN;AAAA,gBACA;AAAA,cACD;AACD,mBAAI,aAAQ,cAAR,mBAAmB,SAAS,UAAU;AACxC,wBAAQ,IAAI,0CAA0C,OAAO;AAC7D,wBAAQ,UAAU,OAAO,MAAM;AAC/B;AAAA,cAChB;AAEc,wBAAU,QAAQ,cAAc,QAAQ,YAAa,EAAC;AAAA,YACpE;AAAA,UACW,SAAQ,OAAO;AACd,oBAAQ,MAAM,0CAA0C,KAAK;AAAA,UACzE;AAAA,QACS,GAAE,GAAG;AAAA,MACP,WAAU,OAAO,UAAU,SAAS,cAAc,GAAG;AACpD,cAAM,SAAS,OAAO,QAAQ;AAC9B,aAAK;AAAA,UACH,IAAI,YAAY,iBAAiB;AAAA,YAC/B,QAAQ,EAAE,YAAY,OAAQ;AAAA,YAC9B,SAAS;AAAA,YACT,UAAU;AAAA,UACX,CAAA;AAAA,QACF;AAAA,MACT;AAAA,IACA,CAAK;AAAA,EACL;AAAA,EAEE,YAAY,IAAI;AACd,YAAQ,IAAI,8CAA8C,EAAE;AAC5D,YAAQ,IAAI,0CAA0C,KAAK,SAAS;AACpE,UAAM,WAAW,KAAK,UAAU;AAAA,MAC9B,CAACA,cAAaA,UAAS,OAAO,SAAS,EAAE;AAAA,IAC1C;AACD,YAAQ,IAAI,qCAAqC,QAAQ;AACzD,WAAO;AAAA,EACX;AAAA,EAEE,YAAY,UAAU;AACpB,YAAQ,IAAI,sCAAsC,QAAQ;AAC1D,SAAK,UAAU,KAAK,QAAQ;AAC5B,SAAK,OAAQ;AAAA,EACjB;AAAA;AAAA,EAGE,eAAe,IAAI,mBAAmB;AN1dxC;AM2dI,UAAM,QAAQ,KAAK,UAAU,UAAU,CAAC,MAAM,EAAE,OAAO,EAAE;AACzD,QAAI,UAAU,GAAI;AAElB,UAAM,WAAW,KAAK,UAAU,KAAK;AACrC,UAAM,aAAa,SAAS;AAG5B,QAAI,OAAO,sBAAsB,YAAY;AAC3C,eAAS,UAAU,kBAAkB,SAAS,OAAO;AAAA,IAC3D,OAAW;AACL,eAAS,UAAU;AAAA,IACzB;AAGI,UAAM,gBAAgB,eAAe;AACrC,UAAM,sBACJ,OAAO,sBAAsB,cAC7B,SAAS,QAAQ,SAAS,WAAW,UACrC,SAAS,QAAQ,WAAW,UAAU;AAGxC,UAAM,gBAAgB,KAAK,WAAW,cAAc,aAAa,EAAE,IAAI;AACvE,QAAI,CAAC,eAAe;AAElB,WAAK,OAAQ;AACb;AAAA,IACN;AAGI,UAAM,iBAAiB,cAAc,cAAc,mBAAmB;AACtE,QAAI,CAAC,eAAgB;AAKrB,QAAI,eAAe;AACjB,cAAQ;AAAA,QACN;AAAA,MACD;AAGD,UAAI,aAAa,SAAS,WAAW;AAGrC,UAAI,WAAW,WAAW,MAAM,KAAK,WAAW,WAAW,OAAO,GAAG;AACnE,gBAAQ;AAAA,UACN;AAAA,QACD;AACD,qBAAa,MAAM;AAEnB,iBAAS,UAAU;AAAA,MAC3B;AAGM,YAAM,WAAW,SAAS,eAAe,UAAU;AAGnD,qBAAe,YAAY;AAC3B,qBAAe,YAAY,QAAQ;AAGnC,qBAAe,QAAQ,kBAAkB;AACzC,qBAAe,UAAU,IAAI,kBAAkB;AAAA,IACrD,WAIM,uBACA,eAAe,QAAQ,oBAAoB,QAC3C;AAEoB,eAAS,QAAQ,UAAU,WAAW,MAAM;AAGhE,UACE,eAAe,aACf,eAAe,UAAU,aAAa,KAAK,WAC3C;AAEA,uBAAe,UAAU,YAAY,SAAS;AAAA,MACtD,OAAa;AACL,cAAM,WAAW,SAAS,eAAe,SAAS,OAAO;AACzD,uBAAe,YAAY;AAC3B,uBAAe,YAAY,QAAQ;AAAA,MAC3C;AAGM,YAAM,YAAY,cAAc;AAChC,UAAI,WAAW;AACb,cAAM,eAAe,UAAU,eAAe,UAAU,YAAY,UAAU,eAAe;AAC7F,YAAI,cAAc;AAChB,oBAAU,YAAY,UAAU;AAAA,QAC1C;AAAA,MACA;AAAA,IACA,OAGS;AACH,cAAQ;AAAA,QACN;AAAA,MACD;AAGD,YAAM,sBAAsB,SAAS,QAAQ,SAAS;AAGtD,UACE,uBACA,eAAe,QAAQ,oBAAoB,QAC3C;AACA,uBAAe,UAAU,OAAO,kBAAkB;AAClD,uBAAe,QAAQ,kBAAkB;AAGzC,cAAM,cAAc,SAAS;AAG7B,cAAM,cAAY,mBAAc,eAAd,mBAA0B,cAAa;AAGzD,YAAI,KAAK,iBAAiB;AACxB,cAAI;AACF,2BAAe,YACb,KAAK,gBAAgB,QAAQ,WAAW;AAAA,UAC3C,SAAQ,OAAO;AACd,oBAAQ,MAAM,8CAA8C,KAAK;AACjE,2BAAe,cAAc;AAAA,UACzC;AAAA,QACA,OAAe;AACL,yBAAe,cAAc;AAAA,QACvC;AAGQ,YAAI,cAAc,YAAY;AAC5B,wBAAc,WAAW,YAAY;AAAA,QAC/C;AAAA,MACA,WAEe,CAAC,qBAAqB;AAC7B,YAAI,KAAK,iBAAiB;AACxB,yBAAe,YAAY,KAAK,gBAAgB;AAAA,YAC9C,SAAS;AAAA,UACV;AAAA,QACX,OAAe;AACL,yBAAe,cAAc,SAAS;AAAA,QAChD;AAAA,MACA;AAAA,IACA;AAAA,EACA;AAAA,EAEE,uBAAuB;AACrB,WAAO;AAAA,EACX;AAAA,EAEE,YAAY,IAAI;AACd,WAAO,KAAK,UAAU,KAAK,CAAC,aAAa,SAAS,OAAO,SAAS,EAAE,CAAC;AAAA,EACzE;AAAA,EAEE,eAAe,IAAI;AACjB,SAAK,YAAY,KAAK,UAAU,OAAO,CAAC,MAAM,EAAE,OAAO,EAAE;AACzD,SAAK,OAAQ;AAAA,EACjB;AAAA,EAEE,QAAQ;AACN,SAAK,YAAY,CAAE;AACnB,SAAK,OAAQ;AAAA,EACjB;AAAA,EAEE,SAAS;AACP,UAAM,QAAQ,SAAS,cAAc,OAAO;AAG5C,UAAM,cAAc;AAAA,QAChB,SAAS;AAAA,QACT,UAAU;AAAA,QACV,aAAa;AAAA,QACb,qBAAqB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AA8EzB,UAAM,YAAY,SAAS,cAAc,KAAK;AAC9C,cAAU,YAAY;AAGtB,SAAK,UAAU,QAAQ,CAAC,aAAa;AACnC,gBAAU,YAAY,KAAK,oBAAoB,QAAQ,CAAC;AAAA,IAC9D,CAAK;AAGD,WAAO,KAAK,WAAW,YAAY;AACjC,WAAK,WAAW,YAAY,KAAK,WAAW,UAAU;AAAA,IAC5D;AAEI,SAAK,WAAW,YAAY,KAAK;AACjC,SAAK,WAAW,YAAY,SAAS;AAGrC,QAAI,KAAK,UAAU,SAAS,GAAG;AAC7B,4BAAsB,MAAM;AAC1B,kBAAU,YAAY,UAAU;AAAA,MACxC,CAAO;AAAA,IACP;AAAA,EACA;AAAA,EAEE,gBAAgB,WAAW;AACzB,QAAI,CAAC,UAAW,QAAO;AAEvB,QAAI;AACF,cAAQ,IAAI,2CAA2C,SAAS;AAChE,aAAO,IAAI,KAAK,SAAS,EAAE,mBAAmB,KAAK,YAAY,MAAM;AAAA,QACnE,MAAM;AAAA,QACN,QAAQ;AAAA,MAChB,CAAO;AAAA,IACF,SAAQ,OAAO;AACd,cAAQ,MAAM,iDAAiD,KAAK;AACpE,aAAO;AAAA,IACb;AAAA,EACA;AACA;AAEA,eAAe,OAAO,oBAAoB,eAAe;AChwBlD,MAAM,aAAa;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ACAnB,MAAM,qBAAqB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ACM3B,MAAM,sBAAsB,YAAY;AAAA,EAC7C,cAAc;AACZ,UAAO;AACP,SAAK,aAAa,EAAE,MAAM,OAAM,CAAE;AAClC,SAAK,YAAY;AAAA,EAErB;AAAA,EAEE,WAAW,qBAAqB;AAC9B,WAAO;AAAA,MACL;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,IACD;AAAA,EACL;AAAA,EAEE,IAAI,cAAc;AAChB,WAAO,KAAK,aAAa,aAAa,KAAK;AAAA,EAC/C;AAAA,EAEE,IAAI,WAAW;AACb,WAAO,KAAK,aAAa,UAAU,KAAK;AAAA,EAC5C;AAAA,EAEE,IAAI,cAAc;AAChB,WAAO,KAAK,aAAa,aAAa,KAAK;AAAA,EAC/C;AAAA,EAEE,IAAI,iBAAiB;AACnB,WAAO,KAAK,aAAa,iBAAiB,MAAM;AAAA,EACpD;AAAA,EAEE,IAAI,WAAW;AACb,WAAO,KAAK,aAAa,UAAU,KAAK;AAAA,EAC5C;AAAA,EAEE,IAAI,eAAe;AACjB,WAAO,aAAa,KAAK,QAAQ,KAAK,aAAa;AAAA,EACvD;AAAA,EAEE,IAAI,WAAW;AACb,WAAO,KAAK,aAAa,WAAW;AAAA,EACxC;AAAA,EAEE,IAAI,gBAAgB;AAClB,WAAO,KAAK,aAAa,gBAAgB,KAAK;AAAA,EAClD;AAAA,EAIE,MAAM,oBAAoB;AACxB,SAAK,OAAQ;AACb,SAAK,oBAAqB;AAE1B,QAAI,KAAK,UAAU;AACjB,YAAM,KAAK,eAAe,KAAK,QAAQ;AAAA,IAC7C;AAGI,SAAK,iBAAkB;AAAA,EAC3B;AAAA,EAEE,yBAAyB,MAAM,UAAU,UAAU;AACjD,QAAI,aAAa,SAAU;AAE3B,YAAQ,MAAI;AAAA,MACV,KAAK;AACH,aAAK,mBAAoB;AACzB;AAAA,MACF,KAAK;AACH,YAAI,UAAU;AACZ,eAAK,eAAe,QAAQ;AAAA,QACtC;AACQ;AAAA,MACF,KAAK;AACH,aAAK,uBAAwB;AAC7B;AAAA,MACF,KAAK;AAAA,MACL,KAAK;AAAA,MACL,KAAK;AACH,aAAK,oBAAqB;AAC1B;AAAA,IACR;AAAA,EACA;AAAA,EAEE,mBAAmB;ATlGrB;ASmGI,QAAI,CAAC,KAAK,WAAY;AAEtB,UAAM,YAAY,KAAK,WAAW,cAAc,aAAa;AAC7D,QAAI,CAAC,UAAW;AAGhB,QAAI,SAAS;AAEb,UAAM,UAAU,KAAK,aAAa,SAAS,KAAK,KAAK,kBAAkB;AACvE,UAAM,UAAU,KAAK,aAAa,SAAS,KAAK;AAEhD,UAAM,aAAa,CAAC,CAAC,QAAQ,KAAM;AACnC,UAAM,aAAa,CAAC,CAAC,QAAQ,KAAM;AAEnC,QAAI,cAAc,YAAY;AAE5B,iBACG,gBAAK,iBAAL,mBAAmB,SAAnB,mBAAyB,2BACtB,GAAG,KAAK,aAAa,KAAK,uBAAuB;AAAA;AAAA,EAAO,OAAO;AAAA;AAAA,IAAO,gBAAK,iBAAL,mBAAmB,SAAnB,mBAAyB,iBAAgB,WAAW;AAAA,EAAK,OAAO,KACtI;AAAA;AAAA,EAAoE,OAAO;AAAA;AAAA;AAAA,EAAkB,OAAO;AAAA,IAC3G,WAAU,YAAY;AAErB,iBACG,gBAAK,iBAAL,mBAAmB,SAAnB,mBAAyB,iBACtB,GAAG,KAAK,aAAa,KAAK,aAAa;AAAA;AAAA,EAAO,OAAO,KACrD;AAAA;AAAA,EAAiC,OAAO;AAAA,IAC/C,WAAU,YAAY;AAErB,iBACG,gBAAK,iBAAL,mBAAmB,SAAnB,mBAAyB,iBACtB,GAAG,KAAK,aAAa,KAAK,aAAa;AAAA;AAAA,EAAO,OAAO,KACrD;AAAA;AAAA,EAAgE,OAAO;AAAA,IACnF,WAAe,KAAK,eAAe;AAC7B,eAAS,KAAK;AAAA,IACpB;AAGI,QAAI,UAAU,UAAU,UAAU,KAAI,MAAO,IAAI;AAC/C,gBAAU,YAAY;AAGtB,UAAI,SAAS,kBAAkB,WAAW;AACxC,cAAM,YAAY,OAAO,aAAc;AACvC,cAAM,QAAQ,SAAS,YAAa;AACpC,cAAM,mBAAmB,SAAS;AAClC,cAAM,SAAS,KAAK;AACpB,kBAAU,gBAAiB;AAC3B,kBAAU,SAAS,KAAK;AAAA,MAChC;AAAA,IACA;AAAA,EACA;AAAA,EAEE,sBAAsB;ATvJxB;ASyJI,UAAM,aAAY,UAAK,eAAL,mBAAiB,cAAc;AACjD,QAAI,aAAa,UAAU,UAAU,KAAI,MAAO,IAAI;AAClD,WAAK,iBAAkB;AAAA,IAC7B;AAAA,EACA;AAAA,EAEE,qBAAqB;AAGnB,UAAM,kBAAkB,KAAK,WAAW;AAAA,MACtC;AAAA,IACD;AACD,QAAI,iBAAiB;AACnB,sBAAgB,OAAQ;AAAA,IAC9B;AAAA,EACA;AAAA,EAEE,SAAS;AT1KX;AS2KI,UAAM,QAAQ,SAAS,cAAc,OAAO;AAC5C,UAAM,cAAc;AAAA,QAChB,SAAS;AAAA,QACT,UAAU;AAAA,QACV,UAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AA0Ed,UAAM,WAAW;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,uCAOF,gBAAK,iBAAL,mBAAmB,SAAnB,mBAAyB,gBAAe,mBACzC;AAAA;AAAA;AAAA;AAAA,YAKN,KAAK,iBACD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,cAUA,EAChB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAWI,SAAK,WAAW,YAAY;AAC5B,SAAK,WAAW,YAAY,KAAK;AACjC,SAAK,WAAW;AAAA,MACd,SAAS,cAAc,yBAAyB,QAAQ;AAAA,IACzD;AAAA,EACL;AAAA,EAEE,sBAAsB;AACpB,UAAM,OAAO,KAAK,WAAW,cAAc,YAAY;AACvD,UAAM,QAAQ,KAAK,WAAW,cAAc,aAAa;AACzD,UAAM,eAAe,KAAK,WAAW,cAAc,qBAAqB;AACxE,UAAM,aAAa,KAAK,WAAW,cAAc,aAAa;AAE9D,SAAK,iBAAiB,UAAU,KAAK,aAAa,KAAK,IAAI,CAAC;AAG5D,UAAM,iBAAiB,WAAW,CAAC,MAAM;AACvC,UAAI,EAAE,QAAQ,WAAW,CAAC,EAAE,UAAU;AACpC,UAAE,eAAgB;AAClB,aAAK,cAAc,IAAI,MAAM,QAAQ,CAAC;AAAA,MAC9C;AAAA,IACA,CAAK;AAGD,UAAM,iBAAiB,SAAS,MAAM;AACpC,UAAI,MAAM,UAAU,KAAI,MAAO,IAAI;AACjC,aAAK,iBAAkB;AAAA,MAC/B;AAAA,IACA,CAAK;AAED,QAAI,gBAAgB,YAAY;AAC9B,mBAAa,iBAAiB,SAAS,CAAC,MAAM;AAE5C,UAAE,gBAAiB;AAAA,MAC3B,CAAO;AAED,iBAAW,iBAAiB,UAAU,CAAC,MAAM;AAC3C,aAAK,iBAAiB,CAAC;AAEvB,UAAE,OAAO,QAAQ;AAAA,MACzB,CAAO;AAAA,IACP;AAAA,EACA;AAAA,EAEE,iBAAiB,OAAO;AACtB,UAAM,OAAO,MAAM,OAAO,MAAM,CAAC;AACjC,QAAI,MAAM;AACR,WAAK,YAAY;AAAA,IACvB;AAAA,EACA;AAAA;AAAA;AAAA;AAAA,EAKE,aAAa,OAAO;AAClB,UAAM,eAAgB;AACtB,UAAM,gBAAiB;AAEvB,UAAM,QAAQ,KAAK,WAAW,cAAc,aAAa;AACzD,UAAM,UAAU,MAAM,UAAU,KAAM;AAEtC,QAAI,WAAW,KAAK,WAAW;AAC7B,WAAK;AAAA,QACH,IAAI,YAAY,eAAe;AAAA,UAC7B,QAAQ;AAAA,YACN;AAAA,YACA,OAAO,KAAK;AAAA,YACZ,aAAa,KAAK;AAAA,YAClB,UAAU,KAAK;AAAA,YACf,aAAa,KAAK;AAAA,UACnB;AAAA,UACD,SAAS;AAAA,UACT,UAAU;AAAA,QACX,CAAA;AAAA,MACF;AACD,YAAM,YAAY;AAGlB,WAAK,YAAY;AACjB,YAAM,YAAY,KAAK,WAAW;AAAA,QAChC;AAAA,MACD;AACD,UAAI,WAAW;AACb,kBAAU,OAAQ;AAAA,MAC1B;AAAA,IACA;AAAA,EACA;AAAA,EAEE,qBAAqB;ATrXvB;ASsXI,UAAM,QAAQ,KAAK,WAAW,cAAc,aAAa;AACzD,UAAM,eAAe,KAAK,WAAW,cAAc,cAAc;AAEjE,QAAI,SAAS,cAAc;AACzB,YAAM;AAAA,QACJ;AAAA,UACA,gBAAK,iBAAL,mBAAmB,SAAnB,mBAAyB,gBAAe;AAAA,MACzC;AACD,mBAAa,YAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAM/B;AAGI,SAAK,oBAAqB;AAAA,EAC9B;AAAA,EAEE,yBAAyB;AACvB,UAAM,eAAe,KAAK,WAAW,cAAc,qBAAqB;AACxE,QAAI,cAAc;AAChB,mBAAa,MAAM,UAAU,KAAK,iBAAiB,gBAAgB;AAAA,IACzE;AAAA,EACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAWE,MAAM,eAAe,KAAK;AACxB,QAAI,CAAC,IAAK;AAEV,YAAQ,IAAI,yCAAyC,GAAG;AAExD,QAAI;AAEF,UAAI;AACF,cAAM,WAAW,MAAM,MAAM,KAAK;AAAA,UAChC,MAAM;AAAA,UACN,aAAa;AAAA;AAAA,UACb,OAAO;AAAA;AAAA,QACjB,CAAS;AAED,cAAM,OAAO,MAAM,SAAS,KAAM;AAClC,cAAM,OAAO,IAAI,KAAK,CAAC,IAAI,GAAG,aAAa,EAAE,MAAM,KAAK,MAAM;AAC9D,aAAK,YAAY;AAEjB,gBAAQ,IAAI,qDAAqD;AACjE,aAAK,mBAAoB;AACzB;AAAA,MACD,SAAQ,YAAY;AACnB,gBAAQ,KAAK,yCAAyC,UAAU;AAGhE,aAAK,YAAY;AACjB,gBAAQ;AAAA,UACN;AAAA,QACD;AAGD,aAAK,yBAAyB,GAAG;AAAA,MACzC;AAAA,IACK,SAAQ,OAAO;AACd,cAAQ,MAAM,wCAAwC,KAAK;AAAA,IACjE;AAAA,EACA;AAAA;AAAA;AAAA;AAAA,EAKE,yBAAyB,KAAK;AAC5B,QAAI,CAAC,IAAK;AAGV,QAAI,WAAW;AACf,QAAI;AACF,YAAM,SAAS,IAAI,IAAI,GAAG;AAC1B,YAAM,YAAY,OAAO,SAAS,MAAM,GAAG;AAC3C,UAAI,UAAU,SAAS,GAAG;AACxB,cAAM,WAAW,UAAU,UAAU,SAAS,CAAC;AAC/C,YAAI,UAAU;AACZ,qBAAW;AAAA,QACrB;AAAA,MACA;AAAA,IACK,SAAQ,GAAG;AACV,cAAQ,KAAK,sDAAsD;AAAA,IACzE;AAEI,UAAM,YAAY,SAAS,cAAc,KAAK;AAC9C,cAAU,YAAY;AACtB,cAAU,YAAY;AAAA;AAAA;AAAA;AAAA,sBAIJ,GAAG;AAAA;AAAA;AAAA;AAAA,cAIX,QAAQ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAclB,UAAM,oBAAoB,KAAK,WAAW;AAAA,MACxC;AAAA,IACD;AACD,QAAI,mBAAmB;AACrB,wBAAkB,OAAQ;AAAA,IAChC;AAGI,SAAK,WACF,cAAc,YAAY,EAC1B,WAAW;AAAA,MACV;AAAA,MACA,KAAK,WAAW,cAAc,YAAY;AAAA,IAC3C;AAGH,UAAM,eAAe,UAAU,cAAc,uBAAuB;AACpE,QAAI,cAAc;AAChB,mBAAa,iBAAiB,SAAS,MAAM;AAC3C,aAAK,YAAY;AACjB,kBAAU,OAAQ;AAAA,MAC1B,CAAO;AAAA,IACP;AAAA,EACA;AACA;AAEA,eAAe,OAAO,mBAAmB,aAAa;ACjgB/C,MAAM,gBAAgB,YAAY;AAAA,EACvC,cAAc;AACZ,UAAO;AACP,SAAK,aAAa,EAAE,MAAM,OAAM,CAAE;AAClC,SAAK,gBAAgB;AAAA,EACzB;AAAA,EAEE,WAAW,qBAAqB;AAC9B,WAAO,CAAC,eAAe,UAAU;AAAA,EACrC;AAAA,EAEE,IAAI,aAAa;AACf,WAAO,KAAK,aAAa,aAAa,MAAM;AAAA,EAChD;AAAA,EAEE,IAAI,WAAW;AACb,WAAO,KAAK,aAAa,UAAU,KAAK;AAAA,EAC5C;AAAA,EAEE,IAAI,eAAe;AACjB,WAAO,aAAa,KAAK,QAAQ,KAAK,aAAa;AAAA,EACvD;AAAA,EAEE,oBAAoB;AAClB,SAAK,OAAQ;AACb,SAAK,WAAY;AAAA,EACrB;AAAA,EAEE,yBAAyB,MAAM,UAAU,UAAU;AACjD,QAAI,aAAa,SAAU;AAE3B,QAAI,SAAS,YAAY;AAEvB,WAAK,OAAQ;AAAA,IACnB,WAAe,SAAS,eAAe;AACjC,WAAK,mBAAoB;AAAA,IAC/B;AAAA,EACA;AAAA,EAEE,SAAS;AACP,UAAM,QAAQ,SAAS,cAAc,OAAO;AAC5C,UAAM,cAAc;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAuCpB,SAAK,WAAW,YAAY;AAC5B,SAAK,WAAW,YAAY,KAAK;AACjC,SAAK,WAAW,YAAY,KAAK,cAAa,CAAE;AAEhD,0BAAsB,MAAM;AAC1B,WAAK,mBAAoB;AAAA,IAC/B,CAAK;AAAA,EACL;AAAA,EAEE,gBAAgB;AACd,UAAM,UAAU,SAAS,cAAc,KAAK;AAC5C,YAAQ,YAAY;AAEpB,UAAM,QAAQ;AAAA,MACZ,EAAE,QAAQ,WAAW,OAAO,KAAK,aAAa,MAAM,QAAS;AAAA,MAC7D,EAAE,QAAQ,aAAa,OAAO,KAAK,aAAa,MAAM,UAAW;AAAA,MACjE,EAAE,QAAQ,UAAU,OAAO,KAAK,aAAa,MAAM,OAAQ;AAAA,MAC3D,EAAE,QAAQ,cAAc,OAAO,KAAK,aAAa,MAAM,WAAY;AAAA,MACnE,EAAE,QAAQ,eAAe,OAAO,KAAK,aAAa,MAAM,aAAa,KAAK,KAAK,aAAa,MAAM,OAAQ;AAAA,MAC1G,EAAE,QAAQ,eAAe,OAAO,KAAK,aAAa,MAAM,aAAa,KAAK,KAAK,aAAa,MAAM,OAAM;AAAA,IACzG;AAED,UAAM,QAAQ,CAAC,SAAS;AACtB,YAAM,SAAS,SAAS,cAAc,QAAQ;AAC9C,aAAO,YAAY;AACnB,aAAO,QAAQ,SAAS,KAAK;AAE7B,YAAM,QAAQ,KAAK,SAAS,KAAK;AACjC,aAAO,YAAY,GAAG,YAAY,KAAK,MAAM,CAAC,GAAG,KAAK;AACtD,cAAQ,YAAY,MAAM;AAAA,IAChC,CAAK;AAED,WAAO;AAAA,EACX;AAAA,EAEE,aAAa;AACX,SAAK,WAAW,iBAAiB,cAAc,EAAE,QAAQ,CAAC,WAAW;AACnE,aAAO,UAAU,MAAM;AACrB,aAAK,gBAAgB,OAAO,QAAQ,MAAM;AAC1C,aAAK;AAAA,UACH,IAAI,YAAY,cAAc;AAAA,YAC5B,QAAQ,EAAE,QAAQ,OAAO,QAAQ,OAAQ;AAAA,YACzC,SAAS;AAAA,YACT,UAAU;AAAA,UACX,CAAA;AAAA,QACF;AAAA,MACF;AAAA,IACP,CAAK;AAAA,EACL;AAAA,EAEE,gBAAgB,QAAQ;AACtB,SAAK,gBAAgB;AACrB,SAAK,WAAW,iBAAiB,cAAc,EAAE,QAAQ,CAAC,WAAW;AACnE,aAAO,UAAU,OAAO,UAAU,OAAO,QAAQ,WAAW,MAAM;AAAA,IACxE,CAAK;AAAA,EACL;AAAA,EAEE,qBAAqB;AACnB,UAAM,aAAa,KAAK;AACxB,UAAM,gBAAgB,KAAK,WAAW,cAAc,yBAAyB;AAC7E,UAAM,QAAQ,KAAK,WAAW,iBAAiB,cAAc;AAE7D,QAAI,CAAC,YAAY;AACf,oBAAc,YAAY;AAAA;AAAA;AAAA;AAAA;AAAA,UAKtB,KAAK,aAAa,MAAM,YAAY,UAAU;AAAA;AAAA,IAExD,OAAW;AACL,oBAAc,YAAY,GAAG,YAAY,SAAS,CAAC,GAAG,KAAK,aAAa,MAAM,OAAO;AAAA,IAC3F;AAEI,UAAM,QAAQ,CAAC,SAAS;AACtB,YAAM,SAAS,KAAK,QAAQ;AAC5B,UAAI,YAAY;AACd,aAAK,MAAM,UAAU;AAAA,MAC7B,OAAa;AACL,aAAK,MAAM,UAAU,WAAW,YAAY,gBAAgB;AAAA,MACpE;AAAA,IACA,CAAK;AAAA,EACL;AAAA,EAEE,mBAAmB;AACjB,WAAO,KAAK;AAAA,EAChB;AACA;AAEA,eAAe,OAAO,cAAc,OAAO;AC3KpC,MAAM,aAAa;AAAA,EACxB,cAAc;AAGZ,SAAK,gBAAgB;AAAA,MACnB,IAAI;AAAA;AAAA,MACJ,IAAI;AAAA;AAAA,MACJ,IAAI;AAAA;AAAA,MACJ,IAAI;AAAA;AAAA,MACJ,IAAI;AAAA;AAAA,MACJ,IAAI;AAAA;AAAA,IACL;AAED,SAAK,uBAAuB;AAAA,EAChC;AACA;AClBO,MAAM,gBAAgB;AAAA,EAC3B,cAAc;AACZ,SAAK,SAAS;AAAA,EAClB;AAAA,EAEE,MAAM,aAAa;AACjB,QAAI;AACF,YAAM,EAAE,OAAM,IAAK,MAAM,OAAO,uDAAuD;AACvF,WAAK,SAAS;AAEd,WAAK,OAAO,WAAW;AAAA,QACrB,KAAK;AAAA,QACL,QAAQ;AAAA,QACR,UAAU;AAAA,MAClB,CAAO;AAAA,IACF,SAAQ,OAAO;AACd,cAAQ,MAAM,wCAAwC,KAAK;AAC3D,YAAM;AAAA,IACZ;AAAA,EACA;AAAA,EAEE,QAAQ,MAAM;AACZ,QAAI,CAAC,QAAQ,CAAC,KAAK,OAAQ,QAAO;AAClC,WAAO,KAAK,OAAO,IAAI;AAAA,EAC3B;AACA;ACvBA,MAAM,UAAU;AAAA,EACd,YAAY,SAAS,IAAI;AACvB,SAAK,SAAS;AAAA,MACZ,eACE,OAAO,iBACP;AAAA,MACF,aAAa,OAAO,eAAe;AAAA,MACnC,cAAc,OAAO,gBAAgB;AAAA,MACrC,cACE,OAAO,gBACP;AAAA,MAOF,UAAU,OAAO,YAAY;AAAA,MAC7B,QAAQ,OAAO,UAAU;AAAA,MACzB,aAAa,OAAO,eAAe;AAAA,MACnC,WAAW,OAAO,aAAa;AAAA,IAChC;AACD,SAAK,iBAAiB;AAAA,EAC1B;AAAA,EAEE,gBAAgB,OAAO;AACrB,SAAK,OAAO,eAAe;AAAA,EAC/B;AAAA;AAAA,EAGE,aAAa,QAAQ;AACnB,QAAI,OAAO,cAAc;AACvB,WAAK,gBAAgB,OAAO,YAAY;AAAA,IAC9C;AACI,QAAI,OAAO,UAAU;AACnB,WAAK,OAAO,WAAW,OAAO;AAAA,IACpC;AACI,QAAI,OAAO,QAAQ;AACjB,WAAK,OAAO,SAAS,OAAO;AAAA,IAClC;AACI,QAAI,OAAO,aAAa;AACtB,WAAK,OAAO,cAAc,OAAO;AAAA,IACvC;AACI,QAAI,OAAO,eAAe;AACxB,WAAK,OAAO,gBAAgB,OAAO;AAAA,IACzC;AACI,QAAI,OAAO,cAAc,QAAW;AAClC,WAAK,OAAO,YAAY,OAAO;AAAA,IACrC;AAAA,EACA;AAAA;AAAA,EAGE,MAAM,cAAc,UAAU,YAAY;AACxC,UAAM,SAAS,SAAS,KAAK,UAAW;AACxC,UAAM,UAAU,IAAI,YAAa;AACjC,QAAI,SAAS;AACb,QAAI,eAAe;AACnB,QAAI,oBAAoB,CAAE;AAC1B,QAAI,gBAAgB;AACpB,QAAI,eAAe;AAEnB,QAAI;AACF,cAAQ,IAAI,+CAA+C;AAG3D,YAAM,yBAAyB,CAAC,SAAS;AACvC,YAAI,UAAU;AAEd,YACE,KAAK,WACL,KAAK,QAAQ,CAAC,EAAE,SAChB,KAAK,QAAQ,CAAC,EAAE,MAAM,YAAY,QAClC;AAEA,oBAAU,KAAK,QAAQ,CAAC,EAAE,MAAM;AAAA,QAC1C,WAAmB,KAAK,SAAS,QAAW;AAElC,oBAAU,KAAK;AAAA,QACzB,WAAmB,KAAK,YAAY,QAAW;AAErC,oBAAU,KAAK;AAAA,QACzB,WAAmB,KAAK,SAAS,KAAK,MAAM,SAAS,QAAW;AAEtD,oBAAU,KAAK,MAAM;AAAA,QAC/B;AAEQ,eAAO;AAAA,MACR;AAGD,UAAI,sBAAsB;AAE1B,aAAO,MAAM;AACX,cAAM,EAAE,MAAM,MAAO,IAAG,MAAM,OAAO,KAAM;AAE3C,YAAI,MAAM;AACR,kBAAQ;AAAA,YACN;AAAA,YACA;AAAA,YACA;AAAA,UACD;AAGD,cAAI,OAAO,QAAQ;AACjB,gBAAI;AAEF,oBAAM,YAAY,OAAO,MAAM,cAAc;AAC7C,kBAAI,WAAW;AACb,oBAAI;AACF,wBAAM,OAAO,KAAK,MAAM,UAAU,CAAC,CAAC;AACpC,wBAAM,UAAU,uBAAuB,IAAI;AAC3C,sBAAI,SAAS;AACX,oCAAgB;AAChB,+BAAW,OAAO;AAAA,kBACtC;AAAA,gBACiB,SAAQ,GAAG;AAEV,kCAAgB,OAAO,KAAM;AAC7B,6BAAW,OAAO,MAAM;AAAA,gBAC1C;AAAA,cACA,OAAqB;AAEL,sBAAM,cAAc,OAAO,QAAQ,aAAa,EAAE,EAAE,KAAM;AAC1D,oBAAI,eAAe,gBAAgB,UAAU;AAC3C,kCAAgB;AAChB,6BAAW,WAAW;AAAA,gBACxC;AAAA,cACA;AAAA,YACa,SAAQ,GAAG;AACV,sBAAQ,KAAK,8CAA8C,CAAC;AAAA,YAC1E;AAAA,UACA;AACU;AAAA,QACV;AAGQ,cAAM,QAAQ,QAAQ,OAAO,OAAO,EAAE,QAAQ,MAAM;AACpD,kBAAU;AACV;AAEA,YAAI,KAAK,OAAO,WAAW;AACzB,kBAAQ;AAAA,YACN,sBAAsB,YAAY;AAAA,YAClC,MAAM,SAAS,MACX,GAAG,MAAM,UAAU,GAAG,GAAG,CAAC,QAAQ,MAAM,MAAM,YAC9C;AAAA,UACL;AAED,4BAAkB,KAAK,KAAK;AAAA,QACtC;AAGQ,cAAM,QAAQ,OAAO,MAAM,IAAI;AAC/B,iBAAS,MAAM,IAAK,KAAI;AAExB,YAAI,eAAe;AAEnB,mBAAW,QAAQ,OAAO;AAExB,cAAI,KAAK,WAAW,QAAQ,GAAG;AAC7B,kBAAM,UAAU,KAAK,MAAM,CAAC,EAAE,KAAM;AAEpC,gBAAI,YAAY,SAAU;AAE1B,gBAAI;AACJ,gBAAI;AACF,yBAAW,KAAK,MAAM,OAAO;AAAA,YAC9B,SAAQ,GAAG;AAEV,kBAAI,QAAQ,QAAQ;AAClB,+BAAe;AACf,gCAAgB;AAChB,2BAAW,OAAO;AAAA,cAClC;AACc;AAAA,YACd;AAEY,kBAAM,mBAAmB,uBAAuB,QAAQ;AAExD,gBAAI,kBAAkB;AACpB,6BAAe;AACf,8BAAgB;AAChB,+BAAiB,iBAAiB;AAGlC,yBAAW,gBAAgB;AAAA,YACzC;AAAA,UACA;AAAA,QACA;AAIQ,YAAI,CAAC,gBAAgB,OAAO,SAAS,SAAS,GAAG;AAC/C,cAAI;AACF,kBAAM,QAAQ,OAAO,MAAM,QAAQ;AACnC,qBAAS,IAAI,GAAG,IAAI,MAAM,QAAQ,KAAK;AACrC,kBAAI,MAAM,CAAC,EAAE,KAAM,KAAI,MAAM,CAAC,EAAE,SAAS,qBAAqB,GAAG;AAC/D,oBAAI;AAEF,wBAAM,QAAQ,MAAM,CAAC,EAAE,MAAM,qBAAqB;AAClD,sBAAI,SAAS,MAAM,CAAC,GAAG;AACrB,0BAAM,UAAU,MAAM,CAAC;AACvB,oCAAgB;AAChB,qCAAiB,QAAQ;AACzB,+BAAW,OAAO;AAGlB,0BAAM,YAAY,MAAM,CAAC,EAAE;AAAA,sBACzB;AAAA,sBACA,MAAM,QAAQ,MAAM,CAAC,EAAE;AAAA,oBACxB;AACD,6BAAS,OAAO,QAAQ,WAAW,EAAE;AAErC,wBAAI,qBAAqB;AACvB,4CAAsB;AACtB,0BAAI,KAAK,OAAO,WAAW;AACzB,gCAAQ;AAAA,0BACN,2CAA2C,OAAO;AAAA,wBACnD;AAAA,sBACzB;AAAA,oBACA;AAAA,kBACA;AAAA,gBACiB,SAAQ,GAAG;AACV,0BAAQ;AAAA,oBACN;AAAA,oBACA;AAAA,kBACD;AAAA,gBACnB;AAAA,cACA;AAAA,YACA;AAAA,UACW,SAAQ,GAAG;AACV,oBAAQ,KAAK,wCAAwC,CAAC;AAAA,UAClE;AAAA,QACA;AAAA,MACA;AAGM,UAAI,KAAK,OAAO,WAAW;AACzB,gBAAQ;AAAA,UACN,+BAA+B,aAAa,MAAM;AAAA,UAClD,aAAa,UAAU,GAAG,EAAE,KACzB,aAAa,SAAS,KAAK,QAAQ;AAAA,QACvC;AAGD,YAAI,aAAa,WAAW,MAAM,KAAK,kBAAkB,SAAS,GAAG;AACnE,kBAAQ;AAAA,YACN;AAAA,YACA,kBAAkB,MAAM,GAAG,CAAC;AAAA,UAC7B;AAAA,QACX;AAAA,MACA;AAEM,aAAO;AAAA,IACR,SAAQ,OAAO;AACd,cAAQ,MAAM,iDAAiD,KAAK;AACpE,YAAM;AAAA,IACZ;AAAA,EACA;AAAA,EAEE,MAAM,YAAY,QAAQ,SAAS,aAAa,MAAM;AAAA,EAAA,GAAI;AbvQ5D;AawQI,QAAI;AACF,YAAM,QAAQ,KAAK,OAAO,OAAO,KAAK,OAAO,QAAQ;AACrD,UAAI,CAAC,OAAO;AACV,cAAM,IAAI,MAAM,mCAAmC;AAAA,MAC3D;AAGM,YAAM,kBAAkB,KAAK,OAAO,YAChC,KAAK,4BAA4B,UAAU,IAC3C;AAGJ,YAAM,UAAU;AAAA,QACd,UAAU,KAAK,OAAO;AAAA,QACtB;AAAA,QACA,UAAU;AAAA,UACR;AAAA,YACE,MAAM;AAAA,YACN,SAAS,KAAK,OAAO;AAAA,UACtB;AAAA,UACD;AAAA,YACE,MAAM;AAAA,YACN,SAAS,GAAG,MAAM;AAAA;AAAA,EAAO,WAAW,6BAA6B;AAAA,UAClE;AAAA,QACF;AAAA,QACD,aAAa,KAAK,OAAO;AAAA,QACzB,QAAQ;AAAA,QACR,UAAU,KAAK,OAAO;AAAA,QACtB,QAAQ,KAAK,OAAO;AAAA,QACpB,UAAU,KAAK,OAAO;AAAA;AAAA,QACtB,WAAW,KAAK,OAAO;AAAA,MACxB;AAED,cAAQ;AAAA,QACN;AAAA,QACA,KAAK,OAAO;AAAA,MACb;AACD,cAAQ;AAAA,QACN;AAAA,QACA,KAAK;AAAA,UACH;AAAA,YACE,UAAU,KAAK,OAAO;AAAA,YACtB,QAAQ;AAAA,YACR,SAAS;AAAA,cACP,gBAAgB;AAAA,YACjB;AAAA,YACD,MAAM,KAAK,UAAU,OAAO;AAAA,UAC7B;AAAA,UACD;AAAA,UACA;AAAA,QACV;AAAA,MACO;AACD,UAAI,KAAK,OAAO,WAAW;AACzB,gBAAQ,IAAI,wBAAwB,KAAK,UAAU,SAAS,MAAM,CAAC,CAAC;AAAA,MAC5E;AAGM,WAAK,iBAAiB;AAEtB,YAAM,WAAW,MAAM,MAAM,KAAK,OAAO,eAAe;AAAA,QACtD,QAAQ;AAAA,QACR,SAAS;AAAA,UACP,gBAAgB;AAAA,QACjB;AAAA,QACD,MAAM,KAAK,UAAU,OAAO;AAAA,MACpC,CAAO;AAED,cAAQ,IAAI,oCAAoC;AAAA,QAC9C,QAAQ,SAAS;AAAA,QACjB,IAAI,SAAS;AAAA,QACb,SAAS,OAAO,YAAY,CAAC,GAAG,SAAS,QAAQ,QAAO,CAAE,CAAC;AAAA,MACnE,CAAO;AAED,UAAI,CAAC,SAAS,IAAI;AAChB,YAAI;AACJ,YAAI;AACF,gBAAM,YAAY,MAAM,SAAS,KAAM;AACvC,2BACE,eAAU,UAAV,mBAAiB,YACjB,cAAc,SAAS,MAAM,IAAI,SAAS,UAAU;AAAA,QACvD,SAAQ,GAAG;AACV,yBAAe,cAAc,SAAS,MAAM,IAAI,SAAS,UAAU;AAAA,QAC7E;AACQ,cAAM,IAAI,MAAM,YAAY;AAAA,MACpC;AAEM,aAAO,MAAM,KAAK,cAAc,UAAU,eAAe;AAAA,IAC1D,SAAQ,OAAO;AACd,cAAQ,MAAM,4CAA4C,KAAK;AAC/D,YAAM,IAAI,SAAS,MAAM,SAAS,KAAK;AAAA,IAC7C;AAAA,EACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAUE,MAAM,qBACJ,QACA,SACA,aACA,aAAa,MAAM;AAAA,EAAA,GACnB;AblXJ;AamXI,QAAI;AACF,UAAI;AACJ,UAAI;AACJ,UAAI,WAAW;AACf,UAAI,gBAAgB;AAEpB,UAAI,OAAO,gBAAgB,UAAU;AAEnC,mBAAW;AACX,wBAAgB;AAChB,gBAAQ,IAAI,yCAAyC,QAAQ;AAAA,MACrE,WAAiB,uBAAuB,MAAM;AAEtC,oBAAY,MAAM,KAAK,cAAc,WAAW;AAChD,mBAAW,YAAY,QAAQ;AAC/B,gBAAQ,IAAI,2CAA2C,QAAQ;AAAA,MACvE,OAAa;AACL,cAAM,IAAI,MAAM,sBAAsB;AAAA,MAC9C;AAGM,YAAM,kBAAkB,KAAK,OAAO,YAChC,KAAK,4BAA4B,UAAU,IAC3C;AAGJ,YAAM,WAAW,CAAE;AAEnB,UAAI,KAAK,OAAO,aAAa,UAAU;AACrC,iBAAS,KAAK;AAAA,UACZ,MAAM;AAAA,UACN,SAAS,KAAK,OAAO;AAAA,QAC/B,CAAS;AAGD,cAAM,cAAc;AAAA,UAClB;AAAA,YACE,MAAM;AAAA,YACN,MAAM,GAAG,MAAM;AAAA;AAAA,EACb,WAAW,kCACzB;AAAA,UACW;AAAA,QACF;AAGD,YAAI,eAAe;AACjB,sBAAY,KAAK;AAAA,YACf,MAAM;AAAA,YACN,WAAW,EAAE,KAAK,UAAU,QAAQ,OAAQ;AAAA,UACxD,CAAW;AAAA,QACX,OAAe;AACL,sBAAY,KAAK;AAAA,YACf,MAAM;AAAA,YACN,WAAW;AAAA,cACT,KAAK,QAAQ,QAAQ,WAAW,SAAS;AAAA,cACzC,QAAQ;AAAA,YACT;AAAA,UACb,CAAW;AAAA,QACX;AAEQ,iBAAS,KAAK;AAAA,UACZ,MAAM;AAAA,UACN,SAAS;AAAA,QACnB,CAAS;AAAA,MACF,WAAU,KAAK,OAAO,aAAa,aAAa;AAE/C,cAAM,cAAc;AAAA,UAClB;AAAA,YACE,MAAM;AAAA,YACN,MAAM,KAAK,OAAO;AAAA,UACnB;AAAA,QACF;AAGD,YAAI,eAAe;AACjB,sBAAY,KAAK;AAAA,YACf,MAAM;AAAA,YACN,QAAQ,EAAE,MAAM,OAAO,KAAK,SAAU;AAAA,UAClD,CAAW;AAAA,QACX,OAAe;AACL,sBAAY,KAAK;AAAA,YACf,MAAM;AAAA,YACN,QAAQ,EAAE,MAAM,UAAU,YAAY,UAAU,MAAM,UAAW;AAAA,UAC7E,CAAW;AAAA,QACX;AAGQ,oBAAY,KAAK;AAAA,UACf,MAAM;AAAA,UACN,MAAM,GAAG,MAAM;AAAA;AAAA,EAAO,WAAW,kCAAkC;AAAA,QAC7E,CAAS;AAED,iBAAS,KAAK;AAAA,UACZ,MAAM;AAAA,UACN,SAAS;AAAA,QACnB,CAAS;AAAA,MACF,WAAU,KAAK,OAAO,aAAa,UAAU;AAE5C,cAAM,YAAY;AAAA,UAChB;AAAA,YACE,MAAM,GAAG,KAAK,OAAO,YAAY;AAAA;AAAA,EAAO,MAAM;AAAA;AAAA,EAC5C,WAAW,kCACzB;AAAA,UACW;AAAA,QACF;AAGD,YAAI,eAAe;AAGjB,oBAAU,KAAK;AAAA,YACb,kBAAkB;AAAA;AAAA,UAC9B,CAAW;AAAA,QACX,OAAe;AACL,oBAAU,KAAK;AAAA,YACb,aAAa;AAAA,cACX,WAAW;AAAA,cACX,MAAM;AAAA,YACP;AAAA,UACb,CAAW;AAAA,QACX;AAEQ,iBAAS,KAAK;AAAA,UACZ,MAAM;AAAA,UACN,OAAO;AAAA,QACjB,CAAS;AAAA,MACT;AAGM,YAAM,cAAc,KAAK,aAAa;AAAA,QACpC,KAAK,OAAO;AAAA,MACb;AAED,YAAM,UAAU;AAAA,QACd,UAAU,KAAK,OAAO;AAAA,QACtB,OAAO,eAAe,KAAK,OAAO,OAAO,KAAK,OAAO,QAAQ;AAAA,QAC7D;AAAA,QACA,aAAa,KAAK,OAAO;AAAA,QACzB,QAAQ;AAAA,QACR,UAAU,KAAK,OAAO;AAAA,QACtB,QAAQ,KAAK,OAAO;AAAA,QACpB,UAAU,KAAK,OAAO;AAAA;AAAA,QACtB,UAAU;AAAA,QACV,oBAAoB;AAAA;AAAA,MACrB;AAED,cAAQ,IAAI,+CAA+C;AAAA,QACzD,UAAU,KAAK,OAAO;AAAA,QACtB,UAAU,KAAK,OAAO;AAAA,QACtB,OAAO,QAAQ;AAAA,QACf,UAAU;AAAA,QACV;AAAA,MACR,CAAO;AAGD,WAAK,iBAAiB;AAEtB,YAAM,WAAW,MAAM,MAAM,KAAK,OAAO,eAAe;AAAA,QACtD,QAAQ;AAAA,QACR,SAAS;AAAA,UACP,gBAAgB;AAAA,UAChB,GAAI,KAAK,OAAO,gBAAgB;AAAA,YAC9B,eAAe,UAAU,KAAK,OAAO,YAAY;AAAA,UAC7D;AAAA,QACS;AAAA,QACD,MAAM,KAAK,UAAU,OAAO;AAAA,MACpC,CAAO;AAED,cAAQ;AAAA,QACN;AAAA,QACA,SAAS;AAAA,QACT,SAAS;AAAA,MACV;AAED,UAAI,CAAC,SAAS,IAAI;AAEhB,YAAI;AACF,gBAAM,YAAY,MAAM,SAAS,KAAM;AACvC,kBAAQ,MAAM,yCAAyC,SAAS;AAChE,gBAAM,IAAI;AAAA,cACR,eAAU,UAAV,mBAAiB,YACf,cAAc,SAAS,MAAM,IAAI,SAAS,UAAU;AAAA,UACvD;AAAA,QACF,SAAQ,YAAY;AACnB,kBAAQ;AAAA,YACN;AAAA,YACA;AAAA,UACD;AACD,gBAAM,UAAU,MAAM,SAAS,KAAI,EAAG,MAAM,MAAM,EAAE;AACpD,kBAAQ,MAAM,mCAAmC,OAAO;AACxD,gBAAM,IAAI;AAAA,YACR,cAAc,SAAS,MAAM,IAAI,SAAS,UAAU;AAAA,UACrD;AAAA,QACX;AAAA,MACA;AAEM,aAAO,MAAM,KAAK,cAAc,UAAU,eAAe;AAAA,IAC1D,SAAQ,OAAO;AACd,cAAQ,MAAM,uCAAuC,KAAK;AAC1D,YAAM,IAAI,MAAM,4BAA4B,MAAM,OAAO,EAAE;AAAA,IACjE;AAAA,EACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQE,uBAAuB,aAAa,UAAU;AAE5C,UAAM,gBAAgB,OAAO,gBAAgB;AAC7C,UAAM,WAAW,KAAK,OAAO;AAE7B,QAAI,aAAa,UAAU;AACzB,UAAI,eAAe;AACjB,eAAO;AAAA,UACL,MAAM;AAAA,UACN,WAAW;AAAA,YACT,KAAK;AAAA,YACL,QAAQ;AAAA,UACT;AAAA,QACF;AAAA,MACT,OAAa;AACL,eAAO;AAAA,UACL,MAAM;AAAA,UACN,WAAW;AAAA,YACT,KAAK,QAAQ,QAAQ,WAAW,WAAW;AAAA,YAC3C,QAAQ;AAAA,UACT;AAAA,QACF;AAAA,MACT;AAAA,IACA,WAAe,aAAa,aAAa;AACnC,UAAI,eAAe;AACjB,eAAO;AAAA,UACL,MAAM;AAAA,UACN,QAAQ;AAAA,YACN,MAAM;AAAA,YACN,KAAK;AAAA,UACN;AAAA,QACF;AAAA,MACT,OAAa;AACL,eAAO;AAAA,UACL,MAAM;AAAA,UACN,QAAQ;AAAA,YACN,MAAM;AAAA,YACN,YAAY;AAAA,YACZ,MAAM;AAAA,UACP;AAAA,QACF;AAAA,MACT;AAAA,IACA,WAAe,aAAa,UAAU;AAChC,UAAI,eAAe;AAGjB,eAAO;AAAA,UACL,kBAAkB;AAAA;AAAA,QACnB;AAAA,MACT,OAAa;AACL,eAAO;AAAA,UACL,aAAa;AAAA,YACX,WAAW;AAAA,YACX,MAAM;AAAA,UACP;AAAA,QACF;AAAA,MACT;AAAA,IACA;AAGI,WAAO,gBAAgB,EAAE,KAAK,YAAW,IAAK,EAAE,QAAQ,YAAa;AAAA,EACzE;AAAA,EAEE,MAAM,cAAc,WAAW;AAC7B,QAAI,CAAC,WAAW;AACd,YAAM,IAAI,MAAM,wBAAwB;AAAA,IAC9C;AAEI,QAAI,CAAC,UAAU,KAAK,WAAW,QAAQ,GAAG;AACxC,YAAM,IAAI,MAAM,kDAAkD;AAAA,IACxE;AAEI,WAAO,IAAI,QAAQ,CAAC,SAAS,WAAW;AACtC,YAAM,SAAS,IAAI,WAAY;AAC/B,aAAO,SAAS,MAAM;AACpB,YAAI;AACF,gBAAM,SAAS,OAAO,OAAO,MAAM,GAAG,EAAE,CAAC;AACzC,cAAI,CAAC,QAAQ;AACX,mBAAO,IAAI,MAAM,mCAAmC,CAAC;AACrD;AAAA,UACZ;AACU,kBAAQ,MAAM;AAAA,QACf,SAAQ,OAAO;AACd,iBAAO,IAAI,MAAM,8BAA8B,CAAC;AAAA,QAC1D;AAAA,MACO;AACD,aAAO,UAAU,MAAM,OAAO,IAAI,MAAM,2BAA2B,CAAC;AACpE,aAAO,cAAc,SAAS;AAAA,IACpC,CAAK;AAAA,EACL;AAAA,EAEE,MAAM,YACJ,SACA,SAAS,WACT,YAAY,MACZ,UAAU,IACV,aAAa,MAAM;AAAA,EAAA,GACnB;AACA,UAAM,UAAU;AAAA,MACd,SAAS;AAAA,EAAsE,OAAO;AAAA;AAAA;AAAA,MACtF,WAAW;AAAA,EAAoD,OAAO;AAAA;AAAA;AAAA,MACtE,QAAQ;AAAA,EAA8C,OAAO;AAAA;AAAA;AAAA,MAC7D,YAAY;AAAA,EAA8C,OAAO;AAAA;AAAA;AAAA,MACjE,eAAe;AAAA,EAAwC,OAAO;AAAA;AAAA;AAAA,MAC9D,eAAe;AAAA,EAAwC,OAAO;AAAA;AAAA;AAAA,MAC9D,OAAO;AAAA,EAAwC,OAAO;AAAA;AAAA;AAAA,IACvD;AAED,UAAM,SAAS,QAAQ,MAAM,KAAK,QAAQ;AAG1C,UAAM,kBAAkB,KAAK,OAAO,YAChC,KAAK,4BAA4B,UAAU,IAC3C;AAEJ,QAAI;AACF,UACE,aACA,KAAK,aAAa,4BAA4B,KAAK,OAAO,QAAQ,GAClE;AACA,eAAO,MAAM,KAAK;AAAA,UAChB;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,QACD;AAAA,MACT,OAAa;AACL,eAAO,MAAM,KAAK,YAAY,QAAQ,SAAS,eAAe;AAAA,MACtE;AAAA,IACK,SAAQ,OAAO;AACd,cAAQ,MAAM,qCAAqC,KAAK;AACxD,YAAM,IAAI,MAAM,8BAA8B,MAAM,OAAO,EAAE;AAAA,IACnE;AAAA,EACA;AAAA,EAEE,MAAM,aAAa,SAAS,SAAS,QAAQ,MAAM,aAAa,MAAM;AAAA,KAAI;Ab3sB5E;Aa4sBI,QAAI;AAEF,YAAM,kBAAkB,KAAK,OAAO,YAChC,KAAK,4BAA4B,UAAU,IAC3C;AAGJ,UAAI,WAAW;AAAA,QACb,EAAE,MAAM,UAAU,SAAS,KAAK,OAAO,aAAc;AAAA,QACrD,EAAE,MAAM,QAAQ,QAAkB;AAAA,MACnC;AAED,UAAI,WAAW;AAEf,UAAI,SAAS;AAEX,YACE,SACA,KAAK,aAAa,4BAA4B,KAAK,OAAO,QAAQ,GAClE;AACA,cAAI;AACF,kBAAM,YAAY,MAAM,KAAK,cAAc,KAAK;AAChD,kBAAM,WAAW,MAAM,QAAQ;AAC/B,oBAAQ,IAAI,4CAA4C,QAAQ;AAEhE,uBAAW;AAEX,gBAAI,KAAK,OAAO,aAAa,UAAU;AACrC,uBAAS,KAAK;AAAA,gBACZ,MAAM;AAAA,gBACN,SAAS;AAAA,kBACP,EAAE,MAAM,QAAQ,MAAM,QAAS;AAAA,kBAC/B;AAAA,oBACE,MAAM;AAAA,oBACN,WAAW;AAAA,sBACT,KAAK,QAAQ,QAAQ,WAAW,SAAS;AAAA,sBACzC,QAAQ;AAAA,oBACT;AAAA,kBACF;AAAA,gBACF;AAAA,cACjB,CAAe;AAAA,YACF,WAAU,KAAK,OAAO,aAAa,aAAa;AAC/C,uBAAS,KAAK;AAAA,gBACZ,MAAM;AAAA,gBACN,SAAS;AAAA,kBACP,EAAE,MAAM,QAAQ,MAAM,QAAS;AAAA,kBAC/B;AAAA,oBACE,MAAM;AAAA,oBACN,QAAQ;AAAA,sBACN,MAAM;AAAA,sBACN,YAAY;AAAA,sBACZ,MAAM;AAAA,oBACP;AAAA,kBACF;AAAA,gBACF;AAAA,cACjB,CAAe;AAAA,YACF,WAAU,KAAK,OAAO,aAAa,UAAU;AAE5C,uBAAS,KAAK;AAAA,gBACZ,MAAM;AAAA,gBACN,OAAO;AAAA,kBACL,EAAE,MAAM,QAAS;AAAA,kBACjB;AAAA,oBACE,aAAa;AAAA,sBACX,WAAW;AAAA,sBACX,MAAM;AAAA,oBACP;AAAA,kBACF;AAAA,gBACF;AAAA,cACjB,CAAe;AAAA,YACf,OAAmB;AAEL,uBAAS,KAAK,EAAE,MAAM,QAAQ,SAAS,SAAS;AAChD,yBAAW;AAAA,YACzB;AAAA,UACW,SAAQ,YAAY;AACnB,oBAAQ;AAAA,cACN;AAAA,cACA;AAAA,YACD;AAED,qBAAS,KAAK,EAAE,MAAM,QAAQ,SAAS,SAAS;AAChD,uBAAW;AAAA,UACvB;AAAA,QACA,OAAe;AAEL,mBAAS,KAAK,EAAE,MAAM,QAAQ,SAAS,SAAS;AAAA,QAC1D;AAAA,MACA;AAGM,YAAM,QAAQ,KAAK,OAAO,SAAS;AAEnC,YAAM,UAAU;AAAA,QACd,UAAU,KAAK,OAAO;AAAA,QACtB;AAAA,QACA;AAAA,QACA,aAAa,KAAK,OAAO;AAAA,QACzB,QAAQ;AAAA,QACR,UAAU,KAAK,OAAO;AAAA,QACtB,QAAQ,KAAK,OAAO;AAAA,QACpB,UAAU,KAAK,OAAO;AAAA;AAAA,QACtB;AAAA,MACD;AAED,cAAQ;AAAA,QACN;AAAA,QACA,KAAK,UAAU,SAAS,MAAM,CAAC;AAAA,MAChC;AAED,cAAQ,IAAI,8CAA8C;AAAA,QACxD,UAAU,KAAK,OAAO;AAAA,QACtB,UAAU,KAAK,OAAO;AAAA,QACtB,OAAO,QAAQ;AAAA,QACf;AAAA,MACR,CAAO;AAGD,WAAK,iBAAiB;AAEtB,YAAM,WAAW,MAAM,MAAM,KAAK,OAAO,eAAe;AAAA,QACtD,QAAQ;AAAA,QACR,SAAS;AAAA,UACP,gBAAgB;AAAA,UAChB,GAAI,KAAK,OAAO,gBAAgB;AAAA,YAC9B,eAAe,UAAU,KAAK,OAAO,YAAY;AAAA,UAC7D;AAAA,QACS;AAAA,QACD,MAAM,KAAK,UAAU,OAAO;AAAA,MACpC,CAAO;AAED,cAAQ;AAAA,QACN;AAAA,QACA,SAAS;AAAA,QACT,SAAS;AAAA,MACV;AAED,UAAI,CAAC,SAAS,IAAI;AAChB,YAAI;AACF,gBAAM,YAAY,MAAM,SAAS,KAAM;AACvC,kBAAQ,MAAM,wCAAwC,SAAS;AAC/D,gBAAM,IAAI;AAAA,cACR,eAAU,UAAV,mBAAiB,YACf,cAAc,SAAS,MAAM,IAAI,SAAS,UAAU;AAAA,UACvD;AAAA,QACF,SAAQ,YAAY;AACnB,kBAAQ;AAAA,YACN;AAAA,YACA;AAAA,UACD;AACD,gBAAM,UAAU,MAAM,SAAS,KAAI,EAAG,MAAM,MAAM,EAAE;AACpD,kBAAQ,MAAM,mCAAmC,OAAO;AACxD,gBAAM,IAAI;AAAA,YACR,cAAc,SAAS,MAAM,IAAI,SAAS,UAAU;AAAA,UACrD;AAAA,QACX;AAAA,MACA;AAEM,aAAO,MAAM,KAAK,cAAc,UAAU,eAAe;AAAA,IAC1D,SAAQ,OAAO;AACd,cAAQ,MAAM,oCAAoC,KAAK;AACvD,YAAM,IAAI,SAAS,yBAAyB,MAAM,OAAO,IAAI,KAAK;AAAA,IACxE;AAAA,EACA;AAAA,EAEE,IAAI,iBAAiB;AACnB,WAAO,KAAK,aAAa,4BAA4B,KAAK,OAAO,QAAQ;AAAA,EAC7E;AAAA;AAAA,EAGE,4BAA4B,iBAAiB;AAC3C,QAAI,aAAa;AAEjB,WAAO,CAAC,UAAU;AAEhB,cAAQ;AAAA,QACN,+BAA+B,UAAU;AAAA,QACzC,MAAM,SAAS,KACX,GAAG,MAAM,UAAU,GAAG,EAAE,CAAC,QAAQ,MAAM,MAAM,YAC7C;AAAA,QACJ,IAAI,MAAM,KAAK,MAAM,UAAU,GAAG,CAAC,CAAC,EACjC,IAAI,CAAC,MAAM,EAAE,WAAW,CAAC,CAAC,EAC1B,KAAK,GAAG,CAAC;AAAA,MACb;AAGD,UAAI,aAAa,GAAG;AAElB,YAAI,eAAe,KAAK,MAAM,SAAS,GAAG;AACxC,kBAAQ,KAAK,iDAAiD,KAAK;AAAA,QAC7E;AAGQ,YAAK,eAAe,KAAK,UAAU,SAAU,UAAU,QAAQ;AAC7D,kBAAQ;AAAA,YACN;AAAA,YACA;AAAA,UACD;AAAA,QACX;AAAA,MACA;AAGM,UAAI,OAAO,oBAAoB,YAAY;AACzC,wBAAgB,KAAK;AAAA,MAC7B;AAEM;AAAA,IACD;AAAA,EACL;AACA;AAEA,MAAM,iBAAiB,MAAM;AAAA,EAC3B,YAAY,SAAS,gBAAgB,MAAM;AACzC,UAAM,OAAO;AACb,SAAK,OAAO;AACZ,SAAK,gBAAgB;AAAA,EACzB;AACA;AAEO,SAAS,gBAAgB,SAAS,IAAI;AAC3C,SAAO,IAAI,UAAU,MAAM;AAC7B;ACv6BO,MAAM,aAAa;AAAA,EACxB,YAAY,UAAU,IAAI;AACxB,SAAK,UAAU;AAAA,MACb,QAAQ,QAAQ,UAAU;AAAA,MAC1B,UAAU,QAAQ,YAAY;AAAA,MAC9B,KAAK,QAAQ,OAAO,KAAK,KAAK;AAAA;AAAA,MAC9B,SAAS,QAAQ,WAAW,OAAO;AAAA,IACpC;AAGD,SAAK,gBAAiB;AAAA,EAC1B;AAAA;AAAA;AAAA;AAAA;AAAA,EAME,kBAAkB;AAChB,QAAI;AACF,YAAM,UAAU,GAAG,KAAK,QAAQ,MAAM;AACtC,WAAK,QAAQ,QAAQ,QAAQ,SAAS,MAAM;AAC5C,WAAK,QAAQ,QAAQ,WAAW,OAAO;AAAA,IACxC,SAAQ,OAAO;AACd,YAAM,IAAI,MAAM,+BAA+B,MAAM,OAAO;AAAA,IAClE;AAAA,EACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQE,YAAY,QAAQ,SAAS;AAC3B,UAAM,OAAO,KAAK,WAAW,OAAO;AACpC,WAAO,GAAG,KAAK,QAAQ,MAAM,IAAI,MAAM,IAAI,IAAI;AAAA,EACnD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOE,WAAW,KAAK;AACd,QAAI,OAAO;AACX,aAAS,IAAI,GAAG,IAAI,IAAI,QAAQ,KAAK;AACnC,YAAM,OAAO,IAAI,WAAW,CAAC;AAC7B,cAAQ,QAAQ,KAAK,OAAO;AAC5B,aAAO,OAAO;AAAA,IACpB;AACI,WAAO,KAAK,IAAI,IAAI,EAAE,SAAS,EAAE;AAAA,EACrC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQE,IAAI,QAAQ,SAAS;AACnB,QAAI;AACF,YAAM,MAAM,KAAK,YAAY,QAAQ,OAAO;AAC5C,YAAM,aAAa,KAAK,QAAQ,QAAQ,QAAQ,GAAG;AAEnD,UAAI,CAAC,WAAY,QAAO;AAExB,YAAM,OAAO,KAAK,MAAM,UAAU;AAGlC,UAAI,KAAK,QAAQ,KAAK,YAAY,KAAK,QAAQ,KAAK;AAClD,aAAK,OAAO,QAAQ,OAAO;AAC3B,eAAO;AAAA,MACf;AAEM,aAAO,KAAK;AAAA,IACb,SAAQ,OAAO;AACd,cAAQ,MAAM,6BAA6B,KAAK;AAChD,aAAO;AAAA,IACb;AAAA,EACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQE,IAAI,QAAQ,SAAS,OAAO;AAC1B,QAAI;AACF,YAAM,MAAM,KAAK,YAAY,QAAQ,OAAO;AAC5C,YAAM,OAAO;AAAA,QACX;AAAA,QACA,WAAW,KAAK,IAAK;AAAA,MACtB;AAGD,WAAK,iBAAkB;AAEvB,WAAK,QAAQ,QAAQ,QAAQ,KAAK,KAAK,UAAU,IAAI,CAAC;AAAA,IACvD,SAAQ,OAAO;AACd,cAAQ,MAAM,2BAA2B,KAAK;AAC9C,WAAK,QAAO;AAAA,IAClB;AAAA,EACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOE,OAAO,QAAQ,SAAS;AACtB,UAAM,MAAM,KAAK,YAAY,QAAQ,OAAO;AAC5C,SAAK,QAAQ,QAAQ,WAAW,GAAG;AAAA,EACvC;AAAA;AAAA;AAAA;AAAA,EAKE,mBAAmB;AACjB,QAAI;AACF,YAAM,OAAO,KAAK,aAAc;AAChC,UAAI,KAAK,UAAU,KAAK,QAAQ,UAAU;AAExC,cAAM,gBAAgB,KACnB,IAAI,CAAC,SAAS;AAAA,UACb;AAAA,UACA,WAAW,KAAK,MAAM,KAAK,QAAQ,QAAQ,QAAQ,GAAG,CAAC,EAAE;AAAA,QACrE,EAAY,EACD,KAAK,CAAC,GAAG,MAAM,EAAE,YAAY,EAAE,SAAS,EACxC,MAAM,GAAG,KAAK,SAAS,KAAK,QAAQ,WAAW,CAAC;AAEnD,sBAAc,QAAQ,CAAC,SAAS;AAC9B,eAAK,QAAQ,QAAQ,WAAW,KAAK,GAAG;AAAA,QAClD,CAAS;AAAA,MACT;AAAA,IACK,SAAQ,OAAO;AACd,cAAQ,MAAM,qCAAqC,KAAK;AAAA,IAC9D;AAAA,EACA;AAAA;AAAA;AAAA;AAAA;AAAA,EAME,eAAe;AACb,UAAM,OAAO,CAAE;AACf,aAAS,IAAI,GAAG,IAAI,KAAK,QAAQ,QAAQ,QAAQ,KAAK;AACpD,YAAM,MAAM,KAAK,QAAQ,QAAQ,IAAI,CAAC;AACtC,UAAI,IAAI,WAAW,KAAK,QAAQ,MAAM,GAAG;AACvC,aAAK,KAAK,GAAG;AAAA,MACrB;AAAA,IACA;AACI,WAAO;AAAA,EACX;AAAA;AAAA;AAAA;AAAA,EAKE,UAAU;AACR,QAAI;AACF,YAAM,MAAM,KAAK,IAAK;AACtB,YAAM,OAAO,KAAK,aAAc;AAEhC,WAAK,QAAQ,CAAC,QAAQ;AACpB,cAAM,OAAO,KAAK,MAAM,KAAK,QAAQ,QAAQ,QAAQ,GAAG,CAAC;AACzD,YAAI,MAAM,KAAK,YAAY,KAAK,QAAQ,KAAK;AAC3C,eAAK,QAAQ,QAAQ,WAAW,GAAG;AAAA,QAC7C;AAAA,MACA,CAAO;AAAA,IACF,SAAQ,OAAO;AACd,cAAQ,MAAM,+BAA+B,KAAK;AAAA,IACxD;AAAA,EACA;AAAA;AAAA;AAAA;AAAA,EAKE,QAAQ;AACN,UAAM,OAAO,KAAK,aAAc;AAChC,SAAK,QAAQ,CAAC,QAAQ;AACpB,WAAK,QAAQ,QAAQ,WAAW,GAAG;AAAA,IACzC,CAAK;AAAA,EACL;AAAA;AAAA;AAAA;AAAA;AAAA,EAME,WAAW;AACT,QAAI;AACF,YAAM,OAAO,KAAK,aAAc;AAChC,YAAM,MAAM,KAAK,IAAK;AACtB,UAAI,YAAY;AAChB,UAAI,eAAe;AAEnB,WAAK,QAAQ,CAAC,QAAQ;AACpB,cAAM,OAAO,KAAK,MAAM,KAAK,QAAQ,QAAQ,QAAQ,GAAG,CAAC;AACzD,qBAAa,KAAK,UAAU,IAAI,EAAE;AAClC,YAAI,MAAM,KAAK,YAAY,KAAK,QAAQ,KAAK;AAC3C;AAAA,QACV;AAAA,MACA,CAAO;AAED,aAAO;AAAA,QACL,YAAY,KAAK;AAAA,QACjB,cAAc;AAAA,QACd;AAAA,QACA,UAAU,KAAK,QAAQ;AAAA,MACxB;AAAA,IACF,SAAQ,OAAO;AACd,cAAQ,MAAM,8BAA8B,KAAK;AACjD,aAAO;AAAA,IACb;AAAA,EACA;AACA;AAGO,SAAS,mBAAmB,UAAU,IAAI;AAC/C,SAAO,IAAI,aAAa,OAAO;AACjC;ACxNO,MAAM,eAAe;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAM1B,YAAY,UAAU,UAAU,IAAI;AAClC,SAAK,WAAW;AAChB,SAAK,UAAU;AAAA,MACb,OAAO,QAAQ,SAAS;AAAA,MACxB,aAAa,QAAQ,eAAe;AAAA,MACpC,oBAAoB,QAAQ,uBAAuB;AAAA;AAAA,MACnD,GAAG;AAAA,IACJ;AAED,SAAK,iBAAiB;AACtB,SAAK,eAAe;AACpB,SAAK,cAAc;AAGnB,SAAK,oBAAqB;AAAA,EAC9B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOE,wBAAwB;AfjC1B;AekCI,QAAI;AACF,UAAI,OAAO,OAAO,YAAY,aAAa;AACzC,eAAO;AAAA,MACf;AAGM,UAAI,OAAO,QAAQ,cAAc;AAC/B,eAAO,SAAS,OAAO,QAAQ,cAAc,EAAE;AAAA,MACvD;AAGM,UAAI,OAAO,OAAO,QAAQ,iBAAiB,YAAY;AACrD,eAAO;AAAA,MACf,WAAiB,SAAO,YAAO,QAAQ,QAAf,mBAAoB,gBAAe,YAAY;AAC/D,eAAO;AAAA,MACf,WAAiB,SAAO,YAAO,QAAQ,QAAf,mBAAoB,gBAAe,YAAY;AAC/D,eAAO;AAAA,MACf,WAAiB,SAAO,YAAO,QAAQ,QAAf,mBAAoB,WAAU,YAAY;AAC1D,eAAO;AAAA,MACf;AAGM,aAAO;AAAA,IACR,SAAQ,OAAO;AACd,cAAQ,MAAM,qDAAqD,KAAK;AACxE,aAAO;AAAA,IACb;AAAA,EACA;AAAA;AAAA;AAAA;AAAA;AAAA,EAME,sBAAsB;AACpB,QAAI;AAEF,WAAK,cAAc,KAAK,sBAAuB;AAE/C,UAAI,KAAK,QAAQ,OAAO;AACtB,gBAAQ;AAAA,UACN,8CACE,KAAK,eAAe,SACrB;AAAA,QACF;AAAA,MACT;AAGM,UAAI,OAAO,OAAO,YAAY,aAAa;AAEzC,YAAI,WAAW;AAGf,YAAI,KAAK,eAAe,GAAG;AACzB,qBAAW,OAAO,QAAQ,IAAI,KAAK,QAAQ;AAAA,QACrD;AAGQ,YAAI,CAAC,YAAY,KAAK,QAAQ,oBAAoB;AAEhD,gBAAM,oBAAoB,WAAW,KAAK,QAAQ;AAClD,cAAI,OAAO,iBAAiB,GAAG;AAC7B,uBAAW,OAAO,iBAAiB;AAAA,UAC/C;AAGU,cAAI,OAAO,iBAAiB;AAC1B,uBAAW,OAAO;AAAA,UAC9B;AAAA,QACA;AAEQ,YAAI,UAAU;AACZ,eAAK,iBAAiB;AACtB,eAAK,eAAe;AAEpB,cAAI,KAAK,QAAQ,OAAO;AACtB,oBAAQ;AAAA,cACN,+CAA+C,KAAK,QAAQ;AAAA,cAC5D;AAAA,YACD;AAAA,UACb;AAEU,iBAAO;AAAA,QACjB;AAAA,MACA;AAEM,UAAI,KAAK,QAAQ,OAAO;AACtB,gBAAQ;AAAA,UACN,oDAAoD,KAAK,QAAQ;AAAA,QAClE;AAAA,MACT;AAEM,aAAO;AAAA,IACR,SAAQ,OAAO;AACd,cAAQ,MAAM,oDAAoD,KAAK;AACvE,aAAO;AAAA,IACb;AAAA,EACA;AAAA;AAAA;AAAA;AAAA;AAAA,EAME,MAAM,gBAAgB;AACpB,QAAI,KAAK,gBAAgB,KAAK,gBAAgB;AAC5C,aAAO;AAAA,IACb;AAEI,WAAO,IAAI,QAAQ,CAAC,YAAY;AAE9B,UAAI,KAAK,uBAAuB;AAC9B,gBAAQ,IAAI;AACZ;AAAA,MACR;AAGM,YAAM,YAAY,KAAK,IAAK;AAC5B,YAAM,gBAAgB,YAAY,MAAM;AACtC,YAAI,KAAK,uBAAuB;AAC9B,wBAAc,aAAa;AAC3B,kBAAQ,IAAI;AACZ;AAAA,QACV;AAGQ,YAAI,KAAK,IAAK,IAAG,YAAY,KAAK,QAAQ,aAAa;AACrD,wBAAc,aAAa;AAC3B,kBAAQ;AAAA,YACN;AAAA,UACD;AACD,kBAAQ,KAAK;AAAA,QACvB;AAAA,MACO,GAAE,GAAG;AAAA,IACZ,CAAK;AAAA,EACL;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOE,WAAW,YAAY;AACrB,WACE,KAAK,kBACL,OAAO,KAAK,eAAe,UAAU,MAAM;AAAA,EAEjD;AAAA;AAAA;AAAA;AAAA;AAAA,EAME,MAAM,aAAa;AfzLrB;Ae0LI,UAAM,KAAK,cAAe;AAE1B,QAAI;AACF,UAAI,CAAC,KAAK,gBAAgB;AACxB,cAAM,IAAI,MAAM,8BAA8B;AAAA,MACtD;AAGM,UAAI,KAAK,WAAW,YAAY,GAAG;AACjC,YAAI;AAEF,gBAAM,UAAU,KAAK,eAAe,WAAW,EAAE,QAAQ,QAAQ;AAEjE,cAAI,KAAK,QAAQ,OAAO;AACtB,oBAAQ;AAAA,cACN,2DACE,mCAAS,WAAU,CACnC;AAAA,YACa;AAAA,UACb;AAEU,iBAAO,WAAW;AAAA,QACnB,SAAQ,KAAK;AACZ,kBAAQ,KAAK,8CAA8C,GAAG;AAAA,QAExE;AAAA,MACA;AAGM,UAAI,KAAK,eAAe,SAAS;AAC/B,YAAI;AACF,gBAAM,OAAO,KAAK,eAAe,QAAS;AAC1C,cAAI,MAAM;AACR,kBAAM,UAAU,KAAK;AAErB,gBAAI,KAAK,QAAQ,OAAO;AACtB,sBAAQ;AAAA,gBACN,kDACE,mCAAS,WAAU,CACrC;AAAA,cACe;AAAA,YACf;AAEY,mBAAO,WAAW;AAAA,UAC9B;AAAA,QACS,SAAQ,KAAK;AACZ,kBAAQ,KAAK,kDAAkD,GAAG;AAAA,QAC5E;AAAA,MACA;AAGM,UAAI,KAAK,eAAe,iBAAiB;AACvC,YAAI;AACF,gBAAM,MAAM,KAAK,eAAe;AAChC,cAAI,OAAO,IAAI,MAAM;AACnB,kBAAM,UAAU,IAAI,KAAK;AAEzB,gBAAI,KAAK,QAAQ,OAAO;AACtB,sBAAQ;AAAA,gBACN,6DACE,mCAAS,WAAU,CACrC;AAAA,cACe;AAAA,YACf;AAEY,mBAAO,WAAW;AAAA,UAC9B;AAAA,QACS,SAAQ,KAAK;AACZ,kBAAQ;AAAA,YACN;AAAA,YACA;AAAA,UACD;AAAA,QACX;AAAA,MACA;AAGM,YAAM,kBAAkB,SAAS,eAAe,KAAK,QAAQ;AAC7D,UAAI,mBAAmB,gBAAgB,OAAO;AAC5C,YAAI,KAAK,QAAQ,OAAO;AACtB,kBAAQ;AAAA,YACN,uDACE,qBAAgB,UAAhB,mBAAuB,WAAU,CAC/C;AAAA,UACW;AAAA,QACX;AACQ,eAAO,gBAAgB;AAAA,MAC/B;AAGM,cAAQ,MAAM,uDAAuD;AACrE,aAAO;AAAA,IACR,SAAQ,OAAO;AACd,cAAQ,MAAM,2CAA2C,KAAK;AAC9D,aAAO;AAAA,IACb;AAAA,EACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOE,MAAM,WAAW,SAAS;AACxB,UAAM,KAAK,cAAe;AAE1B,QAAI;AACF,UAAI,CAAC,KAAK,gBAAgB;AACxB,cAAM,IAAI,MAAM,8BAA8B;AAAA,MACtD;AAGM,UAAI,KAAK,WAAW,YAAY,GAAG;AACjC,YAAI;AACF,eAAK,eAAe,WAAW,OAAO;AAGtC,cACE,KAAK,WAAW,aAAa,KAC7B,KAAK,eAAe,eACpB,KAAK,WAAW,iBAAiB,GACjC;AACA,iBAAK,eAAe,YAAY,IAAK;AAAA,UACjD;AAEU,cAAI,KAAK,QAAQ,OAAO;AACtB,oBAAQ;AAAA,cACN,gEACE,mCAAS,WAAU,CACnC;AAAA,YACa;AAAA,UACb;AAEU,iBAAO;AAAA,QACR,SAAQ,KAAK;AACZ,kBAAQ,KAAK,8CAA8C,GAAG;AAAA,QAExE;AAAA,MACA;AAGM,UAAI,KAAK,eAAe,SAAS;AAC/B,YAAI;AACF,gBAAM,OAAO,KAAK,eAAe,QAAS;AAC1C,cAAI,MAAM;AACR,iBAAK,YAAY;AAEjB,gBAAI,KAAK,QAAQ,OAAO;AACtB,sBAAQ;AAAA,gBACN,0DACE,mCAAS,WAAU,CACrC;AAAA,cACe;AAAA,YACf;AAEY,mBAAO;AAAA,UACnB;AAAA,QACS,SAAQ,KAAK;AACZ,kBAAQ,KAAK,gDAAgD,GAAG;AAAA,QAC1E;AAAA,MACA;AAGM,UAAI,KAAK,eAAe,iBAAiB;AACvC,YAAI;AACF,gBAAM,MAAM,KAAK,eAAe;AAChC,cAAI,OAAO,IAAI,MAAM;AACnB,gBAAI,KAAK,YAAY;AAErB,gBAAI,KAAK,QAAQ,OAAO;AACtB,sBAAQ;AAAA,gBACN,qEACE,mCAAS,WAAU,CACrC;AAAA,cACe;AAAA,YACf;AAEY,mBAAO;AAAA,UACnB;AAAA,QACS,SAAQ,KAAK;AACZ,kBAAQ,KAAK,mDAAmD,GAAG;AAAA,QAC7E;AAAA,MACA;AAGM,YAAM,kBAAkB,SAAS,eAAe,KAAK,QAAQ;AAC7D,UAAI,iBAAiB;AACnB,wBAAgB,QAAQ;AAGxB,YAAI,KAAK,WAAW,MAAM,GAAG;AAC3B,eAAK,eAAe,KAAM;AAAA,QACpC;AAEQ,YAAI,KAAK,QAAQ,OAAO;AACtB,kBAAQ;AAAA,YACN,iDACE,mCAAS,WAAU,CACjC;AAAA,UACW;AAAA,QACX;AAEQ,eAAO;AAAA,MACf;AAGM,cAAQ,MAAM,qDAAqD;AACnE,aAAO;AAAA,IACR,SAAQ,OAAO;AACd,cAAQ,MAAM,2CAA2C,KAAK;AAC9D,aAAO;AAAA,IACb;AAAA,EACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOE,MAAM,cAAc,SAAS;AAC3B,UAAM,KAAK,cAAe;AAE1B,QAAI;AACF,UAAI,CAAC,KAAK,gBAAgB;AACxB,cAAM,IAAI,MAAM,8BAA8B;AAAA,MACtD;AAGM,UAAI,KAAK,WAAW,aAAa,GAAG;AAClC,YAAI;AACF,eAAK,eAAe,YAAY,oBAAoB,OAAO,OAAO;AAGlE,cACE,KAAK,WAAW,aAAa,KAC7B,KAAK,eAAe,eACpB,KAAK,WAAW,iBAAiB,GACjC;AACA,iBAAK,eAAe,YAAY,IAAK;AAAA,UACjD;AAEU,cAAI,KAAK,QAAQ,OAAO;AACtB,oBAAQ;AAAA,cACN;AAAA,YACD;AAAA,UACb;AAEU,iBAAO;AAAA,QACR,SAAQ,KAAK;AACZ,kBAAQ,KAAK,+CAA+C,GAAG;AAAA,QAEzE;AAAA,MACA;AAGM,UAAI,KAAK,WAAW,WAAW,KAAK,KAAK,eAAe,WAAW;AACjE,YAAI;AACF,gBAAM,YAAY,KAAK,eAAe;AAEtC,cAAI,KAAK,WAAW,sBAAsB,GAAG;AAC3C,sBAAU,WAAW,OAAO;AAE5B,gBAAI,KAAK,QAAQ,OAAO;AACtB,sBAAQ;AAAA,gBACN;AAAA,cACD;AAAA,YACf;AAEY,mBAAO;AAAA,UACnB;AAAA,QACS,SAAQ,KAAK;AACZ,kBAAQ;AAAA,YACN;AAAA,YACA;AAAA,UACD;AAAA,QACX;AAAA,MACA;AAGM,aAAO,MAAM,KAAK,WAAW,OAAO;AAAA,IACrC,SAAQ,OAAO;AACd,cAAQ,MAAM,6CAA6C,KAAK;AAChE,aAAO;AAAA,IACb;AAAA,EACA;AAAA;AAAA;AAAA;AAAA;AAAA,EAME,gBAAgB;AACd,WAAO,KAAK,gBAAgB,KAAK,mBAAmB;AAAA,EACxD;AAAA;AAAA;AAAA;AAAA;AAAA,EAME,aAAa;AACX,WAAO,KAAK;AAAA,EAChB;AACA;AAQO,SAAS,qBAAqB,UAAU,UAAU,IAAI;AAC3D,SAAO,IAAI,eAAe,UAAU,OAAO;AAC7C;AC3eO,MAAM,gBAAgB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAM3B,YAAY,UAAU,UAAU,IAAI;AAClC,SAAK,WAAW;AAChB,SAAK,UAAU;AAAA,MACb,OAAO,QAAQ,SAAS;AAAA,MACxB,aAAa,QAAQ,eAAe;AAAA,MACpC,GAAG;AAAA,IACJ;AAED,SAAK,iBAAiB;AACtB,SAAK,eAAe;AAGpB,SAAK,oBAAqB;AAAA,EAC9B;AAAA;AAAA;AAAA;AAAA;AAAA,EAME,sBAAsB;AACpB,QAAI;AAEF,UAAI,OAAO,OAAO,qBAAqB,aAAa;AAClD,aAAK,iBAAiB,OAAO;AAC7B,aAAK,eAAe;AAEpB,YAAI,KAAK,QAAQ,OAAO;AACtB,kBAAQ;AAAA,YACN;AAAA,UACD;AAAA,QACX;AAEQ,eAAO;AAAA,MACf;AAGM,YAAM,gBAAgB,SAAS,eAAe,KAAK,QAAQ;AAC3D,UAAI,iBAAiB,cAAc,kBAAkB;AACnD,aAAK,iBAAiB,cAAc;AACpC,aAAK,eAAe;AAEpB,YAAI,KAAK,QAAQ,OAAO;AACtB,kBAAQ;AAAA,YACN;AAAA,UACD;AAAA,QACX;AAEQ,eAAO;AAAA,MACf;AAEM,UAAI,KAAK,QAAQ,OAAO;AACtB,gBAAQ;AAAA,UACN,sDAAsD,KAAK,QAAQ;AAAA,QACpE;AAAA,MACT;AAEM,aAAO;AAAA,IACR,SAAQ,OAAO;AACd,cAAQ;AAAA,QACN;AAAA,QACA;AAAA,MACD;AACD,aAAO;AAAA,IACb;AAAA,EACA;AAAA;AAAA;AAAA;AAAA;AAAA,EAME,MAAM,gBAAgB;AACpB,QAAI,KAAK,gBAAgB,KAAK,gBAAgB;AAC5C,aAAO;AAAA,IACb;AAEI,WAAO,IAAI,QAAQ,CAAC,YAAY;AAE9B,UAAI,KAAK,uBAAuB;AAC9B,gBAAQ,IAAI;AACZ;AAAA,MACR;AAGM,YAAM,YAAY,KAAK,IAAK;AAC5B,YAAM,gBAAgB,YAAY,MAAM;AACtC,YAAI,KAAK,uBAAuB;AAC9B,wBAAc,aAAa;AAC3B,kBAAQ,IAAI;AACZ;AAAA,QACV;AAGQ,YAAI,KAAK,IAAK,IAAG,YAAY,KAAK,QAAQ,aAAa;AACrD,wBAAc,aAAa;AAC3B,kBAAQ;AAAA,YACN;AAAA,UACD;AACD,kBAAQ,KAAK;AAAA,QACvB;AAAA,MACO,GAAE,GAAG;AAAA,IACZ,CAAK;AAAA,EACL;AAAA;AAAA;AAAA;AAAA;AAAA,EAME,MAAM,aAAa;AACjB,UAAM,KAAK,cAAe;AAE1B,QAAI;AACF,UAAI,KAAK,gBAAgB;AACvB,cAAM,UAAU,KAAK,eAAe,QAAS;AAE7C,YAAI,KAAK,QAAQ,OAAO;AACtB,kBAAQ;AAAA,YACN,wCAAwC,QAAQ,MAAM;AAAA,UACvD;AAAA,QACX;AAEQ,eAAO;AAAA,MACf;AAAA,IACK,SAAQ,OAAO;AACd,cAAQ,MAAM,4CAA4C,KAAK;AAAA,IACrE;AAEI,WAAO;AAAA,EACX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOE,MAAM,WAAW,SAAS;AACxB,UAAM,KAAK,cAAe;AAE1B,QAAI;AACF,UAAI,KAAK,gBAAgB;AACvB,aAAK,eAAe,QAAQ,OAAO;AAEnC,YAAI,KAAK,QAAQ,OAAO;AACtB,kBAAQ;AAAA,YACN,+CAA+C,QAAQ,MAAM;AAAA,UAC9D;AAAA,QACX;AAEQ,eAAO;AAAA,MACf;AAAA,IACK,SAAQ,OAAO;AACd,cAAQ,MAAM,4CAA4C,KAAK;AAAA,IACrE;AAEI,WAAO;AAAA,EACX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOE,MAAM,cAAc,SAAS;AAC3B,UAAM,KAAK,cAAe;AAE1B,QAAI;AACF,UAAI,KAAK,gBAAgB;AACvB,cAAM,eAAe,KAAK,eAAe,KAAK,UAAU,OAAO,OAAO;AACtE,cAAM,gBAAgB,KAAK,eAAe,KAAK,QAAQ,YAAY;AACnE,aAAK,eAAe,MAAM,cAAc,aAAa;AAErD,YAAI,KAAK,QAAQ,OAAO;AACtB,kBAAQ,IAAI,iDAAiD;AAAA,QACvE;AAEQ,eAAO;AAAA,MACf;AAAA,IACK,SAAQ,OAAO;AACd,cAAQ,MAAM,8CAA8C,KAAK;AAAA,IACvE;AAEI,WAAO;AAAA,EACX;AAAA;AAAA;AAAA;AAAA;AAAA,EAME,gBAAgB;AACd,WAAO,KAAK,gBAAgB,KAAK,mBAAmB;AAAA,EACxD;AACA;AAQO,SAAS,sBAAsB,UAAU,UAAU,IAAI;AAC5D,SAAO,IAAI,gBAAgB,UAAU,OAAO;AAC9C;AC9MO,MAAM,aAAa;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAMxB,YAAY,UAAU,UAAU,IAAI;AAClC,SAAK,WAAW;AAChB,SAAK,UAAU;AAAA,MACb,OAAO,QAAQ,SAAS;AAAA,MACxB,aAAa,QAAQ,eAAe;AAAA,MACpC,GAAG;AAAA,IACJ;AAED,SAAK,iBAAiB;AACtB,SAAK,eAAe;AAGpB,SAAK,oBAAqB;AAAA,EAC9B;AAAA;AAAA;AAAA;AAAA;AAAA,EAME,sBAAsB;AACpB,QAAI;AAEF,UAAI,OAAO,OAAO,kBAAkB,aAAa;AAC/C,aAAK,iBAAiB,OAAO;AAC7B,aAAK,eAAe;AAEpB,YAAI,KAAK,QAAQ,OAAO;AACtB,kBAAQ;AAAA,YACN;AAAA,UACD;AAAA,QACX;AAEQ,eAAO;AAAA,MACf;AAGM,YAAM,gBAAgB,SAAS,eAAe,KAAK,QAAQ;AAC3D,UAAI,eAAe;AAEjB,cAAM,iBAAiB;AACvB,YAAI,kBAAkB,eAAe,SAAS;AAC5C,eAAK,iBAAiB,eAAe;AACrC,eAAK,eAAe;AAEpB,cAAI,KAAK,QAAQ,OAAO;AACtB,oBAAQ;AAAA,cACN;AAAA,YACD;AAAA,UACb;AAEU,iBAAO;AAAA,QACjB;AAGQ,cAAM,SAAS,eAAe,cAAc,YAAY;AACxD,YAAI,UAAU,OAAO,SAAS;AAC5B,eAAK,iBAAiB,OAAO;AAC7B,eAAK,eAAe;AAEpB,cAAI,KAAK,QAAQ,OAAO;AACtB,oBAAQ;AAAA,cACN;AAAA,YACD;AAAA,UACb;AAEU,iBAAO;AAAA,QACjB;AAAA,MACA;AAEM,UAAI,KAAK,QAAQ,OAAO;AACtB,gBAAQ;AAAA,UACN,gDAAgD,KAAK,QAAQ;AAAA,QAC9D;AAAA,MACT;AAEM,aAAO;AAAA,IACR,SAAQ,OAAO;AACd,cAAQ,MAAM,gDAAgD,KAAK;AACnE,aAAO;AAAA,IACb;AAAA,EACA;AAAA;AAAA;AAAA;AAAA;AAAA,EAME,MAAM,gBAAgB;AACpB,QAAI,KAAK,gBAAgB,KAAK,gBAAgB;AAC5C,aAAO;AAAA,IACb;AAEI,WAAO,IAAI,QAAQ,CAAC,YAAY;AAE9B,UAAI,KAAK,uBAAuB;AAC9B,gBAAQ,IAAI;AACZ;AAAA,MACR;AAGM,YAAM,YAAY,KAAK,IAAK;AAC5B,YAAM,gBAAgB,YAAY,MAAM;AACtC,YAAI,KAAK,uBAAuB;AAC9B,wBAAc,aAAa;AAC3B,kBAAQ,IAAI;AACZ;AAAA,QACV;AAGQ,YAAI,KAAK,IAAK,IAAG,YAAY,KAAK,QAAQ,aAAa;AACrD,wBAAc,aAAa;AAC3B,kBAAQ;AAAA,YACN;AAAA,UACD;AACD,kBAAQ,KAAK;AAAA,QACvB;AAAA,MACO,GAAE,GAAG;AAAA,IACZ,CAAK;AAAA,EACL;AAAA;AAAA;AAAA;AAAA;AAAA,EAME,MAAM,aAAa;AACjB,UAAM,KAAK,cAAe;AAE1B,QAAI;AACF,UAAI,KAAK,gBAAgB;AAMvB,cAAM,UAAU,KAAK,eAAe,KAAK;AAEzC,YAAI,KAAK,QAAQ,OAAO;AACtB,kBAAQ;AAAA,YACN,qCAAqC,QAAQ,MAAM;AAAA,UACpD;AAAA,QACX;AAEQ,eAAO;AAAA,MACf;AAAA,IACK,SAAQ,OAAO;AACd,cAAQ,MAAM,yCAAyC,KAAK;AAAA,IAClE;AAEI,WAAO;AAAA,EACX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOE,MAAM,WAAW,SAAS;AACxB,UAAM,KAAK,cAAe;AAE1B,QAAI;AACF,UAAI,KAAK,gBAAgB;AAEvB,aAAK,eAAe,UAAU,qBAAqB,OAAO;AAE1D,YAAI,KAAK,QAAQ,OAAO;AACtB,kBAAQ;AAAA,YACN,4CAA4C,QAAQ,MAAM;AAAA,UAC3D;AAAA,QACX;AAEQ,eAAO;AAAA,MACf;AAAA,IACK,SAAQ,OAAO;AACd,cAAQ,MAAM,yCAAyC,KAAK;AAAA,IAClE;AAEI,WAAO;AAAA,EACX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOE,MAAM,cAAc,SAAS;AAC3B,UAAM,KAAK,cAAe;AAE1B,QAAI;AACF,UAAI,KAAK,gBAAgB;AACvB,cAAM,QAAQ,KAAK,eAAe,aAAc;AAChD,YAAI,OAAO;AAET,eAAK,eAAe,UAAU;AAAA,YAC5B,MAAM;AAAA,YACN;AAAA,YACA;AAAA,UACD;AAAA,QACX,OAAe;AAEL,gBAAM,SAAS,KAAK,eAAe,UAAW;AAC9C,eAAK,eAAe,UAAU;AAAA,YAC5B;AAAA,YACA;AAAA,YACA;AAAA,UACD;AAAA,QACX;AAEQ,YAAI,KAAK,QAAQ,OAAO;AACtB,kBAAQ,IAAI,8CAA8C;AAAA,QACpE;AAEQ,eAAO;AAAA,MACf;AAAA,IACK,SAAQ,OAAO;AACd,cAAQ,MAAM,2CAA2C,KAAK;AAAA,IACpE;AAEI,WAAO;AAAA,EACX;AAAA;AAAA;AAAA;AAAA;AAAA,EAME,gBAAgB;AACd,WAAO,KAAK,gBAAgB,KAAK,mBAAmB;AAAA,EACxD;AACA;AAQO,SAAS,mBAAmB,UAAU,UAAU,IAAI;AACzD,SAAO,IAAI,aAAa,UAAU,OAAO;AAC3C;AClPO,MAAM,cAAc;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAMzB,YAAY,UAAU,UAAU,IAAI;AAClC,SAAK,WAAW;AAChB,SAAK,UAAU;AAAA,MACb,OAAO,QAAQ,SAAS;AAAA,MACxB,aAAa,QAAQ,eAAe;AAAA,MACpC,GAAG;AAAA,IACJ;AAED,SAAK,iBAAiB;AACtB,SAAK,eAAe;AAGpB,SAAK,oBAAqB;AAAA,EAC9B;AAAA;AAAA;AAAA;AAAA;AAAA,EAME,sBAAsB;AACpB,QAAI;AAEF,UAAI,OAAO,OAAO,mBAAmB,aAAa;AAChD,aAAK,iBAAiB,OAAO;AAC7B,aAAK,eAAe;AAEpB,YAAI,KAAK,QAAQ,OAAO;AACtB,kBAAQ;AAAA,YACN;AAAA,UACD;AAAA,QACX;AAEQ,eAAO;AAAA,MACf;AAGM,YAAM,gBAAgB,SAAS,eAAe,KAAK,QAAQ;AAC3D,UAAI,iBAAiB,cAAc,cAAc;AAC/C,aAAK,iBAAiB,cAAc;AACpC,aAAK,eAAe;AAEpB,YAAI,KAAK,QAAQ,OAAO;AACtB,kBAAQ;AAAA,YACN;AAAA,UACD;AAAA,QACX;AAEQ,eAAO;AAAA,MACf;AAGM,YAAM,kBAAkB,SAAS;AAAA,QAC/B,gBAAgB,KAAK,QAAQ;AAAA,MAC9B;AACD,UAAI,iBAAiB;AAEnB,cAAMC,iBAAgB,gBAAgB;AAAA,UACpC;AAAA,QACD;AACD,YACEA,kBACAA,eAAc,WAAW,cAAc,aAAa,GACpD;AACA,gBAAM,cAAc,OAAO,KAAK,MAAM,EAAE;AAAA,YACtC,CAAC,QACC,IAAI,WAAW,KAAK,KACpB,OAAO,GAAG,KACV,OAAO,OAAO,GAAG,MAAM,YACvB,OAAO,GAAG,EAAE;AAAA,UACf;AAED,cAAI,aAAa;AACf,iBAAK,iBAAiB,OAAO,WAAW;AACxC,iBAAK,eAAe;AAEpB,gBAAI,KAAK,QAAQ,OAAO;AACtB,sBAAQ;AAAA,gBACN;AAAA,cACD;AAAA,YACf;AAEY,mBAAO;AAAA,UACnB;AAAA,QACA;AAAA,MACA;AAEM,UAAI,KAAK,QAAQ,OAAO;AACtB,gBAAQ;AAAA,UACN,kDAAkD,KAAK,QAAQ;AAAA,QAChE;AAAA,MACT;AAEM,aAAO;AAAA,IACR,SAAQ,OAAO;AACd,cAAQ,MAAM,kDAAkD,KAAK;AACrE,aAAO;AAAA,IACb;AAAA,EACA;AAAA;AAAA;AAAA;AAAA;AAAA,EAME,MAAM,gBAAgB;AACpB,QAAI,KAAK,gBAAgB,KAAK,gBAAgB;AAC5C,aAAO;AAAA,IACb;AAEI,WAAO,IAAI,QAAQ,CAAC,YAAY;AAE9B,UAAI,KAAK,uBAAuB;AAC9B,gBAAQ,IAAI;AACZ;AAAA,MACR;AAGM,YAAM,YAAY,KAAK,IAAK;AAC5B,YAAM,gBAAgB,YAAY,MAAM;AACtC,YAAI,KAAK,uBAAuB;AAC9B,wBAAc,aAAa;AAC3B,kBAAQ,IAAI;AACZ;AAAA,QACV;AAGQ,YAAI,KAAK,IAAK,IAAG,YAAY,KAAK,QAAQ,aAAa;AACrD,wBAAc,aAAa;AAC3B,kBAAQ;AAAA,YACN;AAAA,UACD;AACD,kBAAQ,KAAK;AAAA,QACvB;AAAA,MACO,GAAE,GAAG;AAAA,IACZ,CAAK;AAAA,EACL;AAAA;AAAA;AAAA;AAAA;AAAA,EAME,MAAM,aAAa;AACjB,UAAM,KAAK,cAAe;AAE1B,QAAI;AACF,UAAI,KAAK,gBAAgB;AAEvB,cAAM,UAAU,KAAK,eAAe,KAAK,IAAK;AAE9C,YAAI,KAAK,QAAQ,OAAO;AACtB,kBAAQ;AAAA,YACN,uCAAsC,mCAAS,WAAU,CAAC;AAAA,UAC3D;AAAA,QACX;AAEQ,eAAO,WAAW;AAAA,MAC1B;AAAA,IACK,SAAQ,OAAO;AACd,cAAQ,MAAM,0CAA0C,KAAK;AAAA,IACnE;AAGI,QAAI;AACF,YAAM,UAAU,SAAS;AAAA,QACvB,IAAI,KAAK,QAAQ;AAAA,MAClB;AACD,UAAI,SAAS;AACX,eAAO,QAAQ,aAAa;AAAA,MACpC;AAAA,IACK,SAAQ,GAAG;AACV,cAAQ,MAAM,wDAAwD,CAAC;AAAA,IAC7E;AAEI,WAAO;AAAA,EACX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOE,MAAM,WAAW,SAAS;AACxB,UAAM,KAAK,cAAe;AAE1B,QAAI;AACF,UAAI,KAAK,gBAAgB;AAEvB,aAAK,eAAe,KAAK,IAAI,OAAO;AAGpC,aAAK,eAAe,OAAO,QAAQ,gBAAgB;AAEnD,YAAI,KAAK,QAAQ,OAAO;AACtB,kBAAQ;AAAA,YACN,6CAA6C,QAAQ,MAAM;AAAA,UAC5D;AAAA,QACX;AAEQ,eAAO;AAAA,MACf;AAAA,IACK,SAAQ,OAAO;AACd,cAAQ,MAAM,0CAA0C,KAAK;AAAA,IACnE;AAGI,QAAI;AACF,YAAM,UAAU,SAAS;AAAA,QACvB,IAAI,KAAK,QAAQ;AAAA,MAClB;AACD,UAAI,SAAS;AACX,gBAAQ,YAAY;AACpB,eAAO;AAAA,MACf;AAAA,IACK,SAAQ,GAAG;AACV,cAAQ,MAAM,sDAAsD,CAAC;AAAA,IAC3E;AAEI,WAAO;AAAA,EACX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOE,MAAM,cAAc,SAAS;AAC3B,UAAM,KAAK,cAAe;AAE1B,QAAI;AACF,UAAI,KAAK,gBAAgB;AAEvB,aAAK,eAAe,KAAK,OAAO,SAAS,IAAI;AAG7C,aAAK,eAAe,OAAO,QAAQ,gBAAgB;AAEnD,YAAI,KAAK,QAAQ,OAAO;AACtB,kBAAQ,IAAI,+CAA+C;AAAA,QACrE;AAEQ,eAAO;AAAA,MACf;AAAA,IACK,SAAQ,OAAO;AACd,cAAQ,MAAM,4CAA4C,KAAK;AAAA,IACrE;AAEI,WAAO;AAAA,EACX;AAAA;AAAA;AAAA;AAAA;AAAA,EAME,gBAAgB;AACd,WAAO,KAAK,gBAAgB,KAAK,mBAAmB;AAAA,EACxD;AACA;AAQO,SAAS,oBAAoB,UAAU,UAAU,IAAI;AAC1D,SAAO,IAAI,cAAc,UAAU,OAAO;AAC5C;ACxQO,MAAM,cAAc;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOzB,YAAY,UAAU,aAAa,YAAY,UAAU,CAAA,GAAI;AAC3D,SAAK,WAAW;AAChB,SAAK,aAAa,WAAW,YAAa;AAC1C,SAAK,UAAU;AAAA,MACb,OAAO,QAAQ,SAAS;AAAA,MACxB,GAAG;AAAA,IACJ;AAGD,SAAK,mBAAmB,CAAE;AAG1B,SAAK,2BAA4B;AAAA,EACrC;AAAA;AAAA;AAAA;AAAA;AAAA,EAME,6BAA6B;AAC3B,YAAQ,KAAK,YAAU;AAAA,MACrB,KAAK;AACH,YAAI;AACF,eAAK,iBAAiB,UAAU,qBAAqB,KAAK,UAAU;AAAA,YAClE,OAAO,KAAK,QAAQ;AAAA,UAChC,CAAW;AAED,cAAI,KAAK,QAAQ,OAAO;AACtB,oBAAQ,IAAI,6CAA6C;AAAA,UACrE;AAAA,QACS,SAAQ,OAAO;AACd,kBAAQ;AAAA,YACN;AAAA,YACA;AAAA,UACD;AAAA,QACX;AACQ;AAAA,MAEF,KAAK;AACH,YAAI;AACF,eAAK,iBAAiB,WAAW,sBAAsB,KAAK,UAAU;AAAA,YACpE,OAAO,KAAK,QAAQ;AAAA,UAChC,CAAW;AAED,cAAI,KAAK,QAAQ,OAAO;AACtB,oBAAQ,IAAI,8CAA8C;AAAA,UACtE;AAAA,QACS,SAAQ,OAAO;AACd,kBAAQ;AAAA,YACN;AAAA,YACA;AAAA,UACD;AAAA,QACX;AACQ;AAAA,MAEF,KAAK;AACH,YAAI;AACF,eAAK,iBAAiB,QAAQ,mBAAmB,KAAK,UAAU;AAAA,YAC9D,OAAO,KAAK,QAAQ;AAAA,UAChC,CAAW;AAED,cAAI,KAAK,QAAQ,OAAO;AACtB,oBAAQ,IAAI,2CAA2C;AAAA,UACnE;AAAA,QACS,SAAQ,OAAO;AACd,kBAAQ;AAAA,YACN;AAAA,YACA;AAAA,UACD;AAAA,QACX;AACQ;AAAA,MAEF,KAAK;AACH,YAAI;AACF,eAAK,iBAAiB,SAAS,oBAAoB,KAAK,UAAU;AAAA,YAChE,OAAO,KAAK,QAAQ;AAAA,UAChC,CAAW;AAED,cAAI,KAAK,QAAQ,OAAO;AACtB,oBAAQ,IAAI,4CAA4C;AAAA,UACpE;AAAA,QACS,SAAQ,OAAO;AACd,kBAAQ;AAAA,YACN;AAAA,YACA;AAAA,UACD;AAAA,QACX;AACQ;AAAA;AAAA,MAIF;AACE,YAAI,KAAK,QAAQ,OAAO;AACtB,kBAAQ;AAAA,YACN,4DAA4D,KAAK,UAAU;AAAA,UAC5E;AAAA,QACX;AACQ;AAAA,IACR;AAAA,EACA;AAAA;AAAA;AAAA;AAAA;AAAA,EAME,aAAa;AACX,QAAI;AACF,cAAQ,KAAK,YAAU;AAAA,QACrB,KAAK;AAEH,cAAI,KAAK,iBAAiB,SAAS;AACjC,mBAAO,KAAK,iBAAiB,QAAQ,WAAY,KAAI;AAAA,UACjE;AAGU,cAAI,OAAO,YAAY,aAAa;AAClC,kBAAM,SAAS,QAAQ,IAAI,KAAK,QAAQ;AACxC,gBAAI,QAAQ;AACV,qBAAO,OAAO,WAAU,KAAM;AAAA,YAC5C;AAAA,UACA;AAEU,kBAAQ,KAAK,kDAAkD;AAC/D,iBAAO;AAAA,QAET,KAAK;AAEH,cAAI,KAAK,iBAAiB,UAAU;AAClC,mBAAO,KAAK,iBAAiB,SAAS,WAAY,KAAI;AAAA,UAClE;AAGU,cAAI,OAAO,aAAa,aAAa;AACnC,kBAAM,SAAS,SAAS,UAAU,KAAK,QAAQ;AAC/C,gBAAI,QAAQ;AACV,qBAAO,OAAO,QAAO,KAAM;AAAA,YACzC;AAAA,UACA;AAEU,kBAAQ,KAAK,mDAAmD;AAChE,iBAAO;AAAA,QAET,KAAK;AAEH,cAAI,KAAK,iBAAiB,OAAO;AAC/B,mBAAO,KAAK,iBAAiB,MAAM,WAAY,KAAI;AAAA,UAC/D;AAGU,gBAAM,eAAe,SAAS,cAAc,IAAI,KAAK,QAAQ,EAAE;AAC/D,cAAI,gBAAgB,aAAa,SAAS;AACxC,mBAAO,aAAa,QAAQ,KAAK,aAAa;AAAA,UAC1D;AAEU,kBAAQ,KAAK,gDAAgD;AAC7D,iBAAO;AAAA,QAET,KAAK;AAEH,cAAI,KAAK,iBAAiB,QAAQ;AAChC,mBAAO,KAAK,iBAAiB,OAAO,WAAY,KAAI;AAAA,UAChE;AAGU,cAAI,OAAO,OAAO,mBAAmB,aAAa;AAChD,mBAAO,OAAO,eAAe,KAAK,IAAK,KAAI;AAAA,UACvD;AAGU,gBAAM,gBAAgB,SAAS;AAAA,YAC7B,IAAI,KAAK,QAAQ;AAAA,UAClB;AACD,cAAI,eAAe;AACjB,mBAAO,cAAc,aAAa;AAAA,UAC9C;AAEU,kBAAQ,KAAK,iDAAiD;AAC9D,iBAAO;AAAA,QAET,KAAK;AAAA,QACL;AAEE,gBAAM,UAAU,SAAS,eAAe,KAAK,QAAQ;AACrD,cAAI,SAAS;AACX,gBAAI,QAAQ,QAAQ,YAAW,MAAO,YAAY;AAChD,qBAAO,QAAQ,SAAS;AAAA,YACtC,OAAmB;AACL,qBAAO,QAAQ,aAAa;AAAA,YAC1C;AAAA,UACA;AAEU,kBAAQ,KAAK,sCAAsC,KAAK,QAAQ;AAChE,iBAAO;AAAA,MACjB;AAAA,IACK,SAAQ,OAAO;AACd,cAAQ,MAAM,0CAA0C,KAAK;AAC7D,aAAO;AAAA,IACb;AAAA,EACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOE,WAAW,SAAS;AAClB,QAAI;AACF,cAAQ,KAAK,YAAU;AAAA,QACrB,KAAK;AAEH,cAAI,KAAK,iBAAiB,SAAS;AACjC,mBAAO,KAAK,iBAAiB,QAAQ,WAAW,OAAO;AAAA,UACnE;AAGU,cAAI,OAAO,YAAY,aAAa;AAClC,kBAAM,SAAS,QAAQ,IAAI,KAAK,QAAQ;AACxC,gBAAI,QAAQ;AACV,qBAAO,WAAW,OAAO;AACzB,qBAAO;AAAA,YACrB;AAAA,UACA;AAEU,kBAAQ,KAAK,kDAAkD;AAC/D,iBAAO;AAAA,QAET,KAAK;AAEH,cAAI,KAAK,iBAAiB,UAAU;AAClC,mBAAO,KAAK,iBAAiB,SAAS,WAAW,OAAO;AAAA,UACpE;AAGU,cAAI,OAAO,aAAa,aAAa;AACnC,kBAAM,SAAS,SAAS,UAAU,KAAK,QAAQ;AAC/C,gBAAI,QAAQ;AACV,qBAAO,QAAQ,OAAO;AACtB,qBAAO;AAAA,YACrB;AAAA,UACA;AAEU,kBAAQ,KAAK,mDAAmD;AAChE,iBAAO;AAAA,QAET,KAAK;AAEH,cAAI,KAAK,iBAAiB,OAAO;AAC/B,mBAAO,KAAK,iBAAiB,MAAM,WAAW,OAAO;AAAA,UACjE;AAGU,gBAAM,eAAe,SAAS,cAAc,IAAI,KAAK,QAAQ,EAAE;AAC/D,cAAI,gBAAgB,aAAa,SAAS;AACxC,yBAAa,QAAQ,KAAK,YAAY;AACtC,mBAAO;AAAA,UACnB;AAEU,kBAAQ,KAAK,gDAAgD;AAC7D,iBAAO;AAAA,QAET,KAAK;AAEH,cAAI,KAAK,iBAAiB,QAAQ;AAChC,mBAAO,KAAK,iBAAiB,OAAO,WAAW,OAAO;AAAA,UAClE;AAGU,cAAI,OAAO,OAAO,mBAAmB,aAAa;AAChD,mBAAO,eAAe,KAAK,IAAI,OAAO;AACtC,mBAAO,eAAe,OAAO,QAAQ,gBAAgB;AACrD,mBAAO;AAAA,UACnB;AAGU,gBAAM,gBAAgB,SAAS;AAAA,YAC7B,IAAI,KAAK,QAAQ;AAAA,UAClB;AACD,cAAI,eAAe;AACjB,0BAAc,YAAY;AAC1B,mBAAO;AAAA,UACnB;AAEU,kBAAQ,KAAK,iDAAiD;AAC9D,iBAAO;AAAA,QAET,KAAK;AAAA,QACL;AAEE,gBAAM,UAAU,SAAS,eAAe,KAAK,QAAQ;AACrD,cAAI,SAAS;AACX,gBAAI,QAAQ,QAAQ,YAAW,MAAO,YAAY;AAChD,sBAAQ,QAAQ;AAAA,YAC9B,OAAmB;AACL,sBAAQ,YAAY;AAAA,YAClC;AACY,mBAAO;AAAA,UACnB;AAEU,kBAAQ,KAAK,sCAAsC,KAAK,QAAQ;AAChE,iBAAO;AAAA,MACjB;AAAA,IACK,SAAQ,OAAO;AACd,cAAQ,MAAM,0CAA0C,KAAK;AAC7D,aAAO;AAAA,IACb;AAAA,EACA;AACA;ACrUO,MAAM,qBAAqB,CAAC,YAAY;AAC7C,SAAO;AAAA,IACL,MAAM,CAAC,WAAW,WAAW;AAC3B,YAAM,QAAQ,IAAI,YAAY,WAAW;AAAA,QACvC;AAAA,QACA,SAAS;AAAA,QACT,UAAU;AAAA,MAClB,CAAO;AACD,cAAQ,cAAc,KAAK;AAAA,IAC5B;AAAA,IACD,IAAI,CAAC,WAAW,YAAY;AAC1B,cAAQ,iBAAiB,WAAW,OAAO;AAC3C,aAAO,MAAM,QAAQ,oBAAoB,WAAW,OAAO;AAAA,IAC5D;AAAA,IACD,KAAK,CAAC,WAAW,YAAY;AAC3B,cAAQ,oBAAoB,WAAW,OAAO;AAAA,IAC/C;AAAA,EACF;AACH;AClBO,SAAS,qBAAqB,WAAW,iBAAiB;AAC/D,MAAI,CAAC,WAAW;AACd,YAAQ;AAAA,MACN;AAAA,IACD;AACD,WAAO;AAAA,EACX;AAEE,MAAI,CAAC,iBAAiB;AACpB,YAAQ;AAAA,MACN;AAAA,IACD;AACD,WAAO;AAAA,EACX;AAEE,UAAQ,IAAI,2CAA2C;AAAA,IACrD,kBAAkB,UAAU;AAAA,IAC5B,uBAAuB,gBAAgB;AAAA,EAC3C,CAAG;AAGD,MAAI,UAAU,YAAY;AACxB,YAAQ,IAAI,8DAA8D;AAG1E,WAAO,UAAU,WAAW,YAAY;AACtC,gBAAU,WAAW,YAAY,UAAU,WAAW,UAAU;AAAA,IACtE;AAAA,EACA,OAAS;AAEL,QAAI;AACF,gBAAU,aAAa,EAAE,MAAM,OAAM,CAAE;AACvC,cAAQ,IAAI,uBAAuB,CAAC,CAAC,UAAU,UAAU;AAAA,IAC1D,SAAQ,OAAO;AACd,cAAQ,MAAM,8BAA8B,KAAK;AACjD,aAAO;AAAA,IACb;AAAA,EACA;AAEE,MAAI;AAEF,UAAM,WAAW,SAAS,cAAc,UAAU;AAClD,aAAS,YAAY;AACrB,YAAQ;AAAA,MACN;AAAA,MACA,SAAS,UAAU;AAAA,IACpB;AAGD,UAAM,UAAU,SAAS,QAAQ,UAAU,IAAI;AAC/C,YAAQ,IAAI,sBAAsB;AAAA,MAChC,YAAY,CAAC,CAAC;AAAA,MACd,YAAY,QAAQ,WAAW;AAAA,IACrC,CAAK;AAGD,cAAU,WAAW,YAAY,OAAO;AACxC,YAAQ,IAAI,mCAAmC;AAG/C,UAAM,WAAW;AAAA,MACf,cAAc,UAAU,WAAW,cAAc,gBAAgB;AAAA,MACjE,OAAO,UAAU,WAAW,cAAc,QAAQ;AAAA,MAClD,WAAW,UAAU,WAAW,cAAc,YAAY;AAAA,MAC1D,eAAe,UAAU,WAAW,cAAc,iBAAiB;AAAA,MACnE,iBAAiB,UAAU,WAAW,cAAc,kBAAkB;AAAA,IACvE;AAED,YAAQ,IAAI,2BAA2B;AAAA,MACrC,iBAAiB,CAAC,CAAC,SAAS;AAAA,MAC5B,UAAU,CAAC,CAAC,SAAS;AAAA,MACrB,cAAc,CAAC,CAAC,SAAS;AAAA,MACzB,kBAAkB,CAAC,CAAC,SAAS;AAAA,MAC7B,oBAAoB,CAAC,CAAC,SAAS;AAAA,IACrC,CAAK;AAED,WAAO,UAAU;AAAA,EAClB,SAAQ,OAAO;AACd,YAAQ,MAAM,8BAA8B,KAAK;AACjD,WAAO;AAAA,EACX;AACA;AC/EO,MAAM,oBAAoB;AAAA,EAC/B,YAAY,WAAW;AACrB,QAAI,CAAC,WAAW;AACd,cAAQ,MAAM,uDAAuD;AACrE,WAAK,YAAY;AACjB;AAAA,IACN;AAGI,QAAI,UAAU,YAAY;AAExB,WAAK,YAAY,UAAU,WAAW;AAAA,QACpC;AAAA,MACD;AAGD,UAAI,CAAC,KAAK,WAAW;AACnB,aAAK,YAAY,SAAS,cAAc,KAAK;AAC7C,aAAK,UAAU,YAAY;AAC3B,kBAAU,WAAW,YAAY,KAAK,SAAS;AAAA,MACvD;AAAA,IACA,OAAW;AAEL,WAAK,YAAY;AAAA,IACvB;AAEI,SAAK,gBAAgB,oBAAI,IAAK;AAC9B,YAAQ;AAAA,MACN;AAAA,MACA,KAAK;AAAA,IACN;AAAA,EACL;AAAA,EAEE,KAAK,SAAS,OAAO,QAAQ,WAAW,KAAM;AAC5C,QAAI,CAAC,KAAK,WAAW;AACnB,cAAQ;AAAA,QACN;AAAA,MACD;AAED,cAAQ,IAAI,IAAI,KAAK,aAAa,KAAK,OAAO,EAAE;AAChD,aAAO;AAAA,IACb;AAEI,QAAI;AACF,YAAM,eAAe,SAAS,cAAc,KAAK;AACjD,mBAAa,YAAY,mBAAmB,IAAI;AAChD,mBAAa,aAAa,QAAQ,OAAO;AAGzC,YAAM,OAAO,KAAK,eAAe,IAAI;AAErC,mBAAa,YAAY;AAAA,UACrB,IAAI;AAAA,4CAC8B,OAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAS7C,YAAM,QAAQ,MAAM;AAClB,qBAAa,MAAM,YAAY;AAC/B,mBAAW,MAAM;AACf,cAAI,aAAa,YAAY;AAC3B,yBAAa,OAAQ;AAAA,UACjC;AACU,eAAK,cAAc,OAAO,YAAY;AAAA,QACvC,GAAE,GAAG;AAAA,MACP;AAGD,YAAM,cAAc,aAAa,cAAc,qBAAqB;AACpE,UAAI,aAAa;AACf,oBAAY,UAAU;AAAA,MAC9B;AAGM,UAAI,WAAW,GAAG;AAChB,mBAAW,OAAO,QAAQ;AAAA,MAClC;AAGM,WAAK,UAAU,YAAY,YAAY;AACvC,WAAK,cAAc,IAAI,YAAY;AAEnC,cAAQ,IAAI,gDAAgD,IAAI,EAAE;AAGlE,WAAK,wBAAyB;AAE9B,aAAO;AAAA,IACR,SAAQ,OAAO;AACd,cAAQ;AAAA,QACN;AAAA,QACA;AAAA,MACD;AACD,aAAO;AAAA,IACb;AAAA,EACA;AAAA;AAAA,EAGE,MAAM,SAAS,WAAW,KAAM;AAC9B,WAAO,KAAK,KAAK,SAAS,SAAS,QAAQ;AAAA,EAC/C;AAAA,EAEE,QAAQ,SAAS,WAAW,KAAM;AAChC,WAAO,KAAK,KAAK,SAAS,WAAW,QAAQ;AAAA,EACjD;AAAA,EAEE,KAAK,SAAS,WAAW,KAAM;AAC7B,WAAO,KAAK,KAAK,SAAS,QAAQ,QAAQ;AAAA,EAC9C;AAAA,EAEE,QAAQ,SAAS,WAAW,KAAM;AAChC,WAAO,KAAK,KAAK,SAAS,WAAW,QAAQ;AAAA,EACjD;AAAA;AAAA,EAGE,wBAAwB,mBAAmB,GAAG;AAC5C,UAAM,qBAAqB,MAAM,KAAK,KAAK,aAAa;AAExD,QAAI,mBAAmB,SAAS,kBAAkB;AAEhD,YAAM,mBAAmB,mBAAmB;AAAA,QAC1C;AAAA,QACA,mBAAmB,SAAS;AAAA,MAC7B;AAED,uBAAiB,QAAQ,CAAC,iBAAiB;AACzC,YAAI,aAAa,YAAY;AAC3B,uBAAa,OAAQ;AAAA,QAC/B;AACQ,aAAK,cAAc,OAAO,YAAY;AAAA,MAC9C,CAAO;AAAA,IACP;AAAA,EACA;AAAA;AAAA,EAGE,eAAe,MAAM;AACnB,YAAQ,MAAI;AAAA,MACV,KAAK;AACH,eAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAOT,KAAK;AACH,eAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAOT,KAAK;AACH,eAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAMT,KAAK;AAAA,MACL;AACE,eAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAOf;AAAA,EACA;AAAA;AAAA,EAGE,WAAW;AACT,SAAK,cAAc,QAAQ,CAAC,iBAAiB;AAC3C,UAAI,aAAa,YAAY;AAC3B,qBAAa,OAAQ;AAAA,MAC7B;AAAA,IACA,CAAK;AACD,SAAK,cAAc,MAAO;AAAA,EAC9B;AACA;AAGO,SAAS,0BAA0B,WAAW;AACnD,SAAO,IAAI,oBAAoB,SAAS;AAC1C;ACjMO,SAAS,wBAAwB,WAAW;AACjD,WAAS,iBAAiB,WAAW,UAAU,eAAe,KAAK,SAAS,CAAC;AAE7E,QAAM,QAAQ,UAAU,WAAW,cAAc,QAAQ;AACzD,MAAI,OAAO;AACT,UAAM,iBAAiB,WAAW,UAAU,oBAAoB,KAAK,SAAS,CAAC;AAAA,EACnF;AACA;AAEO,MAAM,0BAA0B;AAAA,EACrC,eAAe,OAAO;AACpB,QAAI,MAAM,WAAW,MAAM,SAAS;AAClC,cAAO,MAAM,IAAI,YAAa,GAAA;AAAA,QAC5B,KAAK;AACH,gBAAM,eAAgB;AACtB,eAAK,WAAW,cAAc,gBAAgB,EAAE,MAAO;AACvD;AAAA,QACF,KAAK;AACH,gBAAM,eAAgB;AACtB,cAAI,KAAK,eAAe;AACtB,iBAAK,iBAAiB,SAAS;AAAA,UAC3C;AACU;AAAA,QACF,KAAK;AACH,gBAAM,eAAgB;AACtB,cAAI,KAAK,eAAe;AACtB,iBAAK,iBAAiB,WAAW;AAAA,UAC7C;AACU;AAAA,MACV;AAAA,IACA;AAAA,EACG;AAAA,EAED,oBAAoB,OAAO;AACzB,QAAI,CAAC,KAAK,cAAe;AAEzB,YAAQ,MAAM,KAAG;AAAA,MACf,KAAK;AACH,aAAK,WAAW,cAAc,eAAe,EAAE,MAAO;AACtD;AAAA,MACF,KAAK;AACH,aAAK,oBAAoB,KAAK;AAC9B;AAAA,MACF,KAAK;AAAA,MACL,KAAK;AACH,YAAI,MAAM,OAAO,QAAQ,kBAAkB,GAAG;AAC5C,eAAK,qBAAqB,KAAK;AAAA,QACzC;AACQ;AAAA,IACR;AAAA,EACG;AAAA,EAED,oBAAoB,OAAO;AACzB,UAAM,QAAQ,KAAK,WAAW,cAAc,QAAQ;AACpD,UAAM,oBAAoB,MAAM;AAAA,MAC9B;AAAA,IACD;AACD,UAAM,iBAAiB,kBAAkB,CAAC;AAC1C,UAAM,gBAAgB,kBAAkB,kBAAkB,SAAS,CAAC;AAEpE,QAAI,MAAM,UAAU;AAClB,UAAI,SAAS,kBAAkB,gBAAgB;AAC7C,cAAM,eAAgB;AACtB,sBAAc,MAAO;AAAA,MAC7B;AAAA,IACA,OAAW;AACL,UAAI,SAAS,kBAAkB,eAAe;AAC5C,cAAM,eAAgB;AACtB,uBAAe,MAAO;AAAA,MAC9B;AAAA,IACA;AAAA,EACG;AAAA,EAED,qBAAqB,OAAO;AAC1B,UAAM,UAAU,KAAK,WAAW,cAAc,YAAY;AAC1D,UAAM,QAAQ,QAAQ,WAAW,iBAAiB,cAAc;AAChE,UAAM,cAAc,QAAQ,WAAW,cAAc,oBAAoB;AAEzE,QAAI,CAAC,YAAa;AAElB,UAAM,eAAe,MAAM,KAAK,KAAK,EAAE,QAAQ,WAAW;AAC1D,QAAI;AAEJ,QAAI,MAAM,QAAQ,cAAc;AAC9B,mBAAa,eAAe,KAAK,MAAM;AAAA,IAC7C,OAAW;AACL,mBAAa,eAAe,IAAI,MAAM,UAAU,MAAM;AAAA,IAC5D;AAEI,UAAM,SAAS,EAAE,MAAO;AACxB,UAAM,eAAgB;AAAA,EAC1B;AACA;AC5FO,MAAM,uBAAuB;AAAA;AAAA;AAAA;AAAA;AAAA,EAKlC,mBAAmB,OAAO;AxBL5B;AwBMI,YAAQ,IAAI,2CAA2C,MAAM,MAAM;AACnE,UAAM,EAAE,eAAe,MAAM;AAE7B,QAAI,CAAC,YAAY;AACf,cAAQ,KAAK,yDAAyD;AACtE;AAAA,IACN;AAEI,UAAM,YAAW,UAAK,oBAAL,mBAAsB,YAAY;AACnD,QAAI,CAAC,UAAU;AACb,cAAQ,KAAK,gDAAgD,UAAU;AACvE;AAAA,IACN;AAEI,cAAU,UACP,UAAU,SAAS,OAAO,EAC1B,KAAK,MAAM;AACV,cAAQ,IAAI,gDAAgD;AAG5D,UAAI,KAAK,qBAAqB;AAC5B,aAAK,oBAAoB,QAAQ,+BAA+B,GAAI;AAAA,MAC9E;AAAA,IACO,CAAA,EACA,MAAM,CAAC,QAAQ;AACd,cAAQ,MAAM,mCAAmC,GAAG;AAGpD,UAAI,KAAK,qBAAqB;AAC5B,aAAK,oBAAoB,MAAM,6BAA6B;AAAA,MACtE;AAAA,IACA,CAAO;AAAA,EACJ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOD,kBAAkB,OAAO;AxB7C3B;AwB8CI,QAAI;AACF,cAAQ,IAAI,0CAA0C,MAAM,MAAM;AAGlE,UAAI,CAAC,MAAM,UAAU,CAAC,MAAM,OAAO,YAAY;AAC7C,gBAAQ,KAAK,0CAA0C,MAAM,MAAM;AACnE,cAAM,IAAI,MAAM,uBAAuB;AAAA,MAC/C;AAEM,YAAM,EAAE,eAAe,MAAM;AAG7B,UAAI,CAAC,KAAK,iBAAiB;AACzB,gBAAQ,MAAM,kDAAkD;AAChE,cAAM,IAAI,MAAM,gCAAgC;AAAA,MACxD;AAEM,YAAM,WAAW,KAAK,gBAAgB,YAAY,UAAU;AAE5D,UAAI,CAAC,UAAU;AACb,gBAAQ,KAAK,gDAAgD,UAAU;AACvE,cAAM,IAAI,MAAM,oBAAoB;AAAA,MAC5C;AAGM,UAAI,CAAC,SAAS,WAAW,OAAO,SAAS,YAAY,YAAY,SAAS,QAAQ,KAAI,MAAO,IAAI;AAC/F,gBAAQ,KAAK,iDAAiD,UAAU;AACxE,cAAM,IAAI,MAAM,2BAA2B;AAAA,MACnD;AAGM,UAAI,kBAAkB,SAAS;AAC/B,UAAI,KAAK,mBAAmB,CAAC,WAAW,YAAY,QAAQ,EAAE,UAAS,UAAK,kBAAL,mBAAoB,UAAU,GAAG;AACtG,0BAAkB,KAAK,gBAAgB,QAAQ,SAAS,OAAO;AAC/D,gBAAQ,IAAI,iEAAiE;AAAA,MACrF;AAGM,UAAI,OAAO,WAAW,KAAK,YAAY,QAAQ,IAAI,KAAK,QAAQ,GAAG;AACjE,cAAM,SAAS,QAAQ,IAAI,KAAK,QAAQ;AACxC,YAAI,UAAU,OAAO,aAAa;AAChC,iBAAO,WAAW,eAAe;AACjC,iBAAO,YAAY,IAAK;AACxB,kBAAQ,IAAI,wDAAwD;AAGpE,qBAAW,MAAM;AACf,kBAAM,QAAQ,KAAK,WAAW,cAAc,QAAQ;AACpD,gBAAI,OAAO;AACT,oBAAM,UAAU,OAAO,MAAM;AAAA,YAC3C;AAAA,UACW,GAAE,GAAG;AAEN,iBAAO;AAAA,QACjB;AAAA,MACA;AAGM,UAAI,KAAK,eAAe;AACtB,gBAAQ,IAAI,wDAAwD;AAGpE,cAAM,UAAU,KAAK,cAAc,WAAW,eAAe;AAE7D,YAAI,SAAS;AACX,kBAAQ,IAAI,uDAAuD;AAGnE,eAAK;AAAA,YACH,IAAI,YAAY,wBAAwB;AAAA,cACtC,QAAQ,EAAE,SAAS,gBAAiB;AAAA,cACpC,SAAS;AAAA,cACT,UAAU;AAAA,YACX,CAAA;AAAA,UACF;AAGD,gBAAM,QAAQ,KAAK,WAAW,cAAc,QAAQ;AACpD,cAAI,OAAO;AACT,kBAAM,UAAU,OAAO,MAAM;AAAA,UACzC;AAGU,cAAI,KAAK,qBAAqB;AAC5B,iBAAK,oBAAoB,QAAQ,8BAA8B;AAAA,UAC3E;AAEU,iBAAO;AAAA,QACjB,OAAe;AACL,kBAAQ,MAAM,sDAAsD;AACpE,gBAAM,IAAI,MAAM,mCAAmC;AAAA,QAC7D;AAAA,MACA,OAAa;AACL,gBAAQ,MAAM,gDAAgD;AAC9D,cAAM,IAAI,MAAM,qBAAqB;AAAA,MAC7C;AAAA,IACK,SAAQ,OAAO;AACd,cAAQ,MAAM,kDAAkD,KAAK;AAErE,UAAI,KAAK,qBAAqB;AAC5B,aAAK,oBAAoB,MAAM,UAAU,MAAM,OAAO,EAAE;AAAA,MAChE;AAEM,aAAO;AAAA,IACb;AAAA,EACG;AAAA;AAAA;AAAA;AAAA;AAAA,EAMD,oBAAoB,OAAO;AxB7J7B;AwB8JI,YAAQ,IAAI,4CAA4C,MAAM,MAAM;AACpE,UAAM,EAAE,YAAY,OAAQ,IAAG,MAAM;AAErC,QAAI,CAAC,YAAY;AACf,cAAQ,KAAK,0DAA0D;AACvE;AAAA,IACN;AAEI,UAAM,YAAW,UAAK,oBAAL,mBAAsB,YAAY;AACnD,QAAI,CAAC,UAAU;AACb,cAAQ,KAAK,gDAAgD,UAAU;AACvE;AAAA,IACN;AAEI,YAAQ,IAAI,uCAAuC,SAAS,MAAM;AAGlE,UAAM,iBAAiB;AAAA,MACrB,QAAQ;AAAA,QACN,QAAQ,UAAU,SAAS;AAAA,QAC3B;AAAA,QACA,SAAS,SAAS;AAAA,MACnB;AAAA,IACF;AAGD,SAAK,iBAAiB,cAAc;AAAA,EACrC;AAAA;AAAA;AAAA;AAAA;AAAA,EAMD,mBAAmB,OAAO;AxB/L5B;AwBgMI,YAAQ,IAAI,2CAA2C,MAAM,MAAM;AACnE,UAAM,EAAE,eAAe,MAAM;AAE7B,QAAI,CAAC,YAAY;AACf,cAAQ,KAAK,yDAAyD;AACtE;AAAA,IACN;AAEI,UAAM,YAAW,UAAK,oBAAL,mBAAsB,YAAY;AACnD,QAAI,CAAC,UAAU;AACb,cAAQ,KAAK,gDAAgD,UAAU;AACvE;AAAA,IACN;AAII,YAAQ,IAAI,6DAA6D;AAGzE,QAAI,KAAK,qBAAqB;AAC5B,WAAK,oBAAoB,KAAK,gCAAgC;AAAA,IACpE;AAAA,EACG;AACH;ACrNO,MAAM,oBAAoB;AAAA,EAC/B,YAAY,OAAO;AACjB,QAAI,CAAC,KAAK,gBAAiB,QAAO;AAElC,UAAM,UAAU,iBAAiB,OAAO,MAAM,OAAO;AACrD,WAAO,KAAK,gBAAgB,UAAU;AAAA,MACpC,CAAC,aACC,SAAS,WAAW,kBAAkB,SAAS,cAAc;AAAA,IAChE;AAAA,EACF;AAAA,EAED,kBAAkB,MAAM;AACtB,QAAI,MAAM;AACR,WAAK,eAAe;AACpB,WAAK,kBAAkB;AAGvB,YAAM,eAAe,KAAK,gBAAgB,UAAU;AAAA,QAClD,CAAC,aAAa,SAAS,WAAW;AAAA,MACnC;AAED,UAAI,cAAc;AAEhB,cAAM,mBAAmB,KAAK,mBAAmB,IAAI;AAGrD,cAAM,gBAAgB,KAAK,WAAW;AAAA,UACpC,qCAAqC,aAAa,EAAE;AAAA,QACrD;AAED,YAAI,eAAe;AACjB,gBAAM,kBACJ,cAAc,cAAc,mBAAmB;AACjD,cAAI,iBAAiB;AAEnB,4BAAgB,mBAAmB,aAAa,gBAAgB;AAAA,UAC5E;AAAA,QACA;AAGQ,cAAM,qBAAqB,KAAK,WAAW;AAAA,UACzC;AAAA,QACD;AACD,2BAAmB,QAAQ,CAAC,UAAU,MAAM,OAAM,CAAE;AAGpD,aAAK,gBAAgB,YAAY,KAAK,gBAAgB,UAAU;AAAA,UAC9D,CAAC,aAAa,SAAS,WAAW;AAAA,QACnC;AAAA,MACT;AAAA,IACA;AAAA,EACG;AAAA,EAED,cAAc;AACZ,QAAI,KAAK,gBAAgB,KAAK,iBAAiB;AAC7C,WAAK,eAAe;AACpB,WAAK,kBAAkB;AAGvB,YAAM,eAAe,KAAK,gBAAgB,UAAU;AAAA,QAClD,CAAC,aAAa,SAAS,WAAW;AAAA,MACnC;AAED,UAAI,cAAc;AAEhB,qBAAa,UAAU,aAAa,QAAQ;AAAA,UAC1C;AAAA,UACA;AAAA,QACD;AAID,YAAI,KAAK,iBAAiB;AACxB,eAAK,gBAAgB,OAAQ;AAAA,QACvC;AAAA,MACA;AAAA,IACA;AAAA,EACG;AAAA,EAED,mBAAmB,QAAQ,MAAM,YAAY,OAAO;AAClD,UAAM,gBAAgB,SAAS,KAAK,gBAAgB,KAAK;AACzD,QAAI,CAAC,cAAe,QAAO;AAE3B,UAAM,WACJ,yBAAyB,OACrB,IAAI,gBAAgB,aAAa,IACjC;AAEN,UAAM,WACJ,yBAAyB,OACrB,cAAc,OACd,IAAI,IAAI,aAAa,EAAE,SAAS,MAAM,GAAG,EAAE,IAAG,KAAM;AAE1D,WAAO;AAAA;AAAA,4BAEiB,KAAK,KAAK;AAAA;AAAA,yBAGzB,YAAY,0BAA0B,wBACvC;AAAA;AAAA;AAAA,wBAGY,QAAQ,4BAA4B,QAAQ;AAAA;AAAA;AAAA;AAAA;AAAA,EAKjE;AACH;ACtGO,MAAM,qBAAqB,CAAC,cAAc;AAE/C,QAAM,SAAS,CAAE;AAEjB,SAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAUL,YAAY,UAAU,OAAO,UAAU,CAAA,GAAI;AACzC,YAAM,WAAW,OAAO,QAAQ;AAChC,aAAO,QAAQ,IAAI;AAGnB,gBAAU;AAAA,QACR,IAAI,YAAY,eAAe;AAAA,UAC7B,QAAQ,EAAE,UAAU,UAAU,UAAU,UAAU,MAAO;AAAA,UACzD,SAAS;AAAA,QACV,CAAA;AAAA,MACF;AAGD,UAAI,QAAQ,YAAY,UAAU,YAAY;AAC5C,YAAI,QAAQ,gBAAgB;AAE1B,gBAAM,SAAS,UAAU,WAAW;AAAA,YAClC,QAAQ;AAAA,UACT;AACD,cAAI,UAAU,OAAO,UAAU,eAAe,YAAY;AACxD,sBAAU,WAAW,QAAQ,QAAQ;AAAA,UACjD;AAAA,QACS,WAAU,OAAO,UAAU,WAAW,YAAY;AAEjD,oBAAU,OAAQ;AAAA,QAC5B;AAAA,MACA;AAEM,aAAO;AAAA,IACR;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IASD,SAAS,UAAU,eAAe,MAAM;AACtC,aAAO,YAAY,SAAS,OAAO,QAAQ,IAAI;AAAA,IAChD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAOD,cAAc;AACZ,aAAO,EAAE,GAAG,OAAQ;AAAA,IACrB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAQD,YAAY,cAAc,UAAU,IAAI;AACtC,YAAM,eAAe,CAAE;AAEvB,iBAAW,CAAC,UAAU,KAAK,KAAK,OAAO,QAAQ,YAAY,GAAG;AAC5D,cAAM,WAAW,OAAO,QAAQ;AAChC,YAAI,aAAa,OAAO;AACtB,iBAAO,QAAQ,IAAI;AACnB,uBAAa,KAAK,EAAE,UAAU,UAAU,UAAU,UAAU,OAAO;AAAA,QAC7E;AAAA,MACA;AAGM,UAAI,aAAa,SAAS,GAAG;AAC3B,kBAAU;AAAA,UACR,IAAI,YAAY,oBAAoB;AAAA,YAClC,QAAQ,EAAE,SAAS,aAAc;AAAA,YACjC,SAAS;AAAA,UACV,CAAA;AAAA,QACF;AAGD,YAAI,QAAQ,YAAY,UAAU,YAAY;AAC5C,cACE,QAAQ,kBACR,OAAO,UAAU,eAAe,YAChC;AACA,kBAAM,SAAS,UAAU,WAAW;AAAA,cAClC,QAAQ;AAAA,YACT;AACD,gBAAI,QAAQ;AACV,wBAAU;AAAA,gBACR;AAAA,gBACA,aAAa,IAAI,CAAC,MAAM,EAAE,QAAQ;AAAA,cACnC;AAAA,YACf;AAAA,UACW,WAAU,OAAO,UAAU,WAAW,YAAY;AACjD,sBAAU,OAAQ;AAAA,UAC9B;AAAA,QACA;AAAA,MACA;AAEM,aAAO,aAAa,SAAS;AAAA,IAC9B;AAAA,EACF;AACH;ACxHO,MAAM,uBAAuB;AAAA,EAClC,yBAAyB;AACvB,SAAK,eAAe,mBAAmB,IAAI;AAG3C,SAAK,iBAAiB,eAAe,KAAK,kBAAkB,KAAK,IAAI,CAAC;AACtE,SAAK;AAAA,MACH;AAAA,MACA,KAAK,uBAAuB,KAAK,IAAI;AAAA,IACtC;AAAA,EACF;AAAA,EAED,kBAAkB,OAAO;AACvB,UAAM,EAAE,UAAU,UAAU,SAAU,IAAG,MAAM;AAC/C,YAAQ;AAAA,MACN,4BAA4B,QAAQ;AAAA,MACpC;AAAA,MACA;AAAA,MACA;AAAA,IACD;AAGD,YAAQ,UAAQ;AAAA,MACd,KAAK;AACH,aAAK,yBAAyB,UAAU,QAAQ;AAChD;AAAA,MACF,KAAK;AACH,aAAK,yBAAyB,UAAU,QAAQ;AAChD;AAAA,IAER;AAAA,EACG;AAAA,EAED,uBAAuB,OAAO;AAC5B,YAAQ,IAAI,sCAAsC,MAAM,OAAO,OAAO;AAGtE,UAAM,eAAe,MAAM,OAAO,QAAQ,IAAI,CAAC,MAAM,EAAE,QAAQ;AAE/D,QAAI,aAAa,SAAS,cAAc,GAAG;AACzC,YAAM,SAAS,MAAM,OAAO,QAAQ;AAAA,QAClC,CAAC,MAAM,EAAE,aAAa;AAAA,MACvB;AACD,WAAK,yBAAyB,OAAO,UAAU,OAAO,QAAQ;AAAA,IACpE;AAAA,EAGG;AAAA,EAED,yBAAyB,UAAU,UAAU;AAE3C,QAAI,UAAU;AACZ,cAAQ,IAAI,yCAAyC,SAAS,IAAI;AAGlE,UAAI,KAAK,iBAAiB;AACxB,cAAM,eAAe,KAAK,gBAAgB,UAAU;AAAA,UAClD,CAAC,aAAa,SAAS,WAAW;AAAA,QACnC;AAED,YAAI,cAAc;AAEhB,eAAK,gBAAgB,OAAQ;AAAA,QACvC;AAAA,MACA;AAAA,IACK,WAAU,UAAU;AACnB,cAAQ,IAAI,sCAAsC;AAAA,IACxD;AAAA,EACG;AAAA,EAED,yBAAyB,SAAS,SAAS;AAEzC,YAAQ,IAAI,sCAAsC;AAAA,EACnD;AAAA;AAAA,EAGD,cAAc,SAAS,MAAM;AAC3B,YAAQ;AAAA,MACN;AAAA,MACA,UAAU;AAAA,IACX;AAED,QAAI,CAAC,QAAQ;AAEX,UAAI,KAAK,iBAAiB;AACxB,aAAK,gBAAgB,OAAQ;AAAA,MACrC;AACM,WAAK,mBAAoB;AACzB;AAAA,IACN;AAGI,YAAQ,QAAM;AAAA,MACZ,KAAK;AACH,YAAI,KAAK,iBAAiB;AACxB,eAAK,gBAAgB,OAAQ;AAAA,QACvC;AACQ;AAAA,MACF,KAAK;AACH,aAAK,mBAAoB;AACzB;AAAA,IAER;AAAA,EACG;AACH;AC3GO,MAAM,qBAAqB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ACC3B,MAAM,cAAc;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ACDpB,MAAM,qBAAqB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ACW3B,SAAS,eAAe,WAAW;AACxC,MAAI,CAAC,WAAW;AACd,YAAQ,MAAM,yDAAyD;AACvE,WAAO;AAAA,EACX;AAEE,MAAI;AACF,YAAQ;AAAA,MACN;AAAA,MACA,UAAU;AAAA,IACX;AAGD,UAAM,IAAI,UAAU,gBAAgB,CAAE;AAGtC,UAAM,iBACJ,OAAO,UAAU,mBAAmB,aAChC,UAAU,eAAc,IACxB,UAAU,kBAAkB;AAElC,UAAM,UAAU,UAAU,WAAW;AAErC,UAAM,aAAa,SAAQ,iDAAgB,SAAQ,eAAe,MAAM;AACxE,UAAM,aAAa,SAAQ,mCAAS,SAAQ,QAAQ,MAAM;AAI1D,UAAM,cAAc,CAAC,UAAU;AAE/B,YAAQ,IAAI,2CAA2C;AAAA,MACrD;AAAA,MACA;AAAA,MACA,UAAU,UAAU,YAAY;AAAA,MAChC;AAAA;AAAA,IACN,CAAK;AAGD,WAAO;AAAA;AAAA;AAAA,QAGH,SAAS;AAAA,QACT,UAAU;AAAA,QACV,kBAAkB;AAAA,QAClB,WAAW;AAAA,QACX,aAAa;AAAA,QACb,kBAAkB;AAAA,QAClB,kBAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAsEpB,cACI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,eAYI,uBAAG,iBAAgB,iBAAiB;AAAA;AAAA,QAGxC,EACV;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,iBAOgB,uBAAG,eAAc,cAAc;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,0CAOjC,UAAU,YAAY,IACvB;AAAA;AAAA;AAAA;AAAA;AAAA,2CAK8B,UAAU,gBAAgB,UAAU,aAAa,iBAAiB,CAAC;AAAA;AAAA,0BAEpF,UAAU,YAAY,IAAI;AAAA,2BACzB,UAAU,YAAY,EAAE;AAAA,6BACtB,UAAU,eAAe,QAAQ;AAAA,gBAC9C,UAAU,gBAAgB,UAAU,aAAa,iBAAiB,IAAI,oBAAoB,UAAU,aAAa,iBAAiB,CAAC,MAAM,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAUxJ,SAAQ,OAAO;AACd,YAAQ,MAAM,4CAA4C,KAAK;AAG/D,WAAO;AAAA;AAAA,2CAEgC,MAAM,OAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAcxD;AACA;AC/KA,MAAM,uBAAuB,YAAY;AAAA,EACvC,cAAc;AACZ,UAAO;AAGP,WAAO;AAAA,MACL;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,IACD;AAGD,QAAI,CAAC,eAAe,IAAI,YAAY,GAAG;AACrC,qBAAe,OAAO,cAAc,OAAO;AAAA,IACjD;AACI,QAAI,CAAC,eAAe,IAAI,iBAAiB,GAAG;AAC1C,qBAAe,OAAO,mBAAmB,aAAa;AAAA,IAC5D;AACI,QAAI,CAAC,eAAe,IAAI,kBAAkB,GAAG;AAC3C,qBAAe,OAAO,oBAAoB,eAAe;AAAA,IAC/D;AAGI,SAAK,eAAe,mBAAmB,IAAI;AAC3C,SAAK,kBAAkB;AACvB,SAAK,gBAAgB;AACrB,SAAK,gBAAgB;AAGrB,SAAK,kBAAkB,IAAI,gBAAiB;AAC5C,SAAK,eAAe,IAAI,aAAc;AAGtC,SAAK,uBAAwB;AAG7B,SAAK,eAAe,mBAAmB;AAAA,MACrC,QAAQ;AAAA,MACR,UAAU;AAAA,MACV,KAAK,KAAK,KAAK;AAAA,IACrB,CAAK;AAGD,SAAK,aAAa,YAAY;AAAA,MAC5B,cAAc;AAAA,MACd,cAAc,CAAE;AAAA,MAChB,eAAe;AAAA,MACf,cAAc;AAAA,MACd,cAAc;AAAA,IACpB,CAAK;AAGD,SAAK,YAAa;AAAA,EAItB;AAAA,EAEE,cAAc;AhCtFhB;AgCwFI,SAAK,oBAAmB,UAAK,qBAAL,mBAAuB,KAAK;AACpD,SAAK,qBAAoB,UAAK,sBAAL,mBAAwB,KAAK;AAGtD,SAAK,sBAAqB,UAAK,uBAAL,mBAAyB,KAAK;AACxD,SAAK,qBAAoB,UAAK,sBAAL,mBAAwB,KAAK;AACtD,SAAK,uBAAsB,UAAK,wBAAL,mBAA0B,KAAK;AAC1D,SAAK,sBAAqB,UAAK,uBAAL,mBAAyB,KAAK;AAGxD,SAAK,kBAAiB,UAAK,mBAAL,mBAAqB,KAAK;AAChD,SAAK,uBAAsB,UAAK,wBAAL,mBAA0B,KAAK;AAG1D,SAAK,uBAAsB,UAAK,wBAAL,mBAA0B,KAAK;AAAA,EAC9D;AAAA;AAAA,EAGE,WAAW,qBAAqB;AAC9B,WAAO;AAAA,MACL;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA;AAAA,IACD;AAAA,EACL;AAAA,EAEE,IAAI,WAAW;AACb,WAAO,KAAK,aAAa,UAAU,KAAK;AAAA,EAC5C;AAAA,EAEE,IAAI,eAAe;AACjB,WAAO,aAAa,KAAK,QAAQ,KAAK,aAAa;AAAA,EACvD;AAAA,EAEE,IAAI,WAAW;AACb,WAAO,KAAK,aAAa,WAAW;AAAA,EACxC;AAAA,EAEE,IAAI,aAAa;AACf,WAAO,KAAK,aAAa,aAAa,KAAK;AAAA,EAC/C;AAAA,EAEE,IAAI,SAAS;AACX,WAAO,KAAK,aAAa,SAAS;AAAA,EACtC;AAAA,EAEE,IAAI,SAAS;AACX,WACE,KAAK,aAAa,QAAQ,KAC1B;AAAA,EAEN;AAAA,EAEE,IAAI,iBAAiB;AhCzJvB;AgC0JI,aAAO,UAAK,kBAAL,mBAAoB,iBAAgB;AAAA,EAC/C;AAAA,EAEE,IAAI,cAAc;AAChB,WAAO,KAAK,aAAa,cAAc,KAAK;AAAA,EAChD;AAAA,EAEE,IAAI,WAAW;AACb,WAAO,KAAK,aAAa,WAAW,KAAK;AAAA,EAC7C;AAAA,EAEE,IAAI,WAAW;AACb,WAAO,KAAK,aAAa,WAAW;AAAA,EACxC;AAAA,EAEE,IAAI,UAAU;AACZ,WAAO,KAAK,aAAa,SAAS,KAAK;AAAA,EAC3C;AAAA,EAEE,IAAI,gBAAgB;AAClB,WAAO,KAAK,aAAa,gBAAgB;AAAA,EAC7C;AAAA,EAEE,IAAI,cAAc;AAChB,WAAO,KAAK,aAAa,cAAc;AAAA,EAC3C;AAAA,EAEE,IAAI,cAAc;AAChB,WAAO,KAAK,aAAa,IAAI;AAAA,EACjC;AAAA;AAAA,EAGE,MAAM,oBAAoB;AACxB,QAAI;AACF,cAAQ,IAAI,uDAAuD;AAGnE,YAAM,WAAW,eAAe,IAAI;AACpC,2BAAqB,MAAM,QAAQ;AACnC,cAAQ,IAAI,qCAAqC;AAGjD,YAAM,yBAAyB,KAAK,WAAW;AAAA,QAC7C;AAAA,MACD;AACD,UAAI,wBAAwB;AAC1B,aAAK,sBAAsB;AAAA,UACzB;AAAA,QACD;AACD,gBAAQ,IAAI,mDAAmD;AAAA,MACvE;AAGM,WAAK,kBAAmB;AAGxB,WAAK,0BAA0B,KAAK,QAAQ;AAG5C,WAAK,oBAAqB;AAC1B,8BAAwB,IAAI;AAG5B,YAAM,KAAK,qBAAsB;AACjC,cAAQ,IAAI,yCAAyC;AAGrD,WAAK,oBAAqB;AAG1B,WAAK,cAAc;AACnB,UAAI,OAAO,WAAW,KAAK,YAAY,QAAQ,IAAI,KAAK,QAAQ,GAAG;AACjE,cAAM,iBAAiB,QAAQ,IAAI,KAAK,QAAQ;AAChD,YAAI,eAAe,aAAa;AAC9B,eAAK,cAAc;AAAA,QAC7B,OAAe;AACL,yBAAe,GAAG,QAAQ,MAAM;AAC9B,iBAAK,cAAc;AACnB,iBAAK,gBAAiB;AAAA,UAClC,CAAW;AAAA,QACX;AAAA,MACA,OAAa;AAEL,aAAK,cAAc;AAAA,MAC3B;AAGM,UAAI,KAAK,aAAa;AACpB,aAAK,gBAAiB;AAAA,MAC9B;AAGM,iBAAW,MAAM;AACf,gBAAQ,IAAI,yDAAyD;AACrE,aAAK,WAAY;AAGjB,cAAM,eAAe,KAAK,WAAW,cAAc,gBAAgB;AACnE,YAAI,cAAc;AAChB,kBAAQ,IAAI,2CAA2C,YAAY;AAAA,QAC7E,OAAe;AACL,kBAAQ;AAAA,YACN;AAAA,UACD;AAAA,QACX;AAAA,MACO,GAAE,GAAG;AAEN,cAAQ,IAAI,8CAA8C;AAAA,IAC3D,SAAQ,OAAO;AACd,cAAQ,MAAM,kDAAkD,KAAK;AAGrE,UAAI;AACF,YAAI,KAAK,qBAAqB;AAC5B,eAAK,oBAAoB;AAAA,YACvB,yBAAyB,MAAM,OAAO;AAAA,UACvC;AAAA,QACX,OAAe;AAEL,cAAI,KAAK,YAAY;AACnB,kBAAM,eAAe,SAAS,cAAc,KAAK;AACjD,yBAAa,MAAM,QAAQ;AAC3B,yBAAa,MAAM,UAAU;AAC7B,yBAAa,MAAM,SAAS;AAC5B,yBAAa,MAAM,SAAS;AAC5B,yBAAa,cAAc,iCAAiC,MAAM,OAAO;AACzE,iBAAK,WAAW,YAAY,YAAY;AAAA,UACpD;AAAA,QACA;AAAA,MACO,SAAQ,YAAY;AACnB,gBAAQ;AAAA,UACN;AAAA,UACA;AAAA,QACD;AAAA,MACT;AAAA,IACA;AAAA,EACA;AAAA;AAAA,EAGE,yBAAyB,MAAM,UAAU,UAAU;AACjD,YAAQ;AAAA,MACN;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,IACD;AACD,QAAI,aAAa,SAAU;AAE3B,YAAQ,MAAI;AAAA,MACV,KAAK;AACH,YAAI,KAAK,WAAW;AAClB,eAAK,UAAU,UAAU,QAAQ;AAAA,QAC3C,WAAmB,CAAC,KAAK,eAAe;AAC9B,eAAK,qBAAsB;AAAA,QACrC;AACQ;AAAA,MACF,KAAK;AACH,aAAK,0BAA0B,QAAQ;AACvC;AAAA,MACF,KAAK;AAEH,mBAAW,MAAM,KAAK,gBAAe,GAAI,GAAG;AAC5C;AAAA,MACF,KAAK;AAAA,MACL,KAAK;AAAA,MACL,KAAK;AACH,YAAI,KAAK,iBAAiB,KAAK,WAAW;AACxC,eAAK,UAAU,aAAa;AAAA,YAC1B,UAAU,KAAK;AAAA,YACf,OAAO,KAAK;AAAA,YACZ,eAAe,KAAK;AAAA,UAChC,CAAW;AAAA,QACX;AACQ;AAAA,MACF,KAAK;AACH,YAAI,KAAK,eAAe;AACtB,gBAAM,gBACJ,KAAK,WAAW,cAAc,iBAAiB;AACjD,cAAI,eAAe;AACjB,0BAAc,aAAa,aAAa,YAAY,EAAE;AAAA,UAClE;AAAA,QACA;AACQ;AAAA,IACR;AAAA,EACA;AAAA;AAAA,EAGE,sBAAsB;AACpB,QAAI,CAAC,KAAK,UAAU;AAClB,cAAQ,KAAK,wCAAwC;AACrD;AAAA,IACN;AAEI,UAAM,gBAAgB,SAAS,eAAe,KAAK,QAAQ;AAC3D,QAAI,CAAC,eAAe;AAClB,cAAQ;AAAA,QACN,4CAA4C,KAAK,QAAQ;AAAA,MAC1D;AAED,UAAI,KAAK,qBAAqB;AAC5B,aAAK,oBAAoB;AAAA,UACvB,mBAAmB,KAAK,QAAQ;AAAA,QACjC;AAAA,MACT;AACM;AAAA,IACN;AAGI,UAAM,qBAAqB,MAAM;AAE/B,UAAI,KAAK,eAAe;AACtB,aAAK,gBAAiB;AAGtB,aAAK,mBAAoB;AAAA,MACjC;AAAA,IACK;AAGD,QAAI,KAAK,uBAAuB;AAC9B,oBAAc,oBAAoB,SAAS,KAAK,qBAAqB;AACrE,oBAAc,oBAAoB,UAAU,KAAK,qBAAqB;AAAA,IAC5E;AAGI,SAAK,wBAAwB;AAG7B,kBAAc,iBAAiB,SAAS,KAAK,qBAAqB;AAClE,kBAAc,iBAAiB,UAAU,KAAK,qBAAqB;AAEnE,YAAQ;AAAA,MACN,gDAAgD,KAAK,QAAQ;AAAA,IAC9D;AAAA,EACL;AAAA;AAAA,EAGE,0BAA0B,UAAU;AAClC,YAAQ,IAAI,oDAAoD,QAAQ;AAExE,QAAI,CAAC,KAAK,YAAY;AACpB,cAAQ,KAAK,8CAA8C;AAC3D;AAAA,IACN;AAGI,UAAM,eAAe,KAAK,WAAW,cAAc,qBAAqB;AACxE,UAAM,aAAa,KAAK,WAAW,cAAc,kBAAkB;AAEnE,QAAI,cAAc;AAChB,mBAAa,cACX,KAAK,aAAa,gBAAgB;AACpC,cAAQ;AAAA,QACN;AAAA,QACA,aAAa;AAAA,MACd;AAAA,IACP;AAEI,QAAI,YAAY;AACd,iBAAW,cAAc,KAAK,aAAa,cAAc;AACzD,cAAQ;AAAA,QACN;AAAA,QACA,WAAW;AAAA,MACZ;AAAA,IACP;AAGI,QAAI,KAAK,qBAAqB;AAC5B,YAAM,UAAU,KAAK,WAAW,cAAc,gBAAgB;AAC9D,UAAI,SAAS;AACX,gBAAQ,oBAAoB,SAAS,KAAK,mBAAmB;AAC7D,gBAAQ,iBAAiB,SAAS,KAAK,mBAAmB;AAAA,MAClE;AAAA,IACA;AAGI,UAAM,aAAa,KAAK,WAAW,iBAAiB,YAAY;AAChE,YAAQ;AAAA,MACN;AAAA,MACA,WAAW;AAAA,IACZ;AAED,eAAW,QAAQ,CAAC,cAAc;AAChC,YAAM,UAAU,UAAU,aAAa,UAAU;AACjD,gBAAU,aAAa,YAAY,QAAQ;AAC3C,cAAQ,IAAI,gDAAgD;AAAA,QAC1D,WAAW,UAAU;AAAA,QACrB,MAAM;AAAA,QACN,IAAI;AAAA,MACZ,CAAO;AAAA,IACP,CAAK;AAGD,UAAM,UAAU,KAAK,WAAW,cAAc,YAAY;AAC1D,UAAM,gBAAgB,KAAK,WAAW,cAAc,iBAAiB;AACrE,UAAM,kBAAkB,KAAK,WAAW,cAAc,kBAAkB;AAExE,KAAC,SAAS,eAAe,eAAe,EAAE,QAAQ,CAAC,cAAc;AAC/D,UAAI,WAAW;AACb,kBAAU,aAAa,YAAY,QAAQ;AAC3C,gBAAQ;AAAA,UACN;AAAA,UACA,UAAU;AAAA,QACX;AAAA,MACT;AAAA,IACA,CAAK;AAAA,EACL;AAAA;AAAA,EAGE,sBAAsB;AhCjdxB;AgCkdI,YAAQ,IAAI,6DAA6D;AAEzE,QAAI,CAAC,KAAK,YAAY;AACpB,cAAQ,MAAM,4CAA4C;AAC1D;AAAA,IACN;AAEI,UAAM,QAAQ,KAAK,WAAW,cAAc,QAAQ;AACpD,QAAI,CAAC,OAAO;AACV,cAAQ,MAAM,wDAAwD;AAGtE,UAAI,KAAK,qBAAqB;AAC5B,aAAK,oBAAoB;AAAA,UACvB;AAAA,QACD;AAAA,MACT;AAEM,UAAI,KAAK,qBAAqB;AAC5B,cAAM,WAAW,KAAK,WAAW,cAAc,QAAQ;AACvD,YAAI,UAAU;AACZ,kBAAQ;AAAA,QAClB,OAAe;AACL,cAAI,KAAK,qBAAqB;AAC5B,iBAAK,oBAAoB,MAAM,0BAA0B;AAAA,UACrE;AACU;AAAA,QACV;AAAA,MACA,OAAa;AACL;AAAA,MACR;AAAA,IACA;AAGI,YAAQ,IAAI,sDAAsD;AAAA,MAChE,aAAa,KAAK;AAAA,MAClB,OAAO,KAAK;AAAA,MACZ,UAAU,KAAK;AAAA,MACf,WACE,UAAK,YAAL,mBAAc,UAAU,GAAG,UAC1B,UAAK,YAAL,mBAAc,UAAS,KAAK,QAAQ;AAAA,MACvC,UAAU,KAAK;AAAA,MACf,YAAY,KAAK,cAAc,SAAQ,UAAK,mBAAL,mBAAqB,MAAM,IAAI;AAAA,MACtE,YAAY,SAAQ,UAAK,YAAL,mBAAc,MAAM;AAAA,MACxC,aAAa,KAAK;AAAA,IACxB,CAAK;AAED,UAAM,UAAU,IAAI,MAAM;AAG1B,eAAW,MAAM;AACf,WAAK,mBAAoB;AACzB,WAAK,gBAAiB;AAGtB,YAAM,iBAAiB,MAAM;AAAA,QAC3B;AAAA,MACD;AACD,UAAI,gBAAgB;AAClB,uBAAe,MAAO;AAAA,MAC9B;AAAA,IACK,GAAE,GAAG;AAAA,EACV;AAAA;AAAA,EAGE,YAAY;AACV,UAAM,QAAQ,KAAK,WAAW,cAAc,QAAQ;AACpD,QAAI,OAAO;AACT,YAAM,UAAU,IAAI,MAAM;AAG1B,iBAAW,MAAM;AACf,aAAK,mBAAoB;AACzB,aAAK,gBAAiB;AAGtB,cAAM,iBAAiB,MAAM;AAAA,UAC3B;AAAA,QACD;AACD,YAAI,gBAAgB;AAClB,yBAAe,MAAO;AAAA,QAChC;AAAA,MACO,GAAE,GAAG;AAAA,IACZ;AAAA,EACA;AAAA;AAAA,EAGE,oBAAoB;AAElB,QAAI,CAAC,KAAK,YAAY;AACpB,cAAQ,MAAM,0DAA0D;AACxE,aAAO;AAAA,IACb;AAEI,QAAI,QAAQ,KAAK,WAAW,cAAc,QAAQ;AAClD,QAAI,CAAC,OAAO;AACV,cAAQ,KAAK,0DAA0D;AAGvE,YAAM,WAAW,eAAe,IAAI;AACpC,YAAM,WAAW,SACd,YAAW,EACX,yBAAyB,QAAQ;AACpC,YAAM,WAAW,SAAS,cAAc,QAAQ;AAEhD,UAAI,UAAU;AACZ,aAAK,WAAW,YAAY,QAAQ;AACpC,gBAAQ,IAAI,+CAA+C;AAG3D,cAAM,cAAc,SAAS,cAAc,eAAe;AAC1D,YAAI,aAAa;AACf,sBAAY,UAAU,MAAM,SAAS,UAAU,OAAO,MAAM;AAAA,QACtE;AAEQ,iBAAS,UAAU,CAAC,MAAM;AACxB,cAAI,EAAE,WAAW,UAAU;AACzB,qBAAS,UAAU,OAAO,MAAM;AAAA,UAC5C;AAAA,QACS;AAED,gBAAQ;AAAA,MAChB,OAAa;AACL,gBAAQ,MAAM,2CAA2C;AACzD,eAAO;AAAA,MACf;AAAA,IACA;AAEI,WAAO;AAAA,EACX;AAAA;AAAA,EAGE,sBAAsB;AAEpB,UAAM,gBAAgB,KAAK,WAAW,cAAc,iBAAiB;AACrE,QAAI,eAAe;AAEjB,oBAAc,oBAAoB,eAAe,KAAK,iBAAiB;AAEvE,oBAAc,iBAAiB,eAAe,KAAK,iBAAiB;AACpE,cAAQ,IAAI,qDAAqD;AAAA,IACvE,OAAW;AACL,cAAQ,KAAK,2CAA2C;AAAA,IAC9D;AAGI,SAAK,kBAAkB,KAAK,WAAW,cAAc,kBAAkB;AACvE,QAAI,KAAK,iBAAiB;AAExB,UAAI,KAAK,iBAAiB;AACxB,aAAK,gBAAgB,kBAAkB,KAAK;AAAA,MACpD;AAGM,WAAK,gBAAgB;AAAA,QACnB;AAAA,QACA,KAAK;AAAA,MACN;AACD,WAAK,gBAAgB;AAAA,QACnB;AAAA,QACA,KAAK;AAAA,MACN;AACD,WAAK,gBAAgB;AAAA,QACnB;AAAA,QACA,KAAK;AAAA,MACN;AACD,WAAK,gBAAgB;AAAA,QACnB;AAAA,QACA,KAAK;AAAA,MACN;AACD,WAAK,gBAAgB;AAAA,QACnB;AAAA,QACA,KAAK;AAAA,MACN;AAED,cAAQ,IAAI,iDAAiD;AAAA,IACnE,OAAW;AACL,cAAQ,KAAK,uDAAuD;AAAA,IAC1E;AAGI,SAAK,iBAAiB,wBAAwB,CAAC,UAAU;AACvD,cAAQ,IAAI,2CAA2C,MAAM,MAAM;AACnE,UAAI,KAAK,eAAe;AACtB,aAAK,qBAAoB,EAAG,MAAM,CAAC,UAAU;AAC3C,kBAAQ,MAAM,oCAAoC,KAAK;AACvD,cAAI,KAAK,qBAAqB;AAC5B,iBAAK,oBAAoB;AAAA,cACvB,mCAAmC,MAAM,OAAO;AAAA,YACjD;AAAA,UACb;AAAA,QACA,CAAS;AAAA,MACT;AAAA,IACA,CAAK;AAGD,SAAK,WAAY;AAAA,EACrB;AAAA;AAAA,EAGE,aAAa;AAEX,QAAI,CAAC,KAAK,YAAY;AACpB,cAAQ,MAAM,wDAAwD;AACtE;AAAA,IACN;AAGI,UAAM,QAAQ,KAAK,WAAW,cAAc,QAAQ;AACpD,UAAM,eAAe,KAAK,WAAW,cAAc,gBAAgB;AAEnE,QAAI,cAAc;AAEhB,UAAI,CAAC,KAAK,qBAAqB;AAC7B,aAAK,sBAAsB,KAAK,oBAAoB,KAAK,IAAI;AAAA,MACrE;AAGM,mBAAa,oBAAoB,SAAS,KAAK,mBAAmB;AAClE,mBAAa,iBAAiB,SAAS,KAAK,mBAAmB;AAC/D,cAAQ,IAAI,4CAA4C;AAAA,IAC9D,OAAW;AACL,cAAQ,KAAK,wDAAwD;AAAA,IAC3E;AAGI,QAAI,OAAO;AAET,YAAM,UAAU,CAAC,MAAM;AACrB,YAAI,EAAE,WAAW,OAAO;AACtB,gBAAM,UAAU,OAAO,MAAM;AAAA,QACvC;AAAA,MACO;AAGD,YAAM,cAAc,MAAM,cAAc,eAAe;AACvD,UAAI,aAAa;AACf,oBAAY,UAAU,MAAM,MAAM,UAAU,OAAO,MAAM;AACzD,gBAAQ,IAAI,2CAA2C;AAAA,MAC/D,OAAa;AACL,gBAAQ,KAAK,kDAAkD;AAAA,MACvE;AAAA,IACA,OAAW;AACL,cAAQ,KAAK,wDAAwD;AAAA,IAC3E;AAGI,UAAM,UAAU,KAAK,WAAW,cAAc,YAAY;AAC1D,QAAI,SAAS;AAEX,cAAQ,oBAAoB,cAAc,KAAK,gBAAgB;AAC/D,cAAQ,iBAAiB,cAAc,KAAK,gBAAgB;AAC5D,cAAQ,IAAI,uCAAuC;AAAA,IACzD,OAAW;AACL,cAAQ,KAAK,kDAAkD;AAAA,IACrE;AAGI,UAAM,gBAAgB,KAAK,WAAW,cAAc,iBAAiB;AACrE,QAAI,eAAe;AAEjB,oBAAc,oBAAoB,eAAe,KAAK,iBAAiB;AACvE,oBAAc,iBAAiB,eAAe,KAAK,iBAAiB;AACpE,cAAQ,IAAI,8CAA8C;AAAA,IAChE;AAGI,QAAI,KAAK,iBAAiB;AAExB,WAAK,gBAAgB;AAAA,QACnB;AAAA,QACA,KAAK;AAAA,MACN;AACD,WAAK,gBAAgB;AAAA,QACnB;AAAA,QACA,KAAK;AAAA,MACN;AACD,WAAK,gBAAgB;AAAA,QACnB;AAAA,QACA,KAAK;AAAA,MACN;AACD,WAAK,gBAAgB;AAAA,QACnB;AAAA,QACA,KAAK;AAAA,MACN;AACD,WAAK,gBAAgB;AAAA,QACnB;AAAA,QACA,KAAK;AAAA,MACN;AAGD,WAAK,gBAAgB;AAAA,QACnB;AAAA,QACA,KAAK;AAAA,MACN;AACD,WAAK,gBAAgB;AAAA,QACnB;AAAA,QACA,KAAK;AAAA,MACN;AACD,WAAK,gBAAgB;AAAA,QACnB;AAAA,QACA,KAAK;AAAA,MACN;AACD,WAAK,gBAAgB;AAAA,QACnB;AAAA,QACA,KAAK;AAAA,MACN;AACD,WAAK,gBAAgB;AAAA,QACnB;AAAA,QACA,KAAK;AAAA,MACN;AACD,cAAQ,IAAI,gDAAgD;AAAA,IAClE;AAGI,SAAK,oBAAqB;AAE1B,YAAQ,IAAI,gDAAgD;AAAA,EAChE;AAAA,EAEE,wBAAwB,gBAAgB;AAEtC,QAAI,KAAK,iBAAiB;AACxB,WAAK,gBAAgB,iBAAiB,eAAe,CAAC,UAAU;AAC9D,YAAI;AACF,gBAAM,EAAE,WAAU,IAAK,MAAM,UAAU,CAAE;AACzC,cAAI,CAAC,WAAY;AAGjB,gBAAM,WAAW,KAAK,gBAAgB,YAAY,UAAU;AAC5D,cAAI,YAAY,SAAS,SAAS;AAEhC,gBAAI,kBAAkB,eAAe,aAAa;AAChD,6BAAe,WAAW,SAAS,OAAO;AAC1C,6BAAe,YAAY,IAAK;AAGhC,yBAAW,MAAM;AACf,sBAAM,QAAQ,KAAK,WAAW,cAAc,QAAQ;AACpD,oBAAI,OAAO;AACT,wBAAM,UAAU,OAAO,MAAM;AAAA,gBAC/C;AAAA,cACe,GAAE,GAAG;AAAA,YACpB;AAAA,UACA;AAAA,QACS,SAAQ,OAAO;AACd,kBAAQ;AAAA,YACN;AAAA,YACA;AAAA,UACD;AAAA,QACX;AAAA,MACA,CAAO;AAAA,IACP;AAAA,EACA;AAAA;AAAA,EAGE,MAAM,uBAAuB;AAC3B,QAAI,KAAK,eAAe;AACtB,cAAQ,IAAI,2DAA2D;AACvE;AAAA,IACN;AAEI,QAAI,KAAK,eAAe,aAAa,OAAO,SAAS;AACnD,UAAI;AACF,cAAM,kBAAkB,OAAO,QAAQ,IAAI,KAAK,QAAQ;AACxD,YAAI,iBAAiB;AACnB,kBAAQ;AAAA,YACN;AAAA,UACD;AAGD,eAAK,wBAAwB,eAAe;AAAA,QACtD;AAAA,MACO,SAAQ,OAAO;AACd,gBAAQ;AAAA,UACN;AAAA,UACA;AAAA,QACD;AAAA,MACT;AAAA,IACA;AAEI,QAAI;AACF,cAAQ,IAAI,6CAA6C;AAGzD,YAAM,KAAK,gBAAgB,WAAY;AACvC,cAAQ,IAAI,+CAA+C;AAG3D,YAAM,gBACJ,KAAK,iBAAiB;AAGxB,WAAK,YAAY,gBAAgB;AAAA,QAC/B,UAAU,KAAK;AAAA,QACf,OAAO,KAAK;AAAA,QACZ,cAAc,KAAK;AAAA,QACnB,aAAa;AAAA,QACb;AAAA,QACA,UAAU,KAAK,aAAa,WAAW,KAAK;AAAA,QAC5C,QAAQ,KAAK,aAAa,SAAS,KAAK;AAAA,QACxC,aAAa,KAAK;AAAA;AAAA,QAClB,WAAW;AAAA,MACnB,CAAO;AAED,cAAQ;AAAA,QACN;AAAA,QACA,KAAK;AAAA,MACN;AAGD,UAAI,KAAK,UAAU;AAEjB,aAAK,gBAAgB,IAAI,cAAc,KAAK,UAAU,KAAK,UAAU;AACrE,gBAAQ;AAAA,UACN;AAAA,UACA,KAAK;AAAA,UACL;AAAA,UACA,KAAK;AAAA,QACN;AAAA,MACT,OAAa;AACL,gBAAQ;AAAA,UACN;AAAA,QACD;AAAA,MACT;AAGM,YAAM,kBAAkB,KAAK,WAAW,cAAc,kBAAkB;AACxE,UAAI,iBAAiB;AACnB,wBAAgB,kBAAkB,KAAK;AACvC,gBAAQ;AAAA,UACN;AAAA,QACD;AAAA,MACT;AAGM,WAAK,gBAAgB;AAGrB,UAAI,KAAK,qBAAqB;AAC5B,aAAK,oBAAoB;AAAA,UACvB;AAAA,QACD;AAAA,MACT;AAGM,WAAK,mBAAoB;AAEzB,aAAO;AAAA,IACR,SAAQ,OAAO;AACd,cAAQ,MAAM,kCAAkC,KAAK;AAGrD,UAAI,KAAK,qBAAqB;AAC5B,aAAK,oBAAoB;AAAA,UACvB,yBAAyB,MAAM,OAAO;AAAA,QACvC;AAAA,MACT;AAEM,WAAK;AAAA,QACH;AAAA,QACA,yBAAyB,MAAM,OAAO;AAAA,MACvC;AAED,YAAM;AAAA,IACZ;AAAA,EACA;AAAA,EAEE,cAAc;AhCt6BhB;AgCu6BI,UAAM,SAAQ,UAAK,eAAL,mBAAiB,cAAc;AAC7C,WAAO,QAAQ,MAAM,UAAU,SAAS,MAAM,IAAI;AAAA,EACtD;AAAA;AAAA,EAGE,qBAAqB;AhC56BvB;AgC66BI,QAAI;AAEF,UAAI,UAAU;AAGd,UACE,KAAK,iBACL,OAAO,KAAK,cAAc,eAAe,YACzC;AACA,YAAI;AACF,gBAAM,aAAa,KAAK,cAAc,WAAY;AAClD,oBAAU,OAAO,eAAe,WAAW,aAAa;AAAA,QACzD,SAAQ,OAAO;AACd,kBAAQ;AAAA,YACN;AAAA,YACA;AAAA,UACD;AAAA,QACX;AAAA,MACA;AAGM,YAAM,aAAa,QAAQ,KAAM,EAAC,SAAS;AAG3C,YAAM,WAAU,UAAK,eAAL,mBAAiB,cAAc;AAC/C,UAAI,SAAS;AACX,gBAAQ,aAAa,eAAe,WAAW,SAAQ,CAAE;AAAA,MACjE;AAAA,IACK,SAAQ,OAAO;AACd,cAAQ,KAAK,iDAAiD,KAAK;AAAA,IAEzE;AAAA,EACA;AAAA;AAAA,EAGE,IAAI,iBAAiB;AACnB,QAAI;AAEF,UACE,KAAK,iBACL,OAAO,KAAK,cAAc,eAAe,YACzC;AACA,cAAM,UAAU,KAAK,cAAc,WAAY;AAC/C,YAAI,OAAO,YAAY,UAAU;AAC/B,iBAAO;AAAA,QACjB;AAEQ,YAAI,WAAW,OAAO,QAAQ,SAAS,YAAY;AACjD,kBAAQ,KAAK,oHAAoH;AACjI,iBAAO;AAAA,QACjB;AACQ,gBAAQ,KAAK,qEAAqE,OAAO;AACzF,eAAO;AAAA,MACf;AAGM,UAAI,OAAO,WAAW,KAAK,YAAY,QAAQ,IAAI,KAAK,QAAQ,GAAG;AACjE,cAAM,iBAAiB,QAAQ,IAAI,KAAK,QAAQ;AAChD,YAAI,kBAAkB,OAAO,eAAe,eAAe,YAAY;AACrE,gBAAM,UAAU,eAAe,WAAY;AAC3C,cAAI,OAAO,YAAY,UAAU;AAC/B,mBAAO;AAAA,UACnB,OAAiB;AACL,oBAAQ,KAAK,+DAA+D,OAAO;AACnF,mBAAO;AAAA,UACnB;AAAA,QACA,OAAe;AACL,kBAAQ,KAAK,6DAA6D,KAAK,QAAQ;AACvF,iBAAO;AAAA,QACjB;AAAA,MACA;AAEM,aAAO;AAAA,IACR,SAAQ,OAAO;AACd,cAAQ,KAAK,oDAAoD,KAAK;AACtE,aAAO;AAAA,IACb;AAAA,EACA;AAAA;AAAA;AAAA;AAAA;AAAA,EAME,MAAM,kBAAkB,OAAO;AAC7B,UAAM,EAAE,SAAS,MAAO,IAAG,MAAM;AAEjC,QAAI;AAEF,UAAI,EAAC,mCAAS,WAAU,CAAC,OAAO;AAC9B,cAAM,IAAI,MAAM,yBAAyB;AAAA,MACjD;AAGM,YAAM,mBAAmB;AAAA,QACvB,IAAI,KAAK,IAAK;AAAA,QACd,QAAQ;AAAA,QACR,SAAS,KAAK,KAAK,aAAa,KAAK,QAAQ,OAAO,OAAO;AAAA,QAC3D,WAAW,oBAAI,KAAM;AAAA,QACrB;AAAA,MACD;AACD,WAAK,gBAAgB,YAAY,gBAAgB;AAGjD,YAAM,aAAa,KAAK,IAAG,IAAK;AAGhC,WAAK,gBAAgB,YAAY;AAAA,QAC/B,IAAI;AAAA,QACJ,QAAQ;AAAA,QACR,SAAS;AAAA;AAAA,QACT,WAAW,oBAAI,KAAM;AAAA,MAC7B,CAAO;AAGD,YAAM,aAAa,CAAC,UAAU;AAC5B,aAAK,gBAAgB;AAAA,UACnB;AAAA,UACA,CAAC,gBAAgB,cAAc;AAAA,QAChC;AAAA,MACF;AAGD,UAAI,iBAAiB;AAIrB,UAAI,OAAO,UAAU,YAAY,CAAC,MAAM,WAAW,OAAO,GAAG;AAC3D,gBAAQ,IAAI,8CAA8C,KAAK;AAAA,MAEvE,WAEe,iBAAiB,MAAM;AAC9B,gBAAQ,IAAI,sCAAsC,MAAM,IAAI;AAAA,MACpE;AAIM,YAAM,KAAK,UAAU;AAAA,QACnB,KAAK;AAAA,QACL,QAAQ,KAAM;AAAA,QACd;AAAA,QACA;AAAA,MACD;AAGD,iBAAW,MAAM;AACf,cAAM,oBAAoB,KAAK,WAAW;AAAA,UACxC;AAAA,QACD;AACD,YAAI,mBAAmB;AACrB,4BAAkB,YAAY,kBAAkB;AAAA,QAC1D;AAAA,MACO,GAAE,GAAG;AAGN,UAAI,KAAK,qBAAqB;AAC5B,aAAK,oBAAoB,QAAQ,qBAAqB,GAAI;AAAA,MAClE;AAAA,IACK,SAAQ,OAAO;AACd,cAAQ,MAAM,eAAe,KAAK;AAClC,YAAM,eAAe,KAAK,mBAAmB,KAAK;AAClD,WAAK,qBAAqB,cAAc,YAAY;AAGpD,UAAI,KAAK,qBAAqB;AAC5B,aAAK,oBAAoB,MAAM,eAAe,MAAM,OAAO,EAAE;AAAA,MACrE;AAAA,IACA;AAAA,EACA;AAAA;AAAA,EAEE,cAAc,OAAO,MAAM;AAEzB,QACE,KAAK,gBACL,OAAO,KAAK,aAAa,kBAAkB,YAC3C;AACA,aAAO,KAAK,aAAa,cAAc,IAAI;AAAA,IACjD,OAAW;AACL,cAAQ;AAAA,QACN;AAAA,MACD;AACD,aAAO;AAAA,IACb;AAAA,EACA;AAAA;AAAA;AAAA;AAAA;AAAA,EAME,kBAAkB;AhC1mCpB;AgC2mCI,QAAI,CAAC,KAAK,WAAY;AAEtB,UAAM,gBAAgB,KAAK,WAAW,cAAc,iBAAiB;AACrE,QAAI,CAAC,cAAe;AAGpB,QAAI,KAAK,aAAa,iBAAiB,GAAG;AACxC,oBAAc,aAAa,mBAAmB,KAAK,aAAa,iBAAiB,CAAC;AAAA,IACxF,OAAW;AACL,oBAAc,gBAAgB,iBAAiB;AAAA,IACrD;AAGI,QAAI,gBAAgB;AACpB,QAAI,KAAK,aAAa;AACpB,wBAAgB,UAAK,mBAAL,mBAAqB,WAAU;AAAA,IACrD;AAGI,YAAQ,IAAI,wCAAwC;AAAA,MAClD;AAAA,MACA,iBAAe,UAAK,YAAL,mBAAc,WAAU;AAAA,MACvC,gBAAgB,cAAc,aAAa,iBAAiB;AAAA,MAC5D,aAAa,KAAK;AAAA,IACxB,CAAK;AAAA,EACL;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAUE,MAAM,iBAAiB,OAAO;AhC9oChC;AgCgpCI,UAAM,SAAS,MAAM,UAAU,CAAE;AACjC,UAAM,SAAS,OAAO;AACtB,UAAM,aAAa,OAAO;AAC1B,UAAM,UAAU,OAAO;AAEvB,YAAQ,IAAI,0CAA0C;AAAA,MACpD;AAAA,MACA;AAAA,MACA,eAAe,UAAU,QAAQ,SAAS;AAAA,IAChD,CAAK;AAED,QAAI,CAAC,QAAQ;AACX,cAAQ,MAAM,uDAAuD;AACrE,UAAI,KAAK,qBAAqB;AAC5B,aAAK,oBAAoB,MAAM,wBAAwB;AAAA,MAC/D;AACM;AAAA,IACN;AAEI,QAAI,eAAe;AACnB,QAAI;AAEF,YAAM,gBAAgB,WAAW,KAAK;AAGtC,YAAM,kBAAiB,UAAK,iBAAL,mBAAmB,IAAI,QAAQ;AACtD,UAAI,gBAAgB;AAClB,gBAAQ,IAAI,8CAA8C,MAAM;AAChE,aAAK,qBAAqB,QAAQ,cAAc;AAChD;AAAA,MACR;AAGM,qBAAe;AAAA,QACb,IAAI,KAAK,IAAK;AAAA,QACd;AAAA,QACA,SAAS;AAAA;AAAA,QACT,WAAW,oBAAI,KAAM;AAAA,MACtB;AAGD,UAAI,KAAK,iBAAiB;AACxB,aAAK,gBAAgB,YAAY,YAAY;AAAA,MACrD,OAAa;AACL,gBAAQ,MAAM,iDAAiD;AAC/D;AAAA,MACR;AAGM,UAAI,CAAC,KAAK,aAAa,CAAC,KAAK,eAAe;AAC1C,gBAAQ;AAAA,UACN;AAAA,QACD;AACD,cAAM,KAAK,qBAAsB;AAAA,MACzC;AAGM,YAAM,aAAa,CAAC,UAAU;AAC5B,YAAI,SAAS,KAAK,iBAAiB;AACjC,eAAK,gBAAgB;AAAA,YACnB,aAAa;AAAA,YACb,CAAC,gBAAgB,cAAc;AAAA,UAChC;AAAA,QACX;AAAA,MACO;AAED,UAAI;AAEF,gBAAQ,IAAI,mDAAmD,MAAM;AAGrE,YAAI,CAAC,eAAe;AAClB,kBAAQ;AAAA,YACN;AAAA,YACA;AAAA,UACD;AAAA,QACX;AAEQ,cAAM,eAAe,MAAM,KAAK,UAAU;AAAA,UACxC;AAAA,UACA;AAAA,UACA;AAAA;AAAA,UACA,KAAK;AAAA,UACL;AAAA,QACD;AAGD,YAAI,KAAK,cAAc;AACrB,eAAK,aAAa,IAAI,QAAQ,eAAe,YAAY;AAAA,QACnE;AAGQ,aAAK,gBAAiB;AAGtB,YAAI,KAAK,qBAAqB;AAC5B,gBAAM,eAAa,gBAAK,iBAAL,mBAAmB,UAAnB,mBAA2B,YAAW;AACzD,eAAK,oBAAoB;AAAA,YACvB,QAAQ,UAAU;AAAA,YAClB;AAAA,UACD;AAAA,QACX;AAAA,MACO,SAAQ,OAAO;AACd,gBAAQ,MAAM,uCAAuC,KAAK;AAG1D,YAAI,gBAAgB,KAAK,iBAAiB;AACxC,eAAK,gBAAgB,eAAe,aAAa,EAAE;AAAA,QAC7D;AAGQ,aAAK,qBAAqB,SAAS,KAAK,mBAAmB,KAAK,CAAC;AAGjE,YAAI,KAAK,qBAAqB;AAC5B,eAAK,oBAAoB,MAAM,UAAU,MAAM,OAAO,EAAE;AAAA,QAClE;AAAA,MACA;AAAA,IACK,SAAQ,OAAO;AACd,cAAQ,MAAM,+CAA+C,KAAK;AAGlE,UAAI,gBAAgB,KAAK,iBAAiB;AACxC,aAAK,gBAAgB,eAAe,aAAa,EAAE;AAAA,MAC3D;AAGM,WAAK,qBAAqB,SAAS,UAAU,MAAM,OAAO,EAAE;AAG5D,UAAI,KAAK,qBAAqB;AAC5B,aAAK,oBAAoB,MAAM,UAAU,MAAM,OAAO,EAAE;AAAA,MAChE;AAAA,IACA;AAAA,EACA;AAAA;AAAA;AAAA;AAAA;AAAA,EAME,qBAAqB,QAAQ,SAAS;AACpC,QAAI,CAAC,KAAK,iBAAiB;AACzB,cAAQ,MAAM,gDAAgD;AAC9D;AAAA,IACN;AAEI,UAAM,WAAW;AAAA,MACf,IAAI,KAAK,IAAK;AAAA,MACd;AAAA,MACA,SAAS,WAAW;AAAA,MACpB,WAAW,oBAAI,KAAM;AAAA,IACtB;AAED,SAAK,gBAAgB,YAAY,QAAQ;AACzC,WAAO;AAAA,EACX;AAAA;AAAA;AAAA;AAAA;AAAA,EAME,mBAAmB,OAAO;AACxB,QAAI,CAAC,MAAO,QAAO;AAGnB,QAAI,UAAU,MAAM,WAAW,MAAM,SAAU;AAE/C,QAAI,MAAM,eAAe;AACvB,iBAAW;AAAA,EACT,MAAM,cAAc,WAAW,MAAM,cAAc,SAAQ,CACnE;AAAA,IACA;AAEI,WAAO;AAAA,EACX;AACA;AAGA,eAAe,OAAO,oBAAoB,cAAc;"}